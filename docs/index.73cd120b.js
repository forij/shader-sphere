function t(t,e,i,s){Object.defineProperty(t,e,{get:i,set:s,enumerable:!0,configurable:!0})}function e(t){return t&&t.__esModule?t.default:t}var i="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},s={},n={},r=i.parcelRequire3fb0;null==r&&((r=function(t){if(t in s)return s[t].exports;if(t in n){var e=n[t];delete n[t];var i={id:t,exports:{}};return s[t]=i,e.call(i.exports,i,i.exports),i.exports}var r=new Error("Cannot find module '"+t+"'");throw r.code="MODULE_NOT_FOUND",r}).register=function(t,e){n[t]=e},i.parcelRequire3fb0=r),r.register("27Lyk",(function(e,i){var s,n;t(e.exports,"register",(()=>s),(t=>s=t)),t(e.exports,"resolve",(()=>n),(t=>n=t));var r={};s=function(t){for(var e=Object.keys(t),i=0;i<e.length;i++)r[e[i]]=t[e[i]]},n=function(t){var e=r[t];if(null==e)throw new Error("Could not resolve bundle with id "+t);return e}})),r("27Lyk").register(JSON.parse('{"ff4VL":"index.73cd120b.js","lisvo":"T_Noise_03.360d1654.png"}'));function o(t,e,i){let s=e[0],n=e[1],r=e[2],o=e[3],a=e[4],l=e[5],h=e[6],p=e[7],c=e[8],u=e[9],d=e[10],v=e[11],m=e[12],b=e[13],g=e[14],w=e[15],f=i[0],_=i[1],x=i[2],y=i[3];return t[0]=f*s+_*a+x*c+y*m,t[1]=f*n+_*l+x*u+y*b,t[2]=f*r+_*h+x*d+y*g,t[3]=f*o+_*p+x*v+y*w,f=i[4],_=i[5],x=i[6],y=i[7],t[4]=f*s+_*a+x*c+y*m,t[5]=f*n+_*l+x*u+y*b,t[6]=f*r+_*h+x*d+y*g,t[7]=f*o+_*p+x*v+y*w,f=i[8],_=i[9],x=i[10],y=i[11],t[8]=f*s+_*a+x*c+y*m,t[9]=f*n+_*l+x*u+y*b,t[10]=f*r+_*h+x*d+y*g,t[11]=f*o+_*p+x*v+y*w,f=i[12],_=i[13],x=i[14],y=i[15],t[12]=f*s+_*a+x*c+y*m,t[13]=f*n+_*l+x*u+y*b,t[14]=f*r+_*h+x*d+y*g,t[15]=f*o+_*p+x*v+y*w,t}function a(t,e){let i=e[0],s=e[1],n=e[2],r=e[4],o=e[5],a=e[6],l=e[8],h=e[9],p=e[10];return t[0]=Math.hypot(i,s,n),t[1]=Math.hypot(r,o,a),t[2]=Math.hypot(l,h,p),t}const l=function(){const t=[0,0,0];return function(e,i){let s=t;a(s,i);let n=1/s[0],r=1/s[1],o=1/s[2],l=i[0]*n,h=i[1]*r,p=i[2]*o,c=i[4]*n,u=i[5]*r,d=i[6]*o,v=i[8]*n,m=i[9]*r,b=i[10]*o,g=l+u+b,w=0;return g>0?(w=2*Math.sqrt(g+1),e[3]=.25*w,e[0]=(d-m)/w,e[1]=(v-p)/w,e[2]=(h-c)/w):l>u&&l>b?(w=2*Math.sqrt(1+l-u-b),e[3]=(d-m)/w,e[0]=.25*w,e[1]=(h+c)/w,e[2]=(v+p)/w):u>b?(w=2*Math.sqrt(1+u-l-b),e[3]=(v-p)/w,e[0]=(h+c)/w,e[1]=.25*w,e[2]=(d+m)/w):(w=2*Math.sqrt(1+b-l-u),e[3]=(h-c)/w,e[0]=(v+p)/w,e[1]=(d+m)/w,e[2]=.25*w),e}}();class h extends Array{constructor(t=1,e=0,i=0,s=0,n=0,r=1,o=0,a=0,l=0,h=0,p=1,c=0,u=0,d=0,v=0,m=1){return super(t,e,i,s,n,r,o,a,l,h,p,c,u,d,v,m),this}get x(){return this[12]}get y(){return this[13]}get z(){return this[14]}get w(){return this[15]}set x(t){this[12]=t}set y(t){this[13]=t}set z(t){this[14]=t}set w(t){this[15]=t}set(t,e,i,s,n,r,o,a,l,h,p,c,u,d,v,m){return t.length?this.copy(t):(function(t,e,i,s,n,r,o,a,l,h,p,c,u,d,v,m,b){t[0]=e,t[1]=i,t[2]=s,t[3]=n,t[4]=r,t[5]=o,t[6]=a,t[7]=l,t[8]=h,t[9]=p,t[10]=c,t[11]=u,t[12]=d,t[13]=v,t[14]=m,t[15]=b}(this,t,e,i,s,n,r,o,a,l,h,p,c,u,d,v,m),this)}translate(t,e=this){return function(t,e,i){let s,n,r,o,a,l,h,p,c,u,d,v,m=i[0],b=i[1],g=i[2];e===t?(t[12]=e[0]*m+e[4]*b+e[8]*g+e[12],t[13]=e[1]*m+e[5]*b+e[9]*g+e[13],t[14]=e[2]*m+e[6]*b+e[10]*g+e[14],t[15]=e[3]*m+e[7]*b+e[11]*g+e[15]):(s=e[0],n=e[1],r=e[2],o=e[3],a=e[4],l=e[5],h=e[6],p=e[7],c=e[8],u=e[9],d=e[10],v=e[11],t[0]=s,t[1]=n,t[2]=r,t[3]=o,t[4]=a,t[5]=l,t[6]=h,t[7]=p,t[8]=c,t[9]=u,t[10]=d,t[11]=v,t[12]=s*m+a*b+c*g+e[12],t[13]=n*m+l*b+u*g+e[13],t[14]=r*m+h*b+d*g+e[14],t[15]=o*m+p*b+v*g+e[15])}(this,e,t),this}rotate(t,e,i=this){return function(t,e,i,s){let n,r,o,a,l,h,p,c,u,d,v,m,b,g,w,f,_,x,y,C,P,E,k,V,M=s[0],L=s[1],S=s[2],A=Math.hypot(M,L,S);Math.abs(A)<1e-6||(A=1/A,M*=A,L*=A,S*=A,n=Math.sin(i),r=Math.cos(i),o=1-r,a=e[0],l=e[1],h=e[2],p=e[3],c=e[4],u=e[5],d=e[6],v=e[7],m=e[8],b=e[9],g=e[10],w=e[11],f=M*M*o+r,_=L*M*o+S*n,x=S*M*o-L*n,y=M*L*o-S*n,C=L*L*o+r,P=S*L*o+M*n,E=M*S*o+L*n,k=L*S*o-M*n,V=S*S*o+r,t[0]=a*f+c*_+m*x,t[1]=l*f+u*_+b*x,t[2]=h*f+d*_+g*x,t[3]=p*f+v*_+w*x,t[4]=a*y+c*C+m*P,t[5]=l*y+u*C+b*P,t[6]=h*y+d*C+g*P,t[7]=p*y+v*C+w*P,t[8]=a*E+c*k+m*V,t[9]=l*E+u*k+b*V,t[10]=h*E+d*k+g*V,t[11]=p*E+v*k+w*V,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]))}(this,i,t,e),this}scale(t,e=this){return function(t,e,i){let s=i[0],n=i[1],r=i[2];t[0]=e[0]*s,t[1]=e[1]*s,t[2]=e[2]*s,t[3]=e[3]*s,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*r,t[9]=e[9]*r,t[10]=e[10]*r,t[11]=e[11]*r,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]}(this,e,"number"==typeof t?[t,t,t]:t),this}multiply(t,e){return e?o(this,t,e):o(this,this,t),this}identity(){var t;return(t=this)[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}copy(t){var e,i;return i=t,(e=this)[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],this}fromPerspective({fov:t,aspect:e,near:i,far:s}={}){return function(t,e,i,s,n){let r=1/Math.tan(e/2),o=1/(s-n);t[0]=r/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=r,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=(n+s)*o,t[11]=-1,t[12]=0,t[13]=0,t[14]=2*n*s*o,t[15]=0}(this,t,e,i,s),this}fromOrthogonal({left:t,right:e,bottom:i,top:s,near:n,far:r}){return function(t,e,i,s,n,r,o){let a=1/(e-i),l=1/(s-n),h=1/(r-o);t[0]=-2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*l,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*h,t[11]=0,t[12]=(e+i)*a,t[13]=(n+s)*l,t[14]=(o+r)*h,t[15]=1}(this,t,e,i,s,n,r),this}fromQuaternion(t){return function(t,e){let i=e[0],s=e[1],n=e[2],r=e[3],o=i+i,a=s+s,l=n+n,h=i*o,p=s*o,c=s*a,u=n*o,d=n*a,v=n*l,m=r*o,b=r*a,g=r*l;t[0]=1-c-v,t[1]=p+g,t[2]=u-b,t[3]=0,t[4]=p-g,t[5]=1-h-v,t[6]=d+m,t[7]=0,t[8]=u+b,t[9]=d-m,t[10]=1-h-c,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1}(this,t),this}setPosition(t){return this.x=t[0],this.y=t[1],this.z=t[2],this}inverse(t=this){return function(t,e){let i=e[0],s=e[1],n=e[2],r=e[3],o=e[4],a=e[5],l=e[6],h=e[7],p=e[8],c=e[9],u=e[10],d=e[11],v=e[12],m=e[13],b=e[14],g=e[15],w=i*a-s*o,f=i*l-n*o,_=i*h-r*o,x=s*l-n*a,y=s*h-r*a,C=n*h-r*l,P=p*m-c*v,E=p*b-u*v,k=p*g-d*v,V=c*b-u*m,M=c*g-d*m,L=u*g-d*b,S=w*L-f*M+_*V+x*k-y*E+C*P;S&&(S=1/S,t[0]=(a*L-l*M+h*V)*S,t[1]=(n*M-s*L-r*V)*S,t[2]=(m*C-b*y+g*x)*S,t[3]=(u*y-c*C-d*x)*S,t[4]=(l*k-o*L-h*E)*S,t[5]=(i*L-n*k+r*E)*S,t[6]=(b*_-v*C-g*f)*S,t[7]=(p*C-u*_+d*f)*S,t[8]=(o*M-a*k+h*P)*S,t[9]=(s*k-i*M-r*P)*S,t[10]=(v*y-m*_+g*w)*S,t[11]=(c*_-p*y-d*w)*S,t[12]=(a*E-o*V-l*P)*S,t[13]=(i*V-s*E+n*P)*S,t[14]=(m*f-v*x-b*w)*S,t[15]=(p*x-c*f+u*w)*S)}(this,t),this}compose(t,e,i){return function(t,e,i,s){let n=e[0],r=e[1],o=e[2],a=e[3],l=n+n,h=r+r,p=o+o,c=n*l,u=n*h,d=n*p,v=r*h,m=r*p,b=o*p,g=a*l,w=a*h,f=a*p,_=s[0],x=s[1],y=s[2];t[0]=(1-(v+b))*_,t[1]=(u+f)*_,t[2]=(d-w)*_,t[3]=0,t[4]=(u-f)*x,t[5]=(1-(c+b))*x,t[6]=(m+g)*x,t[7]=0,t[8]=(d+w)*y,t[9]=(m-g)*y,t[10]=(1-(c+v))*y,t[11]=0,t[12]=i[0],t[13]=i[1],t[14]=i[2],t[15]=1}(this,t,e,i),this}getRotation(t){return l(t,this),this}getTranslation(t){var e,i;return i=this,(e=t)[0]=i[12],e[1]=i[13],e[2]=i[14],this}getScaling(t){return a(t,this),this}getMaxScaleOnAxis(){return function(t){let e=t[0],i=t[1],s=t[2],n=t[4],r=t[5],o=t[6],a=t[8],l=t[9],h=t[10];const p=e*e+i*i+s*s,c=n*n+r*r+o*o,u=a*a+l*l+h*h;return Math.sqrt(Math.max(p,c,u))}(this)}lookAt(t,e,i){return function(t,e,i,s){let n=e[0],r=e[1],o=e[2],a=s[0],l=s[1],h=s[2],p=n-i[0],c=r-i[1],u=o-i[2],d=p*p+c*c+u*u;0===d?u=1:(d=1/Math.sqrt(d),p*=d,c*=d,u*=d);let v=l*u-h*c,m=h*p-a*u,b=a*c-l*p;d=v*v+m*m+b*b,0===d&&(h?a+=1e-6:l?h+=1e-6:l+=1e-6,v=l*u-h*c,m=h*p-a*u,b=a*c-l*p,d=v*v+m*m+b*b),d=1/Math.sqrt(d),v*=d,m*=d,b*=d,t[0]=v,t[1]=m,t[2]=b,t[3]=0,t[4]=c*b-u*m,t[5]=u*v-p*b,t[6]=p*m-c*v,t[7]=0,t[8]=p,t[9]=c,t[10]=u,t[11]=0,t[12]=n,t[13]=r,t[14]=o,t[15]=1}(this,t,e,i),this}determinant(){return function(t){let e=t[0],i=t[1],s=t[2],n=t[3],r=t[4],o=t[5],a=t[6],l=t[7],h=t[8],p=t[9],c=t[10],u=t[11],d=t[12],v=t[13],m=t[14],b=t[15];return(e*o-i*r)*(c*b-u*m)-(e*a-s*r)*(p*b-u*v)+(e*l-n*r)*(p*m-c*v)+(i*a-s*o)*(h*b-u*d)-(i*l-n*o)*(h*m-c*d)+(s*l-n*a)*(h*v-p*d)}(this)}fromArray(t,e=0){return this[0]=t[e],this[1]=t[e+1],this[2]=t[e+2],this[3]=t[e+3],this[4]=t[e+4],this[5]=t[e+5],this[6]=t[e+6],this[7]=t[e+7],this[8]=t[e+8],this[9]=t[e+9],this[10]=t[e+10],this[11]=t[e+11],this[12]=t[e+12],this[13]=t[e+13],this[14]=t[e+14],this[15]=t[e+15],this}toArray(t=[],e=0){return t[e]=this[0],t[e+1]=this[1],t[e+2]=this[2],t[e+3]=this[3],t[e+4]=this[4],t[e+5]=this[5],t[e+6]=this[6],t[e+7]=this[7],t[e+8]=this[8],t[e+9]=this[9],t[e+10]=this[10],t[e+11]=this[11],t[e+12]=this[12],t[e+13]=this[13],t[e+14]=this[14],t[e+15]=this[15],t}}function p(t){let e=t[0],i=t[1],s=t[2];return Math.sqrt(e*e+i*i+s*s)}function c(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function u(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t}function d(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t}function v(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t}function m(t){let e=t[0],i=t[1],s=t[2];return e*e+i*i+s*s}function b(t,e){let i=e[0],s=e[1],n=e[2],r=i*i+s*s+n*n;return r>0&&(r=1/Math.sqrt(r)),t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t}function g(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function w(t,e,i){let s=e[0],n=e[1],r=e[2],o=i[0],a=i[1],l=i[2];return t[0]=n*l-r*a,t[1]=r*o-s*l,t[2]=s*a-n*o,t}const f=function(){const t=[0,0,0],e=[0,0,0];return function(i,s){c(t,i),c(e,s),b(t,t),b(e,e);let n=g(t,e);return n>1?0:n<-1?Math.PI:Math.acos(n)}}();const _=t=>!!t.draw;class x extends Array{constructor(t=0,e=t,i=t){return super(t,e,i),this}get x(){return this[0]}get y(){return this[1]}get z(){return this[2]}set x(t){this[0]=t}set y(t){this[1]=t}set z(t){this[2]=t}set(t,e=t,i=t){return t.length?this.copy(t):(function(t,e,i,s){t[0]=e,t[1]=i,t[2]=s}(this,t,e,i),this)}copy(t){return c(this,t),this}add(t,e){return e?u(this,t,e):u(this,this,t),this}sub(t,e){return e?d(this,t,e):d(this,this,t),this}multiply(t){var e,i,s;return t.length?(i=this,s=t,(e=this)[0]=i[0]*s[0],e[1]=i[1]*s[1],e[2]=i[2]*s[2]):v(this,this,t),this}divide(t){var e,i,s;return t.length?(i=this,s=t,(e=this)[0]=i[0]/s[0],e[1]=i[1]/s[1],e[2]=i[2]/s[2]):v(this,this,1/t),this}inverse(t=this){var e,i;return i=t,(e=this)[0]=1/i[0],e[1]=1/i[1],e[2]=1/i[2],this}len(){return p(this)}distance(t){return t?function(t,e){let i=e[0]-t[0],s=e[1]-t[1],n=e[2]-t[2];return Math.sqrt(i*i+s*s+n*n)}(this,t):p(this)}squaredLen(){return m(this)}squaredDistance(t){return t?function(t,e){let i=e[0]-t[0],s=e[1]-t[1],n=e[2]-t[2];return i*i+s*s+n*n}(this,t):m(this)}negate(t=this){var e,i;return i=t,(e=this)[0]=-i[0],e[1]=-i[1],e[2]=-i[2],this}cross(t,e){return e?w(this,t,e):w(this,this,t),this}scale(t){return v(this,this,t),this}normalize(){return b(this,this),this}dot(t){return g(this,t)}equals(t){return i=t,(e=this)[0]===i[0]&&e[1]===i[1]&&e[2]===i[2];var e,i}applyMatrix4(t){return function(t,e,i){let s=e[0],n=e[1],r=e[2],o=i[3]*s+i[7]*n+i[11]*r+i[15];o=o||1,t[0]=(i[0]*s+i[4]*n+i[8]*r+i[12])/o,t[1]=(i[1]*s+i[5]*n+i[9]*r+i[13])/o,t[2]=(i[2]*s+i[6]*n+i[10]*r+i[14])/o}(this,this,t),this}scaleRotateMatrix4(t){return function(t,e,i){let s=e[0],n=e[1],r=e[2],o=i[3]*s+i[7]*n+i[11]*r+i[15];o=o||1,t[0]=(i[0]*s+i[4]*n+i[8]*r)/o,t[1]=(i[1]*s+i[5]*n+i[9]*r)/o,t[2]=(i[2]*s+i[6]*n+i[10]*r)/o}(this,this,t),this}applyQuaternion(t){return function(t,e,i){let s=e[0],n=e[1],r=e[2],o=i[0],a=i[1],l=i[2],h=a*r-l*n,p=l*s-o*r,c=o*n-a*s,u=a*c-l*p,d=l*h-o*c,v=o*p-a*h,m=2*i[3];h*=m,p*=m,c*=m,u*=2,d*=2,v*=2,t[0]=s+h+u,t[1]=n+p+d,t[2]=r+c+v}(this,this,t),this}angle(t){return f(this,t)}lerp(t,e){return function(t,e,i,s){let n=e[0],r=e[1],o=e[2];t[0]=n+s*(i[0]-n),t[1]=r+s*(i[1]-r),t[2]=o+s*(i[2]-o)}(this,this,t,e),this}clone(){return new x(this[0],this[1],this[2])}fromArray(t,e=0){return this[0]=t[e],this[1]=t[e+1],this[2]=t[e+2],this}toArray(t=[],e=0){return t[e]=this[0],t[e+1]=this[1],t[e+2]=this[2],t}transformDirection(t){const e=this[0],i=this[1],s=this[2];return this[0]=t[0]*e+t[4]*i+t[8]*s,this[1]=t[1]*e+t[5]*i+t[9]*s,this[2]=t[2]*e+t[6]*i+t[10]*s,this.normalize()}}function y(t,e,i){let s=e[0],n=e[1],r=e[2],o=e[3],a=i[0],l=i[1],h=i[2],p=i[3];return t[0]=s*p+o*a+n*h-r*l,t[1]=n*p+o*l+r*a-s*h,t[2]=r*p+o*h+s*l-n*a,t[3]=o*p-s*a-n*l-r*h,t}const C=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},P=function(t,e,i,s,n){return t[0]=e,t[1]=i,t[2]=s,t[3]=n,t},E=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},k=function(t,e){let i=e[0],s=e[1],n=e[2],r=e[3],o=i*i+s*s+n*n+r*r;return o>0&&(o=1/Math.sqrt(o)),t[0]=i*o,t[1]=s*o,t[2]=n*o,t[3]=r*o,t};class V extends Array{constructor(t=0,e=0,i=0,s=1){return super(t,e,i,s),this.onChange=()=>{},this}get x(){return this[0]}get y(){return this[1]}get z(){return this[2]}get w(){return this[3]}set x(t){this[0]=t,this.onChange()}set y(t){this[1]=t,this.onChange()}set z(t){this[2]=t,this.onChange()}set w(t){this[3]=t,this.onChange()}identity(){var t;return(t=this)[0]=0,t[1]=0,t[2]=0,t[3]=1,this.onChange(),this}set(t,e,i,s){return t.length?this.copy(t):(P(this,t,e,i,s),this.onChange(),this)}rotateX(t){return function(t,e,i){i*=.5;let s=e[0],n=e[1],r=e[2],o=e[3],a=Math.sin(i),l=Math.cos(i);t[0]=s*l+o*a,t[1]=n*l+r*a,t[2]=r*l-n*a,t[3]=o*l-s*a}(this,this,t),this.onChange(),this}rotateY(t){return function(t,e,i){i*=.5;let s=e[0],n=e[1],r=e[2],o=e[3],a=Math.sin(i),l=Math.cos(i);t[0]=s*l-r*a,t[1]=n*l+o*a,t[2]=r*l+s*a,t[3]=o*l-n*a}(this,this,t),this.onChange(),this}rotateZ(t){return function(t,e,i){i*=.5;let s=e[0],n=e[1],r=e[2],o=e[3],a=Math.sin(i),l=Math.cos(i);t[0]=s*l+n*a,t[1]=n*l-s*a,t[2]=r*l+o*a,t[3]=o*l-r*a}(this,this,t),this.onChange(),this}inverse(t=this){return function(t,e){let i=e[0],s=e[1],n=e[2],r=e[3],o=i*i+s*s+n*n+r*r,a=o?1/o:0;t[0]=-i*a,t[1]=-s*a,t[2]=-n*a,t[3]=r*a}(this,t),this.onChange(),this}conjugate(t=this){var e,i;return i=t,(e=this)[0]=-i[0],e[1]=-i[1],e[2]=-i[2],e[3]=i[3],this.onChange(),this}copy(t){return C(this,t),this.onChange(),this}normalize(t=this){return k(this,t),this.onChange(),this}multiply(t,e){return e?y(this,t,e):y(this,this,t),this.onChange(),this}dot(t){return E(this,t)}fromMatrix3(t){return function(t,e){let i,s=e[0]+e[4]+e[8];if(s>0)i=Math.sqrt(s+1),t[3]=.5*i,i=.5/i,t[0]=(e[5]-e[7])*i,t[1]=(e[6]-e[2])*i,t[2]=(e[1]-e[3])*i;else{let s=0;e[4]>e[0]&&(s=1),e[8]>e[3*s+s]&&(s=2);let n=(s+1)%3,r=(s+2)%3;i=Math.sqrt(e[3*s+s]-e[3*n+n]-e[3*r+r]+1),t[s]=.5*i,i=.5/i,t[3]=(e[3*n+r]-e[3*r+n])*i,t[n]=(e[3*n+s]+e[3*s+n])*i,t[r]=(e[3*r+s]+e[3*s+r])*i}}(this,t),this.onChange(),this}fromEuler(t){return function(t,e,i="YXZ"){let s=Math.sin(.5*e[0]),n=Math.cos(.5*e[0]),r=Math.sin(.5*e[1]),o=Math.cos(.5*e[1]),a=Math.sin(.5*e[2]),l=Math.cos(.5*e[2]);"XYZ"===i?(t[0]=s*o*l+n*r*a,t[1]=n*r*l-s*o*a,t[2]=n*o*a+s*r*l,t[3]=n*o*l-s*r*a):"YXZ"===i?(t[0]=s*o*l+n*r*a,t[1]=n*r*l-s*o*a,t[2]=n*o*a-s*r*l,t[3]=n*o*l+s*r*a):"ZXY"===i?(t[0]=s*o*l-n*r*a,t[1]=n*r*l+s*o*a,t[2]=n*o*a+s*r*l,t[3]=n*o*l-s*r*a):"ZYX"===i?(t[0]=s*o*l-n*r*a,t[1]=n*r*l+s*o*a,t[2]=n*o*a-s*r*l,t[3]=n*o*l+s*r*a):"YZX"===i?(t[0]=s*o*l+n*r*a,t[1]=n*r*l+s*o*a,t[2]=n*o*a-s*r*l,t[3]=n*o*l-s*r*a):"XZY"===i&&(t[0]=s*o*l-n*r*a,t[1]=n*r*l-s*o*a,t[2]=n*o*a+s*r*l,t[3]=n*o*l+s*r*a)}(this,t,t.order),this}fromAxisAngle(t,e){return function(t,e,i){i*=.5;let s=Math.sin(i);t[0]=s*e[0],t[1]=s*e[1],t[2]=s*e[2],t[3]=Math.cos(i)}(this,t,e),this}slerp(t,e){return function(t,e,i,s){let n,r,o,a,l,h=e[0],p=e[1],c=e[2],u=e[3],d=i[0],v=i[1],m=i[2],b=i[3];r=h*d+p*v+c*m+u*b,r<0&&(r=-r,d=-d,v=-v,m=-m,b=-b),1-r>1e-6?(n=Math.acos(r),o=Math.sin(n),a=Math.sin((1-s)*n)/o,l=Math.sin(s*n)/o):(a=1-s,l=s),t[0]=a*h+l*d,t[1]=a*p+l*v,t[2]=a*c+l*m,t[3]=a*u+l*b}(this,this,t,e),this}fromArray(t,e=0){return this[0]=t[e],this[1]=t[e+1],this[2]=t[e+2],this[3]=t[e+3],this}toArray(t=[],e=0){return t[e]=this[0],t[e+1]=this[1],t[e+2]=this[2],t[e+3]=this[3],t}}const M=new h;class L extends Array{constructor(t=0,e=t,i=t,s="YXZ"){return super(t,e,i),this.order=s,this.onChange=()=>{},this}get x(){return this[0]}get y(){return this[1]}get z(){return this[2]}set x(t){this[0]=t,this.onChange()}set y(t){this[1]=t,this.onChange()}set z(t){this[2]=t,this.onChange()}set(t,e=t,i=t){return t.length?this.copy(t):(this[0]=t,this[1]=e,this[2]=i,this.onChange(),this)}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this.onChange(),this}reorder(t){return this.order=t,this.onChange(),this}fromRotationMatrix(t,e=this.order){return function(t,e,i="YXZ"){"XYZ"===i?(t[1]=Math.asin(Math.min(Math.max(e[8],-1),1)),Math.abs(e[8])<.99999?(t[0]=Math.atan2(-e[9],e[10]),t[2]=Math.atan2(-e[4],e[0])):(t[0]=Math.atan2(e[6],e[5]),t[2]=0)):"YXZ"===i?(t[0]=Math.asin(-Math.min(Math.max(e[9],-1),1)),Math.abs(e[9])<.99999?(t[1]=Math.atan2(e[8],e[10]),t[2]=Math.atan2(e[1],e[5])):(t[1]=Math.atan2(-e[2],e[0]),t[2]=0)):"ZXY"===i?(t[0]=Math.asin(Math.min(Math.max(e[6],-1),1)),Math.abs(e[6])<.99999?(t[1]=Math.atan2(-e[2],e[10]),t[2]=Math.atan2(-e[4],e[5])):(t[1]=0,t[2]=Math.atan2(e[1],e[0]))):"ZYX"===i?(t[1]=Math.asin(-Math.min(Math.max(e[2],-1),1)),Math.abs(e[2])<.99999?(t[0]=Math.atan2(e[6],e[10]),t[2]=Math.atan2(e[1],e[0])):(t[0]=0,t[2]=Math.atan2(-e[4],e[5]))):"YZX"===i?(t[2]=Math.asin(Math.min(Math.max(e[1],-1),1)),Math.abs(e[1])<.99999?(t[0]=Math.atan2(-e[9],e[5]),t[1]=Math.atan2(-e[2],e[0])):(t[0]=0,t[1]=Math.atan2(e[8],e[10]))):"XZY"===i&&(t[2]=Math.asin(-Math.min(Math.max(e[4],-1),1)),Math.abs(e[4])<.99999?(t[0]=Math.atan2(e[6],e[5]),t[1]=Math.atan2(e[8],e[0])):(t[0]=Math.atan2(-e[9],e[10]),t[1]=0))}(this,t,e),this}fromQuaternion(t,e=this.order){return M.fromQuaternion(t),this.fromRotationMatrix(M,e)}toArray(t=[],e=0){return t[e]=this[0],t[e+1]=this[1],t[e+2]=this[2],t}}class S{constructor(){this.parent=null,this.children=[],this.visible=!0,this.matrix=new h,this.worldMatrix=new h,this.matrixAutoUpdate=!0,this.up=new x(0,1,0),this.position=new x,this.scale=new x(1),this.quaternion=new V,this.rotation=new L,this.rotation.onChange=()=>this.quaternion.fromEuler(this.rotation),this.quaternion.onChange=()=>this.rotation.fromQuaternion(this.quaternion)}setParent(t,e=!0){this.parent&&t!==this.parent&&this.parent.removeChild(this,!1),this.parent=t,e&&t&&t.addChild(this,!1)}addChild(t,e=!0){~this.children.indexOf(t)||this.children.push(t),e&&t.setParent(this,!1)}removeChild(t,e=!0){~this.children.indexOf(t)&&this.children.splice(this.children.indexOf(t),1),e&&t.setParent(null,!1)}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.worldMatrixNeedsUpdate||t)&&(null===this.parent?this.worldMatrix.copy(this.matrix):this.worldMatrix.multiply(this.parent.worldMatrix,this.matrix),this.worldMatrixNeedsUpdate=!1,t=!0);for(let e=0,i=this.children.length;e<i;e++)this.children[e].updateMatrixWorld(t)}updateMatrix(){this.matrix.compose(this.quaternion,this.position,this.scale),this.worldMatrixNeedsUpdate=!0}traverse(t){if(!t(this))for(let e=0,i=this.children.length;e<i;e++)this.children[e].traverse(t)}decompose(){this.matrix.getTranslation(this.position),this.matrix.getRotation(this.quaternion),this.matrix.getScaling(this.scale),this.rotation.fromQuaternion(this.quaternion)}lookAt(t,e=!1){e?this.matrix.lookAt(this.position,t,this.up):this.matrix.lookAt(t,this.position,this.up),this.matrix.getRotation(this.quaternion),this.rotation.fromQuaternion(this.quaternion)}}const A=new h,D=new x,O=new x;class j extends S{constructor(t,{near:e=.1,far:i=100,fov:s=45,aspect:n=1,left:r,right:o,bottom:a,top:l,zoom:p=1}={}){super(),Object.assign(this,{near:e,far:i,fov:s,aspect:n,left:r,right:o,bottom:a,top:l,zoom:p}),this.projectionMatrix=new h,this.viewMatrix=new h,this.projectionViewMatrix=new h,this.worldPosition=new x,this.type=r||o?"orthographic":"perspective","orthographic"===this.type?this.orthographic():this.perspective()}perspective({near:t=this.near,far:e=this.far,fov:i=this.fov,aspect:s=this.aspect}={}){return Object.assign(this,{near:t,far:e,fov:i,aspect:s}),this.projectionMatrix.fromPerspective({fov:i*(Math.PI/180),aspect:s,near:t,far:e}),this.type="perspective",this}orthographic({near:t=this.near,far:e=this.far,left:i=this.left,right:s=this.right,bottom:n=this.bottom,top:r=this.top,zoom:o=this.zoom}={}){return Object.assign(this,{near:t,far:e,left:i,right:s,bottom:n,top:r,zoom:o}),i/=o,s/=o,n/=o,r/=o,this.projectionMatrix.fromOrthogonal({left:i,right:s,bottom:n,top:r,near:t,far:e}),this.type="orthographic",this}updateMatrixWorld(){return super.updateMatrixWorld(),this.viewMatrix.inverse(this.worldMatrix),this.worldMatrix.getTranslation(this.worldPosition),this.projectionViewMatrix.multiply(this.projectionMatrix,this.viewMatrix),this}lookAt(t){return super.lookAt(t,!0),this}project(t){return t.applyMatrix4(this.viewMatrix),t.applyMatrix4(this.projectionMatrix),this}unproject(t){return t.applyMatrix4(A.inverse(this.projectionMatrix)),t.applyMatrix4(this.worldMatrix),this}updateFrustum(){this.frustum||(this.frustum=[new x,new x,new x,new x,new x,new x]);const t=this.projectionViewMatrix;this.frustum[0].set(t[3]-t[0],t[7]-t[4],t[11]-t[8]).constant=t[15]-t[12],this.frustum[1].set(t[3]+t[0],t[7]+t[4],t[11]+t[8]).constant=t[15]+t[12],this.frustum[2].set(t[3]+t[1],t[7]+t[5],t[11]+t[9]).constant=t[15]+t[13],this.frustum[3].set(t[3]-t[1],t[7]-t[5],t[11]-t[9]).constant=t[15]-t[13],this.frustum[4].set(t[3]-t[2],t[7]-t[6],t[11]-t[10]).constant=t[15]-t[14],this.frustum[5].set(t[3]+t[2],t[7]+t[6],t[11]+t[10]).constant=t[15]+t[14];for(let t=0;t<6;t++){const e=1/this.frustum[t].distance();this.frustum[t].multiply(e),this.frustum[t].constant*=e}}frustumIntersectsMesh(t){if(!t.geometry.attributes.position)return!0;if(t.geometry.bounds&&t.geometry.bounds.radius!==1/0||t.geometry.computeBoundingSphere(),!t.geometry.bounds)return!0;const e=D;e.copy(t.geometry.bounds.center),e.applyMatrix4(t.worldMatrix);const i=t.geometry.bounds.radius*t.worldMatrix.getMaxScaleOnAxis();return this.frustumIntersectsSphere(e,i)}frustumIntersectsSphere(t,e){const i=O;for(let s=0;s<6;s++){const n=this.frustum[s];if(i.copy(n).dot(t)+n.constant<-e)return!1}return!0}}const T=new x;let R=1,z=1,N=!1;class F{constructor(t,e={}){this.raycast="box",t.canvas||console.error("gl not passed as fist argument to Geometry"),this.gl=t,this.attributes=e,this.id=R++,this.VAOs={},this.drawRange={start:0,count:0},this.instancedCount=0,this.gl.renderer.bindVertexArray(null),this.gl.renderer.currentGeometry=null,this.glState=this.gl.renderer.state;for(let t in e)this.addAttribute(t,e[t])}addAttribute(t,e){if(this.attributes[t]=e,e.id=z++,e.size=e.size||1,e.type=e.type||(e.data.constructor===Float32Array?this.gl.FLOAT:e.data.constructor===Uint16Array?this.gl.UNSIGNED_SHORT:this.gl.UNSIGNED_INT),e.target="index"===t?this.gl.ELEMENT_ARRAY_BUFFER:this.gl.ARRAY_BUFFER,e.normalized=e.normalized||!1,e.stride=e.stride||0,e.offset=e.offset||0,e.count=e.count||(e.stride?e.data.byteLength/e.stride:e.data.length/e.size),e.divisor=e.instanced||0,e.needsUpdate=!1,e.buffer||(e.buffer=this.gl.createBuffer(),this.updateAttribute(e)),e.divisor){if(this.isInstanced=!0,this.instancedCount&&this.instancedCount!==e.count*e.divisor)return console.warn("geometry has multiple instanced buffers of different length"),this.instancedCount=Math.min(this.instancedCount,e.count*e.divisor);this.instancedCount=e.count*e.divisor}else"index"===t?this.drawRange.count=e.count:this.attributes.index||(this.drawRange.count=Math.max(this.drawRange.count,e.count))}updateAttribute(t){this.glState.boundBuffer!==t.buffer&&(this.gl.bindBuffer(t.target,t.buffer),this.glState.boundBuffer=t.buffer),this.gl.bufferData(t.target,t.data,this.gl.STATIC_DRAW),t.needsUpdate=!1}setIndex(t){this.addAttribute("index",t)}setDrawRange(t,e){this.drawRange.start=t,this.drawRange.count=e}setInstancedCount(t){this.instancedCount=t}createVAO(t){this.VAOs[t.attributeOrder]=this.gl.renderer.createVertexArray(),this.gl.renderer.bindVertexArray(this.VAOs[t.attributeOrder]),this.bindAttributes(t)}bindAttributes(t){t.attributeLocations.forEach(((t,{name:e,type:i})=>{if(!this.attributes[e])return void console.warn(`active attribute ${e} not being supplied`);const s=this.attributes[e];this.gl.bindBuffer(s.target,s.buffer),this.glState.boundBuffer=s.buffer;let n=1;35674===i&&(n=2),35675===i&&(n=3),35676===i&&(n=4);const r=s.size/n,o=1===n?0:n*n*n,a=1===n?0:n*n;for(let e=0;e<n;e++)this.gl.vertexAttribPointer(t+e,r,s.type,s.normalized,s.stride+o,s.offset+e*a),this.gl.enableVertexAttribArray(t+e),this.gl.renderer.vertexAttribDivisor(t+e,s.divisor)})),this.attributes.index&&this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.attributes.index.buffer)}draw({program:t,mode:e=this.gl.TRIANGLES}){this.gl.renderer.currentGeometry!==`${this.id}_${t.attributeOrder}`&&(this.VAOs[t.attributeOrder]||this.createVAO(t),this.gl.renderer.bindVertexArray(this.VAOs[t.attributeOrder]),this.gl.renderer.currentGeometry=`${this.id}_${t.attributeOrder}`),t.attributeLocations.forEach(((t,{name:e})=>{const i=this.attributes[e];i.needsUpdate&&this.updateAttribute(i)})),this.isInstanced?this.attributes.index?this.gl.renderer.drawElementsInstanced(e,this.drawRange.count,this.attributes.index.type,this.attributes.index.offset+2*this.drawRange.start,this.instancedCount):this.gl.renderer.drawArraysInstanced(e,this.drawRange.start,this.drawRange.count,this.instancedCount):this.attributes.index?this.gl.drawElements(e,this.drawRange.count,this.attributes.index.type,this.attributes.index.offset+2*this.drawRange.start):this.gl.drawArrays(e,this.drawRange.start,this.drawRange.count)}getPosition(){const t=this.attributes.position;return t.data?t:N?void 0:(console.warn("No position buffer data found to compute bounds"),N=!0)}computeBoundingBox(t=null){t||(t=this.getPosition());const e=t.data,i=t.offset||0,s=t.stride||t.size;this.bounds||(this.bounds={min:new x,max:new x,center:new x,scale:new x,radius:1/0});const n=this.bounds.min,r=this.bounds.max,o=this.bounds.center,a=this.bounds.scale;n.set(1/0),r.set(-1/0);for(let t=i,o=e.length;t<o;t+=s){const i=e[t],s=e[t+1],o=e[t+2];n.x=Math.min(i,n.x),n.y=Math.min(s,n.y),n.z=Math.min(o,n.z),r.x=Math.max(i,r.x),r.y=Math.max(s,r.y),r.z=Math.max(o,r.z)}a.sub(r,n),o.add(n,r).divide(2)}computeBoundingSphere(t=null){t||(t=this.getPosition());const e=t.data,i=t.offset||0,s=t.stride||t.size;this.bounds||this.computeBoundingBox(t);let n=0;for(let t=i,r=e.length;t<r;t+=s)T.fromArray(e,t),n=Math.max(n,this.bounds.center.squaredDistance(T));this.bounds.radius=Math.sqrt(n)}computeVertexNormals(){const t=this.attributes.position;if(!t)return;let e=this.attributes.normal;e?e.data.fill(0):(this.addAttribute("normal",{size:3,data:new Float32Array(3*t.count)}),e=this.attributes.normal);const i=new x,s=new x,n=new x,r=new x,o=new x,a=new x,l=new x,h=new x,p=this.attributes.index;if(p){let c,u,d;for(let v=0,m=p.count;v<m;v+=3)c=p.data[v],u=p.data[v+1],d=p.data[v+2],i.fromArray(t.data,c*t.size),s.fromArray(t.data,u*t.size),n.fromArray(t.data,d*t.size),l.sub(n,s),h.sub(i,s),l.cross(h),r.fromArray(e.data,c*e.size),o.fromArray(e.data,u*e.size),a.fromArray(e.data,d*e.size),r.add(l),o.add(l),a.add(l),c*=e.size,e.data[c]=r.x,e.data[c+1]=r.y,e.data[c+2]=r.z,u*=e.size,e.data[u]=o.x,e.data[u+1]=o.y,e.data[u+2]=o.z,d*=e.size,e.data[d]=a.x,e.data[d+1]=a.y,e.data[d+2]=a.z}else for(let r=0,o=t.count;r<o;r+=3)i.fromArray(t.data,r*t.size),s.fromArray(t.data,(r+1)*t.size),n.fromArray(t.data,(r+2)*t.size),l.sub(n,s),h.sub(i,s),l.cross(h),e.data[r*e.size]=l.x,e.data[r*e.size+1]=l.y,e.data[r*e.size+2]=l.z,e.data[(r+1)*e.size]=l.x,e.data[(r+1)*e.size+1]=l.y,e.data[(r+1)*e.size+2]=l.z,e.data[(r+2)*e.size]=l.x,e.data[(r+2)*e.size+1]=l.y,e.data[(r+2)*e.size+2]=l.z;this.normalizeNormals(),e.needsUpdate=!0}normalizeNormals(){const t=this.attributes.normal;for(let e=0,i=t.count;e<i;e++)T.fromArray(t.data,e*t.size),T.normalize(),t.data[e*t.size]=T.x,t.data[e*t.size+1]=T.y,t.data[e*t.size+2]=T.z}remove(){for(let t in this.attributes)this.gl.deleteBuffer(this.attributes[t].buffer),delete this.attributes[t]}}function B(t,e,i){let s=e[0],n=e[1],r=e[2],o=e[3],a=e[4],l=e[5],h=e[6],p=e[7],c=e[8],u=i[0],d=i[1],v=i[2],m=i[3],b=i[4],g=i[5],w=i[6],f=i[7],_=i[8];return t[0]=u*s+d*o+v*h,t[1]=u*n+d*a+v*p,t[2]=u*r+d*l+v*c,t[3]=m*s+b*o+g*h,t[4]=m*n+b*a+g*p,t[5]=m*r+b*l+g*c,t[6]=w*s+f*o+_*h,t[7]=w*n+f*a+_*p,t[8]=w*r+f*l+_*c,t}class I extends Array{constructor(t=1,e=0,i=0,s=0,n=1,r=0,o=0,a=0,l=1){return super(t,e,i,s,n,r,o,a,l),this}set(t,e,i,s,n,r,o,a,l){return t.length?this.copy(t):(function(t,e,i,s,n,r,o,a,l,h){t[0]=e,t[1]=i,t[2]=s,t[3]=n,t[4]=r,t[5]=o,t[6]=a,t[7]=l,t[8]=h}(this,t,e,i,s,n,r,o,a,l),this)}translate(t,e=this){return function(t,e,i){let s=e[0],n=e[1],r=e[2],o=e[3],a=e[4],l=e[5],h=e[6],p=e[7],c=e[8],u=i[0],d=i[1];t[0]=s,t[1]=n,t[2]=r,t[3]=o,t[4]=a,t[5]=l,t[6]=u*s+d*o+h,t[7]=u*n+d*a+p,t[8]=u*r+d*l+c}(this,e,t),this}rotate(t,e=this){return function(t,e,i){let s=e[0],n=e[1],r=e[2],o=e[3],a=e[4],l=e[5],h=e[6],p=e[7],c=e[8],u=Math.sin(i),d=Math.cos(i);t[0]=d*s+u*o,t[1]=d*n+u*a,t[2]=d*r+u*l,t[3]=d*o-u*s,t[4]=d*a-u*n,t[5]=d*l-u*r,t[6]=h,t[7]=p,t[8]=c}(this,e,t),this}scale(t,e=this){return function(t,e,i){let s=i[0],n=i[1];t[0]=s*e[0],t[1]=s*e[1],t[2]=s*e[2],t[3]=n*e[3],t[4]=n*e[4],t[5]=n*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8]}(this,e,t),this}multiply(t,e){return e?B(this,t,e):B(this,this,t),this}identity(){var t;return(t=this)[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,this}copy(t){var e,i;return i=t,(e=this)[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],this}fromMatrix4(t){var e,i;return i=t,(e=this)[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[4],e[4]=i[5],e[5]=i[6],e[6]=i[8],e[7]=i[9],e[8]=i[10],this}fromQuaternion(t){return function(t,e){let i=e[0],s=e[1],n=e[2],r=e[3],o=i+i,a=s+s,l=n+n,h=i*o,p=s*o,c=s*a,u=n*o,d=n*a,v=n*l,m=r*o,b=r*a,g=r*l;t[0]=1-c-v,t[3]=p-g,t[6]=u+b,t[1]=p+g,t[4]=1-h-v,t[7]=d-m,t[2]=u-b,t[5]=d+m,t[8]=1-h-c}(this,t),this}fromBasis(t,e,i){return this.set(t[0],t[1],t[2],e[0],e[1],e[2],i[0],i[1],i[2]),this}inverse(t=this){return function(t,e){let i=e[0],s=e[1],n=e[2],r=e[3],o=e[4],a=e[5],l=e[6],h=e[7],p=e[8],c=p*o-a*h,u=-p*r+a*l,d=h*r-o*l,v=i*c+s*u+n*d;v&&(v=1/v,t[0]=c*v,t[1]=(-p*s+n*h)*v,t[2]=(a*s-n*o)*v,t[3]=u*v,t[4]=(p*i-n*l)*v,t[5]=(-a*i+n*r)*v,t[6]=d*v,t[7]=(-h*i+s*l)*v,t[8]=(o*i-s*r)*v)}(this,t),this}getNormalMatrix(t){return function(t,e){let i=e[0],s=e[1],n=e[2],r=e[3],o=e[4],a=e[5],l=e[6],h=e[7],p=e[8],c=e[9],u=e[10],d=e[11],v=e[12],m=e[13],b=e[14],g=e[15],w=i*a-s*o,f=i*l-n*o,_=i*h-r*o,x=s*l-n*a,y=s*h-r*a,C=n*h-r*l,P=p*m-c*v,E=p*b-u*v,k=p*g-d*v,V=c*b-u*m,M=c*g-d*m,L=u*g-d*b,S=w*L-f*M+_*V+x*k-y*E+C*P;S&&(S=1/S,t[0]=(a*L-l*M+h*V)*S,t[1]=(l*k-o*L-h*E)*S,t[2]=(o*M-a*k+h*P)*S,t[3]=(n*M-s*L-r*V)*S,t[4]=(i*L-n*k+r*E)*S,t[5]=(s*k-i*M-r*P)*S,t[6]=(m*C-b*y+g*x)*S,t[7]=(b*_-v*C-g*f)*S,t[8]=(v*y-m*_+g*w)*S)}(this,t),this}}let U=0;class K extends S{constructor(t,{geometry:e,program:i,mode:s=t.TRIANGLES,frustumCulled:n=!0,renderOrder:r=0}={}){super(),this.hit=null,t.canvas||console.error("gl not passed as first argument to Mesh"),this.gl=t,this.id=U++,this.geometry=e,this.program=i,this.mode=s,this.frustumCulled=n,this.renderOrder=r,this.modelViewMatrix=new h,this.normalMatrix=new I,this.beforeRenderCallbacks=[],this.afterRenderCallbacks=[]}onBeforeRender(t){return this.beforeRenderCallbacks.push(t),this}onAfterRender(t){return this.afterRenderCallbacks.push(t),this}draw({camera:t}={}){this.beforeRenderCallbacks.forEach((e=>e&&e({mesh:this,camera:t}))),t&&(this.program.uniforms.modelMatrix||Object.assign(this.program.uniforms,{modelMatrix:{value:null},viewMatrix:{value:null},modelViewMatrix:{value:null},normalMatrix:{value:null},projectionMatrix:{value:null},cameraPosition:{value:null}}),this.program.uniforms.projectionMatrix.value=t.projectionMatrix,this.program.uniforms.cameraPosition.value=t.worldPosition,this.program.uniforms.viewMatrix.value=t.viewMatrix,this.modelViewMatrix.multiply(t.viewMatrix,this.worldMatrix),this.normalMatrix.getNormalMatrix(this.modelViewMatrix),this.program.uniforms.modelMatrix.value=this.worldMatrix,this.program.uniforms.modelViewMatrix.value=this.modelViewMatrix,this.program.uniforms.normalMatrix.value=this.normalMatrix);let e=this.program.cullFace&&this.worldMatrix.determinant()<0;this.program.use({flipFaces:e}),this.geometry.draw({mode:this.mode,program:this.program}),this.afterRenderCallbacks.forEach((e=>e&&e({mesh:this,camera:t})))}}function q(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t}function $(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t}function G(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t}function H(t){var e=t[0],i=t[1];return Math.sqrt(e*e+i*i)}function Y(t,e){return t[0]*e[1]-t[1]*e[0]}class X extends Array{constructor(t=0,e=t){return super(t,e),this}get x(){return this[0]}get y(){return this[1]}set x(t){this[0]=t}set y(t){this[1]=t}set(t,e=t){return t.length?this.copy(t):(function(t,e,i){t[0]=e,t[1]=i}(this,t,e),this)}copy(t){var e,i;return i=t,(e=this)[0]=i[0],e[1]=i[1],this}add(t,e){return e?q(this,t,e):q(this,this,t),this}sub(t,e){return e?$(this,t,e):$(this,this,t),this}multiply(t){var e,i,s;return t.length?(i=this,s=t,(e=this)[0]=i[0]*s[0],e[1]=i[1]*s[1]):G(this,this,t),this}divide(t){var e,i,s;return t.length?(i=this,s=t,(e=this)[0]=i[0]/s[0],e[1]=i[1]/s[1]):G(this,this,1/t),this}inverse(t=this){var e,i;return i=t,(e=this)[0]=1/i[0],e[1]=1/i[1],this}len(){return H(this)}distance(t){return t?(e=this,s=(i=t)[0]-e[0],n=i[1]-e[1],Math.sqrt(s*s+n*n)):H(this);var e,i,s,n}squaredLen(){return this.squaredDistance()}squaredDistance(t){return t?(e=this,s=(i=t)[0]-e[0],n=i[1]-e[1],s*s+n*n):function(t){var e=t[0],i=t[1];return e*e+i*i}(this);var e,i,s,n}negate(t=this){var e,i;return i=t,(e=this)[0]=-i[0],e[1]=-i[1],this}cross(t,e){return e?Y(t,e):Y(this,t)}scale(t){return G(this,this,t),this}normalize(){var t,e,i,s,n;return t=this,i=(e=this)[0],s=e[1],(n=i*i+s*s)>0&&(n=1/Math.sqrt(n)),t[0]=e[0]*n,t[1]=e[1]*n,this}dot(t){return i=t,(e=this)[0]*i[0]+e[1]*i[1];var e,i}equals(t){return i=t,(e=this)[0]===i[0]&&e[1]===i[1];var e,i}applyMatrix3(t){var e,i,s,n,r;return e=this,s=t,n=(i=this)[0],r=i[1],e[0]=s[0]*n+s[3]*r+s[6],e[1]=s[1]*n+s[4]*r+s[7],this}applyMatrix4(t){return function(t,e,i){let s=e[0],n=e[1];t[0]=i[0]*s+i[4]*n+i[12],t[1]=i[1]*s+i[5]*n+i[13]}(this,this,t),this}lerp(t,e){!function(t,e,i,s){var n=e[0],r=e[1];t[0]=n+s*(i[0]-n),t[1]=r+s*(i[1]-r)}(this,this,t,e)}clone(){return new X(this[0],this[1])}fromArray(t,e=0){return this[0]=t[e],this[1]=t[e+1],this}toArray(t=[],e=0){return t[e]=this[0],t[e+1]=this[1],t}}const W=-1,Z=0,Q=1,J=2,tt=3,et=new x,it=new X,st=new X;function nt(t,{element:e=document.body,enabled:i=!0,target:s=new x,ease:n=.25,inertia:r=.85,enableRotate:o=!0,rotateSpeed:a=.1,autoRotate:l=!1,autoRotateSpeed:h=1,enableZoom:p=!0,zoomSpeed:c=1,enablePan:u=!0,panSpeed:d=.1,minPolarAngle:v=0,maxPolarAngle:m=Math.PI,minAzimuthAngle:b=-1/0,maxAzimuthAngle:g=1/0,minDistance:w=0,maxDistance:f=1/0}={}){this.enabled=i,this.target=s,n=n||1,r=r||0,this.minDistance=w,this.maxDistance=f;const _={radius:1,phi:0,theta:0},y={radius:1,phi:0,theta:0},C={radius:1,phi:0,theta:0},P=new x,E=new x;E.copy(t.position).sub(this.target),C.radius=y.radius=E.distance(),C.theta=y.theta=Math.atan2(E.x,E.z),C.phi=y.phi=Math.acos(Math.min(Math.max(E.y/y.radius,-1),1)),this.offset=E,this.update=()=>{l&&function(){const t=2*Math.PI/60/60*h;_.theta-=t}(),y.radius*=_.radius,y.theta+=_.theta,y.phi+=_.phi,y.theta=Math.max(b,Math.min(g,y.theta)),y.phi=Math.max(v,Math.min(m,y.phi)),y.radius=Math.max(this.minDistance,Math.min(this.maxDistance,y.radius)),C.phi+=(y.phi-C.phi)*n,C.theta+=(y.theta-C.theta)*n,C.radius+=(y.radius-C.radius)*n,this.target.add(P);let e=C.radius*Math.sin(Math.max(1e-6,C.phi));E.x=e*Math.sin(C.theta),E.y=C.radius*Math.cos(C.phi),E.z=e*Math.cos(C.theta),t.position.copy(this.target).add(E),t.lookAt(this.target),_.theta*=r,_.phi*=r,P.multiply(r),_.radius=1},this.forcePosition=()=>{E.copy(t.position).sub(this.target),C.radius=y.radius=E.distance(),C.theta=y.theta=Math.atan2(E.x,E.z),C.phi=y.phi=Math.acos(Math.min(Math.max(E.y/y.radius,-1),1)),t.lookAt(this.target)};const k=new X,V=new X,M=new X;let L=W;function S(){return Math.pow(.95,c)}this.mouseButtons={ORBIT:0,ZOOM:1,PAN:2};const A=(i,s)=>{et.copy(t.position).sub(this.target);let n=et.distance();var r,o;n*=Math.tan((t.fov||45)/2*Math.PI/180),r=2*i*n/e.clientHeight,o=t.matrix,et.set(o[0],o[1],o[2]),et.multiply(-r),P.add(et),function(t,e){et.set(e[4],e[5],e[6]),et.multiply(t),P.add(et)}(2*s*n/e.clientHeight,t.matrix)};function D(t){_.radius/=t}function O(t,i){it.set(t,i),st.sub(it,k).multiply(a),_.theta-=2*Math.PI*st.x/e.clientHeight,_.phi-=2*Math.PI*st.y/e.clientHeight,k.copy(it)}function j(t,e){it.set(t,e),st.sub(it,V).multiply(d),A(st.x,st.y),V.copy(it)}const T=t=>{if(this.enabled){switch(t.button){case this.mouseButtons.ORBIT:if(!1===o)return;k.set(t.clientX,t.clientY),L=Z;break;case this.mouseButtons.ZOOM:if(!1===p)return;M.set(t.clientX,t.clientY),L=Q;break;case this.mouseButtons.PAN:if(!1===u)return;V.set(t.clientX,t.clientY),L=J}L!==W&&(window.addEventListener("mousemove",R,!1),window.addEventListener("mouseup",z,!1))}},R=t=>{if(this.enabled)switch(L){case Z:if(!1===o)return;O(t.clientX,t.clientY);break;case Q:if(!1===p)return;!function(t){it.set(t.clientX,t.clientY),st.sub(it,M),st.y>0?D(S()):st.y<0&&D(1/S()),M.copy(it)}(t);break;case J:if(!1===u)return;j(t.clientX,t.clientY)}},z=()=>{window.removeEventListener("mousemove",R,!1),window.removeEventListener("mouseup",z,!1),L=W},N=t=>{this.enabled&&p&&(L===W||L===Z)&&(t.stopPropagation(),t.preventDefault(),t.deltaY<0?D(1/S()):t.deltaY>0&&D(S()))},F=t=>{if(this.enabled)switch(t.preventDefault(),t.touches.length){case 1:if(!1===o)return;k.set(t.touches[0].pageX,t.touches[0].pageY),L=Z;break;case 2:if(!1===p&&!1===u)return;!function(t){if(p){let e=t.touches[0].pageX-t.touches[1].pageX,i=t.touches[0].pageY-t.touches[1].pageY,s=Math.sqrt(e*e+i*i);M.set(0,s)}if(u){let e=.5*(t.touches[0].pageX+t.touches[1].pageX),i=.5*(t.touches[0].pageY+t.touches[1].pageY);V.set(e,i)}}(t),L=tt;break;default:L=W}},B=t=>{if(this.enabled)switch(t.preventDefault(),t.stopPropagation(),t.touches.length){case 1:if(!1===o)return;O(t.touches[0].pageX,t.touches[0].pageY);break;case 2:if(!1===p&&!1===u)return;!function(t){if(p){let e=t.touches[0].pageX-t.touches[1].pageX,i=t.touches[0].pageY-t.touches[1].pageY,s=Math.sqrt(e*e+i*i);it.set(0,s),st.set(0,Math.pow(it.y/M.y,c)),D(st.y),M.copy(it)}u&&j(.5*(t.touches[0].pageX+t.touches[1].pageX),.5*(t.touches[0].pageY+t.touches[1].pageY))}(t);break;default:L=W}},I=()=>{this.enabled&&(L=W)},U=t=>{this.enabled&&t.preventDefault()};this.remove=function(){e.removeEventListener("contextmenu",U),e.removeEventListener("mousedown",T),e.removeEventListener("wheel",N),e.removeEventListener("touchstart",F),e.removeEventListener("touchend",I),e.removeEventListener("touchmove",B),window.removeEventListener("mousemove",R),window.removeEventListener("mouseup",z)},e.addEventListener("contextmenu",U,!1),e.addEventListener("mousedown",T,!1),e.addEventListener("wheel",N,{passive:!1}),e.addEventListener("touchstart",F,{passive:!1}),e.addEventListener("touchend",I,!1),e.addEventListener("touchmove",B,{passive:!1})}let rt=1;const ot={};class at{constructor(t,{vertex:e,fragment:i,uniforms:s={},transparent:n=!1,cullFace:r=t.BACK,frontFace:o=t.CCW,depthTest:a=!0,depthWrite:l=!0,depthFunc:h=t.LESS}={}){t.canvas||console.error("gl not passed as fist argument to Program"),this.gl=t,this.uniforms=s,this.id=rt++,e||console.warn("vertex shader not supplied"),i||console.warn("fragment shader not supplied"),this.transparent=n,this.cullFace=r,this.frontFace=o,this.depthTest=a,this.depthWrite=l,this.depthFunc=h,this.blendFunc={},this.blendEquation={},this.transparent&&!this.blendFunc.src&&(this.gl.renderer.premultipliedAlpha?this.setBlendFunc(this.gl.ONE,this.gl.ONE_MINUS_SRC_ALPHA):this.setBlendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA));const p=t.createShader(t.VERTEX_SHADER);t.shaderSource(p,e),t.compileShader(p),""!==t.getShaderInfoLog(p)&&console.warn(`${t.getShaderInfoLog(p)}\nVertex Shader\n${ht(e)}`);const c=t.createShader(t.FRAGMENT_SHADER);if(t.shaderSource(c,i),t.compileShader(c),""!==t.getShaderInfoLog(c)&&console.warn(`${t.getShaderInfoLog(c)}\nFragment Shader\n${ht(i)}`),this.program=t.createProgram(),t.attachShader(this.program,p),t.attachShader(this.program,c),t.linkProgram(this.program),!t.getProgramParameter(this.program,t.LINK_STATUS))return void console.warn(t.getProgramInfoLog(this.program));t.deleteShader(p),t.deleteShader(c),this.uniformLocations=new Map;let u=t.getProgramParameter(this.program,t.ACTIVE_UNIFORMS);for(let e=0;e<u;e++){let i=t.getActiveUniform(this.program,e);this.uniformLocations.set(i,t.getUniformLocation(this.program,i.name));const s=i.name.match(/(\w+)/g);i.uniformName=s[0],3===s.length?(i.isStructArray=!0,i.structIndex=Number(s[1]),i.structProperty=s[2]):2===s.length&&isNaN(Number(s[1]))&&(i.isStruct=!0,i.structProperty=s[1])}this.attributeLocations=new Map;const d=[],v=t.getProgramParameter(this.program,t.ACTIVE_ATTRIBUTES);for(let e=0;e<v;e++){const i=t.getActiveAttrib(this.program,e),s=t.getAttribLocation(this.program,i.name);d[s]=i.name,this.attributeLocations.set(i,s)}this.attributeOrder=d.join("")}setBlendFunc(t,e,i,s){this.blendFunc.src=t,this.blendFunc.dst=e,this.blendFunc.srcAlpha=i,this.blendFunc.dstAlpha=s,t&&(this.transparent=!0)}setBlendEquation(t,e){this.blendEquation.modeRGB=t,this.blendEquation.modeAlpha=e}applyState(){this.depthTest?this.gl.renderer.enable(this.gl.DEPTH_TEST):this.gl.renderer.disable(this.gl.DEPTH_TEST),this.cullFace?this.gl.renderer.enable(this.gl.CULL_FACE):this.gl.renderer.disable(this.gl.CULL_FACE),this.blendFunc.src?this.gl.renderer.enable(this.gl.BLEND):this.gl.renderer.disable(this.gl.BLEND),this.cullFace&&this.gl.renderer.setCullFace(this.cullFace),this.gl.renderer.setFrontFace(this.frontFace),this.gl.renderer.setDepthMask(this.depthWrite),this.gl.renderer.setDepthFunc(this.depthFunc),this.blendFunc.src&&this.gl.renderer.setBlendFunc(this.blendFunc.src,this.blendFunc.dst,this.blendFunc.srcAlpha,this.blendFunc.dstAlpha),this.gl.renderer.setBlendEquation(this.blendEquation.modeRGB,this.blendEquation.modeAlpha)}use({flipFaces:t=!1}={}){let e=-1;this.gl.renderer.currentProgram===this.id||(this.gl.useProgram(this.program),this.gl.renderer.currentProgram=this.id),this.uniformLocations.forEach(((t,i)=>{let s=i.uniformName,n=this.uniforms[s];if(i.isStruct&&(n=n[i.structProperty],s+=`.${i.structProperty}`),i.isStructArray&&(n=n[i.structIndex][i.structProperty],s+=`[${i.structIndex}].${i.structProperty}`),!n)return ct(`Active uniform ${s} has not been supplied`);if(n&&void 0===n.value)return ct(`${s} uniform is missing a value parameter`);if(n.value.texture)return e+=1,n.value.update(e),lt(this.gl,i.type,t,e);if(n.value.length&&n.value[0].texture){const s=[];return n.value.forEach((t=>{e+=1,t.update(e),s.push(e)})),lt(this.gl,i.type,t,s)}lt(this.gl,i.type,t,n.value)})),this.applyState(),t&&this.gl.renderer.setFrontFace(this.frontFace===this.gl.CCW?this.gl.CW:this.gl.CCW)}remove(){this.gl.deleteProgram(this.program)}}function lt(t,e,i,s){s=s.length?function(t){const e=t.length,i=t[0].length;if(void 0===i)return t;const s=e*i;let n=ot[s];n||(ot[s]=n=new Float32Array(s));for(let s=0;s<e;s++)n.set(t[s],s*i);return n}(s):s;const n=t.renderer.state.uniformLocations.get(i);if(s.length)if(void 0===n||n.length!==s.length)t.renderer.state.uniformLocations.set(i,s.slice(0));else{if(function(t,e){if(t.length!==e.length)return!1;for(let i=0,s=t.length;i<s;i++)if(t[i]!==e[i])return!1;return!0}(n,s))return;n.set?n.set(s):function(t,e){for(let i=0,s=t.length;i<s;i++)t[i]=e[i]}(n,s),t.renderer.state.uniformLocations.set(i,n)}else{if(n===s)return;t.renderer.state.uniformLocations.set(i,s)}switch(e){case 5126:return s.length?t.uniform1fv(i,s):t.uniform1f(i,s);case 35664:return t.uniform2fv(i,s);case 35665:return t.uniform3fv(i,s);case 35666:return t.uniform4fv(i,s);case 35670:case 5124:case 35678:case 35680:return s.length?t.uniform1iv(i,s):t.uniform1i(i,s);case 35671:case 35667:return t.uniform2iv(i,s);case 35672:case 35668:return t.uniform3iv(i,s);case 35673:case 35669:return t.uniform4iv(i,s);case 35674:return t.uniformMatrix2fv(i,!1,s);case 35675:return t.uniformMatrix3fv(i,!1,s);case 35676:return t.uniformMatrix4fv(i,!1,s)}}function ht(t){let e=t.split("\n");for(let t=0;t<e.length;t++)e[t]=t+1+": "+e[t];return e.join("\n")}let pt=0;function ct(t){pt>100||(console.warn(t),pt++,pt>100&&console.warn("More than 100 program warnings - stopping logs."))}const ut=new x;let dt=1;class vt{constructor({canvas:t=document.createElement("canvas"),width:e=300,height:i=150,dpr:s=1,alpha:n=!1,depth:r=!0,stencil:o=!1,antialias:a=!1,premultipliedAlpha:l=!1,preserveDrawingBuffer:h=!1,powerPreference:p="default",autoClear:c=!0,webgl:u=2}={}){const d={alpha:n,depth:r,stencil:o,antialias:a,premultipliedAlpha:l,preserveDrawingBuffer:h,powerPreference:p};this.dpr=s,this.alpha=n,this.color=!0,this.depth=r,this.stencil=o,this.premultipliedAlpha=l,this.autoClear=c,this._id=dt++,2===u&&(this.gl=t.getContext("webgl2",d)),this.isWebgl2=!!this.gl,this.gl||(this.gl=t.getContext("webgl",d)||t.getContext("experimental-webgl",d)),this.gl||console.error("unable to create webgl context"),this.gl.renderer=this,this.setSize(e,i),this.state={},this.state.blendFunc={src:this.gl.ONE,dst:this.gl.ZERO},this.state.blendEquation={modeRGB:this.gl.FUNC_ADD},this.state.cullFace=null,this.state.frontFace=this.gl.CCW,this.state.depthMask=!0,this.state.depthFunc=this.gl.LESS,this.state.premultiplyAlpha=!1,this.state.flipY=!1,this.state.unpackAlignment=4,this.state.framebuffer=null,this.state.viewport={width:null,height:null},this.state.textureUnits=[],this.state.activeTextureUnit=0,this.state.boundBuffer=null,this.state.uniformLocations=new Map,this.extensions={},this.isWebgl2?(this.getExtension("EXT_color_buffer_float"),this.getExtension("OES_texture_float_linear")):(this.getExtension("OES_texture_float"),this.getExtension("OES_texture_float_linear"),this.getExtension("OES_texture_half_float"),this.getExtension("OES_texture_half_float_linear"),this.getExtension("OES_element_index_uint"),this.getExtension("OES_standard_derivatives"),this.getExtension("EXT_sRGB"),this.getExtension("WEBGL_depth_texture"),this.getExtension("WEBGL_draw_buffers")),this.vertexAttribDivisor=this.getExtension("ANGLE_instanced_arrays","vertexAttribDivisor","vertexAttribDivisorANGLE"),this.drawArraysInstanced=this.getExtension("ANGLE_instanced_arrays","drawArraysInstanced","drawArraysInstancedANGLE"),this.drawElementsInstanced=this.getExtension("ANGLE_instanced_arrays","drawElementsInstanced","drawElementsInstancedANGLE"),this.createVertexArray=this.getExtension("OES_vertex_array_object","createVertexArray","createVertexArrayOES"),this.bindVertexArray=this.getExtension("OES_vertex_array_object","bindVertexArray","bindVertexArrayOES"),this.deleteVertexArray=this.getExtension("OES_vertex_array_object","deleteVertexArray","deleteVertexArrayOES"),this.drawBuffers=this.getExtension("WEBGL_draw_buffers","drawBuffers","drawBuffersWEBGL"),this.parameters={},this.parameters.maxTextureUnits=this.gl.getParameter(this.gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS),this.parameters.maxAnisotropy=this.getExtension("EXT_texture_filter_anisotropic")?this.gl.getParameter(this.getExtension("EXT_texture_filter_anisotropic").MAX_TEXTURE_MAX_ANISOTROPY_EXT):0}get id(){return this._id}setSize(t,e){this.width=t,this.height=e,this.gl.canvas.width=t*this.dpr,this.gl.canvas.height=e*this.dpr,Object.assign(this.gl.canvas.style,{width:t+"px",height:e+"px"})}setViewport(t,e){this.state.viewport.width===t&&this.state.viewport.height===e||(this.state.viewport.width=t,this.state.viewport.height=e,this.gl.viewport(0,0,t,e))}enable(t){!0!==this.state[t]&&(this.gl.enable(t),this.state[t]=!0)}disable(t){!1!==this.state[t]&&(this.gl.disable(t),this.state[t]=!1)}setBlendFunc(t,e,i,s){this.state.blendFunc.src===t&&this.state.blendFunc.dst===e&&this.state.blendFunc.srcAlpha===i&&this.state.blendFunc.dstAlpha===s||(this.state.blendFunc.src=t,this.state.blendFunc.dst=e,this.state.blendFunc.srcAlpha=i,this.state.blendFunc.dstAlpha=s,void 0!==i?this.gl.blendFuncSeparate(t,e,i,s):this.gl.blendFunc(t,e))}setBlendEquation(t,e){t=t||this.gl.FUNC_ADD,this.state.blendEquation.modeRGB===t&&this.state.blendEquation.modeAlpha===e||(this.state.blendEquation.modeRGB=t,this.state.blendEquation.modeAlpha=e,void 0!==e?this.gl.blendEquationSeparate(t,e):this.gl.blendEquation(t))}setCullFace(t){this.state.cullFace!==t&&(this.state.cullFace=t,this.gl.cullFace(t))}setFrontFace(t){this.state.frontFace!==t&&(this.state.frontFace=t,this.gl.frontFace(t))}setDepthMask(t){this.state.depthMask!==t&&(this.state.depthMask=t,this.gl.depthMask(t))}setDepthFunc(t){this.state.depthFunc!==t&&(this.state.depthFunc=t,this.gl.depthFunc(t))}activeTexture(t){this.state.activeTextureUnit!==t&&(this.state.activeTextureUnit=t,this.gl.activeTexture(this.gl.TEXTURE0+t))}bindFramebuffer({target:t=this.gl.FRAMEBUFFER,buffer:e=null}={}){this.state.framebuffer!==e&&(this.state.framebuffer=e,this.gl.bindFramebuffer(t,e))}getExtension(t,e,i){return e&&this.gl[e]?this.gl[e].bind(this.gl):(this.extensions[t]||(this.extensions[t]=this.gl.getExtension(t)),e?this.extensions[t]?this.extensions[t][i].bind(this.extensions[t]):null:this.extensions[t])}sortOpaque(t,e){return t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.program.id!==e.program.id?t.program.id-e.program.id:t.zDepth!==e.zDepth?t.zDepth-e.zDepth:e.id-t.id}sortTransparent(t,e){return t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.zDepth!==e.zDepth?e.zDepth-t.zDepth:e.id-t.id}sortUI(t,e){return t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.program.id!==e.program.id?t.program.id-e.program.id:e.id-t.id}getRenderList({scene:t,camera:e,frustumCull:i,sort:s}){let n=[];if(e&&i&&e.updateFrustum(),t.traverse((t=>{if(!t.visible)return!0;_(t)&&(i&&t.frustumCulled&&e&&!e.frustumIntersectsMesh(t)||n.push(t))})),s){const t=[],i=[],s=[];n.forEach((n=>{n.program.transparent?n.program.depthTest?i.push(n):s.push(n):t.push(n),n.zDepth=0,0===n.renderOrder&&n.program.depthTest&&e&&(n.worldMatrix.getTranslation(ut),ut.applyMatrix4(e.projectionViewMatrix),n.zDepth=ut.z)})),t.sort(this.sortOpaque),i.sort(this.sortTransparent),s.sort(this.sortUI),n=t.concat(i,s)}return n}render({scene:t,camera:e,target:i=null,update:s=!0,sort:n=!0,frustumCull:r=!0,clear:o}){null===i?(this.bindFramebuffer(),this.setViewport(this.width*this.dpr,this.height*this.dpr)):(this.bindFramebuffer(i),this.setViewport(i.width,i.height)),(o||this.autoClear&&!1!==o)&&(!this.depth||i&&!i.depth||(this.enable(this.gl.DEPTH_TEST),this.setDepthMask(!0)),this.gl.clear((this.color?this.gl.COLOR_BUFFER_BIT:0)|(this.depth?this.gl.DEPTH_BUFFER_BIT:0)|(this.stencil?this.gl.STENCIL_BUFFER_BIT:0))),s&&t.updateMatrixWorld(),e&&e.updateMatrixWorld();this.getRenderList({scene:t,camera:e,frustumCull:r,sort:n}).forEach((t=>{t.draw({camera:e})}))}}const mt=new Uint8Array(4);function bt(t){return 0==(t&t-1)}let gt=1;class wt{constructor(t,{image:e,target:i=t.TEXTURE_2D,type:s=t.UNSIGNED_BYTE,format:n=t.RGBA,internalFormat:r=n,wrapS:o=t.CLAMP_TO_EDGE,wrapT:a=t.CLAMP_TO_EDGE,generateMipmaps:l=!0,minFilter:h=(l?t.NEAREST_MIPMAP_LINEAR:t.LINEAR),magFilter:p=t.LINEAR,premultiplyAlpha:c=!1,unpackAlignment:u=4,flipY:d=i==t.TEXTURE_2D,anisotropy:v=0,level:m=0,width:b,height:g=b}={}){this.gl=t,this.id=gt++,this.image=e,this.target=i,this.type=s,this.format=n,this.internalFormat=r,this.minFilter=h,this.magFilter=p,this.wrapS=o,this.wrapT=a,this.generateMipmaps=l,this.premultiplyAlpha=c,this.unpackAlignment=u,this.flipY=d,this.anisotropy=Math.min(v,this.gl.renderer.parameters.maxAnisotropy),this.level=m,this.width=b,this.height=g,this.texture=this.gl.createTexture(),this.store={image:null},this.glState=this.gl.renderer.state,this.state={minFilter:this.gl.NEAREST_MIPMAP_LINEAR,magFilter:this.gl.LINEAR,wrapS:this.gl.REPEAT,wrapT:this.gl.REPEAT,anisotropy:0}}bind(){this.glState.textureUnits[this.glState.activeTextureUnit]!==this.id&&(this.gl.bindTexture(this.target,this.texture),this.glState.textureUnits[this.glState.activeTextureUnit]=this.id)}update(t=0){const e=!(this.image===this.store.image&&!this.needsUpdate);if((e||this.glState.textureUnits[t]!==this.id)&&(this.gl.renderer.activeTexture(t),this.bind()),e){if(this.needsUpdate=!1,this.flipY!==this.glState.flipY&&(this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,this.flipY),this.glState.flipY=this.flipY),this.premultiplyAlpha!==this.glState.premultiplyAlpha&&(this.gl.pixelStorei(this.gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.premultiplyAlpha),this.glState.premultiplyAlpha=this.premultiplyAlpha),this.unpackAlignment!==this.glState.unpackAlignment&&(this.gl.pixelStorei(this.gl.UNPACK_ALIGNMENT,this.unpackAlignment),this.glState.unpackAlignment=this.unpackAlignment),this.minFilter!==this.state.minFilter&&(this.gl.texParameteri(this.target,this.gl.TEXTURE_MIN_FILTER,this.minFilter),this.state.minFilter=this.minFilter),this.magFilter!==this.state.magFilter&&(this.gl.texParameteri(this.target,this.gl.TEXTURE_MAG_FILTER,this.magFilter),this.state.magFilter=this.magFilter),this.wrapS!==this.state.wrapS&&(this.gl.texParameteri(this.target,this.gl.TEXTURE_WRAP_S,this.wrapS),this.state.wrapS=this.wrapS),this.wrapT!==this.state.wrapT&&(this.gl.texParameteri(this.target,this.gl.TEXTURE_WRAP_T,this.wrapT),this.state.wrapT=this.wrapT),this.anisotropy&&this.anisotropy!==this.state.anisotropy&&(this.gl.texParameterf(this.target,this.gl.renderer.getExtension("EXT_texture_filter_anisotropic").TEXTURE_MAX_ANISOTROPY_EXT,this.anisotropy),this.state.anisotropy=this.anisotropy),this.image){if(this.image.width&&(this.width=this.image.width,this.height=this.image.height),this.target===this.gl.TEXTURE_CUBE_MAP)for(let t=0;t<6;t++)this.gl.texImage2D(this.gl.TEXTURE_CUBE_MAP_POSITIVE_X+t,this.level,this.internalFormat,this.format,this.type,this.image[t]);else if(ArrayBuffer.isView(this.image))this.gl.texImage2D(this.target,this.level,this.internalFormat,this.width,this.height,0,this.format,this.type,this.image);else if(!0===this.image.isCompressedTexture){let t;for(let e=0;e<this.image.length;e++)t=this.image[e],this.gl.compressedTexImage2D(this.target,e,this.internalFormat,t.width,t.height,0,t.data)}else this.gl.texImage2D(this.target,this.level,this.internalFormat,this.format,this.type,this.image);this.generateMipmaps&&(this.gl.renderer.isWebgl2||bt(this.image.width)&&bt(this.image.height)?this.gl.generateMipmap(this.target):(this.generateMipmaps=!1,this.wrapS=this.wrapT=this.gl.CLAMP_TO_EDGE,this.minFilter=this.gl.LINEAR)),this.onUpdate&&this.onUpdate()}else if(this.target===this.gl.TEXTURE_CUBE_MAP)for(let t=0;t<6;t++)this.gl.texImage2D(this.gl.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,this.gl.RGBA,1,1,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,mt);else this.width?this.gl.texImage2D(this.target,this.level,this.internalFormat,this.width,this.height,0,this.format,this.type,null):this.gl.texImage2D(this.target,0,this.gl.RGBA,1,1,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,mt);this.store.image=this.image}}}var ft;function _t(t){return null==t}function xt(t){return null!==t&&"object"==typeof t}function yt(t){return null!==t&&"object"==typeof t}function Ct(t,e){if(t.length!==e.length)return!1;for(let i=0;i<t.length;i++)if(t[i]!==e[i])return!1;return!0}function Pt(t,e){return Array.from(new Set([...Object.keys(t),...Object.keys(e)])).reduce(((i,s)=>{const n=t[s],r=e[s];return yt(n)&&yt(r)?Object.assign(Object.assign({},i),{[s]:Pt(n,r)}):Object.assign(Object.assign({},i),{[s]:s in e?r:n})}),{})}function Et(t){return!!xt(t)&&"target"in t}ft=new URL(r("27Lyk").resolve("lisvo"),import.meta.url).toString();const kt={alreadydisposed:()=>"View has been already disposed",invalidparams:t=>`Invalid parameters for '${t.name}'`,nomatchingcontroller:t=>`No matching controller for '${t.key}'`,nomatchingview:t=>`No matching view for '${JSON.stringify(t.params)}'`,notbindable:()=>"Value is not bindable",notcompatible:t=>`Not compatible with  plugin '${t.id}'`,propertynotfound:t=>`Property '${t.name}' not found`,shouldneverhappen:()=>"This error should never happen"};class Vt{static alreadyDisposed(){return new Vt({type:"alreadydisposed"})}static notBindable(){return new Vt({type:"notbindable"})}static notCompatible(t,e){return new Vt({type:"notcompatible",context:{id:`${t}.${e}`}})}static propertyNotFound(t){return new Vt({type:"propertynotfound",context:{name:t}})}static shouldNeverHappen(){return new Vt({type:"shouldneverhappen"})}constructor(t){var e;this.message=null!==(e=kt[t.type](t.context))&&void 0!==e?e:"Unexpected error",this.name=this.constructor.name,this.stack=new Error(this.message).stack,this.type=t.type}toString(){return this.message}}class Mt{constructor(t,e){this.obj_=t,this.key=e}static isBindable(t){return null!==t&&("object"==typeof t||"function"==typeof t)}read(){return this.obj_[this.key]}write(t){this.obj_[this.key]=t}writeProperty(t,e){const i=this.read();if(!Mt.isBindable(i))throw Vt.notBindable();if(!(t in i))throw Vt.propertyNotFound(t);i[t]=e}}class Lt{constructor(){this.observers_={}}on(t,e,i){var s;let n=this.observers_[t];return n||(n=this.observers_[t]=[]),n.push({handler:e,key:null!==(s=null==i?void 0:i.key)&&void 0!==s?s:e}),this}off(t,e){const i=this.observers_[t];return i&&(this.observers_[t]=i.filter((t=>t.key!==e))),this}emit(t,e){const i=this.observers_[t];i&&i.forEach((t=>{t.handler(e)}))}}class St{constructor(t,e){var i;this.constraint_=null==e?void 0:e.constraint,this.equals_=null!==(i=null==e?void 0:e.equals)&&void 0!==i?i:(t,e)=>t===e,this.emitter=new Lt,this.rawValue_=t}get constraint(){return this.constraint_}get rawValue(){return this.rawValue_}set rawValue(t){this.setRawValue(t,{forceEmit:!1,last:!0})}setRawValue(t,e){const i=null!=e?e:{forceEmit:!1,last:!0},s=this.constraint_?this.constraint_.constrain(t):t,n=this.rawValue_;(!this.equals_(n,s)||i.forceEmit)&&(this.emitter.emit("beforechange",{sender:this}),this.rawValue_=s,this.emitter.emit("change",{options:i,previousRawValue:n,rawValue:s,sender:this}))}}class At{constructor(t){this.emitter=new Lt,this.value_=t}get rawValue(){return this.value_}set rawValue(t){this.setRawValue(t,{forceEmit:!1,last:!0})}setRawValue(t,e){const i=null!=e?e:{forceEmit:!1,last:!0},s=this.value_;(s!==t||i.forceEmit)&&(this.emitter.emit("beforechange",{sender:this}),this.value_=t,this.emitter.emit("change",{options:i,previousRawValue:s,rawValue:this.value_,sender:this}))}}class Dt{constructor(t){this.emitter=new Lt,this.onValueBeforeChange_=this.onValueBeforeChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.value_=t,this.value_.emitter.on("beforechange",this.onValueBeforeChange_),this.value_.emitter.on("change",this.onValueChange_)}get rawValue(){return this.value_.rawValue}onValueBeforeChange_(t){this.emitter.emit("beforechange",Object.assign(Object.assign({},t),{sender:this}))}onValueChange_(t){this.emitter.emit("change",Object.assign(Object.assign({},t),{sender:this}))}}function Ot(t,e){const i=null==e?void 0:e.constraint,s=null==e?void 0:e.equals;return i||s?new St(t,e):new At(t)}class jt{constructor(t){this.emitter=new Lt,this.valMap_=t;for(const t in this.valMap_){this.valMap_[t].emitter.on("change",(()=>{this.emitter.emit("change",{key:t,sender:this})}))}}static createCore(t){return Object.keys(t).reduce(((e,i)=>Object.assign(e,{[i]:Ot(t[i])})),{})}static fromObject(t){const e=this.createCore(t);return new jt(e)}get(t){return this.valMap_[t].rawValue}set(t,e){this.valMap_[t].rawValue=e}value(t){return this.valMap_[t]}}class Tt{constructor(t){this.values=jt.fromObject({max:t.max,min:t.min})}constrain(t){const e=this.values.get("max"),i=this.values.get("min");return Math.min(Math.max(t,i),e)}}class Rt{constructor(t){this.values=jt.fromObject({max:t.max,min:t.min})}constrain(t){const e=this.values.get("max"),i=this.values.get("min");let s=t;return _t(i)||(s=Math.max(s,i)),_t(e)||(s=Math.min(s,e)),s}}class zt{constructor(t,e=0){this.step=t,this.origin=e}constrain(t){const e=this.origin%this.step;return e+Math.round((t-e)/this.step)*this.step}}class Nt{constructor(t){this.text=t}evaluate(){return Number(this.text)}toString(){return this.text}}const Ft={"**":(t,e)=>Math.pow(t,e),"*":(t,e)=>t*e,"/":(t,e)=>t/e,"%":(t,e)=>t%e,"+":(t,e)=>t+e,"-":(t,e)=>t-e,"<<":(t,e)=>t<<e,">>":(t,e)=>t>>e,">>>":(t,e)=>t>>>e,"&":(t,e)=>t&e,"^":(t,e)=>t^e,"|":(t,e)=>t|e};class Bt{constructor(t,e,i){this.left=e,this.operator=t,this.right=i}evaluate(){const t=Ft[this.operator];if(!t)throw new Error(`unexpected binary operator: '${this.operator}`);return t(this.left.evaluate(),this.right.evaluate())}toString(){return["b(",this.left.toString(),this.operator,this.right.toString(),")"].join(" ")}}const It={"+":t=>t,"-":t=>-t,"~":t=>~t};class Ut{constructor(t,e){this.operator=t,this.expression=e}evaluate(){const t=It[this.operator];if(!t)throw new Error(`unexpected unary operator: '${this.operator}`);return t(this.expression.evaluate())}toString(){return["u(",this.operator,this.expression.toString(),")"].join(" ")}}function Kt(t){return(e,i)=>{for(let s=0;s<t.length;s++){const n=t[s](e,i);if(""!==n)return n}return""}}function qt(t,e){var i;const s=t.substr(e).match(/^\s+/);return null!==(i=s&&s[0])&&void 0!==i?i:""}function $t(t,e){var i;const s=t.substr(e).match(/^[0-9]+/);return null!==(i=s&&s[0])&&void 0!==i?i:""}function Gt(t,e){const i=t.substr(e,1);if(e+=1,"e"!==i.toLowerCase())return"";const s=function(t,e){const i=$t(t,e);if(""!==i)return i;const s=t.substr(e,1);if("-"!==s&&"+"!==s)return"";const n=$t(t,e+=1);return""===n?"":s+n}(t,e);return""===s?"":i+s}function Ht(t,e){const i=t.substr(e,1);if("0"===i)return i;const s=function(t,e){const i=t.substr(e,1);return i.match(/^[1-9]$/)?i:""}(t,e);return e+=s.length,""===s?"":s+$t(t,e)}const Yt=Kt([function(t,e){const i=Ht(t,e);if(e+=i.length,""===i)return"";const s=t.substr(e,1);if(e+=s.length,"."!==s)return"";const n=$t(t,e);return i+s+n+Gt(t,e+=n.length)},function(t,e){const i=t.substr(e,1);if(e+=i.length,"."!==i)return"";const s=$t(t,e);return e+=s.length,""===s?"":i+s+Gt(t,e)},function(t,e){const i=Ht(t,e);return e+=i.length,""===i?"":i+Gt(t,e)}]);const Xt=Kt([function(t,e){const i=t.substr(e,2);if(e+=i.length,"0b"!==i.toLowerCase())return"";const s=function(t,e){var i;const s=t.substr(e).match(/^[01]+/);return null!==(i=s&&s[0])&&void 0!==i?i:""}(t,e);return""===s?"":i+s},function(t,e){const i=t.substr(e,2);if(e+=i.length,"0o"!==i.toLowerCase())return"";const s=function(t,e){var i;const s=t.substr(e).match(/^[0-7]+/);return null!==(i=s&&s[0])&&void 0!==i?i:""}(t,e);return""===s?"":i+s},function(t,e){const i=t.substr(e,2);if(e+=i.length,"0x"!==i.toLowerCase())return"";const s=function(t,e){var i;const s=t.substr(e).match(/^[0-9a-f]+/i);return null!==(i=s&&s[0])&&void 0!==i?i:""}(t,e);return""===s?"":i+s}]),Wt=Kt([Xt,Yt]);function Zt(t,e){var i;return null!==(i=function(t,e){const i=Wt(t,e);return e+=i.length,""===i?null:{evaluable:new Nt(i),cursor:e}}(t,e))&&void 0!==i?i:function(t,e){const i=t.substr(e,1);if(e+=i.length,"("!==i)return null;const s=te(t,e);if(!s)return null;e=s.cursor,e+=qt(t,e).length;const n=t.substr(e,1);return e+=n.length,")"!==n?null:{evaluable:s.evaluable,cursor:e}}(t,e)}function Qt(t,e,i){i+=qt(e,i).length;const s=t.filter((t=>e.startsWith(t,i)))[0];return s?(i+=s.length,{cursor:i+=qt(e,i).length,operator:s}):null}const Jt=[["**"],["*","/","%"],["+","-"],["<<",">>>",">>"],["&"],["^"],["|"]].reduce(((t,e)=>function(t,e){return(i,s)=>{const n=t(i,s);if(!n)return null;s=n.cursor;let r=n.evaluable;for(;;){const n=Qt(e,i,s);if(!n)break;s=n.cursor;const o=t(i,s);if(!o)return null;s=o.cursor,r=new Bt(n.operator,r,o.evaluable)}return r?{cursor:s,evaluable:r}:null}}(t,e)),(function t(e,i){const s=Zt(e,i);if(s)return s;const n=e.substr(i,1);if(i+=n.length,"+"!==n&&"-"!==n&&"~"!==n)return null;const r=t(e,i);return r?{cursor:i=r.cursor,evaluable:new Ut(n,r.evaluable)}:null}));function te(t,e){return e+=qt(t,e).length,Jt(t,e)}function ee(t){var e;const i=function(t){const e=te(t,0);return e?e.cursor+qt(t,e.cursor).length!==t.length?null:e.evaluable:null}(t);return null!==(e=null==i?void 0:i.evaluate())&&void 0!==e?e:null}function ie(t){if("number"==typeof t)return t;if("string"==typeof t){const e=ee(t);if(!_t(e))return e}return 0}function se(t){return String(t)}function ne(t){return e=>e.toFixed(Math.max(Math.min(t,20),0))}function re(t,e,i,s,n){return s+(t-e)/(i-e)*(n-s)}function oe(t){return String(t.toFixed(10)).split(".")[1].replace(/0+$/,"").length}function ae(t,e,i){return Math.min(Math.max(t,e),i)}function le(t,e){return(t%e+e)%e}function he(t,e){return _t(t.step)?Math.max(oe(e),2):oe(t.step)}function pe(t){var e;return null!==(e=t.step)&&void 0!==e?e:1}function ce(t,e){var i;const s=Math.abs(null!==(i=t.step)&&void 0!==i?i:e);return 0===s?.1:Math.pow(10,Math.floor(Math.log10(s))-1)}function ue(t,e){return _t(t.step)?null:new zt(t.step,e)}function de(t){return _t(t.max)||_t(t.min)?_t(t.max)&&_t(t.min)?null:new Rt({max:t.max,min:t.min}):new Tt({max:t.max,min:t.min})}function ve(t,e){var i,s,n;return{formatter:null!==(i=t.format)&&void 0!==i?i:ne(he(t,e)),keyScale:null!==(s=t.keyScale)&&void 0!==s?s:pe(t),pointerScale:null!==(n=t.pointerScale)&&void 0!==n?n:ce(t,e)}}function me(t){return{format:t.optional.function,keyScale:t.optional.number,max:t.optional.number,min:t.optional.number,pointerScale:t.optional.number,step:t.optional.number}}function be(t){return{constraint:t.constraint,textProps:jt.fromObject(ve(t.params,t.initialValue))}}class ge{constructor(t){this.controller=t}get element(){return this.controller.view.element}get disabled(){return this.controller.viewProps.get("disabled")}set disabled(t){this.controller.viewProps.set("disabled",t)}get hidden(){return this.controller.viewProps.get("hidden")}set hidden(t){this.controller.viewProps.set("hidden",t)}dispose(){this.controller.viewProps.set("disposed",!0)}importState(t){return this.controller.importState(t)}exportState(){return this.controller.exportState()}}class we{constructor(t){this.target=t}}class fe extends we{constructor(t,e,i){super(t),this.value=e,this.last=null==i||i}}class _e extends we{constructor(t,e){super(t),this.expanded=e}}class xe extends we{constructor(t,e){super(t),this.index=e}}class ye extends we{constructor(t,e){super(t),this.native=e}}class Ce extends ge{constructor(t){super(t),this.onValueChange_=this.onValueChange_.bind(this),this.emitter_=new Lt,this.controller.value.emitter.on("change",this.onValueChange_)}get label(){return this.controller.labelController.props.get("label")}set label(t){this.controller.labelController.props.set("label",t)}get key(){return this.controller.value.binding.target.key}get tag(){return this.controller.tag}set tag(t){this.controller.tag=t}on(t,e){const i=e.bind(this);return this.emitter_.on(t,(t=>{i(t)}),{key:e}),this}off(t,e){return this.emitter_.off(t,e),this}refresh(){this.controller.value.fetch()}onValueChange_(t){const e=this.controller.value;this.emitter_.emit("change",new fe(this,e.binding.target.read(),t.options.last))}}class Pe{constructor(t,e){this.onValueBeforeChange_=this.onValueBeforeChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.binding=e,this.value_=t,this.value_.emitter.on("beforechange",this.onValueBeforeChange_),this.value_.emitter.on("change",this.onValueChange_),this.emitter=new Lt}get rawValue(){return this.value_.rawValue}set rawValue(t){this.value_.rawValue=t}setRawValue(t,e){this.value_.setRawValue(t,e)}fetch(){this.value_.rawValue=this.binding.read()}push(){this.binding.write(this.value_.rawValue)}onValueBeforeChange_(t){this.emitter.emit("beforechange",Object.assign(Object.assign({},t),{sender:this}))}onValueChange_(t){this.push(),this.emitter.emit("change",Object.assign(Object.assign({},t),{sender:this}))}}function Ee(t){return e=>i=>{if(!e&&void 0===i)return{succeeded:!1,value:void 0};if(e&&void 0===i)return{succeeded:!0,value:void 0};const s=t(i);return void 0!==s?{succeeded:!0,value:s}:{succeeded:!1,value:void 0}}}function ke(t){return{custom:e=>Ee(e)(t),boolean:Ee((t=>"boolean"==typeof t?t:void 0))(t),number:Ee((t=>"number"==typeof t?t:void 0))(t),string:Ee((t=>"string"==typeof t?t:void 0))(t),function:Ee((t=>"function"==typeof t?t:void 0))(t),constant:e=>Ee((t=>t===e?e:void 0))(t),raw:Ee((t=>t))(t),object:e=>Ee((t=>{var i;if(null!==(i=t)&&"object"==typeof i)return function(t,e){return Object.keys(e).reduce(((i,s)=>{if(void 0===i)return;const n=(0,e[s])(t[s]);return n.succeeded?Object.assign(Object.assign({},i),{[s]:n.value}):void 0}),{})}(t,e)}))(t),array:e=>Ee((t=>{var i;if(Array.isArray(t))return i=e,t.reduce(((t,e)=>{if(void 0===t)return;const s=i(e);return s.succeeded&&void 0!==s.value?[...t,s.value]:void 0}),[])}))(t)}}const Ve={optional:ke(!0),required:ke(!1)};function Me(t,e){const i=e(Ve),s=Ve.required.object(i)(t);return s.succeeded?s.value:void 0}function Le(t,e,i,s){if(e&&!e(t))return!1;const n=Me(t,i);return!!n&&s(n)}function Se(t,e){var i;return Pt(null!==(i=null==t?void 0:t())&&void 0!==i?i:{},e)}function Ae(t){return"value"in t}function De(t){if(!xt(t)||!("binding"in t))return!1;return Et(t.binding)}const Oe="http://www.w3.org/2000/svg";function je(t){t.offsetHeight}function Te(t){return void 0!==t.ontouchstart}function Re(){return globalThis.document}const ze={check:'<path d="M2 8l4 4l8 -8"/>',dropdown:'<path d="M5 7h6l-3 3 z"/>',p2dpad:'<path d="M8 4v8"/><path d="M4 8h8"/><circle cx="12" cy="12" r="1.2"/>'};function Ne(t,e){const i=t.createElementNS(Oe,"svg");return i.innerHTML=ze[e],i}function Fe(t,e,i){t.insertBefore(e,t.children[i])}function Be(t){t.parentElement&&t.parentElement.removeChild(t)}function Ie(t){for(;t.children.length>0;)t.removeChild(t.children[0])}function Ue(t){return t.relatedTarget?t.relatedTarget:"explicitOriginalTarget"in t?t.explicitOriginalTarget:null}function Ke(t,e){t.emitter.on("change",(t=>{e(t.rawValue)})),e(t.rawValue)}function qe(t,e,i){Ke(t.value(e),i)}const $e="tp";function Ge(t){return(e,i)=>[$e,"-",t,"v",e?`_${e}`:"",i?`-${i}`:""].join("")}const He=Ge("lbl");class Ye{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(He()),e.viewProps.bindClassModifiers(this.element);const i=t.createElement("div");i.classList.add(He("l")),qe(e.props,"label",(e=>{_t(e)?this.element.classList.add(He(void 0,"nol")):(this.element.classList.remove(He(void 0,"nol")),function(t){for(;t.childNodes.length>0;)t.removeChild(t.childNodes[0])}(i),i.appendChild(function(t,e){const i=t.createDocumentFragment();return e.split("\n").map((e=>t.createTextNode(e))).forEach(((e,s)=>{s>0&&i.appendChild(t.createElement("br")),i.appendChild(e)})),i}(t,e)))})),this.element.appendChild(i),this.labelElement=i;const s=t.createElement("div");s.classList.add(He("v")),this.element.appendChild(s),this.valueElement=s}}class Xe{constructor(t,e){this.props=e.props,this.valueController=e.valueController,this.viewProps=e.valueController.viewProps,this.view=new Ye(t,{props:e.props,viewProps:this.viewProps}),this.view.valueElement.appendChild(this.valueController.view.element)}importProps(t){return Le(t,null,(t=>({label:t.optional.string})),(t=>(this.props.set("label",t.label),!0)))}exportProps(){return Se(null,{label:this.props.get("label")})}}const We=Ge(""),Ze={veryfirst:"vfst",first:"fst",last:"lst",verylast:"vlst"};class Qe{constructor(t){this.parent_=null,this.blade=t.blade,this.view=t.view,this.viewProps=t.viewProps;const e=this.view.element;this.blade.value("positions").emitter.on("change",(()=>{["veryfirst","first","last","verylast"].forEach((t=>{e.classList.remove(We(void 0,Ze[t]))})),this.blade.get("positions").forEach((t=>{e.classList.add(We(void 0,Ze[t]))}))})),this.viewProps.handleDispose((()=>{Be(e)}))}get parent(){return this.parent_}set parent(t){this.parent_=t,this.viewProps.set("parent",this.parent_?this.parent_.viewProps:null)}importState(t){return Le(t,null,(t=>({disabled:t.required.boolean,hidden:t.required.boolean})),(t=>(this.viewProps.importState(t),!0)))}exportState(){return Se(null,Object.assign({},this.viewProps.exportState()))}}class Je extends Qe{constructor(t,e){if(e.value!==e.valueController.value)throw Vt.shouldNeverHappen();const i=e.valueController.viewProps,s=new Xe(t,{blade:e.blade,props:e.props,valueController:e.valueController});super(Object.assign(Object.assign({},e),{view:new Ye(t,{props:e.props,viewProps:i}),viewProps:i})),this.labelController=s,this.value=e.value,this.valueController=e.valueController,this.view.valueElement.appendChild(this.valueController.view.element)}importState(t){return Le(t,(e=>{var i,s,n;return super.importState(e)&&this.labelController.importProps(e)&&(null===(n=null===(s=(i=this.valueController).importProps)||void 0===s?void 0:s.call(i,t))||void 0===n||n)}),(t=>({value:t.optional.raw})),(t=>(t.value&&(this.value.rawValue=t.value),!0)))}exportState(){var t,e,i;return Se((()=>super.exportState()),Object.assign(Object.assign({value:this.value.rawValue},this.labelController.exportProps()),null!==(i=null===(e=(t=this.valueController).exportProps)||void 0===e?void 0:e.call(t))&&void 0!==i?i:{}))}}function ti(t){const e=Object.assign({},t);return delete e.value,e}class ei extends Je{constructor(t,e){super(t,e),this.tag=e.tag}importState(t){return Le(t,(e=>super.importState(ti(t))),(t=>({tag:t.optional.string})),(t=>(this.tag=t.tag,!0)))}exportState(){return Se((()=>ti(super.exportState())),{binding:{key:this.value.binding.target.key,value:this.value.binding.target.read()},tag:this.tag})}}class ii extends ei{importState(t){return Le(t,(t=>super.importState(t)),(t=>({binding:t.required.object({value:t.required.raw})})),(t=>(this.value.binding.inject(t.binding.value),this.value.fetch(),!0)))}}function si(t){return Ae(t)&&function(t){if(!("binding"in t))return!1;const e=t.binding;return Et(e)&&"read"in e&&"write"in e}(t.value)}function ni(t,e){for(;t.length<e;)t.push(void 0)}function ri(t){const e=t.indexOf(void 0);return e<0?t:t.slice(0,e)}class oi{constructor(t){this.emitter=new Lt,this.onTick_=this.onTick_.bind(this),this.onValueBeforeChange_=this.onValueBeforeChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.binding=t.binding,this.value_=Ot(function(t){const e=[];return ni(e,t),e}(t.bufferSize)),this.value_.emitter.on("beforechange",this.onValueBeforeChange_),this.value_.emitter.on("change",this.onValueChange_),this.ticker=t.ticker,this.ticker.emitter.on("tick",this.onTick_),this.fetch()}get rawValue(){return this.value_.rawValue}set rawValue(t){this.value_.rawValue=t}setRawValue(t,e){this.value_.setRawValue(t,e)}fetch(){this.value_.rawValue=function(t,e){const i=[...ri(t),e];return i.length>t.length?i.splice(0,i.length-t.length):ni(i,t.length),i}(this.value_.rawValue,this.binding.read())}onTick_(){this.fetch()}onValueBeforeChange_(t){this.emitter.emit("beforechange",Object.assign(Object.assign({},t),{sender:this}))}onValueChange_(t){this.emitter.emit("change",Object.assign(Object.assign({},t),{sender:this}))}}class ai extends ei{exportState(){return Se((()=>super.exportState()),{binding:{readonly:!0}})}}function li(t){return Ae(t)&&function(t){if(!("binding"in t))return!1;const e=t.binding;return Et(e)&&"read"in e&&!("write"in e)}(t.value)}class hi extends ge{get label(){return this.controller.labelController.props.get("label")}set label(t){this.controller.labelController.props.set("label",t)}get title(){var t;return null!==(t=this.controller.buttonController.props.get("title"))&&void 0!==t?t:""}set title(t){this.controller.buttonController.props.set("title",t)}on(t,e){const i=e.bind(this);return this.controller.buttonController.emitter.on(t,(t=>{i(new ye(this,t.nativeEvent))})),this}off(t,e){return this.controller.buttonController.emitter.off(t,e),this}}function pi(t,e){return i=>{!function(t,e,i){i?t.classList.add(e):t.classList.remove(e)}(t,e,i)}}function ci(t,e){Ke(t,(t=>{e.textContent=null!=t?t:""}))}const ui=Ge("btn");class di{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(ui()),e.viewProps.bindClassModifiers(this.element);const i=t.createElement("button");i.classList.add(ui("b")),e.viewProps.bindDisabled(i),this.element.appendChild(i),this.buttonElement=i;const s=t.createElement("div");s.classList.add(ui("t")),ci(e.props.value("title"),s),this.buttonElement.appendChild(s)}}class vi{constructor(t,e){this.emitter=new Lt,this.onClick_=this.onClick_.bind(this),this.props=e.props,this.viewProps=e.viewProps,this.view=new di(t,{props:this.props,viewProps:this.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}importProps(t){return Le(t,null,(t=>({title:t.optional.string})),(t=>(this.props.set("title",t.title),!0)))}exportProps(){return Se(null,{title:this.props.get("title")})}onClick_(t){this.emitter.emit("click",{nativeEvent:t,sender:this})}}class mi extends Qe{constructor(t,e){const i=new vi(t,{props:e.buttonProps,viewProps:e.viewProps}),s=new Xe(t,{blade:e.blade,props:e.labelProps,valueController:i});super({blade:e.blade,view:s.view,viewProps:e.viewProps}),this.buttonController=i,this.labelController=s}importState(t){return Le(t,(t=>super.importState(t)&&this.buttonController.importProps(t)&&this.labelController.importProps(t)),(()=>({})),(()=>!0))}exportState(){return Se((()=>super.exportState()),Object.assign(Object.assign({},this.buttonController.exportProps()),this.labelController.exportProps()))}}class bi{constructor(t){const[e,i]=t.split("-"),s=e.split(".");this.major=parseInt(s[0],10),this.minor=parseInt(s[1],10),this.patch=parseInt(s[2],10),this.prerelease=null!=i?i:null}toString(){const t=[this.major,this.minor,this.patch].join(".");return null!==this.prerelease?[t,this.prerelease].join("-"):t}}const gi=new bi("2.0.3");function wi(t){return Object.assign({core:gi},t)}const fi=wi({id:"button",type:"blade",accept(t){const e=Me(t,(t=>({title:t.required.string,view:t.required.constant("button"),label:t.optional.string})));return e?{params:e}:null},controller:t=>new mi(t.document,{blade:t.blade,buttonProps:jt.fromObject({title:t.params.title}),labelProps:jt.fromObject({label:t.params.label}),viewProps:t.viewProps}),api:t=>t.controller instanceof mi?new hi(t.controller):null});class _i{constructor(t,e){this.onRackValueChange_=this.onRackValueChange_.bind(this),this.controller_=t,this.emitter_=new Lt,this.pool_=e;this.controller_.rack.emitter.on("valuechange",this.onRackValueChange_)}get children(){return this.controller_.rack.children.map((t=>this.pool_.createApi(t)))}addBinding(t,e,i){const s=null!=i?i:{},n=this.controller_.element.ownerDocument,r=this.pool_.createBinding(n,function(t,e){if(!Mt.isBindable(t))throw Vt.notBindable();return new Mt(t,e)}(t,e),s),o=this.pool_.createBindingApi(r);return this.add(o,s.index)}addFolder(t){return function(t,e){return t.addBlade(Object.assign(Object.assign({},e),{view:"folder"}))}(this,t)}addButton(t){return function(t,e){return t.addBlade(Object.assign(Object.assign({},e),{view:"button"}))}(this,t)}addTab(t){return function(t,e){return t.addBlade(Object.assign(Object.assign({},e),{view:"tab"}))}(this,t)}add(t,e){const i=t.controller;return this.controller_.rack.add(i,e),t}remove(t){this.controller_.rack.remove(t.controller)}addBlade(t){const e=this.controller_.element.ownerDocument,i=this.pool_.createBlade(e,t),s=this.pool_.createApi(i);return this.add(s,t.index)}on(t,e){const i=e.bind(this);return this.emitter_.on(t,(t=>{i(t)}),{key:e}),this}off(t,e){return this.emitter_.off(t,e),this}refresh(){this.children.forEach((t=>{var e;xt(e=t)&&"refresh"in e&&"function"==typeof e.refresh&&t.refresh()}))}onRackValueChange_(t){const e=t.bladeController,i=this.pool_.createApi(e),s=De(e.value)?e.value.binding:null;this.emitter_.emit("change",new fe(i,s?s.target.read():e.value.rawValue,t.options.last))}}class xi extends ge{constructor(t,e){super(t),this.rackApi_=new _i(t.rackController,e)}refresh(){this.rackApi_.refresh()}}class yi extends Qe{constructor(t){super({blade:t.blade,view:t.view,viewProps:t.rackController.viewProps}),this.rackController=t.rackController}importState(t){return Le(t,(t=>super.importState(t)),(t=>({children:t.required.array(t.required.raw)})),(t=>this.rackController.rack.children.every(((e,i)=>e.importState(t.children[i])))))}exportState(){return Se((()=>super.exportState()),{children:this.rackController.rack.children.map((t=>t.exportState()))})}}function Ci(t){return"rackController"in t}class Pi{constructor(t){this.emitter=new Lt,this.items_=[],this.cache_=new Set,this.onSubListAdd_=this.onSubListAdd_.bind(this),this.onSubListRemove_=this.onSubListRemove_.bind(this),this.extract_=t}get items(){return this.items_}allItems(){return Array.from(this.cache_)}find(t){for(const e of this.allItems())if(t(e))return e;return null}includes(t){return this.cache_.has(t)}add(t,e){if(this.includes(t))throw Vt.shouldNeverHappen();const i=void 0!==e?e:this.items_.length;this.items_.splice(i,0,t),this.cache_.add(t);const s=this.extract_(t);s&&(s.emitter.on("add",this.onSubListAdd_),s.emitter.on("remove",this.onSubListRemove_),s.allItems().forEach((t=>{this.cache_.add(t)}))),this.emitter.emit("add",{index:i,item:t,root:this,target:this})}remove(t){const e=this.items_.indexOf(t);if(e<0)return;this.items_.splice(e,1),this.cache_.delete(t);const i=this.extract_(t);i&&(i.allItems().forEach((t=>{this.cache_.delete(t)})),i.emitter.off("add",this.onSubListAdd_),i.emitter.off("remove",this.onSubListRemove_)),this.emitter.emit("remove",{index:e,item:t,root:this,target:this})}onSubListAdd_(t){this.cache_.add(t.item),this.emitter.emit("add",{index:t.index,item:t.item,root:this,target:t.target})}onSubListRemove_(t){this.cache_.delete(t.item),this.emitter.emit("remove",{index:t.index,item:t.item,root:this,target:t.target})}}function Ei(t){return Ci(t)?t.rackController.rack.bcSet_:null}class ki{constructor(t){var e,i;this.emitter=new Lt,this.onBladePositionsChange_=this.onBladePositionsChange_.bind(this),this.onSetAdd_=this.onSetAdd_.bind(this),this.onSetRemove_=this.onSetRemove_.bind(this),this.onChildDispose_=this.onChildDispose_.bind(this),this.onChildPositionsChange_=this.onChildPositionsChange_.bind(this),this.onChildValueChange_=this.onChildValueChange_.bind(this),this.onChildViewPropsChange_=this.onChildViewPropsChange_.bind(this),this.onRackLayout_=this.onRackLayout_.bind(this),this.onRackValueChange_=this.onRackValueChange_.bind(this),this.blade_=null!==(e=t.blade)&&void 0!==e?e:null,null===(i=this.blade_)||void 0===i||i.value("positions").emitter.on("change",this.onBladePositionsChange_),this.viewProps=t.viewProps,this.bcSet_=new Pi(Ei),this.bcSet_.emitter.on("add",this.onSetAdd_),this.bcSet_.emitter.on("remove",this.onSetRemove_)}get children(){return this.bcSet_.items}add(t,e){var i;null===(i=t.parent)||void 0===i||i.remove(t),t.parent=this,this.bcSet_.add(t,e)}remove(t){t.parent=null,this.bcSet_.remove(t)}find(t){return this.bcSet_.allItems().filter(t)}onSetAdd_(t){this.updatePositions_();const e=t.target===t.root;if(this.emitter.emit("add",{bladeController:t.item,index:t.index,root:e,sender:this}),!e)return;const i=t.item;if(i.viewProps.emitter.on("change",this.onChildViewPropsChange_),i.blade.value("positions").emitter.on("change",this.onChildPositionsChange_),i.viewProps.handleDispose(this.onChildDispose_),Ae(i))i.value.emitter.on("change",this.onChildValueChange_);else if(Ci(i)){const t=i.rackController.rack;if(t){const e=t.emitter;e.on("layout",this.onRackLayout_),e.on("valuechange",this.onRackValueChange_)}}}onSetRemove_(t){this.updatePositions_();const e=t.target===t.root;if(this.emitter.emit("remove",{bladeController:t.item,root:e,sender:this}),!e)return;const i=t.item;if(Ae(i))i.value.emitter.off("change",this.onChildValueChange_);else if(Ci(i)){const t=i.rackController.rack;if(t){const e=t.emitter;e.off("layout",this.onRackLayout_),e.off("valuechange",this.onRackValueChange_)}}}updatePositions_(){const t=this.bcSet_.items.filter((t=>!t.viewProps.get("hidden"))),e=t[0],i=t[t.length-1];this.bcSet_.items.forEach((t=>{const s=[];t===e&&(s.push("first"),this.blade_&&!this.blade_.get("positions").includes("veryfirst")||s.push("veryfirst")),t===i&&(s.push("last"),this.blade_&&!this.blade_.get("positions").includes("verylast")||s.push("verylast")),t.blade.set("positions",s)}))}onChildPositionsChange_(){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildViewPropsChange_(t){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildDispose_(){this.bcSet_.items.filter((t=>t.viewProps.get("disposed"))).forEach((t=>{this.bcSet_.remove(t)}))}onChildValueChange_(t){const e=function(t,e){for(let i=0;i<t.length;i++){const s=t[i];if(Ae(s)&&s.value===e)return s}return null}(this.find(Ae),t.sender);if(!e)throw Vt.alreadyDisposed();this.emitter.emit("valuechange",{bladeController:e,options:t.options,sender:this})}onRackLayout_(t){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onRackValueChange_(t){this.emitter.emit("valuechange",{bladeController:t.bladeController,options:t.options,sender:this})}onBladePositionsChange_(){this.updatePositions_()}}class Vi{constructor(t){this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this),this.element=t.element,this.viewProps=t.viewProps;const e=new ki({blade:t.root?void 0:t.blade,viewProps:t.viewProps});e.emitter.on("add",this.onRackAdd_),e.emitter.on("remove",this.onRackRemove_),this.rack=e,this.viewProps.handleDispose((()=>{for(let t=this.rack.children.length-1;t>=0;t--){this.rack.children[t].viewProps.set("disposed",!0)}}))}onRackAdd_(t){t.root&&Fe(this.element,t.bladeController.view.element,t.index)}onRackRemove_(t){t.root&&Be(t.bladeController.view.element)}}function Mi(){return new jt({positions:Ot([],{equals:Ct})})}class Li extends jt{constructor(t){super(t)}static create(t){const e={completed:!0,expanded:t,expandedHeight:null,shouldFixHeight:!1,temporaryExpanded:null},i=jt.createCore(e);return new Li(i)}get styleExpanded(){var t;return null!==(t=this.get("temporaryExpanded"))&&void 0!==t?t:this.get("expanded")}get styleHeight(){if(!this.styleExpanded)return"0";const t=this.get("expandedHeight");return this.get("shouldFixHeight")&&!_t(t)?`${t}px`:"auto"}bindExpandedClass(t,e){const i=()=>{this.styleExpanded?t.classList.add(e):t.classList.remove(e)};qe(this,"expanded",i),qe(this,"temporaryExpanded",i)}cleanUpTransition(){this.set("shouldFixHeight",!1),this.set("expandedHeight",null),this.set("completed",!0)}}function Si(t,e){e.style.height=t.styleHeight}function Ai(t,e){t.value("expanded").emitter.on("beforechange",(()=>{if(t.set("completed",!1),_t(t.get("expandedHeight"))){const i=function(t,e){let i=0;return function(t,e){const i=t.style.transition;t.style.transition="none",e(),t.style.transition=i}(e,(()=>{t.set("expandedHeight",null),t.set("temporaryExpanded",!0),je(e),i=e.clientHeight,t.set("temporaryExpanded",null),je(e)})),i}(t,e);i>0&&t.set("expandedHeight",i)}t.set("shouldFixHeight",!0),je(e)})),t.emitter.on("change",(()=>{Si(t,e)})),Si(t,e),e.addEventListener("transitionend",(e=>{"height"===e.propertyName&&t.cleanUpTransition()}))}class Di extends xi{constructor(t,e){super(t,e),this.emitter_=new Lt,this.controller.foldable.value("expanded").emitter.on("change",(t=>{this.emitter_.emit("fold",new _e(this,t.sender.rawValue))})),this.rackApi_.on("change",(t=>{this.emitter_.emit("change",t)}))}get expanded(){return this.controller.foldable.get("expanded")}set expanded(t){this.controller.foldable.set("expanded",t)}get title(){return this.controller.props.get("title")}set title(t){this.controller.props.set("title",t)}get children(){return this.rackApi_.children}addBinding(t,e,i){return this.rackApi_.addBinding(t,e,i)}addFolder(t){return this.rackApi_.addFolder(t)}addButton(t){return this.rackApi_.addButton(t)}addTab(t){return this.rackApi_.addTab(t)}add(t,e){return this.rackApi_.add(t,e)}remove(t){this.rackApi_.remove(t)}addBlade(t){return this.rackApi_.addBlade(t)}on(t,e){const i=e.bind(this);return this.emitter_.on(t,(t=>{i(t)}),{key:e}),this}off(t,e){return this.emitter_.off(t,e),this}}const Oi=Ge("cnt");class ji{constructor(t,e){var i;this.className_=Ge(null!==(i=e.viewName)&&void 0!==i?i:"fld"),this.element=t.createElement("div"),this.element.classList.add(this.className_(),Oi()),e.viewProps.bindClassModifiers(this.element),this.foldable_=e.foldable,this.foldable_.bindExpandedClass(this.element,this.className_(void 0,"expanded")),qe(this.foldable_,"completed",pi(this.element,this.className_(void 0,"cpl")));const s=t.createElement("button");s.classList.add(this.className_("b")),qe(e.props,"title",(t=>{_t(t)?this.element.classList.add(this.className_(void 0,"not")):this.element.classList.remove(this.className_(void 0,"not"))})),e.viewProps.bindDisabled(s),this.element.appendChild(s),this.buttonElement=s;const n=t.createElement("div");n.classList.add(this.className_("i")),this.element.appendChild(n);const r=t.createElement("div");r.classList.add(this.className_("t")),ci(e.props.value("title"),r),this.buttonElement.appendChild(r),this.titleElement=r;const o=t.createElement("div");o.classList.add(this.className_("m")),this.buttonElement.appendChild(o);const a=t.createElement("div");a.classList.add(this.className_("c")),this.element.appendChild(a),this.containerElement=a}}class Ti extends yi{constructor(t,e){var i;const s=Li.create(null===(i=e.expanded)||void 0===i||i),n=new ji(t,{foldable:s,props:e.props,viewName:e.root?"rot":void 0,viewProps:e.viewProps});super(Object.assign(Object.assign({},e),{rackController:new Vi({blade:e.blade,element:n.containerElement,root:e.root,viewProps:e.viewProps}),view:n})),this.onTitleClick_=this.onTitleClick_.bind(this),this.props=e.props,this.foldable=s,Ai(this.foldable,this.view.containerElement),this.rackController.rack.emitter.on("add",(()=>{this.foldable.cleanUpTransition()})),this.rackController.rack.emitter.on("remove",(()=>{this.foldable.cleanUpTransition()})),this.view.buttonElement.addEventListener("click",this.onTitleClick_)}get document(){return this.view.element.ownerDocument}importState(t){return Le(t,(t=>super.importState(t)),(t=>({expanded:t.required.boolean,title:t.optional.string})),(t=>(this.foldable.set("expanded",t.expanded),this.props.set("title",t.title),!0)))}exportState(){return Se((()=>super.exportState()),{expanded:this.foldable.get("expanded"),title:this.props.get("title")})}onTitleClick_(){this.foldable.set("expanded",!this.foldable.get("expanded"))}}const Ri=wi({id:"folder",type:"blade",accept(t){const e=Me(t,(t=>({title:t.required.string,view:t.required.constant("folder"),expanded:t.optional.boolean})));return e?{params:e}:null},controller:t=>new Ti(t.document,{blade:t.blade,expanded:t.params.expanded,props:jt.fromObject({title:t.params.title}),viewProps:t.viewProps}),api:t=>t.controller instanceof Ti?new Di(t.controller,t.pool):null}),zi=Ge("");function Ni(t,e){return pi(t,zi(void 0,e))}class Fi extends jt{constructor(t){var e,i;super(t),this.onDisabledChange_=this.onDisabledChange_.bind(this),this.onParentChange_=this.onParentChange_.bind(this),this.onParentGlobalDisabledChange_=this.onParentGlobalDisabledChange_.bind(this),[this.globalDisabled_,this.setGlobalDisabled_]=(i=Ot(this.getGlobalDisabled_()),[new Dt(i),(t,e)=>{i.setRawValue(t,e)}]),this.value("disabled").emitter.on("change",this.onDisabledChange_),this.value("parent").emitter.on("change",this.onParentChange_),null===(e=this.get("parent"))||void 0===e||e.globalDisabled.emitter.on("change",this.onParentGlobalDisabledChange_)}static create(t){var e,i,s;const n=null!=t?t:{};return new Fi(jt.createCore({disabled:null!==(e=n.disabled)&&void 0!==e&&e,disposed:!1,hidden:null!==(i=n.hidden)&&void 0!==i&&i,parent:null!==(s=n.parent)&&void 0!==s?s:null}))}get globalDisabled(){return this.globalDisabled_}bindClassModifiers(t){Ke(this.globalDisabled_,Ni(t,"disabled")),qe(this,"hidden",Ni(t,"hidden"))}bindDisabled(t){Ke(this.globalDisabled_,(e=>{t.disabled=e}))}bindTabIndex(t){Ke(this.globalDisabled_,(e=>{t.tabIndex=e?-1:0}))}handleDispose(t){this.value("disposed").emitter.on("change",(e=>{e&&t()}))}importState(t){this.set("disabled",t.disabled),this.set("hidden",t.hidden)}exportState(){return{disabled:this.get("disabled"),hidden:this.get("hidden")}}getGlobalDisabled_(){const t=this.get("parent");return!!t&&t.globalDisabled.rawValue||this.get("disabled")}updateGlobalDisabled_(){this.setGlobalDisabled_(this.getGlobalDisabled_())}onDisabledChange_(){this.updateGlobalDisabled_()}onParentGlobalDisabledChange_(){this.updateGlobalDisabled_()}onParentChange_(t){var e;const i=t.previousRawValue;null==i||i.globalDisabled.emitter.off("change",this.onParentGlobalDisabledChange_),null===(e=this.get("parent"))||void 0===e||e.globalDisabled.emitter.on("change",this.onParentGlobalDisabledChange_),this.updateGlobalDisabled_()}}const Bi=Ge("tbp");class Ii{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(Bi()),e.viewProps.bindClassModifiers(this.element);const i=t.createElement("div");i.classList.add(Bi("c")),this.element.appendChild(i),this.containerElement=i}}const Ui=Ge("tbi");class Ki{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(Ui()),e.viewProps.bindClassModifiers(this.element),qe(e.props,"selected",(t=>{t?this.element.classList.add(Ui(void 0,"sel")):this.element.classList.remove(Ui(void 0,"sel"))}));const i=t.createElement("button");i.classList.add(Ui("b")),e.viewProps.bindDisabled(i),this.element.appendChild(i),this.buttonElement=i;const s=t.createElement("div");s.classList.add(Ui("t")),ci(e.props.value("title"),s),this.buttonElement.appendChild(s),this.titleElement=s}}class qi{constructor(t,e){this.emitter=new Lt,this.onClick_=this.onClick_.bind(this),this.props=e.props,this.viewProps=e.viewProps,this.view=new Ki(t,{props:e.props,viewProps:e.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}onClick_(){this.emitter.emit("click",{sender:this})}}class $i extends yi{constructor(t,e){const i=new Ii(t,{viewProps:e.viewProps});super(Object.assign(Object.assign({},e),{rackController:new Vi({blade:e.blade,element:i.containerElement,viewProps:e.viewProps}),view:i})),this.onItemClick_=this.onItemClick_.bind(this),this.ic_=new qi(t,{props:e.itemProps,viewProps:Fi.create()}),this.ic_.emitter.on("click",this.onItemClick_),this.props=e.props,qe(this.props,"selected",(t=>{this.itemController.props.set("selected",t),this.viewProps.set("hidden",!t)}))}get itemController(){return this.ic_}importState(t){return Le(t,(t=>super.importState(t)),(t=>({selected:t.required.boolean,title:t.required.string})),(t=>(this.ic_.props.set("selected",t.selected),this.ic_.props.set("title",t.title),!0)))}exportState(){return Se((()=>super.exportState()),{selected:this.ic_.props.get("selected"),title:this.ic_.props.get("title")})}onItemClick_(){this.props.set("selected",!0)}}class Gi extends xi{constructor(t,e){super(t,e),this.emitter_=new Lt,this.onSelect_=this.onSelect_.bind(this),this.pool_=e,this.rackApi_.on("change",(t=>{this.emitter_.emit("change",t)})),this.controller.tab.selectedIndex.emitter.on("change",this.onSelect_)}get pages(){return this.rackApi_.children}addPage(t){const e=this.controller.view.element.ownerDocument,i=new $i(e,{blade:Mi(),itemProps:jt.fromObject({selected:!1,title:t.title}),props:jt.fromObject({selected:!1}),viewProps:Fi.create()}),s=this.pool_.createApi(i);return this.rackApi_.add(s,t.index)}removePage(t){this.rackApi_.remove(this.rackApi_.children[t])}on(t,e){const i=e.bind(this);return this.emitter_.on(t,(t=>{i(t)}),{key:e}),this}off(t,e){return this.emitter_.off(t,e),this}onSelect_(t){this.emitter_.emit("select",new xe(this,t.rawValue))}}class Hi extends xi{get title(){var t;return null!==(t=this.controller.itemController.props.get("title"))&&void 0!==t?t:""}set title(t){this.controller.itemController.props.set("title",t)}get selected(){return this.controller.props.get("selected")}set selected(t){this.controller.props.set("selected",t)}get children(){return this.rackApi_.children}addButton(t){return this.rackApi_.addButton(t)}addFolder(t){return this.rackApi_.addFolder(t)}addTab(t){return this.rackApi_.addTab(t)}add(t,e){this.rackApi_.add(t,e)}remove(t){this.rackApi_.remove(t)}addBinding(t,e,i){return this.rackApi_.addBinding(t,e,i)}addBlade(t){return this.rackApi_.addBlade(t)}}class Yi{constructor(){this.onItemSelectedChange_=this.onItemSelectedChange_.bind(this),this.empty=Ot(!0),this.selectedIndex=Ot(-1),this.items_=[]}add(t,e){const i=null!=e?e:this.items_.length;this.items_.splice(i,0,t),t.emitter.on("change",this.onItemSelectedChange_),this.keepSelection_()}remove(t){const e=this.items_.indexOf(t);e<0||(this.items_.splice(e,1),t.emitter.off("change",this.onItemSelectedChange_),this.keepSelection_())}keepSelection_(){if(0===this.items_.length)return this.selectedIndex.rawValue=-1,void(this.empty.rawValue=!0);const t=this.items_.findIndex((t=>t.rawValue));t<0?(this.items_.forEach(((t,e)=>{t.rawValue=0===e})),this.selectedIndex.rawValue=0):(this.items_.forEach(((e,i)=>{e.rawValue=i===t})),this.selectedIndex.rawValue=t),this.empty.rawValue=!1}onItemSelectedChange_(t){if(t.rawValue){const e=this.items_.findIndex((e=>e===t.sender));this.items_.forEach(((t,i)=>{t.rawValue=i===e})),this.selectedIndex.rawValue=e}else this.keepSelection_()}}const Xi=Ge("tab");class Wi{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(Xi(),Oi()),e.viewProps.bindClassModifiers(this.element),Ke(e.empty,pi(this.element,Xi(void 0,"nop")));const i=t.createElement("div");i.classList.add(Xi("t")),this.element.appendChild(i),this.itemsElement=i;const s=t.createElement("div");s.classList.add(Xi("i")),this.element.appendChild(s);const n=t.createElement("div");n.classList.add(Xi("c")),this.element.appendChild(n),this.contentsElement=n}}class Zi extends yi{constructor(t,e){const i=new Yi,s=new Wi(t,{empty:i.empty,viewProps:e.viewProps});super({blade:e.blade,rackController:new Vi({blade:e.blade,element:s.contentsElement,viewProps:e.viewProps}),view:s}),this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this);const n=this.rackController.rack;n.emitter.on("add",this.onRackAdd_),n.emitter.on("remove",this.onRackRemove_),this.tab=i}add(t,e){this.rackController.rack.add(t,e)}remove(t){this.rackController.rack.remove(this.rackController.rack.children[t])}onRackAdd_(t){if(!t.root)return;const e=t.bladeController;Fe(this.view.itemsElement,e.itemController.view.element,t.index),e.itemController.viewProps.set("parent",this.viewProps),this.tab.add(e.props.value("selected"))}onRackRemove_(t){if(!t.root)return;const e=t.bladeController;Be(e.itemController.view.element),e.itemController.viewProps.set("parent",null),this.tab.remove(e.props.value("selected"))}}const Qi=wi({id:"tab",type:"blade",accept(t){const e=Me(t,(t=>({pages:t.required.array(t.required.object({title:t.required.string})),view:t.required.constant("tab")})));return e&&0!==e.pages.length?{params:e}:null},controller(t){const e=new Zi(t.document,{blade:t.blade,viewProps:t.viewProps});return t.params.pages.forEach((i=>{const s=new $i(t.document,{blade:Mi(),itemProps:jt.fromObject({selected:!1,title:i.title}),props:jt.fromObject({selected:!1}),viewProps:Fi.create()});e.add(s)})),e},api:t=>t.controller instanceof Zi?new Gi(t.controller,t.pool):t.controller instanceof $i?new Hi(t.controller,t.pool):null});class Ji extends Ce{get options(){return this.controller.valueController.props.get("options")}set options(t){this.controller.valueController.props.set("options",t)}}class ts{constructor(){this.disabled=!1,this.emitter=new Lt}dispose(){}tick(){this.disabled||this.emitter.emit("tick",{sender:this})}}class es{constructor(t,e){this.disabled_=!1,this.timerId_=null,this.onTick_=this.onTick_.bind(this),this.doc_=t,this.emitter=new Lt,this.interval_=e,this.setTimer_()}get disabled(){return this.disabled_}set disabled(t){this.disabled_=t,this.disabled_?this.clearTimer_():this.setTimer_()}dispose(){this.clearTimer_()}clearTimer_(){if(null===this.timerId_)return;const t=this.doc_.defaultView;t&&t.clearInterval(this.timerId_),this.timerId_=null}setTimer_(){if(this.clearTimer_(),this.interval_<=0)return;const t=this.doc_.defaultView;t&&(this.timerId_=t.setInterval(this.onTick_,this.interval_))}onTick_(){this.disabled_||this.emitter.emit("tick",{sender:this})}}class is{constructor(t){this.constraints=t}constrain(t){return this.constraints.reduce(((t,e)=>e.constrain(t)),t)}}function ss(t,e){if(t instanceof e)return t;if(t instanceof is){const i=t.constraints.reduce(((t,i)=>t||(i instanceof e?i:null)),null);if(i)return i}return null}class ns{constructor(t){this.values=jt.fromObject({options:t})}constrain(t){const e=this.values.get("options");if(0===e.length)return t;return e.filter((e=>e.value===t)).length>0?t:e[0].value}}function rs(t){var e;const i=Ve;return Array.isArray(t)?null===(e=Me({items:t},(t=>({items:t.required.array(t.required.object({text:t.required.string,value:t.required.raw}))}))))||void 0===e?void 0:e.items:"object"==typeof t?i.required.raw(t).value:void 0}function os(t){if(Array.isArray(t))return t;const e=[];return Object.keys(t).forEach((i=>{e.push({text:i,value:t[i]})})),e}function as(t){return _t(t)?null:new ns(os(t))}const ls=Ge("lst");class hs{constructor(t,e){this.onValueChange_=this.onValueChange_.bind(this),this.props_=e.props,this.element=t.createElement("div"),this.element.classList.add(ls()),e.viewProps.bindClassModifiers(this.element);const i=t.createElement("select");i.classList.add(ls("s")),e.viewProps.bindDisabled(i),this.element.appendChild(i),this.selectElement=i;const s=t.createElement("div");s.classList.add(ls("m")),s.appendChild(Ne(t,"dropdown")),this.element.appendChild(s),e.value.emitter.on("change",this.onValueChange_),this.value_=e.value,qe(this.props_,"options",(e=>{Ie(this.selectElement),e.forEach((e=>{const i=t.createElement("option");i.textContent=e.text,this.selectElement.appendChild(i)})),this.update_()}))}update_(){const t=this.props_.get("options").map((t=>t.value));this.selectElement.selectedIndex=t.indexOf(this.value_.rawValue)}onValueChange_(){this.update_()}}class ps{constructor(t,e){this.onSelectChange_=this.onSelectChange_.bind(this),this.props=e.props,this.value=e.value,this.viewProps=e.viewProps,this.view=new hs(t,{props:this.props,value:this.value,viewProps:this.viewProps}),this.view.selectElement.addEventListener("change",this.onSelectChange_)}onSelectChange_(t){const e=t.currentTarget;this.value.rawValue=this.props.get("options")[e.selectedIndex].value}importProps(t){return Le(t,null,(t=>({options:t.required.custom(rs)})),(t=>(this.props.set("options",os(t.options)),!0)))}exportProps(){return Se(null,{options:this.props.get("options")})}}const cs=Ge("pop");class us{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(cs()),e.viewProps.bindClassModifiers(this.element),Ke(e.shows,pi(this.element,cs(void 0,"v")))}}class ds{constructor(t,e){this.shows=Ot(!1),this.viewProps=e.viewProps,this.view=new us(t,{shows:this.shows,viewProps:this.viewProps})}}const vs=Ge("txt");class ms{constructor(t,e){this.onChange_=this.onChange_.bind(this),this.element=t.createElement("div"),this.element.classList.add(vs()),e.viewProps.bindClassModifiers(this.element),this.props_=e.props,this.props_.emitter.on("change",this.onChange_);const i=t.createElement("input");i.classList.add(vs("i")),i.type="text",e.viewProps.bindDisabled(i),this.element.appendChild(i),this.inputElement=i,e.value.emitter.on("change",this.onChange_),this.value_=e.value,this.refresh()}refresh(){const t=this.props_.get("formatter");this.inputElement.value=t(this.value_.rawValue)}onChange_(){this.refresh()}}class bs{constructor(t,e){this.onInputChange_=this.onInputChange_.bind(this),this.parser_=e.parser,this.props=e.props,this.value=e.value,this.viewProps=e.viewProps,this.view=new ms(t,{props:e.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(t){const e=t.currentTarget.value,i=this.parser_(e);_t(i)||(this.value.rawValue=i),this.view.refresh()}}function gs(t){return"false"!==t&&!!t}function ws(t){return function(t){return String(t)}(t)}const fs=ne(0);function _s(t){return fs(t)+"%"}function xs(t){return String(t)}function ys(t){return t}function Cs({primary:t,secondary:e,forward:i,backward:s}){let n=!1;function r(t){n||(n=!0,t(),n=!1)}t.emitter.on("change",(s=>{r((()=>{e.setRawValue(i(t.rawValue,e.rawValue),s.options)}))})),e.emitter.on("change",(n=>{r((()=>{t.setRawValue(s(t.rawValue,e.rawValue),n.options)})),r((()=>{e.setRawValue(i(t.rawValue,e.rawValue),n.options)}))})),r((()=>{e.setRawValue(i(t.rawValue,e.rawValue),{forceEmit:!1,last:!0})}))}function Ps(t,e){const i=t*(e.altKey?.1:1)*(e.shiftKey?10:1);return e.upKey?+i:e.downKey?-i:0}function Es(t){return{altKey:t.altKey,downKey:"ArrowDown"===t.key,shiftKey:t.shiftKey,upKey:"ArrowUp"===t.key}}function ks(t){return{altKey:t.altKey,downKey:"ArrowLeft"===t.key,shiftKey:t.shiftKey,upKey:"ArrowRight"===t.key}}function Vs(t){return function(t){return"ArrowUp"===t||"ArrowDown"===t}(t)||"ArrowLeft"===t||"ArrowRight"===t}function Ms(t,e){var i,s;const n=e.ownerDocument.defaultView,r=e.getBoundingClientRect();return{x:t.pageX-((null!==(i=n&&n.scrollX)&&void 0!==i?i:0)+r.left),y:t.pageY-((null!==(s=n&&n.scrollY)&&void 0!==s?s:0)+r.top)}}class Ls{constructor(t){this.lastTouch_=null,this.onDocumentMouseMove_=this.onDocumentMouseMove_.bind(this),this.onDocumentMouseUp_=this.onDocumentMouseUp_.bind(this),this.onMouseDown_=this.onMouseDown_.bind(this),this.onTouchEnd_=this.onTouchEnd_.bind(this),this.onTouchMove_=this.onTouchMove_.bind(this),this.onTouchStart_=this.onTouchStart_.bind(this),this.elem_=t,this.emitter=new Lt,t.addEventListener("touchstart",this.onTouchStart_,{passive:!1}),t.addEventListener("touchmove",this.onTouchMove_,{passive:!0}),t.addEventListener("touchend",this.onTouchEnd_),t.addEventListener("mousedown",this.onMouseDown_)}computePosition_(t){const e=this.elem_.getBoundingClientRect();return{bounds:{width:e.width,height:e.height},point:t?{x:t.x,y:t.y}:null}}onMouseDown_(t){var e;t.preventDefault(),null===(e=t.currentTarget)||void 0===e||e.focus();const i=this.elem_.ownerDocument;i.addEventListener("mousemove",this.onDocumentMouseMove_),i.addEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("down",{altKey:t.altKey,data:this.computePosition_(Ms(t,this.elem_)),sender:this,shiftKey:t.shiftKey})}onDocumentMouseMove_(t){this.emitter.emit("move",{altKey:t.altKey,data:this.computePosition_(Ms(t,this.elem_)),sender:this,shiftKey:t.shiftKey})}onDocumentMouseUp_(t){const e=this.elem_.ownerDocument;e.removeEventListener("mousemove",this.onDocumentMouseMove_),e.removeEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("up",{altKey:t.altKey,data:this.computePosition_(Ms(t,this.elem_)),sender:this,shiftKey:t.shiftKey})}onTouchStart_(t){t.preventDefault();const e=t.targetTouches.item(0),i=this.elem_.getBoundingClientRect();this.emitter.emit("down",{altKey:t.altKey,data:this.computePosition_(e?{x:e.clientX-i.left,y:e.clientY-i.top}:void 0),sender:this,shiftKey:t.shiftKey}),this.lastTouch_=e}onTouchMove_(t){const e=t.targetTouches.item(0),i=this.elem_.getBoundingClientRect();this.emitter.emit("move",{altKey:t.altKey,data:this.computePosition_(e?{x:e.clientX-i.left,y:e.clientY-i.top}:void 0),sender:this,shiftKey:t.shiftKey}),this.lastTouch_=e}onTouchEnd_(t){var e;const i=null!==(e=t.targetTouches.item(0))&&void 0!==e?e:this.lastTouch_,s=this.elem_.getBoundingClientRect();this.emitter.emit("up",{altKey:t.altKey,data:this.computePosition_(i?{x:i.clientX-s.left,y:i.clientY-s.top}:void 0),sender:this,shiftKey:t.shiftKey})}}const Ss=Ge("txt");class As{constructor(t,e){this.onChange_=this.onChange_.bind(this),this.props_=e.props,this.props_.emitter.on("change",this.onChange_),this.element=t.createElement("div"),this.element.classList.add(Ss(),Ss(void 0,"num")),e.arrayPosition&&this.element.classList.add(Ss(void 0,e.arrayPosition)),e.viewProps.bindClassModifiers(this.element);const i=t.createElement("input");i.classList.add(Ss("i")),i.type="text",e.viewProps.bindDisabled(i),this.element.appendChild(i),this.inputElement=i,this.onDraggingChange_=this.onDraggingChange_.bind(this),this.dragging_=e.dragging,this.dragging_.emitter.on("change",this.onDraggingChange_),this.element.classList.add(Ss()),this.inputElement.classList.add(Ss("i"));const s=t.createElement("div");s.classList.add(Ss("k")),this.element.appendChild(s),this.knobElement=s;const n=t.createElementNS(Oe,"svg");n.classList.add(Ss("g")),this.knobElement.appendChild(n);const r=t.createElementNS(Oe,"path");r.classList.add(Ss("gb")),n.appendChild(r),this.guideBodyElem_=r;const o=t.createElementNS(Oe,"path");o.classList.add(Ss("gh")),n.appendChild(o),this.guideHeadElem_=o;const a=t.createElement("div");a.classList.add(Ge("tt")()),this.knobElement.appendChild(a),this.tooltipElem_=a,e.value.emitter.on("change",this.onChange_),this.value=e.value,this.refresh()}onDraggingChange_(t){if(null===t.rawValue)return void this.element.classList.remove(Ss(void 0,"drg"));this.element.classList.add(Ss(void 0,"drg"));const e=t.rawValue/this.props_.get("pointerScale"),i=e+(e>0?-1:e<0?1:0),s=ae(-i,-4,4);this.guideHeadElem_.setAttributeNS(null,"d",[`M ${i+s},0 L${i},4 L${i+s},8`,`M ${e},-1 L${e},9`].join(" ")),this.guideBodyElem_.setAttributeNS(null,"d",`M 0,4 L${e},4`);const n=this.props_.get("formatter");this.tooltipElem_.textContent=n(this.value.rawValue),this.tooltipElem_.style.left=`${e}px`}refresh(){const t=this.props_.get("formatter");this.inputElement.value=t(this.value.rawValue)}onChange_(){this.refresh()}}class Ds{constructor(t,e){var i;this.originRawValue_=0,this.onInputChange_=this.onInputChange_.bind(this),this.onInputKeyDown_=this.onInputKeyDown_.bind(this),this.onInputKeyUp_=this.onInputKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.parser_=e.parser,this.props=e.props,this.sliderProps_=null!==(i=e.sliderProps)&&void 0!==i?i:null,this.value=e.value,this.viewProps=e.viewProps,this.dragging_=Ot(null),this.view=new As(t,{arrayPosition:e.arrayPosition,dragging:this.dragging_,props:this.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_),this.view.inputElement.addEventListener("keydown",this.onInputKeyDown_),this.view.inputElement.addEventListener("keyup",this.onInputKeyUp_);const s=new Ls(this.view.knobElement);s.emitter.on("down",this.onPointerDown_),s.emitter.on("move",this.onPointerMove_),s.emitter.on("up",this.onPointerUp_)}constrainValue_(t){var e,i;const s=null===(e=this.sliderProps_)||void 0===e?void 0:e.get("min"),n=null===(i=this.sliderProps_)||void 0===i?void 0:i.get("max");let r=t;return void 0!==s&&(r=Math.max(r,s)),void 0!==n&&(r=Math.min(r,n)),r}onInputChange_(t){const e=t.currentTarget.value,i=this.parser_(e);_t(i)||(this.value.rawValue=this.constrainValue_(i)),this.view.refresh()}onInputKeyDown_(t){const e=Ps(this.props.get("keyScale"),Es(t));0!==e&&this.value.setRawValue(this.constrainValue_(this.value.rawValue+e),{forceEmit:!1,last:!1})}onInputKeyUp_(t){0!==Ps(this.props.get("keyScale"),Es(t))&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}onPointerDown_(){this.originRawValue_=this.value.rawValue,this.dragging_.rawValue=0}computeDraggingValue_(t){if(!t.point)return null;const e=t.point.x-t.bounds.width/2;return this.constrainValue_(this.originRawValue_+e*this.props.get("pointerScale"))}onPointerMove_(t){const e=this.computeDraggingValue_(t.data);null!==e&&(this.value.setRawValue(e,{forceEmit:!1,last:!1}),this.dragging_.rawValue=this.value.rawValue-this.originRawValue_)}onPointerUp_(t){const e=this.computeDraggingValue_(t.data);null!==e&&(this.value.setRawValue(e,{forceEmit:!0,last:!0}),this.dragging_.rawValue=null)}}const Os=Ge("sld");class js{constructor(t,e){this.onChange_=this.onChange_.bind(this),this.props_=e.props,this.props_.emitter.on("change",this.onChange_),this.element=t.createElement("div"),this.element.classList.add(Os()),e.viewProps.bindClassModifiers(this.element);const i=t.createElement("div");i.classList.add(Os("t")),e.viewProps.bindTabIndex(i),this.element.appendChild(i),this.trackElement=i;const s=t.createElement("div");s.classList.add(Os("k")),this.trackElement.appendChild(s),this.knobElement=s,e.value.emitter.on("change",this.onChange_),this.value=e.value,this.update_()}update_(){const t=ae(re(this.value.rawValue,this.props_.get("min"),this.props_.get("max"),0,100),0,100);this.knobElement.style.width=`${t}%`}onChange_(){this.update_()}}class Ts{constructor(t,e){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDownOrMove_=this.onPointerDownOrMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=e.value,this.viewProps=e.viewProps,this.props=e.props,this.view=new js(t,{props:this.props,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Ls(this.view.trackElement),this.ptHandler_.emitter.on("down",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("move",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.trackElement.addEventListener("keydown",this.onKeyDown_),this.view.trackElement.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(t,e){t.point&&this.value.setRawValue(re(ae(t.point.x,0,t.bounds.width),0,t.bounds.width,this.props.get("min"),this.props.get("max")),e)}onPointerDownOrMove_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerUp_(t){this.handlePointerEvent_(t.data,{forceEmit:!0,last:!0})}onKeyDown_(t){const e=Ps(this.props.get("keyScale"),ks(t));0!==e&&this.value.setRawValue(this.value.rawValue+e,{forceEmit:!1,last:!1})}onKeyUp_(t){0!==Ps(this.props.get("keyScale"),ks(t))&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const Rs=Ge("sldtxt");class zs{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(Rs());const i=t.createElement("div");i.classList.add(Rs("s")),this.sliderView_=e.sliderView,i.appendChild(this.sliderView_.element),this.element.appendChild(i);const s=t.createElement("div");s.classList.add(Rs("t")),this.textView_=e.textView,s.appendChild(this.textView_.element),this.element.appendChild(s)}}class Ns{constructor(t,e){this.value=e.value,this.viewProps=e.viewProps,this.sliderC_=new Ts(t,{props:e.sliderProps,value:e.value,viewProps:this.viewProps}),this.textC_=new Ds(t,{parser:e.parser,props:e.textProps,sliderProps:e.sliderProps,value:e.value,viewProps:e.viewProps}),this.view=new zs(t,{sliderView:this.sliderC_.view,textView:this.textC_.view})}get sliderController(){return this.sliderC_}get textController(){return this.textC_}importProps(t){return Le(t,null,(t=>({max:t.required.number,min:t.required.number})),(t=>{const e=this.sliderC_.props;return e.set("max",t.max),e.set("min",t.min),!0}))}exportProps(){const t=this.sliderC_.props;return Se(null,{max:t.get("max"),min:t.get("min")})}}function Fs(t){return{sliderProps:new jt({keyScale:t.keyScale,max:t.max,min:t.min}),textProps:new jt({formatter:Ot(t.formatter),keyScale:t.keyScale,pointerScale:Ot(t.pointerScale)})}}const Bs={containerUnitSize:"cnt-usz"};function Is(t){return`--${Bs[t]}`}function Us(t){return me(t)}function Ks(t){if(yt(t))return Me(t,Us)}function qs(t,e){if(!t)return;const i=[],s=ue(t,e);s&&i.push(s);const n=de(t);return n&&i.push(n),new is(i)}function $s(t){if("inline"===t||"popup"===t)return t}function Gs(t,e){t.write(e)}const Hs=Ge("ckb");class Ys{constructor(t,e){this.onValueChange_=this.onValueChange_.bind(this),this.element=t.createElement("div"),this.element.classList.add(Hs()),e.viewProps.bindClassModifiers(this.element);const i=t.createElement("label");i.classList.add(Hs("l")),this.element.appendChild(i),this.labelElement=i;const s=t.createElement("input");s.classList.add(Hs("i")),s.type="checkbox",this.labelElement.appendChild(s),this.inputElement=s,e.viewProps.bindDisabled(this.inputElement);const n=t.createElement("div");n.classList.add(Hs("w")),this.labelElement.appendChild(n);const r=Ne(t,"check");n.appendChild(r),e.value.emitter.on("change",this.onValueChange_),this.value=e.value,this.update_()}update_(){this.inputElement.checked=this.value.rawValue}onValueChange_(){this.update_()}}class Xs{constructor(t,e){this.onInputChange_=this.onInputChange_.bind(this),this.onLabelMouseDown_=this.onLabelMouseDown_.bind(this),this.value=e.value,this.viewProps=e.viewProps,this.view=new Ys(t,{value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_),this.view.labelElement.addEventListener("mousedown",this.onLabelMouseDown_)}onInputChange_(t){const e=t.currentTarget;this.value.rawValue=e.checked,t.preventDefault(),t.stopPropagation()}onLabelMouseDown_(t){t.preventDefault()}}const Ws=wi({id:"input-bool",type:"input",accept:(t,e)=>{if("boolean"!=typeof t)return null;const i=Me(e,(t=>({options:t.optional.custom(rs),readonly:t.optional.constant(!1)})));return i?{initialValue:t,params:i}:null},binding:{reader:t=>gs,constraint:t=>function(t){const e=[],i=as(t.options);return i&&e.push(i),new is(e)}(t.params),writer:t=>Gs},controller:t=>{const e=t.document,i=t.value,s=t.constraint,n=s&&ss(s,ns);return n?new ps(e,{props:new jt({options:n.values.value("options")}),value:i,viewProps:t.viewProps}):new Xs(e,{value:i,viewProps:t.viewProps})},api:t=>"boolean"!=typeof t.controller.value.rawValue?null:t.controller.valueController instanceof ps?new Ji(t.controller):null}),Zs=Ge("col");class Qs{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(Zs()),e.foldable.bindExpandedClass(this.element,Zs(void 0,"expanded")),qe(e.foldable,"completed",pi(this.element,Zs(void 0,"cpl")));const i=t.createElement("div");i.classList.add(Zs("h")),this.element.appendChild(i);const s=t.createElement("div");s.classList.add(Zs("s")),i.appendChild(s),this.swatchElement=s;const n=t.createElement("div");if(n.classList.add(Zs("t")),i.appendChild(n),this.textElement=n,"inline"===e.pickerLayout){const e=t.createElement("div");e.classList.add(Zs("p")),this.element.appendChild(e),this.pickerElement=e}else this.pickerElement=null}}function Js(t,e,i){const s=le(t,360),n=ae(e/100,0,1),r=ae(i/100,0,1),o=r*n,a=o*(1-Math.abs(s/60%2-1)),l=r-o;let h,p,c;return[h,p,c]=s>=0&&s<60?[o,a,0]:s>=60&&s<120?[a,o,0]:s>=120&&s<180?[0,o,a]:s>=180&&s<240?[0,a,o]:s>=240&&s<300?[a,0,o]:[o,0,a],[255*(h+l),255*(p+l),255*(c+l)]}function tn(t){return[t[0],t[1],t[2]]}function en(t,e){return[t[0],t[1],t[2],e]}const sn={hsl:{hsl:(t,e,i)=>[t,e,i],hsv:function(t,e,i){const s=i+e*(100-Math.abs(2*i-100))/200;return[t,0!==s?e*(100-Math.abs(2*i-100))/s:0,i+e*(100-Math.abs(2*i-100))/200]},rgb:function(t,e,i){const s=(t%360+360)%360,n=ae(e/100,0,1),r=ae(i/100,0,1),o=(1-Math.abs(2*r-1))*n,a=o*(1-Math.abs(s/60%2-1)),l=r-o/2;let h,p,c;return[h,p,c]=s>=0&&s<60?[o,a,0]:s>=60&&s<120?[a,o,0]:s>=120&&s<180?[0,o,a]:s>=180&&s<240?[0,a,o]:s>=240&&s<300?[a,0,o]:[o,0,a],[255*(h+l),255*(p+l),255*(c+l)]}},hsv:{hsl:function(t,e,i){const s=100-Math.abs(i*(200-e)/100-100);return[t,0!==s?e*i/s:0,i*(200-e)/200]},hsv:(t,e,i)=>[t,e,i],rgb:Js},rgb:{hsl:function(t,e,i){const s=ae(t/255,0,1),n=ae(e/255,0,1),r=ae(i/255,0,1),o=Math.max(s,n,r),a=Math.min(s,n,r),l=o-a;let h=0,p=0;const c=(a+o)/2;return 0!==l&&(p=l/(1-Math.abs(o+a-1)),h=s===o?(n-r)/l:n===o?2+(r-s)/l:4+(s-n)/l,h=h/6+(h<0?1:0)),[360*h,100*p,100*c]},hsv:function(t,e,i){const s=ae(t/255,0,1),n=ae(e/255,0,1),r=ae(i/255,0,1),o=Math.max(s,n,r),a=o-Math.min(s,n,r);let l;return l=0===a?0:o===s?((n-r)/a%6+6)%6*60:o===n?60*((r-s)/a+2):60*((s-n)/a+4),[l,100*(0===o?0:a/o),100*o]},rgb:(t,e,i)=>[t,e,i]}};function nn(t,e){return["float"===e?1:"rgb"===t?255:360,"float"===e?1:"rgb"===t?255:100,"float"===e?1:"rgb"===t?255:100]}function rn(t,e,i){var s;const n=nn(e,i);return["rgb"===e?ae(t[0],0,n[0]):(r=t[0],o=n[0],r===o?o:le(r,o)),ae(t[1],0,n[1]),ae(t[2],0,n[2]),ae(null!==(s=t[3])&&void 0!==s?s:1,0,1)];var r,o}function on(t,e,i,s){const n=nn(e,i),r=nn(e,s);return t.map(((t,e)=>t/n[e]*r[e]))}function an(t,e,i){const s=on(t,e.mode,e.type,"int");return on(sn[e.mode][i.mode](...s),i.mode,"int",i.type)}class ln{static black(){return new ln([0,0,0],"rgb")}constructor(t,e){this.type="int",this.mode=e,this.comps_=rn(t,e,this.type)}getComponents(t){return en(an(tn(this.comps_),{mode:this.mode,type:this.type},{mode:null!=t?t:this.mode,type:this.type}),this.comps_[3])}toRgbaObject(){const t=this.getComponents("rgb");return{r:t[0],g:t[1],b:t[2],a:t[3]}}}const hn=Ge("colp");class pn{constructor(t,e){this.alphaViews_=null,this.element=t.createElement("div"),this.element.classList.add(hn()),e.viewProps.bindClassModifiers(this.element);const i=t.createElement("div");i.classList.add(hn("hsv"));const s=t.createElement("div");s.classList.add(hn("sv")),this.svPaletteView_=e.svPaletteView,s.appendChild(this.svPaletteView_.element),i.appendChild(s);const n=t.createElement("div");n.classList.add(hn("h")),this.hPaletteView_=e.hPaletteView,n.appendChild(this.hPaletteView_.element),i.appendChild(n),this.element.appendChild(i);const r=t.createElement("div");if(r.classList.add(hn("rgb")),this.textsView_=e.textsView,r.appendChild(this.textsView_.element),this.element.appendChild(r),e.alphaViews){this.alphaViews_={palette:e.alphaViews.palette,text:e.alphaViews.text};const i=t.createElement("div");i.classList.add(hn("a"));const s=t.createElement("div");s.classList.add(hn("ap")),s.appendChild(this.alphaViews_.palette.element),i.appendChild(s);const n=t.createElement("div");n.classList.add(hn("at")),n.appendChild(this.alphaViews_.text.element),i.appendChild(n),this.element.appendChild(i)}}get allFocusableElements(){const t=[this.svPaletteView_.element,this.hPaletteView_.element,this.textsView_.modeSelectElement,...this.textsView_.inputViews.map((t=>t.inputElement))];return this.alphaViews_&&t.push(this.alphaViews_.palette.element,this.alphaViews_.text.inputElement),t}}function cn(t){return"int"===t?"int":"float"===t?"float":void 0}function un(t){return Me(t,(t=>({color:t.optional.object({alpha:t.optional.boolean,type:t.optional.custom(cn)}),expanded:t.optional.boolean,picker:t.optional.custom($s),readonly:t.optional.constant(!1)})))}function dn(t){return t?.1:1}function vn(t){var e;return null===(e=t.color)||void 0===e?void 0:e.type}class mn{constructor(t,e){this.type="float",this.mode=e,this.comps_=rn(t,e,this.type)}getComponents(t){return en(an(tn(this.comps_),{mode:this.mode,type:this.type},{mode:null!=t?t:this.mode,type:this.type}),this.comps_[3])}toRgbaObject(){const t=this.getComponents("rgb");return{r:t[0],g:t[1],b:t[2],a:t[3]}}}const bn={int:(t,e)=>new ln(t,e),float:(t,e)=>new mn(t,e)};function gn(t,e,i){return bn[i](t,e)}function wn(t,e){if(t.type===e)return t;if(function(t){return"int"===t.type}(t)&&"float"===e)return function(t){const e=t.getComponents(),i=nn(t.mode,"int");return new mn([re(e[0],0,i[0],0,1),re(e[1],0,i[1],0,1),re(e[2],0,i[2],0,1),e[3]],t.mode)}(t);if(function(t){return"float"===t.type}(t)&&"int"===e)return function(t){const e=t.getComponents(),i=nn(t.mode,"int");return new ln([Math.round(re(e[0],0,1,0,i[0])),Math.round(re(e[1],0,1,0,i[1])),Math.round(re(e[2],0,1,0,i[2])),e[3]],t.mode)}(t);throw Vt.shouldNeverHappen()}function fn(t,e){const i=t.match(/^(.+)%$/);return i?Math.min(.01*parseFloat(i[1])*e,e):Math.min(parseFloat(t),e)}const _n={deg:t=>t,grad:t=>360*t/400,rad:t=>360*t/(2*Math.PI),turn:t=>360*t};function xn(t){const e=t.match(/^([0-9.]+?)(deg|grad|rad|turn)$/);if(!e)return parseFloat(t);const i=parseFloat(e[1]),s=e[2];return _n[s](i)}function yn(t){const e=t.match(/^rgb\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const i=[fn(e[1],255),fn(e[2],255),fn(e[3],255)];return isNaN(i[0])||isNaN(i[1])||isNaN(i[2])?null:i}function Cn(t){const e=yn(t);return e?new ln(e,"rgb"):null}function Pn(t){const e=t.match(/^rgba\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const i=[fn(e[1],255),fn(e[2],255),fn(e[3],255),fn(e[4],1)];return isNaN(i[0])||isNaN(i[1])||isNaN(i[2])||isNaN(i[3])?null:i}function En(t){const e=Pn(t);return e?new ln(e,"rgb"):null}function kn(t){const e=t.match(/^hsl\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const i=[xn(e[1]),fn(e[2],100),fn(e[3],100)];return isNaN(i[0])||isNaN(i[1])||isNaN(i[2])?null:i}function Vn(t){const e=kn(t);return e?new ln(e,"hsl"):null}function Mn(t){const e=t.match(/^hsla\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const i=[xn(e[1]),fn(e[2],100),fn(e[3],100),fn(e[4],1)];return isNaN(i[0])||isNaN(i[1])||isNaN(i[2])||isNaN(i[3])?null:i}function Ln(t){const e=Mn(t);return e?new ln(e,"hsl"):null}function Sn(t){const e=t.match(/^#([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(e)return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16)];const i=t.match(/^(?:#|0x)([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return i?[parseInt(i[1],16),parseInt(i[2],16),parseInt(i[3],16)]:null}function An(t){const e=Sn(t);return e?new ln(e,"rgb"):null}function Dn(t){const e=t.match(/^#?([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(e)return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16),re(parseInt(e[4]+e[4],16),0,255,0,1)];const i=t.match(/^(?:#|0x)?([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return i?[parseInt(i[1],16),parseInt(i[2],16),parseInt(i[3],16),re(parseInt(i[4],16),0,255,0,1)]:null}function On(t){const e=Dn(t);return e?new ln(e,"rgb"):null}function jn(t){const e=t.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!e)return null;const i=[parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3])];return isNaN(i[0])||isNaN(i[1])||isNaN(i[2])?null:i}function Tn(t){return e=>{const i=jn(e);return i?gn(i,"rgb",t):null}}function Rn(t){const e=t.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*a\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!e)return null;const i=[parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3]),parseFloat(e[4])];return isNaN(i[0])||isNaN(i[1])||isNaN(i[2])||isNaN(i[3])?null:i}function zn(t){return e=>{const i=Rn(e);return i?gn(i,"rgb",t):null}}const Nn=[{parser:Sn,result:{alpha:!1,mode:"rgb",notation:"hex"}},{parser:Dn,result:{alpha:!0,mode:"rgb",notation:"hex"}},{parser:yn,result:{alpha:!1,mode:"rgb",notation:"func"}},{parser:Pn,result:{alpha:!0,mode:"rgb",notation:"func"}},{parser:kn,result:{alpha:!1,mode:"hsl",notation:"func"}},{parser:Mn,result:{alpha:!0,mode:"hsl",notation:"func"}},{parser:jn,result:{alpha:!1,mode:"rgb",notation:"object"}},{parser:Rn,result:{alpha:!0,mode:"rgb",notation:"object"}}];function Fn(t,e="int"){const i=function(t){return Nn.reduce(((e,{parser:i,result:s})=>e||(i(t)?s:null)),null)}(t);return i?"hex"===i.notation&&"float"!==e?Object.assign(Object.assign({},i),{type:"int"}):"func"===i.notation?Object.assign(Object.assign({},i),{type:e}):null:null}function Bn(t){const e=[An,On,Cn,En,Vn,Ln];"int"===t&&e.push(Tn("int"),zn("int")),"float"===t&&e.push(Tn("float"),zn("float"));const i=function(t){return e=>t.reduce(((t,i)=>null!==t?t:i(e)),null)}(e);return e=>{const s=i(e);return s?wn(s,t):null}}function In(t){const e=Bn("int");if("string"!=typeof t)return ln.black();const i=e(t);return null!=i?i:ln.black()}function Un(t){const e=ae(Math.floor(t),0,255).toString(16);return 1===e.length?`0${e}`:e}function Kn(t,e="#"){return`${e}${tn(t.getComponents("rgb")).map(Un).join("")}`}function qn(t,e="#"){const i=t.getComponents("rgb");return`${e}${[i[0],i[1],i[2],255*i[3]].map(Un).join("")}`}function $n(t){const e=ne(0);return`rgb(${tn(wn(t,"int").getComponents("rgb")).map((t=>e(t))).join(", ")})`}function Gn(t){const e=ne(2),i=ne(0);return`rgba(${wn(t,"int").getComponents("rgb").map(((t,s)=>(3===s?e:i)(t))).join(", ")})`}function Hn(t,e){const i=ne("float"===e?2:0),s=["r","g","b"];return`{${tn(wn(t,e).getComponents("rgb")).map(((t,e)=>`${s[e]}: ${i(t)}`)).join(", ")}}`}function Yn(t){return e=>Hn(e,t)}function Xn(t,e){const i=ne(2),s=ne("float"===e?2:0),n=["r","g","b","a"];return`{${wn(t,e).getComponents("rgb").map(((t,e)=>`${n[e]}: ${(3===e?i:s)(t)}`)).join(", ")}}`}function Wn(t){return e=>Xn(e,t)}const Zn=[{format:{alpha:!1,mode:"rgb",notation:"hex",type:"int"},stringifier:Kn},{format:{alpha:!0,mode:"rgb",notation:"hex",type:"int"},stringifier:qn},{format:{alpha:!1,mode:"rgb",notation:"func",type:"int"},stringifier:$n},{format:{alpha:!0,mode:"rgb",notation:"func",type:"int"},stringifier:Gn},{format:{alpha:!1,mode:"hsl",notation:"func",type:"int"},stringifier:function(t){const e=[ne(0),_s,_s];return`hsl(${tn(wn(t,"int").getComponents("hsl")).map(((t,i)=>e[i](t))).join(", ")})`}},{format:{alpha:!0,mode:"hsl",notation:"func",type:"int"},stringifier:function(t){const e=[ne(0),_s,_s,ne(2)];return`hsla(${wn(t,"int").getComponents("hsl").map(((t,i)=>e[i](t))).join(", ")})`}},...["int","float"].reduce(((t,e)=>[...t,{format:{alpha:!1,mode:"rgb",notation:"object",type:e},stringifier:Yn(e)},{format:{alpha:!0,mode:"rgb",notation:"object",type:e},stringifier:Wn(e)}]),[])];function Qn(t){return Zn.reduce(((e,i)=>{return e||(s=i.format,n=t,s.alpha===n.alpha&&s.mode===n.mode&&s.notation===n.notation&&s.type===n.type?i.stringifier:null);var s,n}),null)}const Jn=Ge("apl");class tr{constructor(t,e){this.onValueChange_=this.onValueChange_.bind(this),this.value=e.value,this.value.emitter.on("change",this.onValueChange_),this.element=t.createElement("div"),this.element.classList.add(Jn()),e.viewProps.bindClassModifiers(this.element),e.viewProps.bindTabIndex(this.element);const i=t.createElement("div");i.classList.add(Jn("b")),this.element.appendChild(i);const s=t.createElement("div");s.classList.add(Jn("c")),i.appendChild(s),this.colorElem_=s;const n=t.createElement("div");n.classList.add(Jn("m")),this.element.appendChild(n),this.markerElem_=n;const r=t.createElement("div");r.classList.add(Jn("p")),this.markerElem_.appendChild(r),this.previewElem_=r,this.update_()}update_(){const t=this.value.rawValue,e=t.getComponents("rgb"),i=new ln([e[0],e[1],e[2],0],"rgb"),s=new ln([e[0],e[1],e[2],255],"rgb"),n=["to right",Gn(i),Gn(s)];this.colorElem_.style.background=`linear-gradient(${n.join(",")})`,this.previewElem_.style.backgroundColor=Gn(t);const r=re(e[3],0,1,0,100);this.markerElem_.style.left=`${r}%`}onValueChange_(){this.update_()}}class er{constructor(t,e){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=e.value,this.viewProps=e.viewProps,this.view=new tr(t,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Ls(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(t,e){if(!t.point)return;const i=t.point.x/t.bounds.width,s=this.value.rawValue,[n,r,o]=s.getComponents("hsv");this.value.setRawValue(new ln([n,r,o,i],"hsv"),e)}onPointerDown_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerMove_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerUp_(t){this.handlePointerEvent_(t.data,{forceEmit:!0,last:!0})}onKeyDown_(t){const e=Ps(dn(!0),ks(t));if(0===e)return;const i=this.value.rawValue,[s,n,r,o]=i.getComponents("hsv");this.value.setRawValue(new ln([s,n,r,o+e],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(t){0!==Ps(dn(!0),ks(t))&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const ir=Ge("coltxt");class sr{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(ir()),e.viewProps.bindClassModifiers(this.element);const i=t.createElement("div");i.classList.add(ir("m")),this.modeElem_=function(t){const e=t.createElement("select");return e.appendChild([{text:"RGB",value:"rgb"},{text:"HSL",value:"hsl"},{text:"HSV",value:"hsv"},{text:"HEX",value:"hex"}].reduce(((e,i)=>{const s=t.createElement("option");return s.textContent=i.text,s.value=i.value,e.appendChild(s),e}),t.createDocumentFragment())),e}(t),this.modeElem_.classList.add(ir("ms")),i.appendChild(this.modeSelectElement),e.viewProps.bindDisabled(this.modeElem_);const s=t.createElement("div");s.classList.add(ir("mm")),s.appendChild(Ne(t,"dropdown")),i.appendChild(s),this.element.appendChild(i);const n=t.createElement("div");n.classList.add(ir("w")),this.element.appendChild(n),this.inputsElem_=n,this.inputViews_=e.inputViews,this.applyInputViews_(),Ke(e.mode,(t=>{this.modeElem_.value=t}))}get modeSelectElement(){return this.modeElem_}get inputViews(){return this.inputViews_}set inputViews(t){this.inputViews_=t,this.applyInputViews_()}applyInputViews_(){Ie(this.inputsElem_);const t=this.element.ownerDocument;this.inputViews_.forEach((e=>{const i=t.createElement("div");i.classList.add(ir("c")),i.appendChild(e.element),this.inputsElem_.appendChild(i)}))}}function nr(t,e,i){const s=nn(t,e)[i];return new Tt({min:0,max:s})}function rr(t,e){const i={colorMode:e.colorMode,colorType:e.colorType,parser:ee,viewProps:e.viewProps};return[0,1,2].map((s=>{const n=function(t,e,i){return new Ds(t,{arrayPosition:0===i?"fst":2===i?"lst":"mid",parser:e.parser,props:jt.fromObject({formatter:(s=e.colorType,ne("float"===s?2:0)),keyScale:dn(!1),pointerScale:"float"===e.colorType?.01:1}),value:Ot(0,{constraint:nr(e.colorMode,e.colorType,i)}),viewProps:e.viewProps});var s}(t,i,s);return Cs({primary:e.value,secondary:n.value,forward:t=>wn(t,e.colorType).getComponents(e.colorMode)[s],backward(t,i){const n=e.colorMode,r=wn(t,e.colorType).getComponents(n);r[s]=i;return wn(gn(en(tn(r),r[3]),n,e.colorType),"int")}}),n}))}class or{constructor(t,e){this.onModeSelectChange_=this.onModeSelectChange_.bind(this),this.colorType_=e.colorType,this.value=e.value,this.viewProps=e.viewProps,this.colorMode=Ot(this.value.rawValue.mode),this.ccs_=this.createComponentControllers_(t),this.view=new sr(t,{mode:this.colorMode,inputViews:[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view],viewProps:this.viewProps}),this.view.modeSelectElement.addEventListener("change",this.onModeSelectChange_)}createComponentControllers_(t){const e=this.colorMode.rawValue;return function(t){return"hex"!==t}(e)?rr(t,{colorMode:e,colorType:this.colorType_,value:this.value,viewProps:this.viewProps}):function(t,e){const i=new bs(t,{parser:Bn("int"),props:jt.fromObject({formatter:Kn}),value:Ot(ln.black()),viewProps:e.viewProps});return Cs({primary:e.value,secondary:i.value,forward:t=>new ln(tn(t.getComponents()),t.mode),backward:(t,e)=>new ln(en(tn(e.getComponents(t.mode)),t.getComponents()[3]),t.mode)}),[i]}(t,{value:this.value,viewProps:this.viewProps})}onModeSelectChange_(t){const e=t.currentTarget;this.colorMode.rawValue=e.value,this.ccs_=this.createComponentControllers_(this.view.element.ownerDocument),this.view.inputViews=this.ccs_.map((t=>t.view))}}const ar=Ge("hpl");class lr{constructor(t,e){this.onValueChange_=this.onValueChange_.bind(this),this.value=e.value,this.value.emitter.on("change",this.onValueChange_),this.element=t.createElement("div"),this.element.classList.add(ar()),e.viewProps.bindClassModifiers(this.element),e.viewProps.bindTabIndex(this.element);const i=t.createElement("div");i.classList.add(ar("c")),this.element.appendChild(i);const s=t.createElement("div");s.classList.add(ar("m")),this.element.appendChild(s),this.markerElem_=s,this.update_()}update_(){const t=this.value.rawValue,[e]=t.getComponents("hsv");this.markerElem_.style.backgroundColor=$n(new ln([e,100,100],"hsv"));const i=re(e,0,360,0,100);this.markerElem_.style.left=`${i}%`}onValueChange_(){this.update_()}}class hr{constructor(t,e){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=e.value,this.viewProps=e.viewProps,this.view=new lr(t,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Ls(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(t,e){if(!t.point)return;const i=re(ae(t.point.x,0,t.bounds.width),0,t.bounds.width,0,360),s=this.value.rawValue,[,n,r,o]=s.getComponents("hsv");this.value.setRawValue(new ln([i,n,r,o],"hsv"),e)}onPointerDown_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerMove_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerUp_(t){this.handlePointerEvent_(t.data,{forceEmit:!0,last:!0})}onKeyDown_(t){const e=Ps(dn(!1),ks(t));if(0===e)return;const i=this.value.rawValue,[s,n,r,o]=i.getComponents("hsv");this.value.setRawValue(new ln([s+e,n,r,o],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(t){0!==Ps(dn(!1),ks(t))&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const pr=Ge("svp");class cr{constructor(t,e){this.onValueChange_=this.onValueChange_.bind(this),this.value=e.value,this.value.emitter.on("change",this.onValueChange_),this.element=t.createElement("div"),this.element.classList.add(pr()),e.viewProps.bindClassModifiers(this.element),e.viewProps.bindTabIndex(this.element);const i=t.createElement("canvas");i.height=64,i.width=64,i.classList.add(pr("c")),this.element.appendChild(i),this.canvasElement=i;const s=t.createElement("div");s.classList.add(pr("m")),this.element.appendChild(s),this.markerElem_=s,this.update_()}update_(){const t=function(t){const e=t.ownerDocument.defaultView;return e&&"document"in e?t.getContext("2d",{willReadFrequently:!0}):null}(this.canvasElement);if(!t)return;const e=this.value.rawValue.getComponents("hsv"),i=this.canvasElement.width,s=this.canvasElement.height,n=t.getImageData(0,0,i,s),r=n.data;for(let t=0;t<s;t++)for(let n=0;n<i;n++){const o=re(n,0,i,0,100),a=re(t,0,s,100,0),l=Js(e[0],o,a),h=4*(t*i+n);r[h]=l[0],r[h+1]=l[1],r[h+2]=l[2],r[h+3]=255}t.putImageData(n,0,0);const o=re(e[1],0,100,0,100);this.markerElem_.style.left=`${o}%`;const a=re(e[2],0,100,100,0);this.markerElem_.style.top=`${a}%`}onValueChange_(){this.update_()}}class ur{constructor(t,e){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=e.value,this.viewProps=e.viewProps,this.view=new cr(t,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Ls(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(t,e){if(!t.point)return;const i=re(t.point.x,0,t.bounds.width,0,100),s=re(t.point.y,0,t.bounds.height,100,0),[n,,,r]=this.value.rawValue.getComponents("hsv");this.value.setRawValue(new ln([n,i,s,r],"hsv"),e)}onPointerDown_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerMove_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerUp_(t){this.handlePointerEvent_(t.data,{forceEmit:!0,last:!0})}onKeyDown_(t){Vs(t.key)&&t.preventDefault();const[e,i,s,n]=this.value.rawValue.getComponents("hsv"),r=dn(!1),o=Ps(r,ks(t)),a=Ps(r,Es(t));0===o&&0===a||this.value.setRawValue(new ln([e,i+o,s+a,n],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(t){const e=dn(!1),i=Ps(e,ks(t)),s=Ps(e,Es(t));0===i&&0===s||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class dr{constructor(t,e){this.value=e.value,this.viewProps=e.viewProps,this.hPaletteC_=new hr(t,{value:this.value,viewProps:this.viewProps}),this.svPaletteC_=new ur(t,{value:this.value,viewProps:this.viewProps}),this.alphaIcs_=e.supportsAlpha?{palette:new er(t,{value:this.value,viewProps:this.viewProps}),text:new Ds(t,{parser:ee,props:jt.fromObject({pointerScale:.01,keyScale:.1,formatter:ne(2)}),value:Ot(0,{constraint:new Tt({min:0,max:1})}),viewProps:this.viewProps})}:null,this.alphaIcs_&&Cs({primary:this.value,secondary:this.alphaIcs_.text.value,forward:t=>t.getComponents()[3],backward:(t,e)=>{const i=t.getComponents();return i[3]=e,new ln(i,t.mode)}}),this.textsC_=new or(t,{colorType:e.colorType,value:this.value,viewProps:this.viewProps}),this.view=new pn(t,{alphaViews:this.alphaIcs_?{palette:this.alphaIcs_.palette.view,text:this.alphaIcs_.text.view}:null,hPaletteView:this.hPaletteC_.view,supportsAlpha:e.supportsAlpha,svPaletteView:this.svPaletteC_.view,textsView:this.textsC_.view,viewProps:this.viewProps})}get textsController(){return this.textsC_}}const vr=Ge("colsw");class mr{constructor(t,e){this.onValueChange_=this.onValueChange_.bind(this),e.value.emitter.on("change",this.onValueChange_),this.value=e.value,this.element=t.createElement("div"),this.element.classList.add(vr()),e.viewProps.bindClassModifiers(this.element);const i=t.createElement("div");i.classList.add(vr("sw")),this.element.appendChild(i),this.swatchElem_=i;const s=t.createElement("button");s.classList.add(vr("b")),e.viewProps.bindDisabled(s),this.element.appendChild(s),this.buttonElement=s,this.update_()}update_(){const t=this.value.rawValue;this.swatchElem_.style.backgroundColor=qn(t)}onValueChange_(){this.update_()}}class br{constructor(t,e){this.value=e.value,this.viewProps=e.viewProps,this.view=new mr(t,{value:this.value,viewProps:this.viewProps})}}class gr{constructor(t,e){this.onButtonBlur_=this.onButtonBlur_.bind(this),this.onButtonClick_=this.onButtonClick_.bind(this),this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.value=e.value,this.viewProps=e.viewProps,this.foldable_=Li.create(e.expanded),this.swatchC_=new br(t,{value:this.value,viewProps:this.viewProps});const i=this.swatchC_.view.buttonElement;i.addEventListener("blur",this.onButtonBlur_),i.addEventListener("click",this.onButtonClick_),this.textC_=new bs(t,{parser:e.parser,props:jt.fromObject({formatter:e.formatter}),value:this.value,viewProps:this.viewProps}),this.view=new Qs(t,{foldable:this.foldable_,pickerLayout:e.pickerLayout}),this.view.swatchElement.appendChild(this.swatchC_.view.element),this.view.textElement.appendChild(this.textC_.view.element),this.popC_="popup"===e.pickerLayout?new ds(t,{viewProps:this.viewProps}):null;const s=new dr(t,{colorType:e.colorType,supportsAlpha:e.supportsAlpha,value:this.value,viewProps:this.viewProps});s.view.allFocusableElements.forEach((t=>{t.addEventListener("blur",this.onPopupChildBlur_),t.addEventListener("keydown",this.onPopupChildKeydown_)})),this.pickerC_=s,this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(s.view.element),Cs({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:t=>t,backward:(t,e)=>e})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),Ai(this.foldable_,this.view.pickerElement))}get textController(){return this.textC_}onButtonBlur_(t){if(!this.popC_)return;const e=this.view.element,i=t.relatedTarget;i&&e.contains(i)||(this.popC_.shows.rawValue=!1)}onButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(t){if(!this.popC_)return;const e=this.popC_.view.element,i=Ue(t);i&&e.contains(i)||i&&i===this.swatchC_.view.buttonElement&&!Te(e.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(t){this.popC_?"Escape"===t.key&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&"Escape"===t.key&&this.swatchC_.view.buttonElement.focus()}}function wr(t){return tn(t.getComponents("rgb")).reduce(((t,e)=>t<<8|255&Math.floor(e)),0)}function fr(t){return t.getComponents("rgb").reduce(((t,e,i)=>t<<8|255&Math.floor(3===i?255*e:e)),0)>>>0}function _r(t){return"number"!=typeof t?ln.black():new ln([(e=t)>>16&255,e>>8&255,255&e],"rgb");var e}function xr(t){return"number"!=typeof t?ln.black():new ln([(e=t)>>24&255,e>>16&255,e>>8&255,re(255&e,0,255,0,1)],"rgb");var e}function yr(t,e){return"object"==typeof t&&!_t(t)&&(e in t&&"number"==typeof t[e])}function Cr(t){return yr(t,"r")&&yr(t,"g")&&yr(t,"b")}function Pr(t){return Cr(t)&&yr(t,"a")}function Er(t){return Cr(t)}function kr(t,e){if(t.mode!==e.mode)return!1;if(t.type!==e.type)return!1;const i=t.getComponents(),s=e.getComponents();for(let t=0;t<i.length;t++)if(i[t]!==s[t])return!1;return!0}function Vr(t){return"a"in t?[t.r,t.g,t.b,t.a]:[t.r,t.g,t.b]}function Mr(t,e){return(i,s)=>{t?function(t,e,i){const s=wn(e,i).toRgbaObject();t.writeProperty("r",s.r),t.writeProperty("g",s.g),t.writeProperty("b",s.b),t.writeProperty("a",s.a)}(i,s,e):function(t,e,i){const s=wn(e,i).toRgbaObject();t.writeProperty("r",s.r),t.writeProperty("g",s.g),t.writeProperty("b",s.b)}(i,s,e)}}const Lr=wi({id:"input-color-number",type:"input",accept:(t,e)=>{if("number"!=typeof t)return null;if(!function(t){return"color"in t||"color"===t.view}(e))return null;const i=un(e);return i?{initialValue:t,params:Object.assign(Object.assign({},i),{supportsAlpha:(s=e,!!(null===(n=null==s?void 0:s.color)||void 0===n?void 0:n.alpha))})}:null;var s,n},binding:{reader:t=>t.params.supportsAlpha?xr:_r,equals:kr,writer:t=>function(t){const e=t?fr:wr;return(t,i)=>{Gs(t,e(i))}}(t.params.supportsAlpha)},controller:t=>{var e,i,s;return new gr(t.document,{colorType:"int",expanded:null!==(e=t.params.expanded)&&void 0!==e&&e,formatter:(s=t.params.supportsAlpha,s?t=>qn(t,"0x"):t=>Kn(t,"0x")),parser:Bn("int"),pickerLayout:null!==(i=t.params.picker)&&void 0!==i?i:"popup",supportsAlpha:t.params.supportsAlpha,value:t.value,viewProps:t.viewProps})}});function Sr(t){return e=>{const i=function(t,e){if(!Er(t))return wn(ln.black(),e);if("int"===e){const e=Vr(t);return new ln(e,"rgb")}if("float"===e){const e=Vr(t);return new mn(e,"rgb")}return wn(ln.black(),"int")}(e,t);return wn(i,"int")}}function Ar(t,e){return i=>t?Xn(i,e):Hn(i,e)}const Dr=wi({id:"input-color-object",type:"input",accept:(t,e)=>{var i;if(!Er(t))return null;const s=un(e);return s?{initialValue:t,params:Object.assign(Object.assign({},s),{colorType:null!==(i=vn(e))&&void 0!==i?i:"int"})}:null},binding:{reader:t=>Sr(t.params.colorType),equals:kr,writer:t=>Mr(Pr(t.initialValue),t.params.colorType)},controller:t=>{var e,i;const s=Pr(t.initialValue);return new gr(t.document,{colorType:t.params.colorType,expanded:null!==(e=t.params.expanded)&&void 0!==e&&e,formatter:Ar(s,t.params.colorType),parser:Bn("int"),pickerLayout:null!==(i=t.params.picker)&&void 0!==i?i:"popup",supportsAlpha:s,value:t.value,viewProps:t.viewProps})}}),Or=wi({id:"input-color-string",type:"input",accept:(t,e)=>{if("string"!=typeof t)return null;if("text"===e.view)return null;const i=Fn(t,vn(e));if(!i)return null;const s=Qn(i);if(!s)return null;const n=un(e);return n?{initialValue:t,params:Object.assign(Object.assign({},n),{format:i,stringifier:s})}:null},binding:{reader:()=>In,equals:kr,writer:t=>{const e=function(t){const e=Qn(t);return e?(t,i)=>{Gs(t,e(i))}:null}(t.params.format);if(!e)throw Vt.notBindable();return e}},controller:t=>{var e,i;return new gr(t.document,{colorType:t.params.format.type,expanded:null!==(e=t.params.expanded)&&void 0!==e&&e,formatter:t.params.stringifier,parser:Bn("int"),pickerLayout:null!==(i=t.params.picker)&&void 0!==i?i:"popup",supportsAlpha:t.params.format.alpha,value:t.value,viewProps:t.viewProps})}});class jr{constructor(t){this.components=t.components,this.asm_=t.assembly}constrain(t){const e=this.asm_.toComponents(t).map(((t,e)=>{var i,s;return null!==(s=null===(i=this.components[e])||void 0===i?void 0:i.constrain(t))&&void 0!==s?s:t}));return this.asm_.fromComponents(e)}}const Tr=Ge("pndtxt");class Rr{constructor(t,e){this.textViews=e.textViews,this.element=t.createElement("div"),this.element.classList.add(Tr()),this.textViews.forEach((e=>{const i=t.createElement("div");i.classList.add(Tr("a")),i.appendChild(e.element),this.element.appendChild(i)}))}}class zr{constructor(t,e){this.value=e.value,this.viewProps=e.viewProps,this.acs_=e.axes.map(((i,s)=>function(t,e,i){return new Ds(t,{arrayPosition:0===i?"fst":i===e.axes.length-1?"lst":"mid",parser:e.parser,props:e.axes[i].textProps,value:Ot(0,{constraint:e.axes[i].constraint}),viewProps:e.viewProps})}(t,e,s))),this.acs_.forEach(((t,i)=>{Cs({primary:this.value,secondary:t.value,forward:t=>e.assembly.toComponents(t)[i],backward:(t,s)=>{const n=e.assembly.toComponents(t);return n[i]=s,e.assembly.fromComponents(n)}})})),this.view=new Rr(t,{textViews:this.acs_.map((t=>t.view))})}get textControllers(){return this.acs_}}class Nr extends Ce{get max(){return this.controller.valueController.sliderController.props.get("max")}set max(t){this.controller.valueController.sliderController.props.set("max",t)}get min(){return this.controller.valueController.sliderController.props.get("min")}set min(t){this.controller.valueController.sliderController.props.set("min",t)}}const Fr=wi({id:"input-number",type:"input",accept:(t,e)=>{if("number"!=typeof t)return null;const i=Me(e,(t=>Object.assign(Object.assign({},me(t)),{options:t.optional.custom(rs),readonly:t.optional.constant(!1)})));return i?{initialValue:t,params:i}:null},binding:{reader:t=>ie,constraint:t=>function(t,e){const i=[],s=ue(t,e);s&&i.push(s);const n=de(t);n&&i.push(n);const r=as(t.options);return r&&i.push(r),new is(i)}(t.params,t.initialValue),writer:t=>Gs},controller:t=>{const e=t.value,i=t.constraint,s=i&&ss(i,ns);if(s)return new ps(t.document,{props:new jt({options:s.values.value("options")}),value:e,viewProps:t.viewProps});const n=ve(t.params,e.rawValue),r=i&&ss(i,Tt);return r?new Ns(t.document,Object.assign(Object.assign({},Fs(Object.assign(Object.assign({},n),{keyScale:Ot(n.keyScale),max:r.values.value("max"),min:r.values.value("min")}))),{parser:ee,value:e,viewProps:t.viewProps})):new Ds(t.document,{parser:ee,props:jt.fromObject(n),value:e,viewProps:t.viewProps})},api:t=>"number"!=typeof t.controller.value.rawValue?null:t.controller.valueController instanceof Ns?new Nr(t.controller):t.controller.valueController instanceof ps?new Ji(t.controller):null});class Br{constructor(t=0,e=0){this.x=t,this.y=e}getComponents(){return[this.x,this.y]}static isObject(t){if(_t(t))return!1;const e=t.x,i=t.y;return"number"==typeof e&&"number"==typeof i}static equals(t,e){return t.x===e.x&&t.y===e.y}toObject(){return{x:this.x,y:this.y}}}const Ir={toComponents:t=>t.getComponents(),fromComponents:t=>new Br(...t)},Ur=Ge("p2d");class Kr{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(Ur()),e.viewProps.bindClassModifiers(this.element),Ke(e.expanded,pi(this.element,Ur(void 0,"expanded")));const i=t.createElement("div");i.classList.add(Ur("h")),this.element.appendChild(i);const s=t.createElement("button");s.classList.add(Ur("b")),s.appendChild(Ne(t,"p2dpad")),e.viewProps.bindDisabled(s),i.appendChild(s),this.buttonElement=s;const n=t.createElement("div");if(n.classList.add(Ur("t")),i.appendChild(n),this.textElement=n,"inline"===e.pickerLayout){const e=t.createElement("div");e.classList.add(Ur("p")),this.element.appendChild(e),this.pickerElement=e}else this.pickerElement=null}}const qr=Ge("p2dp");class $r{constructor(t,e){this.onFoldableChange_=this.onFoldableChange_.bind(this),this.onPropsChange_=this.onPropsChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.props_=e.props,this.props_.emitter.on("change",this.onPropsChange_),this.element=t.createElement("div"),this.element.classList.add(qr()),"popup"===e.layout&&this.element.classList.add(qr(void 0,"p")),e.viewProps.bindClassModifiers(this.element);const i=t.createElement("div");i.classList.add(qr("p")),e.viewProps.bindTabIndex(i),this.element.appendChild(i),this.padElement=i;const s=t.createElementNS(Oe,"svg");s.classList.add(qr("g")),this.padElement.appendChild(s),this.svgElem_=s;const n=t.createElementNS(Oe,"line");n.classList.add(qr("ax")),n.setAttributeNS(null,"x1","0"),n.setAttributeNS(null,"y1","50%"),n.setAttributeNS(null,"x2","100%"),n.setAttributeNS(null,"y2","50%"),this.svgElem_.appendChild(n);const r=t.createElementNS(Oe,"line");r.classList.add(qr("ax")),r.setAttributeNS(null,"x1","50%"),r.setAttributeNS(null,"y1","0"),r.setAttributeNS(null,"x2","50%"),r.setAttributeNS(null,"y2","100%"),this.svgElem_.appendChild(r);const o=t.createElementNS(Oe,"line");o.classList.add(qr("l")),o.setAttributeNS(null,"x1","50%"),o.setAttributeNS(null,"y1","50%"),this.svgElem_.appendChild(o),this.lineElem_=o;const a=t.createElement("div");a.classList.add(qr("m")),this.padElement.appendChild(a),this.markerElem_=a,e.value.emitter.on("change",this.onValueChange_),this.value=e.value,this.update_()}get allFocusableElements(){return[this.padElement]}update_(){const[t,e]=this.value.rawValue.getComponents(),i=this.props_.get("max"),s=re(t,-i,+i,0,100),n=re(e,-i,+i,0,100),r=this.props_.get("invertsY")?100-n:n;this.lineElem_.setAttributeNS(null,"x2",`${s}%`),this.lineElem_.setAttributeNS(null,"y2",`${r}%`),this.markerElem_.style.left=`${s}%`,this.markerElem_.style.top=`${r}%`}onValueChange_(){this.update_()}onPropsChange_(){this.update_()}onFoldableChange_(){this.update_()}}function Gr(t,e,i){return[Ps(e[0],ks(t)),Ps(e[1],Es(t))*(i?1:-1)]}class Hr{constructor(t,e){this.onPadKeyDown_=this.onPadKeyDown_.bind(this),this.onPadKeyUp_=this.onPadKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.props=e.props,this.value=e.value,this.viewProps=e.viewProps,this.view=new $r(t,{layout:e.layout,props:this.props,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Ls(this.view.padElement),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.padElement.addEventListener("keydown",this.onPadKeyDown_),this.view.padElement.addEventListener("keyup",this.onPadKeyUp_)}handlePointerEvent_(t,e){if(!t.point)return;const i=this.props.get("max"),s=re(t.point.x,0,t.bounds.width,-i,+i),n=re(this.props.get("invertsY")?t.bounds.height-t.point.y:t.point.y,0,t.bounds.height,-i,+i);this.value.setRawValue(new Br(s,n),e)}onPointerDown_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerMove_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerUp_(t){this.handlePointerEvent_(t.data,{forceEmit:!0,last:!0})}onPadKeyDown_(t){Vs(t.key)&&t.preventDefault();const[e,i]=Gr(t,[this.props.get("xKeyScale"),this.props.get("yKeyScale")],this.props.get("invertsY"));0===e&&0===i||this.value.setRawValue(new Br(this.value.rawValue.x+e,this.value.rawValue.y+i),{forceEmit:!1,last:!1})}onPadKeyUp_(t){const[e,i]=Gr(t,[this.props.get("xKeyScale"),this.props.get("yKeyScale")],this.props.get("invertsY"));0===e&&0===i||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class Yr{constructor(t,e){var i,s;this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.onPadButtonBlur_=this.onPadButtonBlur_.bind(this),this.onPadButtonClick_=this.onPadButtonClick_.bind(this),this.value=e.value,this.viewProps=e.viewProps,this.foldable_=Li.create(e.expanded),this.popC_="popup"===e.pickerLayout?new ds(t,{viewProps:this.viewProps}):null;const n=new Hr(t,{layout:e.pickerLayout,props:new jt({invertsY:Ot(e.invertsY),max:Ot(e.max),xKeyScale:e.axes[0].textProps.value("keyScale"),yKeyScale:e.axes[1].textProps.value("keyScale")}),value:this.value,viewProps:this.viewProps});n.view.allFocusableElements.forEach((t=>{t.addEventListener("blur",this.onPopupChildBlur_),t.addEventListener("keydown",this.onPopupChildKeydown_)})),this.pickerC_=n,this.textC_=new zr(t,{assembly:Ir,axes:e.axes,parser:e.parser,value:this.value,viewProps:this.viewProps}),this.view=new Kr(t,{expanded:this.foldable_.value("expanded"),pickerLayout:e.pickerLayout,viewProps:this.viewProps}),this.view.textElement.appendChild(this.textC_.view.element),null===(i=this.view.buttonElement)||void 0===i||i.addEventListener("blur",this.onPadButtonBlur_),null===(s=this.view.buttonElement)||void 0===s||s.addEventListener("click",this.onPadButtonClick_),this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(this.pickerC_.view.element),Cs({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:t=>t,backward:(t,e)=>e})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),Ai(this.foldable_,this.view.pickerElement))}get textController(){return this.textC_}onPadButtonBlur_(t){if(!this.popC_)return;const e=this.view.element,i=t.relatedTarget;i&&e.contains(i)||(this.popC_.shows.rawValue=!1)}onPadButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(t){if(!this.popC_)return;const e=this.popC_.view.element,i=Ue(t);i&&e.contains(i)||i&&i===this.view.buttonElement&&!Te(e.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(t){this.popC_?"Escape"===t.key&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&"Escape"===t.key&&this.view.buttonElement.focus()}}function Xr(t){return Br.isObject(t)?new Br(t.x,t.y):new Br}function Wr(t,e){t.writeProperty("x",e.x),t.writeProperty("y",e.y)}function Zr(t,e){var i,s;if(!_t(t.min)||!_t(t.max))return Math.max(Math.abs(null!==(i=t.min)&&void 0!==i?i:0),Math.abs(null!==(s=t.max)&&void 0!==s?s:0));const n=pe(t);return Math.max(10*Math.abs(n),10*Math.abs(e))}function Qr(t,e){var i,s;const n=Zr(Pt(t,null!==(i=t.x)&&void 0!==i?i:{}),e.x),r=Zr(Pt(t,null!==(s=t.y)&&void 0!==s?s:{}),e.y);return Math.max(n,r)}function Jr(t){if(!("y"in t))return!1;const e=t.y;return!!e&&("inverted"in e&&!!e.inverted)}const to=wi({id:"input-point2d",type:"input",accept:(t,e)=>{if(!Br.isObject(t))return null;const i=Me(e,(t=>Object.assign(Object.assign({},Us(t)),{expanded:t.optional.boolean,picker:t.optional.custom($s),readonly:t.optional.constant(!1),x:t.optional.custom(Ks),y:t.optional.object(Object.assign(Object.assign({},Us(t)),{inverted:t.optional.boolean}))})));return i?{initialValue:t,params:i}:null},binding:{reader:()=>Xr,constraint:t=>{return e=t.params,i=t.initialValue,new jr({assembly:Ir,components:[qs(Object.assign(Object.assign({},e),e.x),i.x),qs(Object.assign(Object.assign({},e),e.y),i.y)]});var e,i},equals:Br.equals,writer:()=>Wr},controller:t=>{var e,i;const s=t.document,n=t.value,r=t.constraint,o=[t.params.x,t.params.y];return new Yr(s,{axes:n.rawValue.getComponents().map(((e,i)=>{var s;return be({constraint:r.components[i],initialValue:e,params:Pt(t.params,null!==(s=o[i])&&void 0!==s?s:{})})})),expanded:null!==(e=t.params.expanded)&&void 0!==e&&e,invertsY:Jr(t.params),max:Qr(t.params,n.rawValue),parser:ee,pickerLayout:null!==(i=t.params.picker)&&void 0!==i?i:"popup",value:n,viewProps:t.viewProps})}});class eo{constructor(t=0,e=0,i=0){this.x=t,this.y=e,this.z=i}getComponents(){return[this.x,this.y,this.z]}static isObject(t){if(_t(t))return!1;const e=t.x,i=t.y,s=t.z;return"number"==typeof e&&"number"==typeof i&&"number"==typeof s}static equals(t,e){return t.x===e.x&&t.y===e.y&&t.z===e.z}toObject(){return{x:this.x,y:this.y,z:this.z}}}const io={toComponents:t=>t.getComponents(),fromComponents:t=>new eo(...t)};function so(t){return eo.isObject(t)?new eo(t.x,t.y,t.z):new eo}function no(t,e){t.writeProperty("x",e.x),t.writeProperty("y",e.y),t.writeProperty("z",e.z)}const ro=wi({id:"input-point3d",type:"input",accept:(t,e)=>{if(!eo.isObject(t))return null;const i=Me(e,(t=>Object.assign(Object.assign({},Us(t)),{readonly:t.optional.constant(!1),x:t.optional.custom(Ks),y:t.optional.custom(Ks),z:t.optional.custom(Ks)})));return i?{initialValue:t,params:i}:null},binding:{reader:t=>so,constraint:t=>{return e=t.params,i=t.initialValue,new jr({assembly:io,components:[qs(Object.assign(Object.assign({},e),e.x),i.x),qs(Object.assign(Object.assign({},e),e.y),i.y),qs(Object.assign(Object.assign({},e),e.z),i.z)]});var e,i},equals:eo.equals,writer:t=>no},controller:t=>{const e=t.value,i=t.constraint,s=[t.params.x,t.params.y,t.params.z];return new zr(t.document,{assembly:io,axes:e.rawValue.getComponents().map(((e,n)=>{var r;return be({constraint:i.components[n],initialValue:e,params:Pt(t.params,null!==(r=s[n])&&void 0!==r?r:{})})})),parser:ee,value:e,viewProps:t.viewProps})}});class oo{constructor(t=0,e=0,i=0,s=0){this.x=t,this.y=e,this.z=i,this.w=s}getComponents(){return[this.x,this.y,this.z,this.w]}static isObject(t){if(_t(t))return!1;const e=t.x,i=t.y,s=t.z,n=t.w;return"number"==typeof e&&"number"==typeof i&&"number"==typeof s&&"number"==typeof n}static equals(t,e){return t.x===e.x&&t.y===e.y&&t.z===e.z&&t.w===e.w}toObject(){return{x:this.x,y:this.y,z:this.z,w:this.w}}}const ao={toComponents:t=>t.getComponents(),fromComponents:t=>new oo(...t)};function lo(t){return oo.isObject(t)?new oo(t.x,t.y,t.z,t.w):new oo}function ho(t,e){t.writeProperty("x",e.x),t.writeProperty("y",e.y),t.writeProperty("z",e.z),t.writeProperty("w",e.w)}const po=wi({id:"input-point4d",type:"input",accept:(t,e)=>{if(!oo.isObject(t))return null;const i=Me(e,(t=>Object.assign(Object.assign({},Us(t)),{readonly:t.optional.constant(!1),w:t.optional.custom(Ks),x:t.optional.custom(Ks),y:t.optional.custom(Ks),z:t.optional.custom(Ks)})));return i?{initialValue:t,params:i}:null},binding:{reader:t=>lo,constraint:t=>{return e=t.params,i=t.initialValue,new jr({assembly:ao,components:[qs(Object.assign(Object.assign({},e),e.x),i.x),qs(Object.assign(Object.assign({},e),e.y),i.y),qs(Object.assign(Object.assign({},e),e.z),i.z),qs(Object.assign(Object.assign({},e),e.w),i.w)]});var e,i},equals:oo.equals,writer:t=>ho},controller:t=>{const e=t.value,i=t.constraint,s=[t.params.x,t.params.y,t.params.z,t.params.w];return new zr(t.document,{assembly:ao,axes:e.rawValue.getComponents().map(((e,n)=>{var r;return be({constraint:i.components[n],initialValue:e,params:Pt(t.params,null!==(r=s[n])&&void 0!==r?r:{})})})),parser:ee,value:e,viewProps:t.viewProps})}});const co=wi({id:"input-string",type:"input",accept:(t,e)=>{if("string"!=typeof t)return null;const i=Me(e,(t=>({readonly:t.optional.constant(!1),options:t.optional.custom(rs)})));return i?{initialValue:t,params:i}:null},binding:{reader:t=>xs,constraint:t=>function(t){const e=[],i=as(t.options);return i&&e.push(i),new is(e)}(t.params),writer:t=>Gs},controller:t=>{const e=t.document,i=t.value,s=t.constraint,n=s&&ss(s,ns);return n?new ps(e,{props:new jt({options:n.values.value("options")}),value:i,viewProps:t.viewProps}):new bs(e,{parser:t=>t,props:jt.fromObject({formatter:ys}),value:i,viewProps:t.viewProps})},api:t=>"string"!=typeof t.controller.value.rawValue?null:t.controller.valueController instanceof ps?new Ji(t.controller):null}),uo={defaultInterval:200,defaultRows:3},vo=Ge("mll");class mo{constructor(t,e){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=e.formatter,this.element=t.createElement("div"),this.element.classList.add(vo()),e.viewProps.bindClassModifiers(this.element);const i=t.createElement("textarea");i.classList.add(vo("i")),i.style.height=`calc(var(${Is("containerUnitSize")}) * ${e.rows})`,i.readOnly=!0,e.viewProps.bindDisabled(i),this.element.appendChild(i),this.textareaElem_=i,e.value.emitter.on("change",this.onValueUpdate_),this.value=e.value,this.update_()}update_(){const t=this.textareaElem_,e=t.scrollTop===t.scrollHeight-t.clientHeight,i=[];this.value.rawValue.forEach((t=>{void 0!==t&&i.push(this.formatter_(t))})),t.textContent=i.join("\n"),e&&(t.scrollTop=t.scrollHeight)}onValueUpdate_(){this.update_()}}class bo{constructor(t,e){this.value=e.value,this.viewProps=e.viewProps,this.view=new mo(t,{formatter:e.formatter,rows:e.rows,value:this.value,viewProps:this.viewProps})}}const go=Ge("sgl");class wo{constructor(t,e){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=e.formatter,this.element=t.createElement("div"),this.element.classList.add(go()),e.viewProps.bindClassModifiers(this.element);const i=t.createElement("input");i.classList.add(go("i")),i.readOnly=!0,i.type="text",e.viewProps.bindDisabled(i),this.element.appendChild(i),this.inputElement=i,e.value.emitter.on("change",this.onValueUpdate_),this.value=e.value,this.update_()}update_(){const t=this.value.rawValue,e=t[t.length-1];this.inputElement.value=void 0!==e?this.formatter_(e):""}onValueUpdate_(){this.update_()}}class fo{constructor(t,e){this.value=e.value,this.viewProps=e.viewProps,this.view=new wo(t,{formatter:e.formatter,value:this.value,viewProps:this.viewProps})}}const _o=wi({id:"monitor-bool",type:"monitor",accept:(t,e)=>{if("boolean"!=typeof t)return null;const i=Me(e,(t=>({readonly:t.required.constant(!0),rows:t.optional.number})));return i?{initialValue:t,params:i}:null},binding:{reader:t=>gs},controller:t=>{var e;return 1===t.value.rawValue.length?new fo(t.document,{formatter:ws,value:t.value,viewProps:t.viewProps}):new bo(t.document,{formatter:ws,rows:null!==(e=t.params.rows)&&void 0!==e?e:uo.defaultRows,value:t.value,viewProps:t.viewProps})}});class xo extends Ce{get max(){return this.controller.valueController.props.get("max")}set max(t){this.controller.valueController.props.set("max",t)}get min(){return this.controller.valueController.props.get("min")}set min(t){this.controller.valueController.props.set("min",t)}}const yo=Ge("grl");class Co{constructor(t,e){this.onCursorChange_=this.onCursorChange_.bind(this),this.onValueUpdate_=this.onValueUpdate_.bind(this),this.element=t.createElement("div"),this.element.classList.add(yo()),e.viewProps.bindClassModifiers(this.element),this.formatter_=e.formatter,this.props_=e.props,this.cursor_=e.cursor,this.cursor_.emitter.on("change",this.onCursorChange_);const i=t.createElementNS(Oe,"svg");i.classList.add(yo("g")),i.style.height=`calc(var(${Is("containerUnitSize")}) * ${e.rows})`,this.element.appendChild(i),this.svgElem_=i;const s=t.createElementNS(Oe,"polyline");this.svgElem_.appendChild(s),this.lineElem_=s;const n=t.createElement("div");n.classList.add(yo("t"),Ge("tt")()),this.element.appendChild(n),this.tooltipElem_=n,e.value.emitter.on("change",this.onValueUpdate_),this.value=e.value,this.update_()}get graphElement(){return this.svgElem_}update_(){const{clientWidth:t,clientHeight:e}=this.element,i=this.value.rawValue.length-1,s=this.props_.get("min"),n=this.props_.get("max"),r=[];this.value.rawValue.forEach(((o,a)=>{if(void 0===o)return;const l=re(a,0,i,0,t),h=re(o,s,n,e,0);r.push([l,h].join(","))})),this.lineElem_.setAttributeNS(null,"points",r.join(" "));const o=this.tooltipElem_,a=this.value.rawValue[this.cursor_.rawValue];if(void 0===a)return void o.classList.remove(yo("t","a"));const l=re(this.cursor_.rawValue,0,i,0,t),h=re(a,s,n,e,0);o.style.left=`${l}px`,o.style.top=`${h}px`,o.textContent=`${this.formatter_(a)}`,o.classList.contains(yo("t","a"))||(o.classList.add(yo("t","a"),yo("t","in")),je(o),o.classList.remove(yo("t","in")))}onValueUpdate_(){this.update_()}onCursorChange_(){this.update_()}}class Po{constructor(t,e){if(this.onGraphMouseMove_=this.onGraphMouseMove_.bind(this),this.onGraphMouseLeave_=this.onGraphMouseLeave_.bind(this),this.onGraphPointerDown_=this.onGraphPointerDown_.bind(this),this.onGraphPointerMove_=this.onGraphPointerMove_.bind(this),this.onGraphPointerUp_=this.onGraphPointerUp_.bind(this),this.props=e.props,this.value=e.value,this.viewProps=e.viewProps,this.cursor_=Ot(-1),this.view=new Co(t,{cursor:this.cursor_,formatter:e.formatter,rows:e.rows,props:this.props,value:this.value,viewProps:this.viewProps}),Te(t)){const t=new Ls(this.view.element);t.emitter.on("down",this.onGraphPointerDown_),t.emitter.on("move",this.onGraphPointerMove_),t.emitter.on("up",this.onGraphPointerUp_)}else this.view.element.addEventListener("mousemove",this.onGraphMouseMove_),this.view.element.addEventListener("mouseleave",this.onGraphMouseLeave_)}importProps(t){return Le(t,null,(t=>({max:t.required.number,min:t.required.number})),(t=>(this.props.set("max",t.max),this.props.set("min",t.min),!0)))}exportProps(){return Se(null,{max:this.props.get("max"),min:this.props.get("min")})}onGraphMouseLeave_(){this.cursor_.rawValue=-1}onGraphMouseMove_(t){const{clientWidth:e}=this.view.element;this.cursor_.rawValue=Math.floor(re(t.offsetX,0,e,0,this.value.rawValue.length))}onGraphPointerDown_(t){this.onGraphPointerMove_(t)}onGraphPointerMove_(t){t.data.point?this.cursor_.rawValue=Math.floor(re(t.data.point.x,0,t.data.bounds.width,0,this.value.rawValue.length)):this.cursor_.rawValue=-1}onGraphPointerUp_(){this.cursor_.rawValue=-1}}function Eo(t){return _t(t.format)?ne(2):t.format}function ko(t){return"graph"===t.view}const Vo=wi({id:"monitor-number",type:"monitor",accept:(t,e)=>{if("number"!=typeof t)return null;const i=Me(e,(t=>({format:t.optional.function,max:t.optional.number,min:t.optional.number,readonly:t.required.constant(!0),rows:t.optional.number,view:t.optional.string})));return i?{initialValue:t,params:i}:null},binding:{defaultBufferSize:t=>ko(t)?64:1,reader:t=>ie},controller:t=>ko(t.params)?function(t){var e,i,s;return new Po(t.document,{formatter:Eo(t.params),rows:null!==(e=t.params.rows)&&void 0!==e?e:uo.defaultRows,props:jt.fromObject({max:null!==(i=t.params.max)&&void 0!==i?i:100,min:null!==(s=t.params.min)&&void 0!==s?s:0}),value:t.value,viewProps:t.viewProps})}(t):function(t){var e;return 1===t.value.rawValue.length?new fo(t.document,{formatter:Eo(t.params),value:t.value,viewProps:t.viewProps}):new bo(t.document,{formatter:Eo(t.params),rows:null!==(e=t.params.rows)&&void 0!==e?e:uo.defaultRows,value:t.value,viewProps:t.viewProps})}(t),api:t=>t.controller.valueController instanceof Po?new xo(t.controller):null}),Mo=wi({id:"monitor-string",type:"monitor",accept:(t,e)=>{if("string"!=typeof t)return null;const i=Me(e,(t=>({multiline:t.optional.boolean,readonly:t.required.constant(!0),rows:t.optional.number})));return i?{initialValue:t,params:i}:null},binding:{reader:t=>xs},controller:t=>{var e;const i=t.value;return i.rawValue.length>1||t.params.multiline?new bo(t.document,{formatter:ys,rows:null!==(e=t.params.rows)&&void 0!==e?e:uo.defaultRows,value:i,viewProps:t.viewProps}):new fo(t.document,{formatter:ys,value:i,viewProps:t.viewProps})}});class Lo{constructor(t){this.target=t.target,this.reader_=t.reader,this.writer_=t.writer}read(){return this.reader_(this.target.read())}write(t){this.writer_(this.target,t)}inject(t){this.write(this.reader_(t))}}class So{constructor(t){this.target=t.target,this.reader_=t.reader}read(){return this.reader_(this.target.read())}}function Ao(t,e){return 0===e?new ts:new es(t,null!=e?e:uo.defaultInterval)}class Do{constructor(t){this.pluginsMap_={blades:[],inputs:[],monitors:[]},this.apiCache_=t}getAll(){return[...this.pluginsMap_.blades,...this.pluginsMap_.inputs,...this.pluginsMap_.monitors]}register(t,e){if(!(i=e.core)||i.major!==gi.major)throw Vt.notCompatible(t,e.id);var i;"blade"===e.type?this.pluginsMap_.blades.unshift(e):"input"===e.type?this.pluginsMap_.inputs.unshift(e):"monitor"===e.type&&this.pluginsMap_.monitors.unshift(e)}createInput_(t,e,i){return this.pluginsMap_.inputs.reduce(((s,n)=>null!=s?s:function(t,e){var i;const s=t.accept(e.target.read(),e.params);if(_t(s))return null;const n={target:e.target,initialValue:s.initialValue,params:s.params},r=Me(e.params,(t=>({disabled:t.optional.boolean,hidden:t.optional.boolean,label:t.optional.string,tag:t.optional.string}))),o=t.binding.reader(n),a=t.binding.constraint?t.binding.constraint(n):void 0,l=new Lo({reader:o,target:e.target,writer:t.binding.writer(n)}),h=new Pe(Ot(o(s.initialValue),{constraint:a,equals:t.binding.equals}),l),p=t.controller({constraint:a,document:e.document,initialValue:s.initialValue,params:s.params,value:h,viewProps:Fi.create({disabled:null==r?void 0:r.disabled,hidden:null==r?void 0:r.hidden})});return new ii(e.document,{blade:Mi(),props:jt.fromObject({label:"label"in e.params?null!==(i=null==r?void 0:r.label)&&void 0!==i?i:null:e.target.key}),tag:null==r?void 0:r.tag,value:h,valueController:p})}(n,{document:t,target:e,params:i})),null)}createMonitor_(t,e,i){return this.pluginsMap_.monitors.reduce(((s,n)=>null!=s?s:function(t,e){var i,s,n;const r=t.accept(e.target.read(),e.params);if(_t(r))return null;const o={target:e.target,initialValue:r.initialValue,params:r.params},a=Me(e.params,(t=>({bufferSize:t.optional.number,disabled:t.optional.boolean,hidden:t.optional.boolean,interval:t.optional.number,label:t.optional.string}))),l=t.binding.reader(o),h=null!==(s=null!==(i=null==a?void 0:a.bufferSize)&&void 0!==i?i:t.binding.defaultBufferSize&&t.binding.defaultBufferSize(r.params))&&void 0!==s?s:1,p=new oi({binding:new So({reader:l,target:e.target}),bufferSize:h,ticker:Ao(e.document,null==a?void 0:a.interval)}),c=t.controller({document:e.document,params:r.params,value:p,viewProps:Fi.create({disabled:null==a?void 0:a.disabled,hidden:null==a?void 0:a.hidden})});return c.viewProps.bindDisabled(p.ticker),c.viewProps.handleDispose((()=>{p.ticker.dispose()})),new ai(e.document,{blade:Mi(),props:jt.fromObject({label:"label"in e.params?null!==(n=null==a?void 0:a.label)&&void 0!==n?n:null:e.target.key}),value:p,valueController:c})}(n,{document:t,params:i,target:e})),null)}createBinding(t,e,i){if(_t(e.read()))throw new Vt({context:{key:e.key},type:"nomatchingcontroller"});const s=this.createInput_(t,e,i);if(s)return s;const n=this.createMonitor_(t,e,i);if(n)return n;throw new Vt({context:{key:e.key},type:"nomatchingcontroller"})}createBlade(t,e){const i=this.pluginsMap_.blades.reduce(((i,s)=>null!=i?i:function(t,e){const i=t.accept(e.params);if(!i)return null;const s=Me(e.params,(t=>({disabled:t.optional.boolean,hidden:t.optional.boolean})));return t.controller({blade:Mi(),document:e.document,params:Object.assign(Object.assign({},i.params),{disabled:null==s?void 0:s.disabled,hidden:null==s?void 0:s.hidden}),viewProps:Fi.create({disabled:null==s?void 0:s.disabled,hidden:null==s?void 0:s.hidden})})}(s,{document:t,params:e})),null);if(!i)throw new Vt({type:"nomatchingview",context:{params:e}});return i}createInputBindingApi_(t){const e=this.pluginsMap_.inputs.reduce(((e,i)=>{var s,n;return e||(null!==(n=null===(s=i.api)||void 0===s?void 0:s.call(i,{controller:t}))&&void 0!==n?n:null)}),null);return this.apiCache_.add(t,null!=e?e:new Ce(t))}createMonitorBindingApi_(t){const e=this.pluginsMap_.monitors.reduce(((e,i)=>{var s,n;return e||(null!==(n=null===(s=i.api)||void 0===s?void 0:s.call(i,{controller:t}))&&void 0!==n?n:null)}),null);return this.apiCache_.add(t,null!=e?e:new Ce(t))}createBindingApi(t){if(this.apiCache_.has(t))return this.apiCache_.get(t);if(si(t))return this.createInputBindingApi_(t);if(li(t))return this.createMonitorBindingApi_(t);throw Vt.shouldNeverHappen()}createApi(t){if(this.apiCache_.has(t))return this.apiCache_.get(t);if(function(t){return Ae(t)&&De(t.value)}(t))return this.createBindingApi(t);const e=this.pluginsMap_.blades.reduce(((e,i)=>null!=e?e:i.api({controller:t,pool:this})),null);if(!e)throw Vt.shouldNeverHappen();return this.apiCache_.add(t,e)}}const Oo=new class{constructor(){this.map_=new Map}get(t){var e;return null!==(e=this.map_.get(t))&&void 0!==e?e:null}has(t){return this.map_.has(t)}add(t,e){return this.map_.set(t,e),t.viewProps.handleDispose((()=>{this.map_.delete(t)})),e}};class jo extends ge{constructor(t){super(t),this.emitter_=new Lt,this.controller.value.emitter.on("change",(t=>{this.emitter_.emit("change",new fe(this,t.rawValue))}))}get label(){return this.controller.labelController.props.get("label")}set label(t){this.controller.labelController.props.set("label",t)}get options(){return this.controller.valueController.props.get("options")}set options(t){this.controller.valueController.props.set("options",t)}get value(){return this.controller.value.rawValue}set value(t){this.controller.value.rawValue=t}on(t,e){const i=e.bind(this);return this.emitter_.on(t,(t=>{i(t)}),{key:e}),this}off(t,e){return this.emitter_.off(t,e),this}}class To extends ge{}class Ro extends ge{constructor(t){super(t),this.emitter_=new Lt,this.controller.value.emitter.on("change",(t=>{this.emitter_.emit("change",new fe(this,t.rawValue))}))}get label(){return this.controller.labelController.props.get("label")}set label(t){this.controller.labelController.props.set("label",t)}get max(){return this.controller.valueController.sliderController.props.get("max")}set max(t){this.controller.valueController.sliderController.props.set("max",t)}get min(){return this.controller.valueController.sliderController.props.get("min")}set min(t){this.controller.valueController.sliderController.props.set("min",t)}get value(){return this.controller.value.rawValue}set value(t){this.controller.value.rawValue=t}on(t,e){const i=e.bind(this);return this.emitter_.on(t,(t=>{i(t)}),{key:e}),this}off(t,e){return this.emitter_.off(t,e),this}}class zo extends ge{constructor(t){super(t),this.emitter_=new Lt,this.controller.value.emitter.on("change",(t=>{this.emitter_.emit("change",new fe(this,t.rawValue))}))}get label(){return this.controller.labelController.props.get("label")}set label(t){this.controller.labelController.props.set("label",t)}get formatter(){return this.controller.valueController.props.get("formatter")}set formatter(t){this.controller.valueController.props.set("formatter",t)}get value(){return this.controller.value.rawValue}set value(t){this.controller.value.rawValue=t}on(t,e){const i=e.bind(this);return this.emitter_.on(t,(t=>{i(t)}),{key:e}),this}off(t,e){return this.emitter_.off(t,e),this}}const No={id:"list",type:"blade",core:gi,accept(t){const e=Me(t,(t=>({options:t.required.custom(rs),value:t.required.raw,view:t.required.constant("list"),label:t.optional.string})));return e?{params:e}:null},controller(t){const e=new ns(os(t.params.options)),i=Ot(t.params.value,{constraint:e}),s=new ps(t.document,{props:new jt({options:e.values.value("options")}),value:i,viewProps:t.viewProps});return new Je(t.document,{blade:t.blade,props:jt.fromObject({label:t.params.label}),value:i,valueController:s})},api:t=>t.controller instanceof Je&&t.controller.valueController instanceof ps?new jo(t.controller):null};class Fo extends Di{constructor(t,e){super(t,e)}get element(){return this.controller.view.element}}class Bo extends Ti{constructor(t,e){super(t,{expanded:e.expanded,blade:e.blade,props:e.props,root:!0,viewProps:e.viewProps})}}const Io=Ge("spr");class Uo{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(Io()),e.viewProps.bindClassModifiers(this.element);const i=t.createElement("hr");i.classList.add(Io("r")),this.element.appendChild(i)}}class Ko extends Qe{constructor(t,e){super(Object.assign(Object.assign({},e),{view:new Uo(t,{viewProps:e.viewProps})}))}}const qo={id:"separator",type:"blade",core:gi,accept(t){const e=Me(t,(t=>({view:t.required.constant("separator")})));return e?{params:e}:null},controller:t=>new Ko(t.document,{blade:t.blade,viewProps:t.viewProps}),api:t=>t.controller instanceof Ko?new To(t.controller):null},$o={id:"slider",type:"blade",core:gi,accept(t){const e=Me(t,(t=>({max:t.required.number,min:t.required.number,view:t.required.constant("slider"),format:t.optional.function,label:t.optional.string,value:t.optional.number})));return e?{params:e}:null},controller(t){var e,i;const s=null!==(e=t.params.value)&&void 0!==e?e:0,n=new Tt({max:t.params.max,min:t.params.min}),r=Ot(s,{constraint:n}),o=new Ns(t.document,Object.assign(Object.assign({},Fs({formatter:null!==(i=t.params.format)&&void 0!==i?i:se,keyScale:Ot(1),max:n.values.value("max"),min:n.values.value("min"),pointerScale:ce(t.params,s)})),{parser:ee,value:r,viewProps:t.viewProps}));return new Je(t.document,{blade:t.blade,props:jt.fromObject({label:t.params.label}),value:r,valueController:o})},api:t=>t.controller instanceof Je&&t.controller.valueController instanceof Ns?new Ro(t.controller):null},Go={id:"text",type:"blade",core:gi,accept(t){const e=Me(t,(t=>({parse:t.required.function,value:t.required.raw,view:t.required.constant("text"),format:t.optional.function,label:t.optional.string})));return e?{params:e}:null},controller(t){var e;const i=Ot(t.params.value),s=new bs(t.document,{parser:t.params.parse,props:jt.fromObject({formatter:null!==(e=t.params.format)&&void 0!==e?e:t=>String(t)}),value:i,viewProps:t.viewProps});return new Je(t.document,{blade:t.blade,props:jt.fromObject({label:t.params.label}),value:i,valueController:s})},api:t=>t.controller instanceof Je&&t.controller.valueController instanceof bs?new zo(t.controller):null};class Ho extends Fo{constructor(t){var e,i;const s=null!=t?t:{},n=null!==(e=s.document)&&void 0!==e?e:Re(),r=function(){const t=new Do(Oo);return[to,ro,po,co,Fr,Or,Dr,Lr,Ws,_o,Mo,Vo,fi,Ri,Qi].forEach((e=>{t.register("core",e)})),t}();super(new Bo(n,{expanded:s.expanded,blade:Mi(),props:jt.fromObject({title:s.title}),viewProps:Fi.create()}),r),this.pool_=r,this.containerElem_=null!==(i=s.container)&&void 0!==i?i:function(t){const e=t.createElement("div");return e.classList.add(Ge("dfw")()),t.body&&t.body.appendChild(e),e}(n),this.containerElem_.appendChild(this.element),this.doc_=n,this.usesDefaultWrapper_=!s.container,this.setUpDefaultPlugins_()}get document(){if(!this.doc_)throw Vt.alreadyDisposed();return this.doc_}dispose(){const t=this.containerElem_;if(!t)throw Vt.alreadyDisposed();if(this.usesDefaultWrapper_){const e=t.parentElement;e&&e.removeChild(t)}this.containerElem_=null,this.doc_=null,super.dispose()}registerPlugin(t){t.css&&function(t,e,i){if(t.querySelector(`style[data-tp-style=${e}]`))return;const s=t.createElement("style");s.dataset.tpStyle=e,s.textContent=i,t.head.appendChild(s)}(this.document,`plugin-${t.id}`,t.css);("plugin"in t?[t.plugin]:"plugins"in t?t.plugins:[]).forEach((e=>{this.pool_.register(t.id,e)}))}setUpDefaultPlugins_(){this.registerPlugin({id:"default",css:'.tp-tbiv_b,.tp-coltxtv_ms,.tp-colswv_b,.tp-ckbv_i,.tp-sglv_i,.tp-mllv_i,.tp-grlv_g,.tp-txtv_i,.tp-p2dpv_p,.tp-colswv_sw,.tp-rotv_b,.tp-fldv_b,.tp-p2dv_b,.tp-btnv_b,.tp-lstv_s{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:rgba(0,0,0,0);border-width:0;font-family:inherit;font-size:inherit;font-weight:inherit;margin:0;outline:none;padding:0}.tp-p2dv_b,.tp-btnv_b,.tp-lstv_s{background-color:var(--btn-bg);border-radius:var(--bld-br);color:var(--btn-fg);cursor:pointer;display:block;font-weight:bold;height:var(--cnt-usz);line-height:var(--cnt-usz);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.tp-p2dv_b:hover,.tp-btnv_b:hover,.tp-lstv_s:hover{background-color:var(--btn-bg-h)}.tp-p2dv_b:focus,.tp-btnv_b:focus,.tp-lstv_s:focus{background-color:var(--btn-bg-f)}.tp-p2dv_b:active,.tp-btnv_b:active,.tp-lstv_s:active{background-color:var(--btn-bg-a)}.tp-p2dv_b:disabled,.tp-btnv_b:disabled,.tp-lstv_s:disabled{opacity:.5}.tp-rotv_c>.tp-cntv.tp-v-lst,.tp-tbpv_c>.tp-cntv.tp-v-lst,.tp-fldv_c>.tp-cntv.tp-v-lst{margin-bottom:calc(-1*var(--cnt-vp))}.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-tbpv_c>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_c{border-bottom-left-radius:0}.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-tbpv_c>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_b{border-bottom-left-radius:0}.tp-rotv_c>*:not(.tp-v-fst),.tp-tbpv_c>*:not(.tp-v-fst),.tp-fldv_c>*:not(.tp-v-fst){margin-top:var(--cnt-usp)}.tp-rotv_c>.tp-sprv:not(.tp-v-fst),.tp-tbpv_c>.tp-sprv:not(.tp-v-fst),.tp-fldv_c>.tp-sprv:not(.tp-v-fst),.tp-rotv_c>.tp-cntv:not(.tp-v-fst),.tp-tbpv_c>.tp-cntv:not(.tp-v-fst),.tp-fldv_c>.tp-cntv:not(.tp-v-fst){margin-top:var(--cnt-vp)}.tp-rotv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-tbpv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-fldv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-rotv_c>.tp-cntv+*:not(.tp-v-hidden),.tp-tbpv_c>.tp-cntv+*:not(.tp-v-hidden),.tp-fldv_c>.tp-cntv+*:not(.tp-v-hidden){margin-top:var(--cnt-vp)}.tp-rotv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-tbpv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-fldv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-rotv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-tbpv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-fldv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv{margin-top:0}.tp-tbpv_c>.tp-cntv,.tp-fldv_c>.tp-cntv{margin-left:4px}.tp-tbpv_c>.tp-fldv>.tp-fldv_b,.tp-fldv_c>.tp-fldv>.tp-fldv_b{border-top-left-radius:var(--bld-br);border-bottom-left-radius:var(--bld-br)}.tp-tbpv_c>.tp-fldv.tp-fldv-expanded>.tp-fldv_b,.tp-fldv_c>.tp-fldv.tp-fldv-expanded>.tp-fldv_b{border-bottom-left-radius:0}.tp-tbpv_c .tp-fldv>.tp-fldv_c,.tp-fldv_c .tp-fldv>.tp-fldv_c{border-bottom-left-radius:var(--bld-br)}.tp-tbpv_c>.tp-cntv+.tp-fldv>.tp-fldv_b,.tp-fldv_c>.tp-cntv+.tp-fldv>.tp-fldv_b{border-top-left-radius:0}.tp-tbpv_c>.tp-cntv+.tp-tabv>.tp-tabv_t,.tp-fldv_c>.tp-cntv+.tp-tabv>.tp-tabv_t{border-top-left-radius:0}.tp-tbpv_c>.tp-tabv>.tp-tabv_t,.tp-fldv_c>.tp-tabv>.tp-tabv_t{border-top-left-radius:var(--bld-br)}.tp-tbpv_c .tp-tabv>.tp-tabv_c,.tp-fldv_c .tp-tabv>.tp-tabv_c{border-bottom-left-radius:var(--bld-br)}.tp-rotv_b,.tp-fldv_b{background-color:var(--cnt-bg);color:var(--cnt-fg);cursor:pointer;display:block;height:calc(var(--cnt-usz) + 4px);line-height:calc(var(--cnt-usz) + 4px);overflow:hidden;padding-left:var(--cnt-hp);padding-right:calc(4px + var(--cnt-usz) + var(--cnt-hp));position:relative;text-align:left;text-overflow:ellipsis;white-space:nowrap;width:100%;transition:border-radius .2s ease-in-out .2s}.tp-rotv_b:hover,.tp-fldv_b:hover{background-color:var(--cnt-bg-h)}.tp-rotv_b:focus,.tp-fldv_b:focus{background-color:var(--cnt-bg-f)}.tp-rotv_b:active,.tp-fldv_b:active{background-color:var(--cnt-bg-a)}.tp-rotv_b:disabled,.tp-fldv_b:disabled{opacity:.5}.tp-rotv_m,.tp-fldv_m{background:linear-gradient(to left, var(--cnt-fg), var(--cnt-fg) 2px, transparent 2px, transparent 4px, var(--cnt-fg) 4px);border-radius:2px;bottom:0;content:"";display:block;height:6px;right:calc(var(--cnt-hp) + (var(--cnt-usz) + 4px - 6px)/2 - 2px);margin:auto;opacity:.5;position:absolute;top:0;transform:rotate(90deg);transition:transform .2s ease-in-out;width:6px}.tp-rotv.tp-rotv-expanded .tp-rotv_m,.tp-fldv.tp-fldv-expanded>.tp-fldv_b>.tp-fldv_m{transform:none}.tp-rotv_c,.tp-fldv_c{box-sizing:border-box;height:0;opacity:0;overflow:hidden;padding-bottom:0;padding-top:0;position:relative;transition:height .2s ease-in-out,opacity .2s linear,padding .2s ease-in-out}.tp-rotv.tp-rotv-cpl:not(.tp-rotv-expanded) .tp-rotv_c,.tp-fldv.tp-fldv-cpl:not(.tp-fldv-expanded)>.tp-fldv_c{display:none}.tp-rotv.tp-rotv-expanded .tp-rotv_c,.tp-fldv.tp-fldv-expanded>.tp-fldv_c{opacity:1;padding-bottom:var(--cnt-vp);padding-top:var(--cnt-vp);transform:none;overflow:visible;transition:height .2s ease-in-out,opacity .2s linear .2s,padding .2s ease-in-out}.tp-txtv_i,.tp-p2dpv_p,.tp-colswv_sw{background-color:var(--in-bg);border-radius:var(--bld-br);box-sizing:border-box;color:var(--in-fg);font-family:inherit;height:var(--cnt-usz);line-height:var(--cnt-usz);min-width:0;width:100%}.tp-txtv_i:hover,.tp-p2dpv_p:hover,.tp-colswv_sw:hover{background-color:var(--in-bg-h)}.tp-txtv_i:focus,.tp-p2dpv_p:focus,.tp-colswv_sw:focus{background-color:var(--in-bg-f)}.tp-txtv_i:active,.tp-p2dpv_p:active,.tp-colswv_sw:active{background-color:var(--in-bg-a)}.tp-txtv_i:disabled,.tp-p2dpv_p:disabled,.tp-colswv_sw:disabled{opacity:.5}.tp-lstv,.tp-coltxtv_m{position:relative}.tp-lstv_s{padding:0 20px 0 4px;width:100%}.tp-lstv_m,.tp-coltxtv_mm{bottom:0;margin:auto;pointer-events:none;position:absolute;right:2px;top:0}.tp-lstv_m svg,.tp-coltxtv_mm svg{bottom:0;height:16px;margin:auto;position:absolute;right:0;top:0;width:16px}.tp-lstv_m svg path,.tp-coltxtv_mm svg path{fill:currentColor}.tp-sglv_i,.tp-mllv_i,.tp-grlv_g{background-color:var(--mo-bg);border-radius:var(--bld-br);box-sizing:border-box;color:var(--mo-fg);height:var(--cnt-usz);scrollbar-color:currentColor rgba(0,0,0,0);scrollbar-width:thin;width:100%}.tp-sglv_i::-webkit-scrollbar,.tp-mllv_i::-webkit-scrollbar,.tp-grlv_g::-webkit-scrollbar{height:8px;width:8px}.tp-sglv_i::-webkit-scrollbar-corner,.tp-mllv_i::-webkit-scrollbar-corner,.tp-grlv_g::-webkit-scrollbar-corner{background-color:rgba(0,0,0,0)}.tp-sglv_i::-webkit-scrollbar-thumb,.tp-mllv_i::-webkit-scrollbar-thumb,.tp-grlv_g::-webkit-scrollbar-thumb{background-clip:padding-box;background-color:currentColor;border:rgba(0,0,0,0) solid 2px;border-radius:4px}.tp-pndtxtv,.tp-coltxtv_w{display:flex}.tp-pndtxtv_a,.tp-coltxtv_c{width:100%}.tp-pndtxtv_a+.tp-pndtxtv_a,.tp-coltxtv_c+.tp-pndtxtv_a,.tp-pndtxtv_a+.tp-coltxtv_c,.tp-coltxtv_c+.tp-coltxtv_c{margin-left:2px}.tp-rotv{--bs-bg: var(--tp-base-background-color, hsl(230, 7%, 17%));--bs-br: var(--tp-base-border-radius, 6px);--bs-ff: var(--tp-base-font-family, Roboto Mono, Source Code Pro, Menlo, Courier, monospace);--bs-sh: var(--tp-base-shadow-color, rgba(0, 0, 0, 0.2));--bld-br: var(--tp-blade-border-radius, 2px);--bld-hp: var(--tp-blade-horizontal-padding, 4px);--bld-vw: var(--tp-blade-value-width, 160px);--btn-bg: var(--tp-button-background-color, hsl(230, 7%, 70%));--btn-bg-a: var(--tp-button-background-color-active, #d6d7db);--btn-bg-f: var(--tp-button-background-color-focus, #c8cad0);--btn-bg-h: var(--tp-button-background-color-hover, #bbbcc4);--btn-fg: var(--tp-button-foreground-color, hsl(230, 7%, 17%));--cnt-bg: var(--tp-container-background-color, rgba(187, 188, 196, 0.1));--cnt-bg-a: var(--tp-container-background-color-active, rgba(187, 188, 196, 0.25));--cnt-bg-f: var(--tp-container-background-color-focus, rgba(187, 188, 196, 0.2));--cnt-bg-h: var(--tp-container-background-color-hover, rgba(187, 188, 196, 0.15));--cnt-fg: var(--tp-container-foreground-color, hsl(230, 7%, 75%));--cnt-hp: var(--tp-container-horizontal-padding, 4px);--cnt-vp: var(--tp-container-vertical-padding, 4px);--cnt-usp: var(--tp-container-unit-spacing, 4px);--cnt-usz: var(--tp-container-unit-size, 20px);--in-bg: var(--tp-input-background-color, rgba(187, 188, 196, 0.1));--in-bg-a: var(--tp-input-background-color-active, rgba(187, 188, 196, 0.25));--in-bg-f: var(--tp-input-background-color-focus, rgba(187, 188, 196, 0.2));--in-bg-h: var(--tp-input-background-color-hover, rgba(187, 188, 196, 0.15));--in-fg: var(--tp-input-foreground-color, hsl(230, 7%, 75%));--lbl-fg: var(--tp-label-foreground-color, rgba(187, 188, 196, 0.7));--mo-bg: var(--tp-monitor-background-color, rgba(0, 0, 0, 0.2));--mo-fg: var(--tp-monitor-foreground-color, rgba(187, 188, 196, 0.7));--grv-fg: var(--tp-groove-foreground-color, rgba(187, 188, 196, 0.1))}.tp-btnv_b{width:100%}.tp-btnv_t{text-align:center}.tp-ckbv_l{display:block;position:relative}.tp-ckbv_i{left:0;opacity:0;position:absolute;top:0}.tp-ckbv_w{background-color:var(--in-bg);border-radius:var(--bld-br);cursor:pointer;display:block;height:var(--cnt-usz);position:relative;width:var(--cnt-usz)}.tp-ckbv_w svg{bottom:0;display:block;height:16px;left:0;margin:auto;opacity:0;position:absolute;right:0;top:0;width:16px}.tp-ckbv_w svg path{fill:none;stroke:var(--in-fg);stroke-width:2}.tp-ckbv_i:hover+.tp-ckbv_w{background-color:var(--in-bg-h)}.tp-ckbv_i:focus+.tp-ckbv_w{background-color:var(--in-bg-f)}.tp-ckbv_i:active+.tp-ckbv_w{background-color:var(--in-bg-a)}.tp-ckbv_i:checked+.tp-ckbv_w svg{opacity:1}.tp-ckbv.tp-v-disabled .tp-ckbv_w{opacity:.5}.tp-colv{position:relative}.tp-colv_h{display:flex}.tp-colv_s{flex-grow:0;flex-shrink:0;width:var(--cnt-usz)}.tp-colv_t{flex:1;margin-left:4px}.tp-colv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-colv.tp-colv-expanded.tp-colv-cpl .tp-colv_p{overflow:visible}.tp-colv.tp-colv-expanded .tp-colv_p{margin-top:var(--cnt-usp);opacity:1}.tp-colv .tp-popv{left:calc(-1*var(--cnt-hp));right:calc(-1*var(--cnt-hp));top:var(--cnt-usz)}.tp-colpv_h,.tp-colpv_ap{margin-left:6px;margin-right:6px}.tp-colpv_h{margin-top:var(--cnt-usp)}.tp-colpv_rgb{display:flex;margin-top:var(--cnt-usp);width:100%}.tp-colpv_a{display:flex;margin-top:var(--cnt-vp);padding-top:calc(var(--cnt-vp) + 2px);position:relative}.tp-colpv_a::before{background-color:var(--grv-fg);content:"";height:2px;left:calc(-1*var(--cnt-hp));position:absolute;right:calc(-1*var(--cnt-hp));top:0}.tp-colpv.tp-v-disabled .tp-colpv_a::before{opacity:.5}.tp-colpv_ap{align-items:center;display:flex;flex:3}.tp-colpv_at{flex:1;margin-left:4px}.tp-svpv{border-radius:var(--bld-br);outline:none;overflow:hidden;position:relative}.tp-svpv.tp-v-disabled{opacity:.5}.tp-svpv_c{cursor:crosshair;display:block;height:calc(var(--cnt-usz)*4);width:100%}.tp-svpv_m{border-radius:100%;border:rgba(255,255,255,.75) solid 2px;box-sizing:border-box;filter:drop-shadow(0 0 1px rgba(0, 0, 0, 0.3));height:12px;margin-left:-6px;margin-top:-6px;pointer-events:none;position:absolute;width:12px}.tp-svpv:focus .tp-svpv_m{border-color:#fff}.tp-hplv{cursor:pointer;height:var(--cnt-usz);outline:none;position:relative}.tp-hplv.tp-v-disabled{opacity:.5}.tp-hplv_c{background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAABCAYAAABubagXAAAAQ0lEQVQoU2P8z8Dwn0GCgQEDi2OK/RBgYHjBgIpfovFh8j8YBIgzFGQxuqEgPhaDOT5gOhPkdCxOZeBg+IDFZZiGAgCaSSMYtcRHLgAAAABJRU5ErkJggg==);background-position:left top;background-repeat:no-repeat;background-size:100% 100%;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;position:absolute;top:50%;width:100%}.tp-hplv_m{border-radius:var(--bld-br);border:rgba(255,255,255,.75) solid 2px;box-shadow:0 0 2px rgba(0,0,0,.1);box-sizing:border-box;height:12px;left:50%;margin-left:-6px;margin-top:-6px;pointer-events:none;position:absolute;top:50%;width:12px}.tp-hplv:focus .tp-hplv_m{border-color:#fff}.tp-aplv{cursor:pointer;height:var(--cnt-usz);outline:none;position:relative;width:100%}.tp-aplv.tp-v-disabled{opacity:.5}.tp-aplv_b{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:4px 4px;background-position:0 0,2px 2px;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;overflow:hidden;position:absolute;top:50%;width:100%}.tp-aplv_c{bottom:0;left:0;position:absolute;right:0;top:0}.tp-aplv_m{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:12px 12px;background-position:0 0,6px 6px;border-radius:var(--bld-br);box-shadow:0 0 2px rgba(0,0,0,.1);height:12px;left:50%;margin-left:-6px;margin-top:-6px;overflow:hidden;pointer-events:none;position:absolute;top:50%;width:12px}.tp-aplv_p{border-radius:var(--bld-br);border:rgba(255,255,255,.75) solid 2px;box-sizing:border-box;bottom:0;left:0;position:absolute;right:0;top:0}.tp-aplv:focus .tp-aplv_p{border-color:#fff}.tp-colswv{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:10px 10px;background-position:0 0,5px 5px;border-radius:var(--bld-br);overflow:hidden}.tp-colswv.tp-v-disabled{opacity:.5}.tp-colswv_sw{border-radius:0}.tp-colswv_b{cursor:pointer;display:block;height:var(--cnt-usz);left:0;position:absolute;top:0;width:var(--cnt-usz)}.tp-colswv_b:focus::after{border:rgba(255,255,255,.75) solid 2px;border-radius:var(--bld-br);bottom:0;content:"";display:block;left:0;position:absolute;right:0;top:0}.tp-coltxtv{display:flex;width:100%}.tp-coltxtv_m{margin-right:4px}.tp-coltxtv_ms{border-radius:var(--bld-br);color:var(--lbl-fg);cursor:pointer;height:var(--cnt-usz);line-height:var(--cnt-usz);padding:0 18px 0 4px}.tp-coltxtv_ms:hover{background-color:var(--in-bg-h)}.tp-coltxtv_ms:focus{background-color:var(--in-bg-f)}.tp-coltxtv_ms:active{background-color:var(--in-bg-a)}.tp-coltxtv_mm{color:var(--lbl-fg)}.tp-coltxtv.tp-v-disabled .tp-coltxtv_mm{opacity:.5}.tp-coltxtv_w{flex:1}.tp-dfwv{position:absolute;top:8px;right:8px;width:256px}.tp-fldv{position:relative}.tp-fldv_t{padding-left:4px}.tp-fldv_b:disabled .tp-fldv_m{display:none}.tp-fldv_c{padding-left:4px}.tp-fldv_i{bottom:0;color:var(--cnt-bg);left:0;overflow:hidden;position:absolute;top:calc(var(--cnt-usz) + 4px);width:max(var(--bs-br),4px)}.tp-fldv_i::before{background-color:currentColor;bottom:0;content:"";left:0;position:absolute;top:0;width:4px}.tp-fldv_b:hover+.tp-fldv_i{color:var(--cnt-bg-h)}.tp-fldv_b:focus+.tp-fldv_i{color:var(--cnt-bg-f)}.tp-fldv_b:active+.tp-fldv_i{color:var(--cnt-bg-a)}.tp-fldv.tp-v-disabled>.tp-fldv_i{opacity:.5}.tp-grlv{position:relative}.tp-grlv_g{display:block;height:calc(var(--cnt-usz)*3)}.tp-grlv_g polyline{fill:none;stroke:var(--mo-fg);stroke-linejoin:round}.tp-grlv_t{margin-top:-4px;transition:left .05s,top .05s;visibility:hidden}.tp-grlv_t.tp-grlv_t-a{visibility:visible}.tp-grlv_t.tp-grlv_t-in{transition:none}.tp-grlv.tp-v-disabled .tp-grlv_g{opacity:.5}.tp-grlv .tp-ttv{background-color:var(--mo-fg)}.tp-grlv .tp-ttv::before{border-top-color:var(--mo-fg)}.tp-lblv{align-items:center;display:flex;line-height:1.3;padding-left:var(--cnt-hp);padding-right:var(--cnt-hp)}.tp-lblv.tp-lblv-nol{display:block}.tp-lblv_l{color:var(--lbl-fg);flex:1;-webkit-hyphens:auto;hyphens:auto;overflow:hidden;padding-left:4px;padding-right:16px}.tp-lblv.tp-v-disabled .tp-lblv_l{opacity:.5}.tp-lblv.tp-lblv-nol .tp-lblv_l{display:none}.tp-lblv_v{align-self:flex-start;flex-grow:0;flex-shrink:0;width:var(--bld-vw)}.tp-lblv.tp-lblv-nol .tp-lblv_v{width:100%}.tp-lstv_s{padding:0 20px 0 var(--bld-hp);width:100%}.tp-lstv_m{color:var(--btn-fg)}.tp-sglv_i{padding-left:var(--bld-hp);padding-right:var(--bld-hp)}.tp-sglv.tp-v-disabled .tp-sglv_i{opacity:.5}.tp-mllv_i{display:block;height:calc(var(--cnt-usz)*3);line-height:var(--cnt-usz);padding-left:var(--bld-hp);padding-right:var(--bld-hp);resize:none;white-space:pre}.tp-mllv.tp-v-disabled .tp-mllv_i{opacity:.5}.tp-p2dv{position:relative}.tp-p2dv_h{display:flex}.tp-p2dv_b{height:var(--cnt-usz);margin-right:4px;position:relative;width:var(--cnt-usz)}.tp-p2dv_b svg{display:block;height:16px;left:50%;margin-left:-8px;margin-top:-8px;position:absolute;top:50%;width:16px}.tp-p2dv_b svg path{stroke:currentColor;stroke-width:2}.tp-p2dv_b svg circle{fill:currentColor}.tp-p2dv_t{flex:1}.tp-p2dv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-p2dv.tp-p2dv-expanded .tp-p2dv_p{margin-top:var(--cnt-usp);opacity:1}.tp-p2dv .tp-popv{left:calc(-1*var(--cnt-hp));right:calc(-1*var(--cnt-hp));top:var(--cnt-usz)}.tp-p2dpv{padding-left:calc(var(--cnt-usz) + 4px)}.tp-p2dpv_p{cursor:crosshair;height:0;overflow:hidden;padding-bottom:100%;position:relative}.tp-p2dpv.tp-v-disabled .tp-p2dpv_p{opacity:.5}.tp-p2dpv_g{display:block;height:100%;left:0;pointer-events:none;position:absolute;top:0;width:100%}.tp-p2dpv_ax{opacity:.1;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_l{opacity:.5;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_m{border:var(--in-fg) solid 1px;border-radius:50%;box-sizing:border-box;height:4px;margin-left:-2px;margin-top:-2px;position:absolute;width:4px}.tp-p2dpv_p:focus .tp-p2dpv_m{background-color:var(--in-fg);border-width:0}.tp-popv{background-color:var(--bs-bg);border-radius:var(--bs-br);box-shadow:0 2px 4px var(--bs-sh);display:none;max-width:var(--bld-vw);padding:var(--cnt-vp) var(--cnt-hp);position:absolute;visibility:hidden;z-index:1000}.tp-popv.tp-popv-v{display:block;visibility:visible}.tp-sldv.tp-v-disabled{opacity:.5}.tp-sldv_t{box-sizing:border-box;cursor:pointer;height:var(--cnt-usz);margin:0 6px;outline:none;position:relative}.tp-sldv_t::before{background-color:var(--in-bg);border-radius:1px;bottom:0;content:"";display:block;height:2px;left:0;margin:auto;position:absolute;right:0;top:0}.tp-sldv_k{height:100%;left:0;position:absolute;top:0}.tp-sldv_k::before{background-color:var(--in-fg);border-radius:1px;bottom:0;content:"";display:block;height:2px;left:0;margin-bottom:auto;margin-top:auto;position:absolute;right:0;top:0}.tp-sldv_k::after{background-color:var(--btn-bg);border-radius:var(--bld-br);bottom:0;content:"";display:block;height:12px;margin-bottom:auto;margin-top:auto;position:absolute;right:-6px;top:0;width:12px}.tp-sldv_t:hover .tp-sldv_k::after{background-color:var(--btn-bg-h)}.tp-sldv_t:focus .tp-sldv_k::after{background-color:var(--btn-bg-f)}.tp-sldv_t:active .tp-sldv_k::after{background-color:var(--btn-bg-a)}.tp-sldtxtv{display:flex}.tp-sldtxtv_s{flex:2}.tp-sldtxtv_t{flex:1;margin-left:4px}.tp-tabv{position:relative}.tp-tabv_t{align-items:flex-end;color:var(--cnt-bg);display:flex;overflow:hidden;position:relative}.tp-tabv_t:hover{color:var(--cnt-bg-h)}.tp-tabv_t:has(*:focus){color:var(--cnt-bg-f)}.tp-tabv_t:has(*:active){color:var(--cnt-bg-a)}.tp-tabv_t::before{background-color:currentColor;bottom:0;content:"";height:2px;left:0;pointer-events:none;position:absolute;right:0}.tp-tabv.tp-v-disabled .tp-tabv_t::before{opacity:.5}.tp-tabv.tp-tabv-nop .tp-tabv_t{height:calc(var(--cnt-usz) + 4px);position:relative}.tp-tabv.tp-tabv-nop .tp-tabv_t::before{background-color:var(--cnt-bg);bottom:0;content:"";height:2px;left:0;position:absolute;right:0}.tp-tabv_i{bottom:0;color:var(--cnt-bg);left:0;overflow:hidden;position:absolute;top:calc(var(--cnt-usz) + 4px);width:max(var(--bs-br),4px)}.tp-tabv_i::before{background-color:currentColor;bottom:0;content:"";left:0;position:absolute;top:0;width:4px}.tp-tabv_t:hover+.tp-tabv_i{color:var(--cnt-bg-h)}.tp-tabv_t:has(*:focus)+.tp-tabv_i{color:var(--cnt-bg-f)}.tp-tabv_t:has(*:active)+.tp-tabv_i{color:var(--cnt-bg-a)}.tp-tabv.tp-v-disabled>.tp-tabv_i{opacity:.5}.tp-tbiv{flex:1;min-width:0;position:relative}.tp-tbiv+.tp-tbiv{margin-left:2px}.tp-tbiv+.tp-tbiv.tp-v-disabled::before{opacity:.5}.tp-tbiv_b{display:block;padding-left:calc(var(--cnt-hp) + 4px);padding-right:calc(var(--cnt-hp) + 4px);position:relative;width:100%}.tp-tbiv_b:disabled{opacity:.5}.tp-tbiv_b::before{background-color:var(--cnt-bg);bottom:2px;content:"";left:0;pointer-events:none;position:absolute;right:0;top:0}.tp-tbiv_b:hover::before{background-color:var(--cnt-bg-h)}.tp-tbiv_b:focus::before{background-color:var(--cnt-bg-f)}.tp-tbiv_b:active::before{background-color:var(--cnt-bg-a)}.tp-tbiv_t{color:var(--cnt-fg);height:calc(var(--cnt-usz) + 4px);line-height:calc(var(--cnt-usz) + 4px);opacity:.5;overflow:hidden;position:relative;text-overflow:ellipsis}.tp-tbiv.tp-tbiv-sel .tp-tbiv_t{opacity:1}.tp-tbpv_c{padding-bottom:var(--cnt-vp);padding-left:4px;padding-top:var(--cnt-vp)}.tp-txtv{position:relative}.tp-txtv_i{padding-left:var(--bld-hp);padding-right:var(--bld-hp)}.tp-txtv.tp-txtv-fst .tp-txtv_i{border-bottom-right-radius:0;border-top-right-radius:0}.tp-txtv.tp-txtv-mid .tp-txtv_i{border-radius:0}.tp-txtv.tp-txtv-lst .tp-txtv_i{border-bottom-left-radius:0;border-top-left-radius:0}.tp-txtv.tp-txtv-num .tp-txtv_i{text-align:right}.tp-txtv.tp-txtv-drg .tp-txtv_i{opacity:.3}.tp-txtv_k{cursor:pointer;height:100%;left:calc(var(--bld-hp) - 5px);position:absolute;top:0;width:12px}.tp-txtv_k::before{background-color:var(--in-fg);border-radius:1px;bottom:0;content:"";height:calc(var(--cnt-usz) - 4px);left:50%;margin-bottom:auto;margin-left:-1px;margin-top:auto;opacity:.1;position:absolute;top:0;transition:border-radius .1s,height .1s,transform .1s,width .1s;width:2px}.tp-txtv_k:hover::before,.tp-txtv.tp-txtv-drg .tp-txtv_k::before{opacity:1}.tp-txtv.tp-txtv-drg .tp-txtv_k::before{border-radius:50%;height:4px;transform:translateX(-1px);width:4px}.tp-txtv_g{bottom:0;display:block;height:8px;left:50%;margin:auto;overflow:visible;pointer-events:none;position:absolute;top:0;visibility:hidden;width:100%}.tp-txtv.tp-txtv-drg .tp-txtv_g{visibility:visible}.tp-txtv_gb{fill:none;stroke:var(--in-fg);stroke-dasharray:1}.tp-txtv_gh{fill:none;stroke:var(--in-fg)}.tp-txtv .tp-ttv{margin-left:6px;visibility:hidden}.tp-txtv.tp-txtv-drg .tp-ttv{visibility:visible}.tp-ttv{background-color:var(--in-fg);border-radius:var(--bld-br);color:var(--bs-bg);padding:2px 4px;pointer-events:none;position:absolute;transform:translate(-50%, -100%)}.tp-ttv::before{border-color:var(--in-fg) rgba(0,0,0,0) rgba(0,0,0,0) rgba(0,0,0,0);border-style:solid;border-width:2px;box-sizing:border-box;content:"";font-size:.9em;height:4px;left:50%;margin-left:-2px;position:absolute;top:100%;width:4px}.tp-rotv{background-color:var(--bs-bg);border-radius:var(--bs-br);box-shadow:0 2px 4px var(--bs-sh);font-family:var(--bs-ff);font-size:11px;font-weight:500;line-height:1;text-align:left}.tp-rotv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br);border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br);padding-left:calc(4px + var(--cnt-usz) + var(--cnt-hp));text-align:center}.tp-rotv.tp-rotv-expanded .tp-rotv_b{border-bottom-left-radius:0;border-bottom-right-radius:0;transition-delay:0s;transition-duration:0s}.tp-rotv.tp-rotv-not>.tp-rotv_b{display:none}.tp-rotv_b:disabled .tp-rotv_m{display:none}.tp-rotv_c>.tp-fldv.tp-v-lst>.tp-fldv_c{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c>.tp-fldv.tp-v-lst>.tp-fldv_i{border-bottom-left-radius:var(--bs-br)}.tp-rotv_c>.tp-fldv.tp-v-lst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c>.tp-fldv.tp-v-lst.tp-fldv-expanded>.tp-fldv_b{transition-delay:0s;transition-duration:0s}.tp-rotv_c .tp-fldv.tp-v-vlst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-right-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst{margin-top:calc(-1*var(--cnt-vp))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst>.tp-fldv_b{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv_c>.tp-tabv.tp-v-lst>.tp-tabv_c{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c>.tp-tabv.tp-v-lst>.tp-tabv_i{border-bottom-left-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst{margin-top:calc(-1*var(--cnt-vp))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst>.tp-tabv_t{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv.tp-v-disabled,.tp-rotv .tp-v-disabled{pointer-events:none}.tp-rotv.tp-v-hidden,.tp-rotv .tp-v-hidden{display:none}.tp-sprv_r{background-color:var(--grv-fg);border-width:0;display:block;height:2px;margin:0;width:100%}.tp-sprv.tp-v-disabled .tp-sprv_r{opacity:.5}',plugins:[No,qo,$o,Qi,Go]})}}new bi("4.0.3");var Yo={};function Xo(t){return null==t}function Wo(t){return null!==t&&"object"==typeof t}function Zo(t){return null!==t&&"object"==typeof t}function Qo(t,e){if(t.length!==e.length)return!1;for(let i=0;i<t.length;i++)if(t[i]!==e[i])return!1;return!0}function Jo(t,e){return Array.from(new Set([...Object.keys(t),...Object.keys(e)])).reduce(((i,s)=>{const n=t[s],r=e[s];return Zo(n)&&Zo(r)?Object.assign(Object.assign({},i),{[s]:Jo(n,r)}):Object.assign(Object.assign({},i),{[s]:s in e?r:n})}),{})}t(Yo,"ButtonCellApi",(()=>Lu)),t(Yo,"ButtonGridApi",(()=>Au)),t(Yo,"ButtonGridController",(()=>Du)),t(Yo,"CubicBezierApi",(()=>Tu)),t(Yo,"CubicBezier",(()=>Nu)),t(Yo,"CubicBezierAssembly",(()=>Fu)),t(Yo,"CubicBezierView",(()=>qu)),t(Yo,"CubicBezierPickerView",(()=>Gu)),t(Yo,"CubicBezierGraphView",(()=>Xu)),t(Yo,"CubicBezierPreviewView",(()=>Zu)),t(Yo,"CubicBezierGraphController",(()=>Ju)),t(Yo,"CubicBezierPickerController",(()=>td)),t(Yo,"CubicBezierController",(()=>ed)),t(Yo,"FpsGraphBladeApi",(()=>sd)),t(Yo,"Fpswatch",(()=>nd)),t(Yo,"FpsView",(()=>od)),t(Yo,"FpsGraphController",(()=>ad)),t(Yo,"Interval",(()=>cd)),t(Yo,"IntervalAssembly",(()=>ud)),t(Yo,"IntervalConstraint",(()=>dd)),t(Yo,"RangeSliderTextView",(()=>md)),t(Yo,"RangeSliderView",(()=>gd)),t(Yo,"RangeSliderController",(()=>wd)),t(Yo,"RangeSliderTextController",(()=>fd)),t(Yo,"RadioCellApi",(()=>Cd)),t(Yo,"TpRadioGridChangeEvent",(()=>Pd)),t(Yo,"RadioGridApi",(()=>Ed)),t(Yo,"RadioView",(()=>Vd)),t(Yo,"RadioController",(()=>Md)),t(Yo,"RadioGridController",(()=>Ld)),t(Yo,"id",(()=>Td)),t(Yo,"css",(()=>Rd)),t(Yo,"plugins",(()=>zd));const ta={alreadydisposed:()=>"View has been already disposed",invalidparams:t=>`Invalid parameters for '${t.name}'`,nomatchingcontroller:t=>`No matching controller for '${t.key}'`,nomatchingview:t=>`No matching view for '${JSON.stringify(t.params)}'`,notbindable:()=>"Value is not bindable",notcompatible:t=>`Not compatible with  plugin '${t.id}'`,propertynotfound:t=>`Property '${t.name}' not found`,shouldneverhappen:()=>"This error should never happen"};class ea{static alreadyDisposed(){return new ea({type:"alreadydisposed"})}static notBindable(){return new ea({type:"notbindable"})}static notCompatible(t,e){return new ea({type:"notcompatible",context:{id:`${t}.${e}`}})}static propertyNotFound(t){return new ea({type:"propertynotfound",context:{name:t}})}static shouldNeverHappen(){return new ea({type:"shouldneverhappen"})}constructor(t){var e;this.message=null!==(e=ta[t.type](t.context))&&void 0!==e?e:"Unexpected error",this.name=this.constructor.name,this.stack=new Error(this.message).stack,this.type=t.type}toString(){return this.message}}class ia{constructor(t,e){this.obj_=t,this.key=e}static isBindable(t){return null!==t&&("object"==typeof t||"function"==typeof t)}read(){return this.obj_[this.key]}write(t){this.obj_[this.key]=t}writeProperty(t,e){const i=this.read();if(!ia.isBindable(i))throw ea.notBindable();if(!(t in i))throw ea.propertyNotFound(t);i[t]=e}}class sa{constructor(){this.observers_={}}on(t,e){let i=this.observers_[t];return i||(i=this.observers_[t]=[]),i.push({handler:e}),this}off(t,e){const i=this.observers_[t];return i&&(this.observers_[t]=i.filter((t=>t.handler!==e))),this}emit(t,e){const i=this.observers_[t];i&&i.forEach((t=>{t.handler(e)}))}}class na{constructor(t,e){var i;this.constraint_=null==e?void 0:e.constraint,this.equals_=null!==(i=null==e?void 0:e.equals)&&void 0!==i?i:(t,e)=>t===e,this.emitter=new sa,this.rawValue_=t}get constraint(){return this.constraint_}get rawValue(){return this.rawValue_}set rawValue(t){this.setRawValue(t,{forceEmit:!1,last:!0})}setRawValue(t,e){const i=null!=e?e:{forceEmit:!1,last:!0},s=this.constraint_?this.constraint_.constrain(t):t,n=this.rawValue_;(!this.equals_(n,s)||i.forceEmit)&&(this.emitter.emit("beforechange",{sender:this}),this.rawValue_=s,this.emitter.emit("change",{options:i,previousRawValue:n,rawValue:s,sender:this}))}}class ra{constructor(t){this.emitter=new sa,this.value_=t}get rawValue(){return this.value_}set rawValue(t){this.setRawValue(t,{forceEmit:!1,last:!0})}setRawValue(t,e){const i=null!=e?e:{forceEmit:!1,last:!0},s=this.value_;(s!==t||i.forceEmit)&&(this.emitter.emit("beforechange",{sender:this}),this.value_=t,this.emitter.emit("change",{options:i,previousRawValue:s,rawValue:this.value_,sender:this}))}}class oa{constructor(t){this.emitter=new sa,this.onValueBeforeChange_=this.onValueBeforeChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.value_=t,this.value_.emitter.on("beforechange",this.onValueBeforeChange_),this.value_.emitter.on("change",this.onValueChange_)}get rawValue(){return this.value_.rawValue}onValueBeforeChange_(t){this.emitter.emit("beforechange",Object.assign(Object.assign({},t),{sender:this}))}onValueChange_(t){this.emitter.emit("change",Object.assign(Object.assign({},t),{sender:this}))}}function aa(t,e){const i=null==e?void 0:e.constraint,s=null==e?void 0:e.equals;return i||s?new na(t,e):new ra(t)}class la{constructor(t){this.emitter=new sa,this.valMap_=t;for(const t in this.valMap_){this.valMap_[t].emitter.on("change",(()=>{this.emitter.emit("change",{key:t,sender:this})}))}}static createCore(t){return Object.keys(t).reduce(((e,i)=>Object.assign(e,{[i]:aa(t[i])})),{})}static fromObject(t){const e=this.createCore(t);return new la(e)}get(t){return this.valMap_[t].rawValue}set(t,e){this.valMap_[t].rawValue=e}value(t){return this.valMap_[t]}}class ha{constructor(t){this.values=la.fromObject({max:t.max,min:t.min})}constrain(t){const e=this.values.get("max"),i=this.values.get("min");return Math.min(Math.max(t,i),e)}}class pa{constructor(t){this.values=la.fromObject({max:t.max,min:t.min})}constrain(t){const e=this.values.get("max"),i=this.values.get("min");let s=t;return Xo(i)||(s=Math.max(s,i)),Xo(e)||(s=Math.min(s,e)),s}}class ca{constructor(t,e=0){this.step=t,this.origin=e}constrain(t){const e=this.origin%this.step;return e+Math.round((t-e)/this.step)*this.step}}class ua{constructor(t){this.text=t}evaluate(){return Number(this.text)}toString(){return this.text}}const da={"**":(t,e)=>Math.pow(t,e),"*":(t,e)=>t*e,"/":(t,e)=>t/e,"%":(t,e)=>t%e,"+":(t,e)=>t+e,"-":(t,e)=>t-e,"<<":(t,e)=>t<<e,">>":(t,e)=>t>>e,">>>":(t,e)=>t>>>e,"&":(t,e)=>t&e,"^":(t,e)=>t^e,"|":(t,e)=>t|e};class va{constructor(t,e,i){this.left=e,this.operator=t,this.right=i}evaluate(){const t=da[this.operator];if(!t)throw new Error(`unexpected binary operator: '${this.operator}`);return t(this.left.evaluate(),this.right.evaluate())}toString(){return["b(",this.left.toString(),this.operator,this.right.toString(),")"].join(" ")}}const ma={"+":t=>t,"-":t=>-t,"~":t=>~t};class ba{constructor(t,e){this.operator=t,this.expression=e}evaluate(){const t=ma[this.operator];if(!t)throw new Error(`unexpected unary operator: '${this.operator}`);return t(this.expression.evaluate())}toString(){return["u(",this.operator,this.expression.toString(),")"].join(" ")}}function ga(t){return(e,i)=>{for(let s=0;s<t.length;s++){const n=t[s](e,i);if(""!==n)return n}return""}}function wa(t,e){var i;const s=t.substr(e).match(/^\s+/);return null!==(i=s&&s[0])&&void 0!==i?i:""}function fa(t,e){var i;const s=t.substr(e).match(/^[0-9]+/);return null!==(i=s&&s[0])&&void 0!==i?i:""}function _a(t,e){const i=t.substr(e,1);if(e+=1,"e"!==i.toLowerCase())return"";const s=function(t,e){const i=fa(t,e);if(""!==i)return i;const s=t.substr(e,1);if("-"!==s&&"+"!==s)return"";const n=fa(t,e+=1);return""===n?"":s+n}(t,e);return""===s?"":i+s}function xa(t,e){const i=t.substr(e,1);if("0"===i)return i;const s=function(t,e){const i=t.substr(e,1);return i.match(/^[1-9]$/)?i:""}(t,e);return e+=s.length,""===s?"":s+fa(t,e)}const ya=ga([function(t,e){const i=xa(t,e);if(e+=i.length,""===i)return"";const s=t.substr(e,1);if(e+=s.length,"."!==s)return"";const n=fa(t,e);return i+s+n+_a(t,e+=n.length)},function(t,e){const i=t.substr(e,1);if(e+=i.length,"."!==i)return"";const s=fa(t,e);return e+=s.length,""===s?"":i+s+_a(t,e)},function(t,e){const i=xa(t,e);return e+=i.length,""===i?"":i+_a(t,e)}]);const Ca=ga([function(t,e){const i=t.substr(e,2);if(e+=i.length,"0b"!==i.toLowerCase())return"";const s=function(t,e){var i;const s=t.substr(e).match(/^[01]+/);return null!==(i=s&&s[0])&&void 0!==i?i:""}(t,e);return""===s?"":i+s},function(t,e){const i=t.substr(e,2);if(e+=i.length,"0o"!==i.toLowerCase())return"";const s=function(t,e){var i;const s=t.substr(e).match(/^[0-7]+/);return null!==(i=s&&s[0])&&void 0!==i?i:""}(t,e);return""===s?"":i+s},function(t,e){const i=t.substr(e,2);if(e+=i.length,"0x"!==i.toLowerCase())return"";const s=function(t,e){var i;const s=t.substr(e).match(/^[0-9a-f]+/i);return null!==(i=s&&s[0])&&void 0!==i?i:""}(t,e);return""===s?"":i+s}]),Pa=ga([Ca,ya]);function Ea(t,e){var i;return null!==(i=function(t,e){const i=Pa(t,e);return e+=i.length,""===i?null:{evaluable:new ua(i),cursor:e}}(t,e))&&void 0!==i?i:function(t,e){const i=t.substr(e,1);if(e+=i.length,"("!==i)return null;const s=Ma(t,e);if(!s)return null;e=s.cursor,e+=wa(t,e).length;const n=t.substr(e,1);return e+=n.length,")"!==n?null:{evaluable:s.evaluable,cursor:e}}(t,e)}function ka(t,e,i){i+=wa(e,i).length;const s=t.filter((t=>e.startsWith(t,i)))[0];return s?(i+=s.length,{cursor:i+=wa(e,i).length,operator:s}):null}const Va=[["**"],["*","/","%"],["+","-"],["<<",">>>",">>"],["&"],["^"],["|"]].reduce(((t,e)=>function(t,e){return(i,s)=>{const n=t(i,s);if(!n)return null;s=n.cursor;let r=n.evaluable;for(;;){const n=ka(e,i,s);if(!n)break;s=n.cursor;const o=t(i,s);if(!o)return null;s=o.cursor,r=new va(n.operator,r,o.evaluable)}return r?{cursor:s,evaluable:r}:null}}(t,e)),(function t(e,i){const s=Ea(e,i);if(s)return s;const n=e.substr(i,1);if(i+=n.length,"+"!==n&&"-"!==n&&"~"!==n)return null;const r=t(e,i);return r?{cursor:i=r.cursor,evaluable:new ba(n,r.evaluable)}:null}));function Ma(t,e){return e+=wa(t,e).length,Va(t,e)}function La(t){var e;const i=function(t){const e=Ma(t,0);return e?e.cursor+wa(t,e.cursor).length!==t.length?null:e.evaluable:null}(t);return null!==(e=null==i?void 0:i.evaluate())&&void 0!==e?e:null}function Sa(t){if("number"==typeof t)return t;if("string"==typeof t){const e=La(t);if(!Xo(e))return e}return 0}function Aa(t){return e=>e.toFixed(Math.max(Math.min(t,20),0))}function Da(t,e,i,s,n){return s+(t-e)/(i-e)*(n-s)}function Oa(t){return String(t.toFixed(10)).split(".")[1].replace(/0+$/,"").length}function ja(t,e,i){return Math.min(Math.max(t,e),i)}function Ta(t,e){return(t%e+e)%e}function Ra(t,e){return Xo(t.step)?Math.max(Oa(e),2):Oa(t.step)}function za(t){var e;return null!==(e=t.step)&&void 0!==e?e:1}function Na(t,e){var i;const s=Math.abs(null!==(i=t.step)&&void 0!==i?i:e);return 0===s?.1:Math.pow(10,Math.floor(Math.log10(s))-1)}function Fa(t,e){return Xo(t.step)?null:new ca(t.step,e)}function Ba(t){return Xo(t.max)||Xo(t.min)?Xo(t.max)&&Xo(t.min)?null:new pa({max:t.max,min:t.min}):new ha({max:t.max,min:t.min})}function Ia(t,e){var i,s,n;return{formatter:null!==(i=t.format)&&void 0!==i?i:Aa(Ra(t,e)),keyScale:null!==(s=t.keyScale)&&void 0!==s?s:za(t),pointerScale:null!==(n=t.pointerScale)&&void 0!==n?n:Na(t,e)}}function Ua(t){return{format:t.optional.function,keyScale:t.optional.number,max:t.optional.number,min:t.optional.number,pointerScale:t.optional.number,step:t.optional.number}}function Ka(t){return{constraint:t.constraint,textProps:la.fromObject(Ia(t.params,t.initialValue))}}class qa{constructor(t){this.controller=t}get element(){return this.controller.view.element}get disabled(){return this.controller.viewProps.get("disabled")}set disabled(t){this.controller.viewProps.set("disabled",t)}get hidden(){return this.controller.viewProps.get("hidden")}set hidden(t){this.controller.viewProps.set("hidden",t)}dispose(){this.controller.viewProps.set("disposed",!0)}importState(t){return this.controller.importState(t)}exportState(){return this.controller.exportState()}}class $a{constructor(t){this.target=t}}class Ga extends $a{constructor(t,e,i){super(t),this.value=e,this.last=null==i||i}}class Ha extends $a{constructor(t,e){super(t),this.expanded=e}}class Ya extends $a{constructor(t,e){super(t),this.index=e}}class Xa extends qa{constructor(t){super(t),this.onValueChange_=this.onValueChange_.bind(this),this.emitter_=new sa,this.controller.value.emitter.on("change",this.onValueChange_)}get label(){return this.controller.labelController.props.get("label")}set label(t){this.controller.labelController.props.set("label",t)}get key(){return this.controller.value.binding.target.key}get tag(){return this.controller.tag}set tag(t){this.controller.tag=t}on(t,e){const i=e.bind(this);return this.emitter_.on(t,(t=>{i(t)})),this}refresh(){this.controller.value.fetch()}onValueChange_(t){const e=this.controller.value;this.emitter_.emit("change",new Ga(this,e.binding.target.read(),t.options.last))}}function Wa(t){return e=>i=>{if(!e&&void 0===i)return{succeeded:!1,value:void 0};if(e&&void 0===i)return{succeeded:!0,value:void 0};const s=t(i);return void 0!==s?{succeeded:!0,value:s}:{succeeded:!1,value:void 0}}}function Za(t){return{custom:e=>Wa(e)(t),boolean:Wa((t=>"boolean"==typeof t?t:void 0))(t),number:Wa((t=>"number"==typeof t?t:void 0))(t),string:Wa((t=>"string"==typeof t?t:void 0))(t),function:Wa((t=>"function"==typeof t?t:void 0))(t),constant:e=>Wa((t=>t===e?e:void 0))(t),raw:Wa((t=>t))(t),object:e=>Wa((t=>{var i;if(null!==(i=t)&&"object"==typeof i)return function(t,e){return Object.keys(e).reduce(((i,s)=>{if(void 0===i)return;const n=(0,e[s])(t[s]);return n.succeeded?Object.assign(Object.assign({},i),{[s]:n.value}):void 0}),{})}(t,e)}))(t),array:e=>Wa((t=>{var i;if(Array.isArray(t))return i=e,t.reduce(((t,e)=>{if(void 0===t)return;const s=i(e);return s.succeeded&&void 0!==s.value?[...t,s.value]:void 0}),[])}))(t)}}const Qa={optional:Za(!0),required:Za(!1)};function Ja(t,e){const i=e(Qa),s=Qa.required.object(i)(t);return s.succeeded?s.value:void 0}function tl(t,e,i,s){if(e&&!e(t))return!1;const n=Ja(t,i);return!!n&&s(n)}function el(t,e){var i;return Jo(null!==(i=null==t?void 0:t())&&void 0!==i?i:{},e)}function il(t){return"value"in t}function sl(t){if(!Wo(t)||!("binding"in t))return!1;const e=t.binding;return!!Wo(i=e)&&"target"in i;var i}const nl="http://www.w3.org/2000/svg";function rl(t){t.offsetHeight}function ol(t){return void 0!==t.ontouchstart}const al={check:'<path d="M2 8l4 4l8 -8"/>',dropdown:'<path d="M5 7h6l-3 3 z"/>',p2dpad:'<path d="M8 4v8"/><path d="M4 8h8"/><circle cx="12" cy="12" r="1.2"/>'};function ll(t,e){const i=t.createElementNS(nl,"svg");return i.innerHTML=al[e],i}function hl(t,e,i){t.insertBefore(e,t.children[i])}function pl(t){t.parentElement&&t.parentElement.removeChild(t)}function cl(t){for(;t.children.length>0;)t.removeChild(t.children[0])}function ul(t){return t.relatedTarget?t.relatedTarget:"explicitOriginalTarget"in t?t.explicitOriginalTarget:null}function dl(t,e){t.emitter.on("change",(t=>{e(t.rawValue)})),e(t.rawValue)}function vl(t,e,i){dl(t.value(e),i)}const ml="tp";function bl(t){return(e,i)=>[ml,"-",t,"v",e?`_${e}`:"",i?`-${i}`:""].join("")}const gl=bl("lbl");class wl{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(gl()),e.viewProps.bindClassModifiers(this.element);const i=t.createElement("div");i.classList.add(gl("l")),vl(e.props,"label",(e=>{Xo(e)?this.element.classList.add(gl(void 0,"nol")):(this.element.classList.remove(gl(void 0,"nol")),function(t){for(;t.childNodes.length>0;)t.removeChild(t.childNodes[0])}(i),i.appendChild(function(t,e){const i=t.createDocumentFragment();return e.split("\n").map((e=>t.createTextNode(e))).forEach(((e,s)=>{s>0&&i.appendChild(t.createElement("br")),i.appendChild(e)})),i}(t,e)))})),this.element.appendChild(i),this.labelElement=i;const s=t.createElement("div");s.classList.add(gl("v")),this.element.appendChild(s),this.valueElement=s}}class fl{constructor(t,e){this.props=e.props,this.valueController=e.valueController,this.viewProps=e.valueController.viewProps,this.view=new wl(t,{props:e.props,viewProps:this.viewProps}),this.view.valueElement.appendChild(this.valueController.view.element)}importProps(t){return tl(t,null,(t=>({label:t.optional.string})),(t=>(this.props.set("label",t.label),!0)))}exportProps(){return el(null,{label:this.props.get("label")})}}const _l=bl(""),xl={veryfirst:"vfst",first:"fst",last:"lst",verylast:"vlst"};class yl{constructor(t){this.parent_=null,this.blade=t.blade,this.view=t.view,this.viewProps=t.viewProps;const e=this.view.element;this.blade.value("positions").emitter.on("change",(()=>{["veryfirst","first","last","verylast"].forEach((t=>{e.classList.remove(_l(void 0,xl[t]))})),this.blade.get("positions").forEach((t=>{e.classList.add(_l(void 0,xl[t]))}))})),this.viewProps.handleDispose((()=>{pl(e)}))}get parent(){return this.parent_}set parent(t){this.parent_=t,this.viewProps.set("parent",this.parent_?this.parent_.viewProps:null)}importState(t){return tl(t,null,(t=>({disabled:t.required.boolean,hidden:t.required.boolean})),(t=>(this.viewProps.importState(t),!0)))}exportState(){return el(null,Object.assign({},this.viewProps.exportState()))}}class Cl extends yl{constructor(t,e){if(e.value!==e.valueController.value)throw ea.shouldNeverHappen();const i=e.valueController.viewProps,s=new fl(t,{blade:e.blade,props:e.props,valueController:e.valueController});super(Object.assign(Object.assign({},e),{view:new wl(t,{props:e.props,viewProps:i}),viewProps:i})),this.labelController=s,this.value=e.value,this.valueController=e.valueController,this.view.valueElement.appendChild(this.valueController.view.element)}importState(t){return tl(t,(e=>{var i,s,n;return super.importState(e)&&this.labelController.importProps(e)&&(null===(n=null===(s=(i=this.valueController).importProps)||void 0===s?void 0:s.call(i,t))||void 0===n||n)}),(t=>({value:t.optional.raw})),(t=>(t.value&&(this.value.rawValue=t.value),!0)))}exportState(){var t,e,i;return el((()=>super.exportState()),Object.assign(Object.assign({value:this.value.rawValue},this.labelController.exportProps()),null!==(i=null===(e=(t=this.valueController).exportProps)||void 0===e?void 0:e.call(t))&&void 0!==i?i:{}))}}function Pl(t,e){for(;t.length<e;)t.push(void 0)}function El(t){const e=[];return Pl(e,t),e}function kl(t){const e=t.indexOf(void 0);return e<0?t:t.slice(0,e)}class Vl extends qa{get label(){return this.controller.labelController.props.get("label")}set label(t){this.controller.labelController.props.set("label",t)}get title(){var t;return null!==(t=this.controller.buttonController.props.get("title"))&&void 0!==t?t:""}set title(t){this.controller.buttonController.props.set("title",t)}on(t,e){const i=e.bind(this);return this.controller.buttonController.emitter.on(t,(()=>{i(new $a(this))})),this}}function Ml(t,e){return i=>{!function(t,e,i){i?t.classList.add(e):t.classList.remove(e)}(t,e,i)}}function Ll(t,e){dl(t,(t=>{e.textContent=null!=t?t:""}))}const Sl=bl("btn");class Al{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(Sl()),e.viewProps.bindClassModifiers(this.element);const i=t.createElement("button");i.classList.add(Sl("b")),e.viewProps.bindDisabled(i),this.element.appendChild(i),this.buttonElement=i;const s=t.createElement("div");s.classList.add(Sl("t")),Ll(e.props.value("title"),s),this.buttonElement.appendChild(s)}}class Dl{constructor(t,e){this.emitter=new sa,this.onClick_=this.onClick_.bind(this),this.props=e.props,this.viewProps=e.viewProps,this.view=new Al(t,{props:this.props,viewProps:this.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}importProps(t){return tl(t,null,(t=>({title:t.optional.string})),(t=>(this.props.set("title",t.title),!0)))}exportProps(){return el(null,{title:this.props.get("title")})}onClick_(){this.emitter.emit("click",{sender:this})}}class Ol extends yl{constructor(t,e){const i=new Dl(t,{props:e.buttonProps,viewProps:e.viewProps}),s=new fl(t,{blade:e.blade,props:e.labelProps,valueController:i});super({blade:e.blade,view:s.view,viewProps:e.viewProps}),this.buttonController=i,this.labelController=s}importState(t){return tl(t,(t=>super.importState(t)&&this.buttonController.importProps(t)&&this.labelController.importProps(t)),(()=>({})),(()=>!0))}exportState(){return el((()=>super.exportState()),Object.assign(Object.assign({},this.buttonController.exportProps()),this.labelController.exportProps()))}}const jl=new class{constructor(t){const[e,i]=t.split("-"),s=e.split(".");this.major=parseInt(s[0],10),this.minor=parseInt(s[1],10),this.patch=parseInt(s[2],10),this.prerelease=null!=i?i:null}toString(){const t=[this.major,this.minor,this.patch].join(".");return null!==this.prerelease?[t,this.prerelease].join("-"):t}}("2.0.0-beta.2");function Tl(t){return Object.assign({core:jl},t)}Tl({id:"button",type:"blade",accept(t){const e=Ja(t,(t=>({title:t.required.string,view:t.required.constant("button"),label:t.optional.string})));return e?{params:e}:null},controller:t=>new Ol(t.document,{blade:t.blade,buttonProps:la.fromObject({title:t.params.title}),labelProps:la.fromObject({label:t.params.label}),viewProps:t.viewProps}),api:t=>t.controller instanceof Ol?new Vl(t.controller):null});class Rl{constructor(t,e){this.onRackValueChange_=this.onRackValueChange_.bind(this),this.controller_=t,this.emitter_=new sa,this.pool_=e;this.controller_.rack.emitter.on("valuechange",this.onRackValueChange_)}get children(){return this.controller_.rack.children.map((t=>this.pool_.createApi(t)))}addBinding(t,e,i){const s=null!=i?i:{},n=this.controller_.element.ownerDocument,r=this.pool_.createBinding(n,function(t,e){if(!ia.isBindable(t))throw ea.notBindable();return new ia(t,e)}(t,e),s),o=this.pool_.createBindingApi(r);return this.add(o,s.index)}addFolder(t){return function(t,e){return t.addBlade(Object.assign(Object.assign({},e),{view:"folder"}))}(this,t)}addButton(t){return function(t,e){return t.addBlade(Object.assign(Object.assign({},e),{view:"button"}))}(this,t)}addTab(t){return function(t,e){return t.addBlade(Object.assign(Object.assign({},e),{view:"tab"}))}(this,t)}add(t,e){const i=t.controller;return this.controller_.rack.add(i,e),t}remove(t){this.controller_.rack.remove(t.controller)}addBlade(t){const e=this.controller_.element.ownerDocument,i=this.pool_.createBlade(e,t),s=this.pool_.createApi(i);return this.add(s,t.index)}on(t,e){const i=e.bind(this);return this.emitter_.on(t,(t=>{i(t)})),this}refresh(){this.children.forEach((t=>{var e;Wo(e=t)&&"refresh"in e&&"function"==typeof e.refresh&&t.refresh()}))}onRackValueChange_(t){const e=t.bladeController,i=this.pool_.createApi(e),s=sl(e.value)?e.value.binding:null;this.emitter_.emit("change",new Ga(i,s?s.target.read():e.value.rawValue,t.options.last))}}class zl extends qa{constructor(t,e){super(t),this.rackApi_=new Rl(t.rackController,e)}}class Nl extends yl{constructor(t){super({blade:t.blade,view:t.view,viewProps:t.rackController.viewProps}),this.rackController=t.rackController}importState(t){return tl(t,(t=>super.importState(t)),(t=>({children:t.required.array(t.required.raw)})),(t=>this.rackController.rack.children.every(((e,i)=>e.importState(t.children[i])))))}exportState(){return el((()=>super.exportState()),{children:this.rackController.rack.children.map((t=>t.exportState()))})}}function Fl(t){return"rackController"in t}class Bl{constructor(t){this.emitter=new sa,this.items_=[],this.cache_=new Set,this.onSubListAdd_=this.onSubListAdd_.bind(this),this.onSubListRemove_=this.onSubListRemove_.bind(this),this.extract_=t}get items(){return this.items_}allItems(){return Array.from(this.cache_)}find(t){for(const e of this.allItems())if(t(e))return e;return null}includes(t){return this.cache_.has(t)}add(t,e){if(this.includes(t))throw ea.shouldNeverHappen();const i=void 0!==e?e:this.items_.length;this.items_.splice(i,0,t),this.cache_.add(t);const s=this.extract_(t);s&&(s.emitter.on("add",this.onSubListAdd_),s.emitter.on("remove",this.onSubListRemove_),s.allItems().forEach((t=>{this.cache_.add(t)}))),this.emitter.emit("add",{index:i,item:t,root:this,target:this})}remove(t){const e=this.items_.indexOf(t);if(e<0)return;this.items_.splice(e,1),this.cache_.delete(t);const i=this.extract_(t);i&&(i.allItems().forEach((t=>{this.cache_.delete(t)})),i.emitter.off("add",this.onSubListAdd_),i.emitter.off("remove",this.onSubListRemove_)),this.emitter.emit("remove",{index:e,item:t,root:this,target:this})}onSubListAdd_(t){this.cache_.add(t.item),this.emitter.emit("add",{index:t.index,item:t.item,root:this,target:t.target})}onSubListRemove_(t){this.cache_.delete(t.item),this.emitter.emit("remove",{index:t.index,item:t.item,root:this,target:t.target})}}function Il(t){return Fl(t)?t.rackController.rack.bcSet_:null}class Ul{constructor(t){var e,i;this.emitter=new sa,this.onBladePositionsChange_=this.onBladePositionsChange_.bind(this),this.onSetAdd_=this.onSetAdd_.bind(this),this.onSetRemove_=this.onSetRemove_.bind(this),this.onChildDispose_=this.onChildDispose_.bind(this),this.onChildPositionsChange_=this.onChildPositionsChange_.bind(this),this.onChildValueChange_=this.onChildValueChange_.bind(this),this.onChildViewPropsChange_=this.onChildViewPropsChange_.bind(this),this.onRackLayout_=this.onRackLayout_.bind(this),this.onRackValueChange_=this.onRackValueChange_.bind(this),this.blade_=null!==(e=t.blade)&&void 0!==e?e:null,null===(i=this.blade_)||void 0===i||i.value("positions").emitter.on("change",this.onBladePositionsChange_),this.viewProps=t.viewProps,this.bcSet_=new Bl(Il),this.bcSet_.emitter.on("add",this.onSetAdd_),this.bcSet_.emitter.on("remove",this.onSetRemove_)}get children(){return this.bcSet_.items}add(t,e){var i;null===(i=t.parent)||void 0===i||i.remove(t),t.parent=this,this.bcSet_.add(t,e)}remove(t){t.parent=null,this.bcSet_.remove(t)}find(t){return this.bcSet_.allItems().filter(t)}onSetAdd_(t){this.updatePositions_();const e=t.target===t.root;if(this.emitter.emit("add",{bladeController:t.item,index:t.index,root:e,sender:this}),!e)return;const i=t.item;if(i.viewProps.emitter.on("change",this.onChildViewPropsChange_),i.blade.value("positions").emitter.on("change",this.onChildPositionsChange_),i.viewProps.handleDispose(this.onChildDispose_),il(i))i.value.emitter.on("change",this.onChildValueChange_);else if(Fl(i)){const t=i.rackController.rack;if(t){const e=t.emitter;e.on("layout",this.onRackLayout_),e.on("valuechange",this.onRackValueChange_)}}}onSetRemove_(t){this.updatePositions_();const e=t.target===t.root;if(this.emitter.emit("remove",{bladeController:t.item,root:e,sender:this}),!e)return;const i=t.item;if(il(i))i.value.emitter.off("change",this.onChildValueChange_);else if(Fl(i)){const t=i.rackController.rack;if(t){const e=t.emitter;e.off("layout",this.onRackLayout_),e.off("valuechange",this.onRackValueChange_)}}}updatePositions_(){const t=this.bcSet_.items.filter((t=>!t.viewProps.get("hidden"))),e=t[0],i=t[t.length-1];this.bcSet_.items.forEach((t=>{const s=[];t===e&&(s.push("first"),this.blade_&&!this.blade_.get("positions").includes("veryfirst")||s.push("veryfirst")),t===i&&(s.push("last"),this.blade_&&!this.blade_.get("positions").includes("verylast")||s.push("verylast")),t.blade.set("positions",s)}))}onChildPositionsChange_(){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildViewPropsChange_(t){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildDispose_(){this.bcSet_.items.filter((t=>t.viewProps.get("disposed"))).forEach((t=>{this.bcSet_.remove(t)}))}onChildValueChange_(t){const e=function(t,e){for(let i=0;i<t.length;i++){const s=t[i];if(il(s)&&s.value===e)return s}return null}(this.find(il),t.sender);if(!e)throw ea.alreadyDisposed();this.emitter.emit("valuechange",{bladeController:e,options:t.options,sender:this})}onRackLayout_(t){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onRackValueChange_(t){this.emitter.emit("valuechange",{bladeController:t.bladeController,options:t.options,sender:this})}onBladePositionsChange_(){this.updatePositions_()}}class Kl{constructor(t){this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this),this.element=t.element,this.viewProps=t.viewProps;const e=new Ul({blade:t.root?void 0:t.blade,viewProps:t.viewProps});e.emitter.on("add",this.onRackAdd_),e.emitter.on("remove",this.onRackRemove_),this.rack=e,this.viewProps.handleDispose((()=>{for(let t=this.rack.children.length-1;t>=0;t--){this.rack.children[t].viewProps.set("disposed",!0)}}))}onRackAdd_(t){t.root&&hl(this.element,t.bladeController.view.element,t.index)}onRackRemove_(t){t.root&&pl(t.bladeController.view.element)}}function ql(){return new la({positions:aa([],{equals:Qo})})}class $l extends la{constructor(t){super(t)}static create(t){const e={completed:!0,expanded:t,expandedHeight:null,shouldFixHeight:!1,temporaryExpanded:null},i=la.createCore(e);return new $l(i)}get styleExpanded(){var t;return null!==(t=this.get("temporaryExpanded"))&&void 0!==t?t:this.get("expanded")}get styleHeight(){if(!this.styleExpanded)return"0";const t=this.get("expandedHeight");return this.get("shouldFixHeight")&&!Xo(t)?`${t}px`:"auto"}bindExpandedClass(t,e){const i=()=>{this.styleExpanded?t.classList.add(e):t.classList.remove(e)};vl(this,"expanded",i),vl(this,"temporaryExpanded",i)}cleanUpTransition(){this.set("shouldFixHeight",!1),this.set("expandedHeight",null),this.set("completed",!0)}}function Gl(t,e){e.style.height=t.styleHeight}function Hl(t,e){t.value("expanded").emitter.on("beforechange",(()=>{if(t.set("completed",!1),Xo(t.get("expandedHeight"))){const i=function(t,e){let i=0;return function(t,e){const i=t.style.transition;t.style.transition="none",e(),t.style.transition=i}(e,(()=>{t.set("expandedHeight",null),t.set("temporaryExpanded",!0),rl(e),i=e.clientHeight,t.set("temporaryExpanded",null),rl(e)})),i}(t,e);i>0&&t.set("expandedHeight",i)}t.set("shouldFixHeight",!0),rl(e)})),t.emitter.on("change",(()=>{Gl(t,e)})),Gl(t,e),e.addEventListener("transitionend",(e=>{"height"===e.propertyName&&t.cleanUpTransition()}))}class Yl extends zl{constructor(t,e){super(t,e),this.emitter_=new sa,this.controller.foldable.value("expanded").emitter.on("change",(t=>{this.emitter_.emit("fold",new Ha(this,t.sender.rawValue))})),this.rackApi_.on("change",(t=>{this.emitter_.emit("change",t)}))}get expanded(){return this.controller.foldable.get("expanded")}set expanded(t){this.controller.foldable.set("expanded",t)}get title(){return this.controller.props.get("title")}set title(t){this.controller.props.set("title",t)}get children(){return this.rackApi_.children}addBinding(t,e,i){return this.rackApi_.addBinding(t,e,i)}addFolder(t){return this.rackApi_.addFolder(t)}addButton(t){return this.rackApi_.addButton(t)}addTab(t){return this.rackApi_.addTab(t)}add(t,e){return this.rackApi_.add(t,e)}remove(t){this.rackApi_.remove(t)}addBlade(t){return this.rackApi_.addBlade(t)}on(t,e){const i=e.bind(this);return this.emitter_.on(t,(t=>{i(t)})),this}refresh(){this.rackApi_.refresh()}}const Xl=bl("cnt");class Wl{constructor(t,e){var i;this.className_=bl(null!==(i=e.viewName)&&void 0!==i?i:"fld"),this.element=t.createElement("div"),this.element.classList.add(this.className_(),Xl()),e.viewProps.bindClassModifiers(this.element),this.foldable_=e.foldable,this.foldable_.bindExpandedClass(this.element,this.className_(void 0,"expanded")),vl(this.foldable_,"completed",Ml(this.element,this.className_(void 0,"cpl")));const s=t.createElement("button");s.classList.add(this.className_("b")),vl(e.props,"title",(t=>{Xo(t)?this.element.classList.add(this.className_(void 0,"not")):this.element.classList.remove(this.className_(void 0,"not"))})),e.viewProps.bindDisabled(s),this.element.appendChild(s),this.buttonElement=s;const n=t.createElement("div");n.classList.add(this.className_("i")),this.element.appendChild(n);const r=t.createElement("div");r.classList.add(this.className_("t")),Ll(e.props.value("title"),r),this.buttonElement.appendChild(r),this.titleElement=r;const o=t.createElement("div");o.classList.add(this.className_("m")),this.buttonElement.appendChild(o);const a=t.createElement("div");a.classList.add(this.className_("c")),this.element.appendChild(a),this.containerElement=a}}class Zl extends Nl{constructor(t,e){var i;const s=$l.create(null===(i=e.expanded)||void 0===i||i),n=new Wl(t,{foldable:s,props:e.props,viewName:e.root?"rot":void 0,viewProps:e.viewProps});super(Object.assign(Object.assign({},e),{rackController:new Kl({blade:e.blade,element:n.containerElement,root:e.root,viewProps:e.viewProps}),view:n})),this.onTitleClick_=this.onTitleClick_.bind(this),this.props=e.props,this.foldable=s,Hl(this.foldable,this.view.containerElement),this.rackController.rack.emitter.on("add",(()=>{this.foldable.cleanUpTransition()})),this.rackController.rack.emitter.on("remove",(()=>{this.foldable.cleanUpTransition()})),this.view.buttonElement.addEventListener("click",this.onTitleClick_)}get document(){return this.view.element.ownerDocument}importState(t){return tl(t,(t=>super.importState(t)),(t=>({expanded:t.required.boolean,title:t.optional.string})),(t=>(this.foldable.set("expanded",t.expanded),this.props.set("title",t.title),!0)))}exportState(){return el((()=>super.exportState()),{expanded:this.foldable.get("expanded"),title:this.props.get("title")})}onTitleClick_(){this.foldable.set("expanded",!this.foldable.get("expanded"))}}Tl({id:"folder",type:"blade",accept(t){const e=Ja(t,(t=>({title:t.required.string,view:t.required.constant("folder"),expanded:t.optional.boolean})));return e?{params:e}:null},controller:t=>new Zl(t.document,{blade:t.blade,expanded:t.params.expanded,props:la.fromObject({title:t.params.title}),viewProps:t.viewProps}),api:t=>t.controller instanceof Zl?new Yl(t.controller,t.pool):null});const Ql=bl("");function Jl(t,e){return Ml(t,Ql(void 0,e))}class th extends la{constructor(t){var e,i;super(t),this.onDisabledChange_=this.onDisabledChange_.bind(this),this.onParentChange_=this.onParentChange_.bind(this),this.onParentGlobalDisabledChange_=this.onParentGlobalDisabledChange_.bind(this),[this.globalDisabled_,this.setGlobalDisabled_]=(i=aa(this.getGlobalDisabled_()),[new oa(i),(t,e)=>{i.setRawValue(t,e)}]),this.value("disabled").emitter.on("change",this.onDisabledChange_),this.value("parent").emitter.on("change",this.onParentChange_),null===(e=this.get("parent"))||void 0===e||e.globalDisabled.emitter.on("change",this.onParentGlobalDisabledChange_)}static create(t){var e,i,s;const n=null!=t?t:{};return new th(la.createCore({disabled:null!==(e=n.disabled)&&void 0!==e&&e,disposed:!1,hidden:null!==(i=n.hidden)&&void 0!==i&&i,parent:null!==(s=n.parent)&&void 0!==s?s:null}))}get globalDisabled(){return this.globalDisabled_}bindClassModifiers(t){dl(this.globalDisabled_,Jl(t,"disabled")),vl(this,"hidden",Jl(t,"hidden"))}bindDisabled(t){dl(this.globalDisabled_,(e=>{t.disabled=e}))}bindTabIndex(t){dl(this.globalDisabled_,(e=>{t.tabIndex=e?-1:0}))}handleDispose(t){this.value("disposed").emitter.on("change",(e=>{e&&t()}))}importState(t){this.set("disabled",t.disabled),this.set("hidden",t.hidden)}exportState(){return{disabled:this.get("disabled"),hidden:this.get("hidden")}}getGlobalDisabled_(){const t=this.get("parent");return!!t&&t.globalDisabled.rawValue||this.get("disabled")}updateGlobalDisabled_(){this.setGlobalDisabled_(this.getGlobalDisabled_())}onDisabledChange_(){this.updateGlobalDisabled_()}onParentGlobalDisabledChange_(){this.updateGlobalDisabled_()}onParentChange_(t){var e;const i=t.previousRawValue;null==i||i.globalDisabled.emitter.off("change",this.onParentGlobalDisabledChange_),null===(e=this.get("parent"))||void 0===e||e.globalDisabled.emitter.on("change",this.onParentGlobalDisabledChange_),this.updateGlobalDisabled_()}}const eh=bl("tbp");class ih{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(eh()),e.viewProps.bindClassModifiers(this.element);const i=t.createElement("div");i.classList.add(eh("c")),this.element.appendChild(i),this.containerElement=i}}const sh=bl("tbi");class nh{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(sh()),e.viewProps.bindClassModifiers(this.element),vl(e.props,"selected",(t=>{t?this.element.classList.add(sh(void 0,"sel")):this.element.classList.remove(sh(void 0,"sel"))}));const i=t.createElement("button");i.classList.add(sh("b")),e.viewProps.bindDisabled(i),this.element.appendChild(i),this.buttonElement=i;const s=t.createElement("div");s.classList.add(sh("t")),Ll(e.props.value("title"),s),this.buttonElement.appendChild(s),this.titleElement=s}}class rh{constructor(t,e){this.emitter=new sa,this.onClick_=this.onClick_.bind(this),this.props=e.props,this.viewProps=e.viewProps,this.view=new nh(t,{props:e.props,viewProps:e.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}onClick_(){this.emitter.emit("click",{sender:this})}}class oh extends Nl{constructor(t,e){const i=new ih(t,{viewProps:e.viewProps});super(Object.assign(Object.assign({},e),{rackController:new Kl({blade:e.blade,element:i.containerElement,viewProps:e.viewProps}),view:i})),this.onItemClick_=this.onItemClick_.bind(this),this.ic_=new rh(t,{props:e.itemProps,viewProps:th.create()}),this.ic_.emitter.on("click",this.onItemClick_),this.props=e.props,vl(this.props,"selected",(t=>{this.itemController.props.set("selected",t),this.viewProps.set("hidden",!t)}))}get itemController(){return this.ic_}importState(t){return tl(t,(t=>super.importState(t)),(t=>({selected:t.required.boolean,title:t.required.string})),(t=>(this.ic_.props.set("selected",t.selected),this.ic_.props.set("title",t.title),!0)))}exportState(){return el((()=>super.exportState()),{selected:this.ic_.props.get("selected"),title:this.ic_.props.get("title")})}onItemClick_(){this.props.set("selected",!0)}}class ah extends zl{constructor(t,e){super(t,e),this.emitter_=new sa,this.onSelect_=this.onSelect_.bind(this),this.pool_=e,this.rackApi_.on("change",(t=>{this.emitter_.emit("change",t)})),this.controller.tab.selectedIndex.emitter.on("change",this.onSelect_)}get pages(){return this.rackApi_.children}addPage(t){const e=this.controller.view.element.ownerDocument,i=new oh(e,{blade:ql(),itemProps:la.fromObject({selected:!1,title:t.title}),props:la.fromObject({selected:!1}),viewProps:th.create()}),s=this.pool_.createApi(i);return this.rackApi_.add(s,t.index)}removePage(t){this.rackApi_.remove(this.rackApi_.children[t])}on(t,e){const i=e.bind(this);return this.emitter_.on(t,(t=>{i(t)})),this}onSelect_(t){this.emitter_.emit("select",new Ya(this,t.rawValue))}}class lh extends zl{get title(){var t;return null!==(t=this.controller.itemController.props.get("title"))&&void 0!==t?t:""}set title(t){this.controller.itemController.props.set("title",t)}get selected(){return this.controller.props.get("selected")}set selected(t){this.controller.props.set("selected",t)}get children(){return this.rackApi_.children}addButton(t){return this.rackApi_.addButton(t)}addFolder(t){return this.rackApi_.addFolder(t)}addTab(t){return this.rackApi_.addTab(t)}add(t,e){this.rackApi_.add(t,e)}remove(t){this.rackApi_.remove(t)}addBinding(t,e,i){return this.rackApi_.addBinding(t,e,i)}addBlade(t){return this.rackApi_.addBlade(t)}refresh(){this.rackApi_.refresh()}}class hh{constructor(){this.onItemSelectedChange_=this.onItemSelectedChange_.bind(this),this.empty=aa(!0),this.selectedIndex=aa(-1),this.items_=[]}add(t,e){const i=null!=e?e:this.items_.length;this.items_.splice(i,0,t),t.emitter.on("change",this.onItemSelectedChange_),this.keepSelection_()}remove(t){const e=this.items_.indexOf(t);e<0||(this.items_.splice(e,1),t.emitter.off("change",this.onItemSelectedChange_),this.keepSelection_())}keepSelection_(){if(0===this.items_.length)return this.selectedIndex.rawValue=-1,void(this.empty.rawValue=!0);const t=this.items_.findIndex((t=>t.rawValue));t<0?(this.items_.forEach(((t,e)=>{t.rawValue=0===e})),this.selectedIndex.rawValue=0):(this.items_.forEach(((e,i)=>{e.rawValue=i===t})),this.selectedIndex.rawValue=t),this.empty.rawValue=!1}onItemSelectedChange_(t){if(t.rawValue){const e=this.items_.findIndex((e=>e===t.sender));this.items_.forEach(((t,i)=>{t.rawValue=i===e})),this.selectedIndex.rawValue=e}else this.keepSelection_()}}const ph=bl("tab");class ch{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(ph(),Xl()),e.viewProps.bindClassModifiers(this.element),dl(e.empty,Ml(this.element,ph(void 0,"nop")));const i=t.createElement("div");i.classList.add(ph("t")),this.element.appendChild(i),this.itemsElement=i;const s=t.createElement("div");s.classList.add(ph("i")),this.element.appendChild(s);const n=t.createElement("div");n.classList.add(ph("c")),this.element.appendChild(n),this.contentsElement=n}}class uh extends Nl{constructor(t,e){const i=new hh,s=new ch(t,{empty:i.empty,viewProps:e.viewProps});super({blade:e.blade,rackController:new Kl({blade:e.blade,element:s.contentsElement,viewProps:e.viewProps}),view:s}),this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this);const n=this.rackController.rack;n.emitter.on("add",this.onRackAdd_),n.emitter.on("remove",this.onRackRemove_),this.tab=i}add(t,e){this.rackController.rack.add(t,e)}remove(t){this.rackController.rack.remove(this.rackController.rack.children[t])}onRackAdd_(t){if(!t.root)return;const e=t.bladeController;hl(this.view.itemsElement,e.itemController.view.element,t.index),e.itemController.viewProps.set("parent",this.viewProps),this.tab.add(e.props.value("selected"))}onRackRemove_(t){if(!t.root)return;const e=t.bladeController;pl(e.itemController.view.element),e.itemController.viewProps.set("parent",null),this.tab.remove(e.props.value("selected"))}}Tl({id:"tab",type:"blade",accept(t){const e=Ja(t,(t=>({pages:t.required.array(t.required.object({title:t.required.string})),view:t.required.constant("tab")})));return e&&0!==e.pages.length?{params:e}:null},controller(t){const e=new uh(t.document,{blade:t.blade,viewProps:t.viewProps});return t.params.pages.forEach((i=>{const s=new oh(t.document,{blade:ql(),itemProps:la.fromObject({selected:!1,title:i.title}),props:la.fromObject({selected:!1}),viewProps:th.create()});e.add(s)})),e},api:t=>t.controller instanceof uh?new ah(t.controller,t.pool):t.controller instanceof oh?new lh(t.controller,t.pool):null});class dh extends Xa{get options(){return this.controller.valueController.props.get("options")}set options(t){this.controller.valueController.props.set("options",t)}}class vh{constructor(){this.disabled=!1,this.emitter=new sa}dispose(){}tick(){this.disabled||this.emitter.emit("tick",{sender:this})}}class mh{constructor(t,e){this.disabled_=!1,this.timerId_=null,this.onTick_=this.onTick_.bind(this),this.doc_=t,this.emitter=new sa,this.interval_=e,this.setTimer_()}get disabled(){return this.disabled_}set disabled(t){this.disabled_=t,this.disabled_?this.clearTimer_():this.setTimer_()}dispose(){this.clearTimer_()}clearTimer_(){if(null===this.timerId_)return;const t=this.doc_.defaultView;t&&t.clearInterval(this.timerId_),this.timerId_=null}setTimer_(){if(this.clearTimer_(),this.interval_<=0)return;const t=this.doc_.defaultView;t&&(this.timerId_=t.setInterval(this.onTick_,this.interval_))}onTick_(){this.disabled_||this.emitter.emit("tick",{sender:this})}}class bh{constructor(t){this.constraints=t}constrain(t){return this.constraints.reduce(((t,e)=>e.constrain(t)),t)}}function gh(t,e){if(t instanceof e)return t;if(t instanceof bh){const i=t.constraints.reduce(((t,i)=>t||(i instanceof e?i:null)),null);if(i)return i}return null}class wh{constructor(t){this.values=la.fromObject({options:t})}constrain(t){const e=this.values.get("options");if(0===e.length)return t;return e.filter((e=>e.value===t)).length>0?t:e[0].value}}function fh(t){var e;const i=Qa;return Array.isArray(t)?null===(e=Ja({items:t},(t=>({items:t.required.array(t.required.object({text:t.required.string,value:t.required.raw}))}))))||void 0===e?void 0:e.items:"object"==typeof t?i.required.raw(t).value:void 0}function _h(t){if(Array.isArray(t))return t;const e=[];return Object.keys(t).forEach((i=>{e.push({text:i,value:t[i]})})),e}function xh(t){return Xo(t)?null:new wh(_h(t))}const yh=bl("lst");class Ch{constructor(t,e){this.onValueChange_=this.onValueChange_.bind(this),this.props_=e.props,this.element=t.createElement("div"),this.element.classList.add(yh()),e.viewProps.bindClassModifiers(this.element);const i=t.createElement("select");i.classList.add(yh("s")),e.viewProps.bindDisabled(i),this.element.appendChild(i),this.selectElement=i;const s=t.createElement("div");s.classList.add(yh("m")),s.appendChild(ll(t,"dropdown")),this.element.appendChild(s),e.value.emitter.on("change",this.onValueChange_),this.value_=e.value,vl(this.props_,"options",(e=>{cl(this.selectElement),e.forEach((e=>{const i=t.createElement("option");i.textContent=e.text,this.selectElement.appendChild(i)})),this.update_()}))}update_(){const t=this.props_.get("options").map((t=>t.value));this.selectElement.selectedIndex=t.indexOf(this.value_.rawValue)}onValueChange_(){this.update_()}}class Ph{constructor(t,e){this.onSelectChange_=this.onSelectChange_.bind(this),this.props=e.props,this.value=e.value,this.viewProps=e.viewProps,this.view=new Ch(t,{props:this.props,value:this.value,viewProps:this.viewProps}),this.view.selectElement.addEventListener("change",this.onSelectChange_)}onSelectChange_(t){const e=t.currentTarget;this.value.rawValue=this.props.get("options")[e.selectedIndex].value}importProps(t){return tl(t,null,(t=>({options:t.required.custom(fh)})),(t=>(this.props.set("options",_h(t.options)),!0)))}exportProps(){return el(null,{options:this.props.get("options")})}}const Eh=bl("pop");class kh{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(Eh()),e.viewProps.bindClassModifiers(this.element),dl(e.shows,Ml(this.element,Eh(void 0,"v")))}}class Vh{constructor(t,e){this.shows=aa(!1),this.viewProps=e.viewProps,this.view=new kh(t,{shows:this.shows,viewProps:this.viewProps})}}const Mh=bl("txt");class Lh{constructor(t,e){this.onChange_=this.onChange_.bind(this),this.element=t.createElement("div"),this.element.classList.add(Mh()),e.viewProps.bindClassModifiers(this.element),this.props_=e.props,this.props_.emitter.on("change",this.onChange_);const i=t.createElement("input");i.classList.add(Mh("i")),i.type="text",e.viewProps.bindDisabled(i),this.element.appendChild(i),this.inputElement=i,e.value.emitter.on("change",this.onChange_),this.value_=e.value,this.refresh()}refresh(){const t=this.props_.get("formatter");this.inputElement.value=t(this.value_.rawValue)}onChange_(){this.refresh()}}class Sh{constructor(t,e){this.onInputChange_=this.onInputChange_.bind(this),this.parser_=e.parser,this.props=e.props,this.value=e.value,this.viewProps=e.viewProps,this.view=new Lh(t,{props:e.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(t){const e=t.currentTarget.value,i=this.parser_(e);Xo(i)||(this.value.rawValue=i),this.view.refresh()}}function Ah(t){return"false"!==t&&!!t}function Dh(t){return function(t){return String(t)}(t)}const Oh=Aa(0);function jh(t){return Oh(t)+"%"}function Th(t){return String(t)}function Rh(t){return t}function zh({primary:t,secondary:e,forward:i,backward:s}){let n=!1;function r(t){n||(n=!0,t(),n=!1)}t.emitter.on("change",(s=>{r((()=>{e.setRawValue(i(t.rawValue,e.rawValue),s.options)}))})),e.emitter.on("change",(n=>{r((()=>{t.setRawValue(s(t.rawValue,e.rawValue),n.options)})),r((()=>{e.setRawValue(i(t.rawValue,e.rawValue),n.options)}))})),r((()=>{e.setRawValue(i(t.rawValue,e.rawValue),{forceEmit:!1,last:!0})}))}function Nh(t,e){const i=t*(e.altKey?.1:1)*(e.shiftKey?10:1);return e.upKey?+i:e.downKey?-i:0}function Fh(t){return{altKey:t.altKey,downKey:"ArrowDown"===t.key,shiftKey:t.shiftKey,upKey:"ArrowUp"===t.key}}function Bh(t){return{altKey:t.altKey,downKey:"ArrowLeft"===t.key,shiftKey:t.shiftKey,upKey:"ArrowRight"===t.key}}function Ih(t){return function(t){return"ArrowUp"===t||"ArrowDown"===t}(t)||"ArrowLeft"===t||"ArrowRight"===t}function Uh(t,e){var i,s;const n=e.ownerDocument.defaultView,r=e.getBoundingClientRect();return{x:t.pageX-((null!==(i=n&&n.scrollX)&&void 0!==i?i:0)+r.left),y:t.pageY-((null!==(s=n&&n.scrollY)&&void 0!==s?s:0)+r.top)}}class Kh{constructor(t){this.lastTouch_=null,this.onDocumentMouseMove_=this.onDocumentMouseMove_.bind(this),this.onDocumentMouseUp_=this.onDocumentMouseUp_.bind(this),this.onMouseDown_=this.onMouseDown_.bind(this),this.onTouchEnd_=this.onTouchEnd_.bind(this),this.onTouchMove_=this.onTouchMove_.bind(this),this.onTouchStart_=this.onTouchStart_.bind(this),this.elem_=t,this.emitter=new sa,t.addEventListener("touchstart",this.onTouchStart_,{passive:!1}),t.addEventListener("touchmove",this.onTouchMove_,{passive:!0}),t.addEventListener("touchend",this.onTouchEnd_),t.addEventListener("mousedown",this.onMouseDown_)}computePosition_(t){const e=this.elem_.getBoundingClientRect();return{bounds:{width:e.width,height:e.height},point:t?{x:t.x,y:t.y}:null}}onMouseDown_(t){var e;t.preventDefault(),null===(e=t.currentTarget)||void 0===e||e.focus();const i=this.elem_.ownerDocument;i.addEventListener("mousemove",this.onDocumentMouseMove_),i.addEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("down",{altKey:t.altKey,data:this.computePosition_(Uh(t,this.elem_)),sender:this,shiftKey:t.shiftKey})}onDocumentMouseMove_(t){this.emitter.emit("move",{altKey:t.altKey,data:this.computePosition_(Uh(t,this.elem_)),sender:this,shiftKey:t.shiftKey})}onDocumentMouseUp_(t){const e=this.elem_.ownerDocument;e.removeEventListener("mousemove",this.onDocumentMouseMove_),e.removeEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("up",{altKey:t.altKey,data:this.computePosition_(Uh(t,this.elem_)),sender:this,shiftKey:t.shiftKey})}onTouchStart_(t){t.preventDefault();const e=t.targetTouches.item(0),i=this.elem_.getBoundingClientRect();this.emitter.emit("down",{altKey:t.altKey,data:this.computePosition_(e?{x:e.clientX-i.left,y:e.clientY-i.top}:void 0),sender:this,shiftKey:t.shiftKey}),this.lastTouch_=e}onTouchMove_(t){const e=t.targetTouches.item(0),i=this.elem_.getBoundingClientRect();this.emitter.emit("move",{altKey:t.altKey,data:this.computePosition_(e?{x:e.clientX-i.left,y:e.clientY-i.top}:void 0),sender:this,shiftKey:t.shiftKey}),this.lastTouch_=e}onTouchEnd_(t){var e;const i=null!==(e=t.targetTouches.item(0))&&void 0!==e?e:this.lastTouch_,s=this.elem_.getBoundingClientRect();this.emitter.emit("up",{altKey:t.altKey,data:this.computePosition_(i?{x:i.clientX-s.left,y:i.clientY-s.top}:void 0),sender:this,shiftKey:t.shiftKey})}}const qh=bl("txt");class $h{constructor(t,e){this.onChange_=this.onChange_.bind(this),this.props_=e.props,this.props_.emitter.on("change",this.onChange_),this.element=t.createElement("div"),this.element.classList.add(qh(),qh(void 0,"num")),e.arrayPosition&&this.element.classList.add(qh(void 0,e.arrayPosition)),e.viewProps.bindClassModifiers(this.element);const i=t.createElement("input");i.classList.add(qh("i")),i.type="text",e.viewProps.bindDisabled(i),this.element.appendChild(i),this.inputElement=i,this.onDraggingChange_=this.onDraggingChange_.bind(this),this.dragging_=e.dragging,this.dragging_.emitter.on("change",this.onDraggingChange_),this.element.classList.add(qh()),this.inputElement.classList.add(qh("i"));const s=t.createElement("div");s.classList.add(qh("k")),this.element.appendChild(s),this.knobElement=s;const n=t.createElementNS(nl,"svg");n.classList.add(qh("g")),this.knobElement.appendChild(n);const r=t.createElementNS(nl,"path");r.classList.add(qh("gb")),n.appendChild(r),this.guideBodyElem_=r;const o=t.createElementNS(nl,"path");o.classList.add(qh("gh")),n.appendChild(o),this.guideHeadElem_=o;const a=t.createElement("div");a.classList.add(bl("tt")()),this.knobElement.appendChild(a),this.tooltipElem_=a,e.value.emitter.on("change",this.onChange_),this.value=e.value,this.refresh()}onDraggingChange_(t){if(null===t.rawValue)return void this.element.classList.remove(qh(void 0,"drg"));this.element.classList.add(qh(void 0,"drg"));const e=t.rawValue/this.props_.get("pointerScale"),i=e+(e>0?-1:e<0?1:0),s=ja(-i,-4,4);this.guideHeadElem_.setAttributeNS(null,"d",[`M ${i+s},0 L${i},4 L${i+s},8`,`M ${e},-1 L${e},9`].join(" ")),this.guideBodyElem_.setAttributeNS(null,"d",`M 0,4 L${e},4`);const n=this.props_.get("formatter");this.tooltipElem_.textContent=n(this.value.rawValue),this.tooltipElem_.style.left=`${e}px`}refresh(){const t=this.props_.get("formatter");this.inputElement.value=t(this.value.rawValue)}onChange_(){this.refresh()}}class Gh{constructor(t,e){var i;this.originRawValue_=0,this.onInputChange_=this.onInputChange_.bind(this),this.onInputKeyDown_=this.onInputKeyDown_.bind(this),this.onInputKeyUp_=this.onInputKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.parser_=e.parser,this.props=e.props,this.sliderProps_=null!==(i=e.sliderProps)&&void 0!==i?i:null,this.value=e.value,this.viewProps=e.viewProps,this.dragging_=aa(null),this.view=new $h(t,{arrayPosition:e.arrayPosition,dragging:this.dragging_,props:this.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_),this.view.inputElement.addEventListener("keydown",this.onInputKeyDown_),this.view.inputElement.addEventListener("keyup",this.onInputKeyUp_);const s=new Kh(this.view.knobElement);s.emitter.on("down",this.onPointerDown_),s.emitter.on("move",this.onPointerMove_),s.emitter.on("up",this.onPointerUp_)}constrainValue_(t){var e,i;const s=null===(e=this.sliderProps_)||void 0===e?void 0:e.get("min"),n=null===(i=this.sliderProps_)||void 0===i?void 0:i.get("max");let r=t;return void 0!==s&&(r=Math.max(r,s)),void 0!==n&&(r=Math.min(r,n)),r}onInputChange_(t){const e=t.currentTarget.value,i=this.parser_(e);Xo(i)||(this.value.rawValue=this.constrainValue_(i)),this.view.refresh()}onInputKeyDown_(t){const e=Nh(this.props.get("keyScale"),Fh(t));0!==e&&this.value.setRawValue(this.constrainValue_(this.value.rawValue+e),{forceEmit:!1,last:!1})}onInputKeyUp_(t){0!==Nh(this.props.get("keyScale"),Fh(t))&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}onPointerDown_(){this.originRawValue_=this.value.rawValue,this.dragging_.rawValue=0}computeDraggingValue_(t){if(!t.point)return null;const e=t.point.x-t.bounds.width/2;return this.constrainValue_(this.originRawValue_+e*this.props.get("pointerScale"))}onPointerMove_(t){const e=this.computeDraggingValue_(t.data);null!==e&&(this.value.setRawValue(e,{forceEmit:!1,last:!1}),this.dragging_.rawValue=this.value.rawValue-this.originRawValue_)}onPointerUp_(t){const e=this.computeDraggingValue_(t.data);null!==e&&(this.value.setRawValue(e,{forceEmit:!0,last:!0}),this.dragging_.rawValue=null)}}const Hh=bl("sld");class Yh{constructor(t,e){this.onChange_=this.onChange_.bind(this),this.props_=e.props,this.props_.emitter.on("change",this.onChange_),this.element=t.createElement("div"),this.element.classList.add(Hh()),e.viewProps.bindClassModifiers(this.element);const i=t.createElement("div");i.classList.add(Hh("t")),e.viewProps.bindTabIndex(i),this.element.appendChild(i),this.trackElement=i;const s=t.createElement("div");s.classList.add(Hh("k")),this.trackElement.appendChild(s),this.knobElement=s,e.value.emitter.on("change",this.onChange_),this.value=e.value,this.update_()}update_(){const t=ja(Da(this.value.rawValue,this.props_.get("min"),this.props_.get("max"),0,100),0,100);this.knobElement.style.width=`${t}%`}onChange_(){this.update_()}}class Xh{constructor(t,e){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDownOrMove_=this.onPointerDownOrMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=e.value,this.viewProps=e.viewProps,this.props=e.props,this.view=new Yh(t,{props:this.props,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Kh(this.view.trackElement),this.ptHandler_.emitter.on("down",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("move",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.trackElement.addEventListener("keydown",this.onKeyDown_),this.view.trackElement.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(t,e){t.point&&this.value.setRawValue(Da(ja(t.point.x,0,t.bounds.width),0,t.bounds.width,this.props.get("min"),this.props.get("max")),e)}onPointerDownOrMove_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerUp_(t){this.handlePointerEvent_(t.data,{forceEmit:!0,last:!0})}onKeyDown_(t){const e=Nh(this.props.get("keyScale"),Bh(t));0!==e&&this.value.setRawValue(this.value.rawValue+e,{forceEmit:!1,last:!1})}onKeyUp_(t){0!==Nh(this.props.get("keyScale"),Bh(t))&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const Wh=bl("sldtxt");class Zh{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(Wh());const i=t.createElement("div");i.classList.add(Wh("s")),this.sliderView_=e.sliderView,i.appendChild(this.sliderView_.element),this.element.appendChild(i);const s=t.createElement("div");s.classList.add(Wh("t")),this.textView_=e.textView,s.appendChild(this.textView_.element),this.element.appendChild(s)}}class Qh{constructor(t,e){this.value=e.value,this.viewProps=e.viewProps,this.sliderC_=new Xh(t,{props:e.sliderProps,value:e.value,viewProps:this.viewProps}),this.textC_=new Gh(t,{parser:e.parser,props:e.textProps,sliderProps:e.sliderProps,value:e.value,viewProps:e.viewProps}),this.view=new Zh(t,{sliderView:this.sliderC_.view,textView:this.textC_.view})}get sliderController(){return this.sliderC_}get textController(){return this.textC_}importProps(t){return tl(t,null,(t=>({max:t.required.number,min:t.required.number})),(t=>{const e=this.sliderC_.props;return e.set("max",t.max),e.set("min",t.min),!0}))}exportProps(){const t=this.sliderC_.props;return el(null,{max:t.get("max"),min:t.get("min")})}}const Jh={containerUnitSize:"cnt-usz"};function tp(t){return`--${Jh[t]}`}class ep{constructor(t,e){const i=bl(e.viewName);this.element=t.createElement("div"),this.element.classList.add(i()),e.viewProps.bindClassModifiers(this.element)}}function ip(t){return Ua(t)}function sp(t){if(Zo(t))return Ja(t,ip)}function np(t,e){if(!t)return;const i=[],s=Fa(t,e);s&&i.push(s);const n=Ba(t);return n&&i.push(n),new bh(i)}function rp(t){if("inline"===t||"popup"===t)return t}function op(t,e){t.write(e)}const ap=bl("ckb");class lp{constructor(t,e){this.onValueChange_=this.onValueChange_.bind(this),this.element=t.createElement("div"),this.element.classList.add(ap()),e.viewProps.bindClassModifiers(this.element);const i=t.createElement("label");i.classList.add(ap("l")),this.element.appendChild(i);const s=t.createElement("input");s.classList.add(ap("i")),s.type="checkbox",i.appendChild(s),this.inputElement=s,e.viewProps.bindDisabled(this.inputElement);const n=t.createElement("div");n.classList.add(ap("w")),i.appendChild(n);const r=ll(t,"check");n.appendChild(r),e.value.emitter.on("change",this.onValueChange_),this.value=e.value,this.update_()}update_(){this.inputElement.checked=this.value.rawValue}onValueChange_(){this.update_()}}class hp{constructor(t,e){this.onInputChange_=this.onInputChange_.bind(this),this.value=e.value,this.viewProps=e.viewProps,this.view=new lp(t,{value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(t){const e=t.currentTarget;this.value.rawValue=e.checked}}Tl({id:"input-bool",type:"input",accept:(t,e)=>{if("boolean"!=typeof t)return null;const i=Ja(e,(t=>({options:t.optional.custom(fh),readonly:t.optional.constant(!1)})));return i?{initialValue:t,params:i}:null},binding:{reader:t=>Ah,constraint:t=>function(t){const e=[],i=xh(t.options);return i&&e.push(i),new bh(e)}(t.params),writer:t=>op},controller:t=>{const e=t.document,i=t.value,s=t.constraint,n=s&&gh(s,wh);return n?new Ph(e,{props:new la({options:n.values.value("options")}),value:i,viewProps:t.viewProps}):new hp(e,{value:i,viewProps:t.viewProps})},api:t=>"boolean"!=typeof t.controller.value.rawValue?null:t.controller.valueController instanceof Ph?new dh(t.controller):null});const pp=bl("col");class cp{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(pp()),e.foldable.bindExpandedClass(this.element,pp(void 0,"expanded")),vl(e.foldable,"completed",Ml(this.element,pp(void 0,"cpl")));const i=t.createElement("div");i.classList.add(pp("h")),this.element.appendChild(i);const s=t.createElement("div");s.classList.add(pp("s")),i.appendChild(s),this.swatchElement=s;const n=t.createElement("div");if(n.classList.add(pp("t")),i.appendChild(n),this.textElement=n,"inline"===e.pickerLayout){const e=t.createElement("div");e.classList.add(pp("p")),this.element.appendChild(e),this.pickerElement=e}else this.pickerElement=null}}function up(t,e,i){const s=Ta(t,360),n=ja(e/100,0,1),r=ja(i/100,0,1),o=r*n,a=o*(1-Math.abs(s/60%2-1)),l=r-o;let h,p,c;return[h,p,c]=s>=0&&s<60?[o,a,0]:s>=60&&s<120?[a,o,0]:s>=120&&s<180?[0,o,a]:s>=180&&s<240?[0,a,o]:s>=240&&s<300?[a,0,o]:[o,0,a],[255*(h+l),255*(p+l),255*(c+l)]}function dp(t){return[t[0],t[1],t[2]]}function vp(t,e){return[t[0],t[1],t[2],e]}const mp={hsl:{hsl:(t,e,i)=>[t,e,i],hsv:function(t,e,i){const s=i+e*(100-Math.abs(2*i-100))/200;return[t,0!==s?e*(100-Math.abs(2*i-100))/s:0,i+e*(100-Math.abs(2*i-100))/200]},rgb:function(t,e,i){const s=(t%360+360)%360,n=ja(e/100,0,1),r=ja(i/100,0,1),o=(1-Math.abs(2*r-1))*n,a=o*(1-Math.abs(s/60%2-1)),l=r-o/2;let h,p,c;return[h,p,c]=s>=0&&s<60?[o,a,0]:s>=60&&s<120?[a,o,0]:s>=120&&s<180?[0,o,a]:s>=180&&s<240?[0,a,o]:s>=240&&s<300?[a,0,o]:[o,0,a],[255*(h+l),255*(p+l),255*(c+l)]}},hsv:{hsl:function(t,e,i){const s=100-Math.abs(i*(200-e)/100-100);return[t,0!==s?e*i/s:0,i*(200-e)/200]},hsv:(t,e,i)=>[t,e,i],rgb:up},rgb:{hsl:function(t,e,i){const s=ja(t/255,0,1),n=ja(e/255,0,1),r=ja(i/255,0,1),o=Math.max(s,n,r),a=Math.min(s,n,r),l=o-a;let h=0,p=0;const c=(a+o)/2;return 0!==l&&(p=l/(1-Math.abs(o+a-1)),h=s===o?(n-r)/l:n===o?2+(r-s)/l:4+(s-n)/l,h=h/6+(h<0?1:0)),[360*h,100*p,100*c]},hsv:function(t,e,i){const s=ja(t/255,0,1),n=ja(e/255,0,1),r=ja(i/255,0,1),o=Math.max(s,n,r),a=o-Math.min(s,n,r);let l;return l=0===a?0:o===s?((n-r)/a%6+6)%6*60:o===n?60*((r-s)/a+2):60*((s-n)/a+4),[l,100*(0===o?0:a/o),100*o]},rgb:(t,e,i)=>[t,e,i]}};function bp(t,e){return["float"===e?1:"rgb"===t?255:360,"float"===e?1:"rgb"===t?255:100,"float"===e?1:"rgb"===t?255:100]}function gp(t,e,i){var s;const n=bp(e,i);return["rgb"===e?ja(t[0],0,n[0]):(r=t[0],o=n[0],r===o?o:Ta(r,o)),ja(t[1],0,n[1]),ja(t[2],0,n[2]),ja(null!==(s=t[3])&&void 0!==s?s:1,0,1)];var r,o}function wp(t,e,i,s){const n=bp(e,i),r=bp(e,s);return t.map(((t,e)=>t/n[e]*r[e]))}function fp(t,e,i){const s=wp(t,e.mode,e.type,"int");return wp(mp[e.mode][i.mode](...s),i.mode,"int",i.type)}class _p{static black(){return new _p([0,0,0],"rgb")}constructor(t,e){this.type="int",this.mode=e,this.comps_=gp(t,e,this.type)}getComponents(t){return vp(fp(dp(this.comps_),{mode:this.mode,type:this.type},{mode:null!=t?t:this.mode,type:this.type}),this.comps_[3])}toRgbaObject(){const t=this.getComponents("rgb");return{r:t[0],g:t[1],b:t[2],a:t[3]}}}const xp=bl("colp");class yp{constructor(t,e){this.alphaViews_=null,this.element=t.createElement("div"),this.element.classList.add(xp()),e.viewProps.bindClassModifiers(this.element);const i=t.createElement("div");i.classList.add(xp("hsv"));const s=t.createElement("div");s.classList.add(xp("sv")),this.svPaletteView_=e.svPaletteView,s.appendChild(this.svPaletteView_.element),i.appendChild(s);const n=t.createElement("div");n.classList.add(xp("h")),this.hPaletteView_=e.hPaletteView,n.appendChild(this.hPaletteView_.element),i.appendChild(n),this.element.appendChild(i);const r=t.createElement("div");if(r.classList.add(xp("rgb")),this.textsView_=e.textsView,r.appendChild(this.textsView_.element),this.element.appendChild(r),e.alphaViews){this.alphaViews_={palette:e.alphaViews.palette,text:e.alphaViews.text};const i=t.createElement("div");i.classList.add(xp("a"));const s=t.createElement("div");s.classList.add(xp("ap")),s.appendChild(this.alphaViews_.palette.element),i.appendChild(s);const n=t.createElement("div");n.classList.add(xp("at")),n.appendChild(this.alphaViews_.text.element),i.appendChild(n),this.element.appendChild(i)}}get allFocusableElements(){const t=[this.svPaletteView_.element,this.hPaletteView_.element,this.textsView_.modeSelectElement,...this.textsView_.inputViews.map((t=>t.inputElement))];return this.alphaViews_&&t.push(this.alphaViews_.palette.element,this.alphaViews_.text.inputElement),t}}function Cp(t){return"int"===t?"int":"float"===t?"float":void 0}function Pp(t){return Ja(t,(t=>({color:t.optional.object({alpha:t.optional.boolean,type:t.optional.custom(Cp)}),expanded:t.optional.boolean,picker:t.optional.custom(rp),readonly:t.optional.constant(!1)})))}function Ep(t){return t?.1:1}function kp(t){var e;return null===(e=t.color)||void 0===e?void 0:e.type}class Vp{constructor(t,e){this.type="float",this.mode=e,this.comps_=gp(t,e,this.type)}getComponents(t){return vp(fp(dp(this.comps_),{mode:this.mode,type:this.type},{mode:null!=t?t:this.mode,type:this.type}),this.comps_[3])}toRgbaObject(){const t=this.getComponents("rgb");return{r:t[0],g:t[1],b:t[2],a:t[3]}}}const Mp={int:(t,e)=>new _p(t,e),float:(t,e)=>new Vp(t,e)};function Lp(t,e,i){return Mp[i](t,e)}function Sp(t,e){if(t.type===e)return t;if(function(t){return"int"===t.type}(t)&&"float"===e)return function(t){const e=t.getComponents(),i=bp(t.mode,"int");return new Vp([Da(e[0],0,i[0],0,1),Da(e[1],0,i[1],0,1),Da(e[2],0,i[2],0,1),e[3]],t.mode)}(t);if(function(t){return"float"===t.type}(t)&&"int"===e)return function(t){const e=t.getComponents(),i=bp(t.mode,"int");return new _p([Math.round(Da(e[0],0,1,0,i[0])),Math.round(Da(e[1],0,1,0,i[1])),Math.round(Da(e[2],0,1,0,i[2])),e[3]],t.mode)}(t);throw ea.shouldNeverHappen()}function Ap(t,e){const i=t.match(/^(.+)%$/);return i?Math.min(.01*parseFloat(i[1])*e,e):Math.min(parseFloat(t),e)}const Dp={deg:t=>t,grad:t=>360*t/400,rad:t=>360*t/(2*Math.PI),turn:t=>360*t};function Op(t){const e=t.match(/^([0-9.]+?)(deg|grad|rad|turn)$/);if(!e)return parseFloat(t);const i=parseFloat(e[1]),s=e[2];return Dp[s](i)}function jp(t){const e=t.match(/^rgb\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const i=[Ap(e[1],255),Ap(e[2],255),Ap(e[3],255)];return isNaN(i[0])||isNaN(i[1])||isNaN(i[2])?null:i}function Tp(t){const e=jp(t);return e?new _p(e,"rgb"):null}function Rp(t){const e=t.match(/^rgba\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const i=[Ap(e[1],255),Ap(e[2],255),Ap(e[3],255),Ap(e[4],1)];return isNaN(i[0])||isNaN(i[1])||isNaN(i[2])||isNaN(i[3])?null:i}function zp(t){const e=Rp(t);return e?new _p(e,"rgb"):null}function Np(t){const e=t.match(/^hsl\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const i=[Op(e[1]),Ap(e[2],100),Ap(e[3],100)];return isNaN(i[0])||isNaN(i[1])||isNaN(i[2])?null:i}function Fp(t){const e=Np(t);return e?new _p(e,"hsl"):null}function Bp(t){const e=t.match(/^hsla\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const i=[Op(e[1]),Ap(e[2],100),Ap(e[3],100),Ap(e[4],1)];return isNaN(i[0])||isNaN(i[1])||isNaN(i[2])||isNaN(i[3])?null:i}function Ip(t){const e=Bp(t);return e?new _p(e,"hsl"):null}function Up(t){const e=t.match(/^#([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(e)return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16)];const i=t.match(/^(?:#|0x)([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return i?[parseInt(i[1],16),parseInt(i[2],16),parseInt(i[3],16)]:null}function Kp(t){const e=Up(t);return e?new _p(e,"rgb"):null}function qp(t){const e=t.match(/^#?([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(e)return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16),Da(parseInt(e[4]+e[4],16),0,255,0,1)];const i=t.match(/^(?:#|0x)?([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return i?[parseInt(i[1],16),parseInt(i[2],16),parseInt(i[3],16),Da(parseInt(i[4],16),0,255,0,1)]:null}function $p(t){const e=qp(t);return e?new _p(e,"rgb"):null}function Gp(t){const e=t.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!e)return null;const i=[parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3])];return isNaN(i[0])||isNaN(i[1])||isNaN(i[2])?null:i}function Hp(t){return e=>{const i=Gp(e);return i?Lp(i,"rgb",t):null}}function Yp(t){const e=t.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*a\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!e)return null;const i=[parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3]),parseFloat(e[4])];return isNaN(i[0])||isNaN(i[1])||isNaN(i[2])||isNaN(i[3])?null:i}function Xp(t){return e=>{const i=Yp(e);return i?Lp(i,"rgb",t):null}}const Wp=[{parser:Up,result:{alpha:!1,mode:"rgb",notation:"hex"}},{parser:qp,result:{alpha:!0,mode:"rgb",notation:"hex"}},{parser:jp,result:{alpha:!1,mode:"rgb",notation:"func"}},{parser:Rp,result:{alpha:!0,mode:"rgb",notation:"func"}},{parser:Np,result:{alpha:!1,mode:"hsl",notation:"func"}},{parser:Bp,result:{alpha:!0,mode:"hsl",notation:"func"}},{parser:Gp,result:{alpha:!1,mode:"rgb",notation:"object"}},{parser:Yp,result:{alpha:!0,mode:"rgb",notation:"object"}}];function Zp(t,e="int"){const i=function(t){return Wp.reduce(((e,{parser:i,result:s})=>e||(i(t)?s:null)),null)}(t);return i?"hex"===i.notation&&"float"!==e?Object.assign(Object.assign({},i),{type:"int"}):"func"===i.notation?Object.assign(Object.assign({},i),{type:e}):null:null}function Qp(t){const e=[Kp,$p,Tp,zp,Fp,Ip];"int"===t&&e.push(Hp("int"),Xp("int")),"float"===t&&e.push(Hp("float"),Xp("float"));const i=function(t){return e=>t.reduce(((t,i)=>null!==t?t:i(e)),null)}(e);return e=>{const s=i(e);return s?Sp(s,t):null}}function Jp(t){const e=Qp("int");if("string"!=typeof t)return _p.black();const i=e(t);return null!=i?i:_p.black()}function tc(t){const e=ja(Math.floor(t),0,255).toString(16);return 1===e.length?`0${e}`:e}function ec(t,e="#"){return`${e}${dp(t.getComponents("rgb")).map(tc).join("")}`}function ic(t,e="#"){const i=t.getComponents("rgb");return`${e}${[i[0],i[1],i[2],255*i[3]].map(tc).join("")}`}function sc(t){const e=Aa(0);return`rgb(${dp(Sp(t,"int").getComponents("rgb")).map((t=>e(t))).join(", ")})`}function nc(t){const e=Aa(2),i=Aa(0);return`rgba(${Sp(t,"int").getComponents("rgb").map(((t,s)=>(3===s?e:i)(t))).join(", ")})`}function rc(t,e){const i=Aa("float"===e?2:0),s=["r","g","b"];return`{${dp(Sp(t,e).getComponents("rgb")).map(((t,e)=>`${s[e]}: ${i(t)}`)).join(", ")}}`}function oc(t){return e=>rc(e,t)}function ac(t,e){const i=Aa(2),s=Aa("float"===e?2:0),n=["r","g","b","a"];return`{${Sp(t,e).getComponents("rgb").map(((t,e)=>`${n[e]}: ${(3===e?i:s)(t)}`)).join(", ")}}`}function lc(t){return e=>ac(e,t)}const hc=[{format:{alpha:!1,mode:"rgb",notation:"hex",type:"int"},stringifier:ec},{format:{alpha:!0,mode:"rgb",notation:"hex",type:"int"},stringifier:ic},{format:{alpha:!1,mode:"rgb",notation:"func",type:"int"},stringifier:sc},{format:{alpha:!0,mode:"rgb",notation:"func",type:"int"},stringifier:nc},{format:{alpha:!1,mode:"hsl",notation:"func",type:"int"},stringifier:function(t){const e=[Aa(0),jh,jh];return`hsl(${dp(Sp(t,"int").getComponents("hsl")).map(((t,i)=>e[i](t))).join(", ")})`}},{format:{alpha:!0,mode:"hsl",notation:"func",type:"int"},stringifier:function(t){const e=[Aa(0),jh,jh,Aa(2)];return`hsla(${Sp(t,"int").getComponents("hsl").map(((t,i)=>e[i](t))).join(", ")})`}},...["int","float"].reduce(((t,e)=>[...t,{format:{alpha:!1,mode:"rgb",notation:"object",type:e},stringifier:oc(e)},{format:{alpha:!0,mode:"rgb",notation:"object",type:e},stringifier:lc(e)}]),[])];function pc(t){return hc.reduce(((e,i)=>{return e||(s=i.format,n=t,s.alpha===n.alpha&&s.mode===n.mode&&s.notation===n.notation&&s.type===n.type?i.stringifier:null);var s,n}),null)}const cc=bl("apl");class uc{constructor(t,e){this.onValueChange_=this.onValueChange_.bind(this),this.value=e.value,this.value.emitter.on("change",this.onValueChange_),this.element=t.createElement("div"),this.element.classList.add(cc()),e.viewProps.bindClassModifiers(this.element),e.viewProps.bindTabIndex(this.element);const i=t.createElement("div");i.classList.add(cc("b")),this.element.appendChild(i);const s=t.createElement("div");s.classList.add(cc("c")),i.appendChild(s),this.colorElem_=s;const n=t.createElement("div");n.classList.add(cc("m")),this.element.appendChild(n),this.markerElem_=n;const r=t.createElement("div");r.classList.add(cc("p")),this.markerElem_.appendChild(r),this.previewElem_=r,this.update_()}update_(){const t=this.value.rawValue,e=t.getComponents("rgb"),i=new _p([e[0],e[1],e[2],0],"rgb"),s=new _p([e[0],e[1],e[2],255],"rgb"),n=["to right",nc(i),nc(s)];this.colorElem_.style.background=`linear-gradient(${n.join(",")})`,this.previewElem_.style.backgroundColor=nc(t);const r=Da(e[3],0,1,0,100);this.markerElem_.style.left=`${r}%`}onValueChange_(){this.update_()}}class dc{constructor(t,e){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=e.value,this.viewProps=e.viewProps,this.view=new uc(t,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Kh(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(t,e){if(!t.point)return;const i=t.point.x/t.bounds.width,s=this.value.rawValue,[n,r,o]=s.getComponents("hsv");this.value.setRawValue(new _p([n,r,o,i],"hsv"),e)}onPointerDown_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerMove_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerUp_(t){this.handlePointerEvent_(t.data,{forceEmit:!0,last:!0})}onKeyDown_(t){const e=Nh(Ep(!0),Bh(t));if(0===e)return;const i=this.value.rawValue,[s,n,r,o]=i.getComponents("hsv");this.value.setRawValue(new _p([s,n,r,o+e],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(t){0!==Nh(Ep(!0),Bh(t))&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const vc=bl("coltxt");class mc{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(vc()),e.viewProps.bindClassModifiers(this.element);const i=t.createElement("div");i.classList.add(vc("m")),this.modeElem_=function(t){const e=t.createElement("select");return e.appendChild([{text:"RGB",value:"rgb"},{text:"HSL",value:"hsl"},{text:"HSV",value:"hsv"},{text:"HEX",value:"hex"}].reduce(((e,i)=>{const s=t.createElement("option");return s.textContent=i.text,s.value=i.value,e.appendChild(s),e}),t.createDocumentFragment())),e}(t),this.modeElem_.classList.add(vc("ms")),i.appendChild(this.modeSelectElement),e.viewProps.bindDisabled(this.modeElem_);const s=t.createElement("div");s.classList.add(vc("mm")),s.appendChild(ll(t,"dropdown")),i.appendChild(s),this.element.appendChild(i);const n=t.createElement("div");n.classList.add(vc("w")),this.element.appendChild(n),this.inputsElem_=n,this.inputViews_=e.inputViews,this.applyInputViews_(),dl(e.mode,(t=>{this.modeElem_.value=t}))}get modeSelectElement(){return this.modeElem_}get inputViews(){return this.inputViews_}set inputViews(t){this.inputViews_=t,this.applyInputViews_()}applyInputViews_(){cl(this.inputsElem_);const t=this.element.ownerDocument;this.inputViews_.forEach((e=>{const i=t.createElement("div");i.classList.add(vc("c")),i.appendChild(e.element),this.inputsElem_.appendChild(i)}))}}function bc(t,e,i){const s=bp(t,e)[i];return new ha({min:0,max:s})}function gc(t,e){const i={colorMode:e.colorMode,colorType:e.colorType,parser:La,viewProps:e.viewProps};return[0,1,2].map((s=>{const n=function(t,e,i){return new Gh(t,{arrayPosition:0===i?"fst":2===i?"lst":"mid",parser:e.parser,props:la.fromObject({formatter:(s=e.colorType,Aa("float"===s?2:0)),keyScale:Ep(!1),pointerScale:"float"===e.colorType?.01:1}),value:aa(0,{constraint:bc(e.colorMode,e.colorType,i)}),viewProps:e.viewProps});var s}(t,i,s);return zh({primary:e.value,secondary:n.value,forward:t=>Sp(t,e.colorType).getComponents(e.colorMode)[s],backward(t,i){const n=e.colorMode,r=Sp(t,e.colorType).getComponents(n);r[s]=i;return Sp(Lp(vp(dp(r),r[3]),n,e.colorType),"int")}}),n}))}class wc{constructor(t,e){this.onModeSelectChange_=this.onModeSelectChange_.bind(this),this.colorType_=e.colorType,this.value=e.value,this.viewProps=e.viewProps,this.colorMode=aa(this.value.rawValue.mode),this.ccs_=this.createComponentControllers_(t),this.view=new mc(t,{mode:this.colorMode,inputViews:[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view],viewProps:this.viewProps}),this.view.modeSelectElement.addEventListener("change",this.onModeSelectChange_)}createComponentControllers_(t){const e=this.colorMode.rawValue;return function(t){return"hex"!==t}(e)?gc(t,{colorMode:e,colorType:this.colorType_,value:this.value,viewProps:this.viewProps}):function(t,e){const i=new Sh(t,{parser:Qp("int"),props:la.fromObject({formatter:ec}),value:aa(_p.black()),viewProps:e.viewProps});return zh({primary:e.value,secondary:i.value,forward:t=>new _p(dp(t.getComponents()),t.mode),backward:(t,e)=>new _p(vp(dp(e.getComponents(t.mode)),t.getComponents()[3]),t.mode)}),[i]}(t,{value:this.value,viewProps:this.viewProps})}onModeSelectChange_(t){const e=t.currentTarget;this.colorMode.rawValue=e.value,this.ccs_=this.createComponentControllers_(this.view.element.ownerDocument),this.view.inputViews=this.ccs_.map((t=>t.view))}}const fc=bl("hpl");class _c{constructor(t,e){this.onValueChange_=this.onValueChange_.bind(this),this.value=e.value,this.value.emitter.on("change",this.onValueChange_),this.element=t.createElement("div"),this.element.classList.add(fc()),e.viewProps.bindClassModifiers(this.element),e.viewProps.bindTabIndex(this.element);const i=t.createElement("div");i.classList.add(fc("c")),this.element.appendChild(i);const s=t.createElement("div");s.classList.add(fc("m")),this.element.appendChild(s),this.markerElem_=s,this.update_()}update_(){const t=this.value.rawValue,[e]=t.getComponents("hsv");this.markerElem_.style.backgroundColor=sc(new _p([e,100,100],"hsv"));const i=Da(e,0,360,0,100);this.markerElem_.style.left=`${i}%`}onValueChange_(){this.update_()}}class xc{constructor(t,e){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=e.value,this.viewProps=e.viewProps,this.view=new _c(t,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Kh(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(t,e){if(!t.point)return;const i=Da(ja(t.point.x,0,t.bounds.width),0,t.bounds.width,0,360),s=this.value.rawValue,[,n,r,o]=s.getComponents("hsv");this.value.setRawValue(new _p([i,n,r,o],"hsv"),e)}onPointerDown_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerMove_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerUp_(t){this.handlePointerEvent_(t.data,{forceEmit:!0,last:!0})}onKeyDown_(t){const e=Nh(Ep(!1),Bh(t));if(0===e)return;const i=this.value.rawValue,[s,n,r,o]=i.getComponents("hsv");this.value.setRawValue(new _p([s+e,n,r,o],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(t){0!==Nh(Ep(!1),Bh(t))&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const yc=bl("svp");class Cc{constructor(t,e){this.onValueChange_=this.onValueChange_.bind(this),this.value=e.value,this.value.emitter.on("change",this.onValueChange_),this.element=t.createElement("div"),this.element.classList.add(yc()),e.viewProps.bindClassModifiers(this.element),e.viewProps.bindTabIndex(this.element);const i=t.createElement("canvas");i.height=64,i.width=64,i.classList.add(yc("c")),this.element.appendChild(i),this.canvasElement=i;const s=t.createElement("div");s.classList.add(yc("m")),this.element.appendChild(s),this.markerElem_=s,this.update_()}update_(){const t=function(t){const e=t.ownerDocument.defaultView;return e&&"document"in e?t.getContext("2d",{willReadFrequently:!0}):null}(this.canvasElement);if(!t)return;const e=this.value.rawValue.getComponents("hsv"),i=this.canvasElement.width,s=this.canvasElement.height,n=t.getImageData(0,0,i,s),r=n.data;for(let t=0;t<s;t++)for(let n=0;n<i;n++){const o=Da(n,0,i,0,100),a=Da(t,0,s,100,0),l=up(e[0],o,a),h=4*(t*i+n);r[h]=l[0],r[h+1]=l[1],r[h+2]=l[2],r[h+3]=255}t.putImageData(n,0,0);const o=Da(e[1],0,100,0,100);this.markerElem_.style.left=`${o}%`;const a=Da(e[2],0,100,100,0);this.markerElem_.style.top=`${a}%`}onValueChange_(){this.update_()}}class Pc{constructor(t,e){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=e.value,this.viewProps=e.viewProps,this.view=new Cc(t,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Kh(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(t,e){if(!t.point)return;const i=Da(t.point.x,0,t.bounds.width,0,100),s=Da(t.point.y,0,t.bounds.height,100,0),[n,,,r]=this.value.rawValue.getComponents("hsv");this.value.setRawValue(new _p([n,i,s,r],"hsv"),e)}onPointerDown_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerMove_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerUp_(t){this.handlePointerEvent_(t.data,{forceEmit:!0,last:!0})}onKeyDown_(t){Ih(t.key)&&t.preventDefault();const[e,i,s,n]=this.value.rawValue.getComponents("hsv"),r=Ep(!1),o=Nh(r,Bh(t)),a=Nh(r,Fh(t));0===o&&0===a||this.value.setRawValue(new _p([e,i+o,s+a,n],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(t){const e=Ep(!1),i=Nh(e,Bh(t)),s=Nh(e,Fh(t));0===i&&0===s||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class Ec{constructor(t,e){this.value=e.value,this.viewProps=e.viewProps,this.hPaletteC_=new xc(t,{value:this.value,viewProps:this.viewProps}),this.svPaletteC_=new Pc(t,{value:this.value,viewProps:this.viewProps}),this.alphaIcs_=e.supportsAlpha?{palette:new dc(t,{value:this.value,viewProps:this.viewProps}),text:new Gh(t,{parser:La,props:la.fromObject({pointerScale:.01,keyScale:.1,formatter:Aa(2)}),value:aa(0,{constraint:new ha({min:0,max:1})}),viewProps:this.viewProps})}:null,this.alphaIcs_&&zh({primary:this.value,secondary:this.alphaIcs_.text.value,forward:t=>t.getComponents()[3],backward:(t,e)=>{const i=t.getComponents();return i[3]=e,new _p(i,t.mode)}}),this.textsC_=new wc(t,{colorType:e.colorType,value:this.value,viewProps:this.viewProps}),this.view=new yp(t,{alphaViews:this.alphaIcs_?{palette:this.alphaIcs_.palette.view,text:this.alphaIcs_.text.view}:null,hPaletteView:this.hPaletteC_.view,supportsAlpha:e.supportsAlpha,svPaletteView:this.svPaletteC_.view,textsView:this.textsC_.view,viewProps:this.viewProps})}get textsController(){return this.textsC_}}const kc=bl("colsw");class Vc{constructor(t,e){this.onValueChange_=this.onValueChange_.bind(this),e.value.emitter.on("change",this.onValueChange_),this.value=e.value,this.element=t.createElement("div"),this.element.classList.add(kc()),e.viewProps.bindClassModifiers(this.element);const i=t.createElement("div");i.classList.add(kc("sw")),this.element.appendChild(i),this.swatchElem_=i;const s=t.createElement("button");s.classList.add(kc("b")),e.viewProps.bindDisabled(s),this.element.appendChild(s),this.buttonElement=s,this.update_()}update_(){const t=this.value.rawValue;this.swatchElem_.style.backgroundColor=ic(t)}onValueChange_(){this.update_()}}class Mc{constructor(t,e){this.value=e.value,this.viewProps=e.viewProps,this.view=new Vc(t,{value:this.value,viewProps:this.viewProps})}}class Lc{constructor(t,e){this.onButtonBlur_=this.onButtonBlur_.bind(this),this.onButtonClick_=this.onButtonClick_.bind(this),this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.value=e.value,this.viewProps=e.viewProps,this.foldable_=$l.create(e.expanded),this.swatchC_=new Mc(t,{value:this.value,viewProps:this.viewProps});const i=this.swatchC_.view.buttonElement;i.addEventListener("blur",this.onButtonBlur_),i.addEventListener("click",this.onButtonClick_),this.textC_=new Sh(t,{parser:e.parser,props:la.fromObject({formatter:e.formatter}),value:this.value,viewProps:this.viewProps}),this.view=new cp(t,{foldable:this.foldable_,pickerLayout:e.pickerLayout}),this.view.swatchElement.appendChild(this.swatchC_.view.element),this.view.textElement.appendChild(this.textC_.view.element),this.popC_="popup"===e.pickerLayout?new Vh(t,{viewProps:this.viewProps}):null;const s=new Ec(t,{colorType:e.colorType,supportsAlpha:e.supportsAlpha,value:this.value,viewProps:this.viewProps});s.view.allFocusableElements.forEach((t=>{t.addEventListener("blur",this.onPopupChildBlur_),t.addEventListener("keydown",this.onPopupChildKeydown_)})),this.pickerC_=s,this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(s.view.element),zh({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:t=>t,backward:(t,e)=>e})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),Hl(this.foldable_,this.view.pickerElement))}get textController(){return this.textC_}onButtonBlur_(t){if(!this.popC_)return;const e=this.view.element,i=t.relatedTarget;i&&e.contains(i)||(this.popC_.shows.rawValue=!1)}onButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(t){if(!this.popC_)return;const e=this.popC_.view.element,i=ul(t);i&&e.contains(i)||i&&i===this.swatchC_.view.buttonElement&&!ol(e.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(t){this.popC_?"Escape"===t.key&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&"Escape"===t.key&&this.swatchC_.view.buttonElement.focus()}}function Sc(t){return dp(t.getComponents("rgb")).reduce(((t,e)=>t<<8|255&Math.floor(e)),0)}function Ac(t){return t.getComponents("rgb").reduce(((t,e,i)=>t<<8|255&Math.floor(3===i?255*e:e)),0)>>>0}function Dc(t){return"number"!=typeof t?_p.black():new _p([(e=t)>>16&255,e>>8&255,255&e],"rgb");var e}function Oc(t){return"number"!=typeof t?_p.black():new _p([(e=t)>>24&255,e>>16&255,e>>8&255,Da(255&e,0,255,0,1)],"rgb");var e}function jc(t,e){return"object"==typeof t&&!Xo(t)&&(e in t&&"number"==typeof t[e])}function Tc(t){return jc(t,"r")&&jc(t,"g")&&jc(t,"b")}function Rc(t){return Tc(t)&&jc(t,"a")}function zc(t){return Tc(t)}function Nc(t,e){if(t.mode!==e.mode)return!1;if(t.type!==e.type)return!1;const i=t.getComponents(),s=e.getComponents();for(let t=0;t<i.length;t++)if(i[t]!==s[t])return!1;return!0}function Fc(t){return"a"in t?[t.r,t.g,t.b,t.a]:[t.r,t.g,t.b]}function Bc(t,e){return(i,s)=>{t?function(t,e,i){const s=Sp(e,i).toRgbaObject();t.writeProperty("r",s.r),t.writeProperty("g",s.g),t.writeProperty("b",s.b),t.writeProperty("a",s.a)}(i,s,e):function(t,e,i){const s=Sp(e,i).toRgbaObject();t.writeProperty("r",s.r),t.writeProperty("g",s.g),t.writeProperty("b",s.b)}(i,s,e)}}function Ic(t){return e=>{const i=function(t,e){if(!zc(t))return Sp(_p.black(),e);if("int"===e){const e=Fc(t);return new _p(e,"rgb")}if("float"===e){const e=Fc(t);return new Vp(e,"rgb")}return Sp(_p.black(),"int")}(e,t);return Sp(i,"int")}}function Uc(t,e){return i=>t?ac(i,e):rc(i,e)}Tl({id:"input-color-number",type:"input",accept:(t,e)=>{if("number"!=typeof t)return null;if(!function(t){return"color"in t||"color"===t.view}(e))return null;const i=Pp(e);return i?{initialValue:t,params:Object.assign(Object.assign({},i),{supportsAlpha:(s=e,!!(null===(n=null==s?void 0:s.color)||void 0===n?void 0:n.alpha))})}:null;var s,n},binding:{reader:t=>t.params.supportsAlpha?Oc:Dc,equals:Nc,writer:t=>function(t){const e=t?Ac:Sc;return(t,i)=>{op(t,e(i))}}(t.params.supportsAlpha)},controller:t=>{var e,i,s;return new Lc(t.document,{colorType:"int",expanded:null!==(e=t.params.expanded)&&void 0!==e&&e,formatter:(s=t.params.supportsAlpha,s?t=>ic(t,"0x"):t=>ec(t,"0x")),parser:Qp("int"),pickerLayout:null!==(i=t.params.picker)&&void 0!==i?i:"popup",supportsAlpha:t.params.supportsAlpha,value:t.value,viewProps:t.viewProps})}}),Tl({id:"input-color-object",type:"input",accept:(t,e)=>{var i;if(!zc(t))return null;const s=Pp(e);return s?{initialValue:t,params:Object.assign(Object.assign({},s),{colorType:null!==(i=kp(e))&&void 0!==i?i:"int"})}:null},binding:{reader:t=>Ic(t.params.colorType),equals:Nc,writer:t=>Bc(Rc(t.initialValue),t.params.colorType)},controller:t=>{var e,i;const s=Rc(t.initialValue);return new Lc(t.document,{colorType:t.params.colorType,expanded:null!==(e=t.params.expanded)&&void 0!==e&&e,formatter:Uc(s,t.params.colorType),parser:Qp("int"),pickerLayout:null!==(i=t.params.picker)&&void 0!==i?i:"popup",supportsAlpha:s,value:t.value,viewProps:t.viewProps})}}),Tl({id:"input-color-string",type:"input",accept:(t,e)=>{if("string"!=typeof t)return null;if("text"===e.view)return null;const i=Zp(t,kp(e));if(!i)return null;const s=pc(i);if(!s)return null;const n=Pp(e);return n?{initialValue:t,params:Object.assign(Object.assign({},n),{format:i,stringifier:s})}:null},binding:{reader:()=>Jp,equals:Nc,writer:t=>{const e=function(t){const e=pc(t);return e?(t,i)=>{op(t,e(i))}:null}(t.params.format);if(!e)throw ea.notBindable();return e}},controller:t=>{var e,i;return new Lc(t.document,{colorType:t.params.format.type,expanded:null!==(e=t.params.expanded)&&void 0!==e&&e,formatter:t.params.stringifier,parser:Qp("int"),pickerLayout:null!==(i=t.params.picker)&&void 0!==i?i:"popup",supportsAlpha:t.params.format.alpha,value:t.value,viewProps:t.viewProps})}});class Kc{constructor(t){this.components=t.components,this.asm_=t.assembly}constrain(t){const e=this.asm_.toComponents(t).map(((t,e)=>{var i,s;return null!==(s=null===(i=this.components[e])||void 0===i?void 0:i.constrain(t))&&void 0!==s?s:t}));return this.asm_.fromComponents(e)}}const qc=bl("pndtxt");class $c{constructor(t,e){this.textViews=e.textViews,this.element=t.createElement("div"),this.element.classList.add(qc()),this.textViews.forEach((e=>{const i=t.createElement("div");i.classList.add(qc("a")),i.appendChild(e.element),this.element.appendChild(i)}))}}class Gc{constructor(t,e){this.value=e.value,this.viewProps=e.viewProps,this.acs_=e.axes.map(((i,s)=>function(t,e,i){return new Gh(t,{arrayPosition:0===i?"fst":i===e.axes.length-1?"lst":"mid",parser:e.parser,props:e.axes[i].textProps,value:aa(0,{constraint:e.axes[i].constraint}),viewProps:e.viewProps})}(t,e,s))),this.acs_.forEach(((t,i)=>{zh({primary:this.value,secondary:t.value,forward:t=>e.assembly.toComponents(t)[i],backward:(t,s)=>{const n=e.assembly.toComponents(t);return n[i]=s,e.assembly.fromComponents(n)}})})),this.view=new $c(t,{textViews:this.acs_.map((t=>t.view))})}get textControllers(){return this.acs_}}class Hc extends Xa{get max(){return this.controller.valueController.sliderController.props.get("max")}set max(t){this.controller.valueController.sliderController.props.set("max",t)}get min(){return this.controller.valueController.sliderController.props.get("min")}set min(t){this.controller.valueController.sliderController.props.set("min",t)}}Tl({id:"input-number",type:"input",accept:(t,e)=>{if("number"!=typeof t)return null;const i=Ja(e,(t=>Object.assign(Object.assign({},Ua(t)),{options:t.optional.custom(fh),readonly:t.optional.constant(!1)})));return i?{initialValue:t,params:i}:null},binding:{reader:t=>Sa,constraint:t=>function(t,e){const i=[],s=Fa(t,e);s&&i.push(s);const n=Ba(t);n&&i.push(n);const r=xh(t.options);return r&&i.push(r),new bh(i)}(t.params,t.initialValue),writer:t=>op},controller:t=>{const e=t.value,i=t.constraint,s=i&&gh(i,wh);if(s)return new Ph(t.document,{props:new la({options:s.values.value("options")}),value:e,viewProps:t.viewProps});const n=Ia(t.params,e.rawValue),r=i&&gh(i,ha);return r?new Qh(t.document,Object.assign(Object.assign({},(o=Object.assign(Object.assign({},n),{keyScale:aa(n.keyScale),max:r.values.value("max"),min:r.values.value("min")}),{sliderProps:new la({keyScale:o.keyScale,max:o.max,min:o.min}),textProps:new la({formatter:aa(o.formatter),keyScale:o.keyScale,pointerScale:aa(o.pointerScale)})})),{parser:La,value:e,viewProps:t.viewProps})):new Gh(t.document,{parser:La,props:la.fromObject(n),value:e,viewProps:t.viewProps});var o},api:t=>"number"!=typeof t.controller.value.rawValue?null:t.controller.valueController instanceof Qh?new Hc(t.controller):t.controller.valueController instanceof Ph?new dh(t.controller):null});class Yc{constructor(t=0,e=0){this.x=t,this.y=e}getComponents(){return[this.x,this.y]}static isObject(t){if(Xo(t))return!1;const e=t.x,i=t.y;return"number"==typeof e&&"number"==typeof i}static equals(t,e){return t.x===e.x&&t.y===e.y}toObject(){return{x:this.x,y:this.y}}}const Xc={toComponents:t=>t.getComponents(),fromComponents:t=>new Yc(...t)},Wc=bl("p2d");class Zc{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(Wc()),e.viewProps.bindClassModifiers(this.element),dl(e.expanded,Ml(this.element,Wc(void 0,"expanded")));const i=t.createElement("div");i.classList.add(Wc("h")),this.element.appendChild(i);const s=t.createElement("button");s.classList.add(Wc("b")),s.appendChild(ll(t,"p2dpad")),e.viewProps.bindDisabled(s),i.appendChild(s),this.buttonElement=s;const n=t.createElement("div");if(n.classList.add(Wc("t")),i.appendChild(n),this.textElement=n,"inline"===e.pickerLayout){const e=t.createElement("div");e.classList.add(Wc("p")),this.element.appendChild(e),this.pickerElement=e}else this.pickerElement=null}}const Qc=bl("p2dp");class Jc{constructor(t,e){this.onFoldableChange_=this.onFoldableChange_.bind(this),this.onPropsChange_=this.onPropsChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.props_=e.props,this.props_.emitter.on("change",this.onPropsChange_),this.element=t.createElement("div"),this.element.classList.add(Qc()),"popup"===e.layout&&this.element.classList.add(Qc(void 0,"p")),e.viewProps.bindClassModifiers(this.element);const i=t.createElement("div");i.classList.add(Qc("p")),e.viewProps.bindTabIndex(i),this.element.appendChild(i),this.padElement=i;const s=t.createElementNS(nl,"svg");s.classList.add(Qc("g")),this.padElement.appendChild(s),this.svgElem_=s;const n=t.createElementNS(nl,"line");n.classList.add(Qc("ax")),n.setAttributeNS(null,"x1","0"),n.setAttributeNS(null,"y1","50%"),n.setAttributeNS(null,"x2","100%"),n.setAttributeNS(null,"y2","50%"),this.svgElem_.appendChild(n);const r=t.createElementNS(nl,"line");r.classList.add(Qc("ax")),r.setAttributeNS(null,"x1","50%"),r.setAttributeNS(null,"y1","0"),r.setAttributeNS(null,"x2","50%"),r.setAttributeNS(null,"y2","100%"),this.svgElem_.appendChild(r);const o=t.createElementNS(nl,"line");o.classList.add(Qc("l")),o.setAttributeNS(null,"x1","50%"),o.setAttributeNS(null,"y1","50%"),this.svgElem_.appendChild(o),this.lineElem_=o;const a=t.createElement("div");a.classList.add(Qc("m")),this.padElement.appendChild(a),this.markerElem_=a,e.value.emitter.on("change",this.onValueChange_),this.value=e.value,this.update_()}get allFocusableElements(){return[this.padElement]}update_(){const[t,e]=this.value.rawValue.getComponents(),i=this.props_.get("max"),s=Da(t,-i,+i,0,100),n=Da(e,-i,+i,0,100),r=this.props_.get("invertsY")?100-n:n;this.lineElem_.setAttributeNS(null,"x2",`${s}%`),this.lineElem_.setAttributeNS(null,"y2",`${r}%`),this.markerElem_.style.left=`${s}%`,this.markerElem_.style.top=`${r}%`}onValueChange_(){this.update_()}onPropsChange_(){this.update_()}onFoldableChange_(){this.update_()}}function tu(t,e,i){return[Nh(e[0],Bh(t)),Nh(e[1],Fh(t))*(i?1:-1)]}class eu{constructor(t,e){this.onPadKeyDown_=this.onPadKeyDown_.bind(this),this.onPadKeyUp_=this.onPadKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.props=e.props,this.value=e.value,this.viewProps=e.viewProps,this.view=new Jc(t,{layout:e.layout,props:this.props,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Kh(this.view.padElement),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.padElement.addEventListener("keydown",this.onPadKeyDown_),this.view.padElement.addEventListener("keyup",this.onPadKeyUp_)}handlePointerEvent_(t,e){if(!t.point)return;const i=this.props.get("max"),s=Da(t.point.x,0,t.bounds.width,-i,+i),n=Da(this.props.get("invertsY")?t.bounds.height-t.point.y:t.point.y,0,t.bounds.height,-i,+i);this.value.setRawValue(new Yc(s,n),e)}onPointerDown_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerMove_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerUp_(t){this.handlePointerEvent_(t.data,{forceEmit:!0,last:!0})}onPadKeyDown_(t){Ih(t.key)&&t.preventDefault();const[e,i]=tu(t,[this.props.get("xKeyScale"),this.props.get("yKeyScale")],this.props.get("invertsY"));0===e&&0===i||this.value.setRawValue(new Yc(this.value.rawValue.x+e,this.value.rawValue.y+i),{forceEmit:!1,last:!1})}onPadKeyUp_(t){const[e,i]=tu(t,[this.props.get("xKeyScale"),this.props.get("yKeyScale")],this.props.get("invertsY"));0===e&&0===i||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class iu{constructor(t,e){var i,s;this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.onPadButtonBlur_=this.onPadButtonBlur_.bind(this),this.onPadButtonClick_=this.onPadButtonClick_.bind(this),this.value=e.value,this.viewProps=e.viewProps,this.foldable_=$l.create(e.expanded),this.popC_="popup"===e.pickerLayout?new Vh(t,{viewProps:this.viewProps}):null;const n=new eu(t,{layout:e.pickerLayout,props:new la({invertsY:aa(e.invertsY),max:aa(e.max),xKeyScale:e.axes[0].textProps.value("keyScale"),yKeyScale:e.axes[1].textProps.value("keyScale")}),value:this.value,viewProps:this.viewProps});n.view.allFocusableElements.forEach((t=>{t.addEventListener("blur",this.onPopupChildBlur_),t.addEventListener("keydown",this.onPopupChildKeydown_)})),this.pickerC_=n,this.textC_=new Gc(t,{assembly:Xc,axes:e.axes,parser:e.parser,value:this.value,viewProps:this.viewProps}),this.view=new Zc(t,{expanded:this.foldable_.value("expanded"),pickerLayout:e.pickerLayout,viewProps:this.viewProps}),this.view.textElement.appendChild(this.textC_.view.element),null===(i=this.view.buttonElement)||void 0===i||i.addEventListener("blur",this.onPadButtonBlur_),null===(s=this.view.buttonElement)||void 0===s||s.addEventListener("click",this.onPadButtonClick_),this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(this.pickerC_.view.element),zh({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:t=>t,backward:(t,e)=>e})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),Hl(this.foldable_,this.view.pickerElement))}get textController(){return this.textC_}onPadButtonBlur_(t){if(!this.popC_)return;const e=this.view.element,i=t.relatedTarget;i&&e.contains(i)||(this.popC_.shows.rawValue=!1)}onPadButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(t){if(!this.popC_)return;const e=this.popC_.view.element,i=ul(t);i&&e.contains(i)||i&&i===this.view.buttonElement&&!ol(e.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(t){this.popC_?"Escape"===t.key&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&"Escape"===t.key&&this.view.buttonElement.focus()}}function su(t){return Yc.isObject(t)?new Yc(t.x,t.y):new Yc}function nu(t,e){t.writeProperty("x",e.x),t.writeProperty("y",e.y)}function ru(t,e){var i,s;if(!Xo(t.min)||!Xo(t.max))return Math.max(Math.abs(null!==(i=t.min)&&void 0!==i?i:0),Math.abs(null!==(s=t.max)&&void 0!==s?s:0));const n=za(t);return Math.max(10*Math.abs(n),10*Math.abs(e))}function ou(t,e){var i,s;const n=ru(Jo(t,null!==(i=t.x)&&void 0!==i?i:{}),e.x),r=ru(Jo(t,null!==(s=t.y)&&void 0!==s?s:{}),e.y);return Math.max(n,r)}function au(t){if(!("y"in t))return!1;const e=t.y;return!!e&&("inverted"in e&&!!e.inverted)}Tl({id:"input-point2d",type:"input",accept:(t,e)=>{if(!Yc.isObject(t))return null;const i=Ja(e,(t=>Object.assign(Object.assign({},ip(t)),{expanded:t.optional.boolean,picker:t.optional.custom(rp),readonly:t.optional.constant(!1),x:t.optional.custom(sp),y:t.optional.object(Object.assign(Object.assign({},ip(t)),{inverted:t.optional.boolean}))})));return i?{initialValue:t,params:i}:null},binding:{reader:()=>su,constraint:t=>{return e=t.params,i=t.initialValue,new Kc({assembly:Xc,components:[np(Object.assign(Object.assign({},e),e.x),i.x),np(Object.assign(Object.assign({},e),e.y),i.y)]});var e,i},equals:Yc.equals,writer:()=>nu},controller:t=>{var e,i;const s=t.document,n=t.value,r=t.constraint,o=[t.params.x,t.params.y];return new iu(s,{axes:n.rawValue.getComponents().map(((e,i)=>{var s;return Ka({constraint:r.components[i],initialValue:e,params:Jo(t.params,null!==(s=o[i])&&void 0!==s?s:{})})})),expanded:null!==(e=t.params.expanded)&&void 0!==e&&e,invertsY:au(t.params),max:ou(t.params,n.rawValue),parser:La,pickerLayout:null!==(i=t.params.picker)&&void 0!==i?i:"popup",value:n,viewProps:t.viewProps})}});class lu{constructor(t=0,e=0,i=0){this.x=t,this.y=e,this.z=i}getComponents(){return[this.x,this.y,this.z]}static isObject(t){if(Xo(t))return!1;const e=t.x,i=t.y,s=t.z;return"number"==typeof e&&"number"==typeof i&&"number"==typeof s}static equals(t,e){return t.x===e.x&&t.y===e.y&&t.z===e.z}toObject(){return{x:this.x,y:this.y,z:this.z}}}const hu={toComponents:t=>t.getComponents(),fromComponents:t=>new lu(...t)};function pu(t){return lu.isObject(t)?new lu(t.x,t.y,t.z):new lu}function cu(t,e){t.writeProperty("x",e.x),t.writeProperty("y",e.y),t.writeProperty("z",e.z)}Tl({id:"input-point3d",type:"input",accept:(t,e)=>{if(!lu.isObject(t))return null;const i=Ja(e,(t=>Object.assign(Object.assign({},ip(t)),{readonly:t.optional.constant(!1),x:t.optional.custom(sp),y:t.optional.custom(sp),z:t.optional.custom(sp)})));return i?{initialValue:t,params:i}:null},binding:{reader:t=>pu,constraint:t=>{return e=t.params,i=t.initialValue,new Kc({assembly:hu,components:[np(Object.assign(Object.assign({},e),e.x),i.x),np(Object.assign(Object.assign({},e),e.y),i.y),np(Object.assign(Object.assign({},e),e.z),i.z)]});var e,i},equals:lu.equals,writer:t=>cu},controller:t=>{const e=t.value,i=t.constraint,s=[t.params.x,t.params.y,t.params.z];return new Gc(t.document,{assembly:hu,axes:e.rawValue.getComponents().map(((e,n)=>{var r;return Ka({constraint:i.components[n],initialValue:e,params:Jo(t.params,null!==(r=s[n])&&void 0!==r?r:{})})})),parser:La,value:e,viewProps:t.viewProps})}});class uu{constructor(t=0,e=0,i=0,s=0){this.x=t,this.y=e,this.z=i,this.w=s}getComponents(){return[this.x,this.y,this.z,this.w]}static isObject(t){if(Xo(t))return!1;const e=t.x,i=t.y,s=t.z,n=t.w;return"number"==typeof e&&"number"==typeof i&&"number"==typeof s&&"number"==typeof n}static equals(t,e){return t.x===e.x&&t.y===e.y&&t.z===e.z&&t.w===e.w}toObject(){return{x:this.x,y:this.y,z:this.z,w:this.w}}}const du={toComponents:t=>t.getComponents(),fromComponents:t=>new uu(...t)};function vu(t){return uu.isObject(t)?new uu(t.x,t.y,t.z,t.w):new uu}function mu(t,e){t.writeProperty("x",e.x),t.writeProperty("y",e.y),t.writeProperty("z",e.z),t.writeProperty("w",e.w)}Tl({id:"input-point4d",type:"input",accept:(t,e)=>{if(!uu.isObject(t))return null;const i=Ja(e,(t=>Object.assign(Object.assign({},ip(t)),{readonly:t.optional.constant(!1),w:t.optional.custom(sp),x:t.optional.custom(sp),y:t.optional.custom(sp),z:t.optional.custom(sp)})));return i?{initialValue:t,params:i}:null},binding:{reader:t=>vu,constraint:t=>{return e=t.params,i=t.initialValue,new Kc({assembly:du,components:[np(Object.assign(Object.assign({},e),e.x),i.x),np(Object.assign(Object.assign({},e),e.y),i.y),np(Object.assign(Object.assign({},e),e.z),i.z),np(Object.assign(Object.assign({},e),e.w),i.w)]});var e,i},equals:uu.equals,writer:t=>mu},controller:t=>{const e=t.value,i=t.constraint,s=[t.params.x,t.params.y,t.params.z,t.params.w];return new Gc(t.document,{assembly:du,axes:e.rawValue.getComponents().map(((e,n)=>{var r;return Ka({constraint:i.components[n],initialValue:e,params:Jo(t.params,null!==(r=s[n])&&void 0!==r?r:{})})})),parser:La,value:e,viewProps:t.viewProps})}}),Tl({id:"input-string",type:"input",accept:(t,e)=>{if("string"!=typeof t)return null;const i=Ja(e,(t=>({readonly:t.optional.constant(!1),options:t.optional.custom(fh)})));return i?{initialValue:t,params:i}:null},binding:{reader:t=>Th,constraint:t=>function(t){const e=[],i=xh(t.options);return i&&e.push(i),new bh(e)}(t.params),writer:t=>op},controller:t=>{const e=t.document,i=t.value,s=t.constraint,n=s&&gh(s,wh);return n?new Ph(e,{props:new la({options:n.values.value("options")}),value:i,viewProps:t.viewProps}):new Sh(e,{parser:t=>t,props:la.fromObject({formatter:Rh}),value:i,viewProps:t.viewProps})},api:t=>"string"!=typeof t.controller.value.rawValue?null:t.controller.valueController instanceof Ph?new dh(t.controller):null});const bu={defaultInterval:200,defaultRows:3},gu=bl("mll");class wu{constructor(t,e){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=e.formatter,this.element=t.createElement("div"),this.element.classList.add(gu()),e.viewProps.bindClassModifiers(this.element);const i=t.createElement("textarea");i.classList.add(gu("i")),i.style.height=`calc(var(${tp("containerUnitSize")}) * ${e.rows})`,i.readOnly=!0,e.viewProps.bindDisabled(i),this.element.appendChild(i),this.textareaElem_=i,e.value.emitter.on("change",this.onValueUpdate_),this.value=e.value,this.update_()}update_(){const t=this.textareaElem_,e=t.scrollTop===t.scrollHeight-t.clientHeight,i=[];this.value.rawValue.forEach((t=>{void 0!==t&&i.push(this.formatter_(t))})),t.textContent=i.join("\n"),e&&(t.scrollTop=t.scrollHeight)}onValueUpdate_(){this.update_()}}class fu{constructor(t,e){this.value=e.value,this.viewProps=e.viewProps,this.view=new wu(t,{formatter:e.formatter,rows:e.rows,value:this.value,viewProps:this.viewProps})}}const _u=bl("sgl");class xu{constructor(t,e){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=e.formatter,this.element=t.createElement("div"),this.element.classList.add(_u()),e.viewProps.bindClassModifiers(this.element);const i=t.createElement("input");i.classList.add(_u("i")),i.readOnly=!0,i.type="text",e.viewProps.bindDisabled(i),this.element.appendChild(i),this.inputElement=i,e.value.emitter.on("change",this.onValueUpdate_),this.value=e.value,this.update_()}update_(){const t=this.value.rawValue,e=t[t.length-1];this.inputElement.value=void 0!==e?this.formatter_(e):""}onValueUpdate_(){this.update_()}}class yu{constructor(t,e){this.value=e.value,this.viewProps=e.viewProps,this.view=new xu(t,{formatter:e.formatter,value:this.value,viewProps:this.viewProps})}}Tl({id:"monitor-bool",type:"monitor",accept:(t,e)=>{if("boolean"!=typeof t)return null;const i=Ja(e,(t=>({readonly:t.required.constant(!0),rows:t.optional.number})));return i?{initialValue:t,params:i}:null},binding:{reader:t=>Ah},controller:t=>{var e;return 1===t.value.rawValue.length?new yu(t.document,{formatter:Dh,value:t.value,viewProps:t.viewProps}):new fu(t.document,{formatter:Dh,rows:null!==(e=t.params.rows)&&void 0!==e?e:bu.defaultRows,value:t.value,viewProps:t.viewProps})}});class Cu extends Xa{get max(){return this.controller.valueController.props.get("max")}set max(t){this.controller.valueController.props.set("max",t)}get min(){return this.controller.valueController.props.get("min")}set min(t){this.controller.valueController.props.set("min",t)}}const Pu=bl("grl");class Eu{constructor(t,e){this.onCursorChange_=this.onCursorChange_.bind(this),this.onValueUpdate_=this.onValueUpdate_.bind(this),this.element=t.createElement("div"),this.element.classList.add(Pu()),e.viewProps.bindClassModifiers(this.element),this.formatter_=e.formatter,this.props_=e.props,this.cursor_=e.cursor,this.cursor_.emitter.on("change",this.onCursorChange_);const i=t.createElementNS(nl,"svg");i.classList.add(Pu("g")),i.style.height=`calc(var(${tp("containerUnitSize")}) * ${e.rows})`,this.element.appendChild(i),this.svgElem_=i;const s=t.createElementNS(nl,"polyline");this.svgElem_.appendChild(s),this.lineElem_=s;const n=t.createElement("div");n.classList.add(Pu("t"),bl("tt")()),this.element.appendChild(n),this.tooltipElem_=n,e.value.emitter.on("change",this.onValueUpdate_),this.value=e.value,this.update_()}get graphElement(){return this.svgElem_}update_(){const t=this.svgElem_.getBoundingClientRect(),e=this.value.rawValue.length-1,i=this.props_.get("min"),s=this.props_.get("max"),n=[];this.value.rawValue.forEach(((r,o)=>{if(void 0===r)return;const a=Da(o,0,e,0,t.width),l=Da(r,i,s,t.height,0);n.push([a,l].join(","))})),this.lineElem_.setAttributeNS(null,"points",n.join(" "));const r=this.tooltipElem_,o=this.value.rawValue[this.cursor_.rawValue];if(void 0===o)return void r.classList.remove(Pu("t","a"));const a=Da(this.cursor_.rawValue,0,e,0,t.width),l=Da(o,i,s,t.height,0);r.style.left=`${a}px`,r.style.top=`${l}px`,r.textContent=`${this.formatter_(o)}`,r.classList.contains(Pu("t","a"))||(r.classList.add(Pu("t","a"),Pu("t","in")),rl(r),r.classList.remove(Pu("t","in")))}onValueUpdate_(){this.update_()}onCursorChange_(){this.update_()}}class ku{constructor(t,e){if(this.onGraphMouseMove_=this.onGraphMouseMove_.bind(this),this.onGraphMouseLeave_=this.onGraphMouseLeave_.bind(this),this.onGraphPointerDown_=this.onGraphPointerDown_.bind(this),this.onGraphPointerMove_=this.onGraphPointerMove_.bind(this),this.onGraphPointerUp_=this.onGraphPointerUp_.bind(this),this.props=e.props,this.value=e.value,this.viewProps=e.viewProps,this.cursor_=aa(-1),this.view=new Eu(t,{cursor:this.cursor_,formatter:e.formatter,rows:e.rows,props:this.props,value:this.value,viewProps:this.viewProps}),ol(t)){const t=new Kh(this.view.element);t.emitter.on("down",this.onGraphPointerDown_),t.emitter.on("move",this.onGraphPointerMove_),t.emitter.on("up",this.onGraphPointerUp_)}else this.view.element.addEventListener("mousemove",this.onGraphMouseMove_),this.view.element.addEventListener("mouseleave",this.onGraphMouseLeave_)}importProps(t){return tl(t,null,(t=>({max:t.required.number,min:t.required.number})),(t=>(this.props.set("max",t.max),this.props.set("min",t.min),!0)))}exportProps(){return el(null,{max:this.props.get("max"),min:this.props.get("min")})}onGraphMouseLeave_(){this.cursor_.rawValue=-1}onGraphMouseMove_(t){const e=this.view.element.getBoundingClientRect();this.cursor_.rawValue=Math.floor(Da(t.offsetX,0,e.width,0,this.value.rawValue.length))}onGraphPointerDown_(t){this.onGraphPointerMove_(t)}onGraphPointerMove_(t){t.data.point?this.cursor_.rawValue=Math.floor(Da(t.data.point.x,0,t.data.bounds.width,0,this.value.rawValue.length)):this.cursor_.rawValue=-1}onGraphPointerUp_(){this.cursor_.rawValue=-1}}function Vu(t){return Xo(t.format)?Aa(2):t.format}function Mu(t){return"graph"===t.view}Tl({id:"monitor-number",type:"monitor",accept:(t,e)=>{if("number"!=typeof t)return null;const i=Ja(e,(t=>({format:t.optional.function,max:t.optional.number,min:t.optional.number,readonly:t.required.constant(!0),rows:t.optional.number,view:t.optional.string})));return i?{initialValue:t,params:i}:null},binding:{defaultBufferSize:t=>Mu(t)?64:1,reader:t=>Sa},controller:t=>Mu(t.params)?function(t){var e,i,s;return new ku(t.document,{formatter:Vu(t.params),rows:null!==(e=t.params.rows)&&void 0!==e?e:bu.defaultRows,props:la.fromObject({max:null!==(i=t.params.max)&&void 0!==i?i:100,min:null!==(s=t.params.min)&&void 0!==s?s:0}),value:t.value,viewProps:t.viewProps})}(t):function(t){var e;return 1===t.value.rawValue.length?new yu(t.document,{formatter:Vu(t.params),value:t.value,viewProps:t.viewProps}):new fu(t.document,{formatter:Vu(t.params),rows:null!==(e=t.params.rows)&&void 0!==e?e:bu.defaultRows,value:t.value,viewProps:t.viewProps})}(t),api:t=>t.controller.valueController instanceof ku?new Cu(t.controller):null}),Tl({id:"monitor-string",type:"monitor",accept:(t,e)=>{if("string"!=typeof t)return null;const i=Ja(e,(t=>({multiline:t.optional.boolean,readonly:t.required.constant(!0),rows:t.optional.number})));return i?{initialValue:t,params:i}:null},binding:{reader:t=>Th},controller:t=>{var e;const i=t.value;return i.rawValue.length>1||t.params.multiline?new fu(t.document,{formatter:Rh,rows:null!==(e=t.params.rows)&&void 0!==e?e:bu.defaultRows,value:i,viewProps:t.viewProps}):new yu(t.document,{formatter:Rh,value:i,viewProps:t.viewProps})}});class Lu{constructor(t){this.controller_=t}get disabled(){return this.controller_.viewProps.get("disabled")}set disabled(t){this.controller_.viewProps.set("disabled",t)}get title(){var t;return null!==(t=this.controller_.props.get("title"))&&void 0!==t?t:""}set title(t){this.controller_.props.set("title",t)}on(t,e){const i=e.bind(this);return this.controller_.emitter.on(t,(()=>{i(new $a(this))})),this}}class Su extends $a{constructor(t,e,i){super(t),this.cell=e,this.index=i}}class Au extends qa{constructor(t){super(t),this.cellToApiMap_=new Map,this.emitter_=new sa;const e=this.controller.valueController;e.cellControllers.forEach(((t,i)=>{const s=new Lu(t);this.cellToApiMap_.set(t,s),t.emitter.on("click",(()=>{const t=i%e.size[0],n=Math.floor(i/e.size[0]);this.emitter_.emit("click",{event:new Su(this,s,[t,n])})}))}))}cell(t,e){const i=this.controller.valueController,s=i.cellControllers[e*i.size[0]+t];return this.cellToApiMap_.get(s)}on(t,e){const i=e.bind(this);return this.emitter_.on(t,(t=>{i(t.event)})),this}}class Du{constructor(t,e){this.size=e.size;const[i,s]=this.size,n=[];for(let r=0;r<s;r++)for(let s=0;s<i;s++){const i=new Dl(t,{props:la.fromObject(Object.assign({},e.cellConfig(s,r))),viewProps:th.create()});n.push(i)}this.cellCs_=n,this.viewProps=th.create(),this.viewProps.handleDispose((()=>{this.cellCs_.forEach((t=>{t.viewProps.set("disposed",!0)}))})),this.view=new ep(t,{viewProps:this.viewProps,viewName:"btngrid"}),this.view.element.style.gridTemplateColumns=`repeat(${i}, 1fr)`,this.cellCs_.forEach((t=>{this.view.element.appendChild(t.view.element)}))}get cellControllers(){return this.cellCs_}}class Ou extends yl{constructor(t,e){const i=e.valueController,s=new fl(t,{blade:e.blade,props:e.labelProps,valueController:i});super({blade:e.blade,view:s.view,viewProps:i.viewProps}),this.valueController=i,this.labelController=s}}const ju=Tl({id:"buttongrid",type:"blade",accept(t){const e=Ja(t,(t=>({cells:t.required.function,size:t.required.array(t.required.number),view:t.required.constant("buttongrid"),label:t.optional.string})));return e?{params:e}:null},controller:t=>new Ou(t.document,{blade:t.blade,labelProps:la.fromObject({label:t.params.label}),valueController:new Du(t.document,{cellConfig:t.params.cells,size:t.params.size})}),api:t=>t.controller instanceof Ou?new Au(t.controller):null});class Tu extends qa{get label(){return this.controller.labelController.props.get("label")}set label(t){this.controller.labelController.props.set("label",t)}get value(){return this.controller.valueController.value.rawValue}set value(t){this.controller.valueController.value.rawValue=t}on(t,e){const i=e.bind(this);return this.controller.valueController.value.emitter.on(t,(t=>{i(new Ga(this,t.rawValue,t.options.last))})),this}}function Ru(t,e,i){return t*(1-i)+e*i}function zu(t,e){let i=.25,s=.5,n=-1;for(let r=0;r<20;r++){const[r,o]=t.curve(s);if(s+=i*(r<e?1:-1),n=o,i*=.5,Math.abs(e-r)<.001)break}return n}class Nu{constructor(t=0,e=0,i=1,s=1){this.cache_=[],this.comps_=[t,e,i,s]}get x1(){return this.comps_[0]}get y1(){return this.comps_[1]}get x2(){return this.comps_[2]}get y2(){return this.comps_[3]}static isObject(t){return!Xo(t)&&(!!Array.isArray(t)&&("number"==typeof t[0]&&"number"==typeof t[1]&&"number"==typeof t[2]&&"number"==typeof t[3]))}static equals(t,e){return t.x1===e.x1&&t.y1===e.y1&&t.x2===e.x2&&t.y2===e.y2}curve(t){const e=Ru(0,this.x1,t),i=Ru(0,this.y1,t),s=Ru(this.x1,this.x2,t),n=Ru(this.y1,this.y2,t),r=Ru(this.x2,1,t),o=Ru(this.y2,1,t),a=Ru(e,s,t),l=Ru(i,n,t),h=Ru(s,r,t),p=Ru(n,o,t);return[Ru(a,h,t),Ru(l,p,t)]}y(t){if(0===this.cache_.length){const t=[];for(let e=0;e<100;e++)t.push(zu(this,Da(e,0,99,0,1)));this.cache_=t}return this.cache_[Math.round(Da(ja(t,0,1),0,1,0,99))]}toObject(){return[this.comps_[0],this.comps_[1],this.comps_[2],this.comps_[3]]}}const Fu={toComponents:t=>t.toObject(),fromComponents:t=>new Nu(...t)};function Bu(t){const e=Aa(2);return`cubic-bezier(${t.toObject().map((t=>e(t))).join(", ")})`}const Iu=[0,.5,.5,1];function Uu(t){const e=t.match(/^cubic-bezier\s*\(\s*([0-9.]+)\s*,\s*([0-9.]+)\s*,\s*([0-9.]+)\s*,\s*([0-9.]+)\s*\)$/);if(!e)return new Nu(...Iu);const i=[e[1],e[2],e[3],e[4]].reduce(((t,e)=>{if(!t)return null;const i=Number(e);return isNaN(i)?null:[...t,i]}),[]);return new Nu(...null!=i?i:Iu)}const Ku=bl("cbz");class qu{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(Ku()),e.viewProps.bindClassModifiers(this.element),e.foldable.bindExpandedClass(this.element,Ku(void 0,"expanded")),vl(e.foldable,"completed",Ml(this.element,Ku(void 0,"cpl")));const i=t.createElement("div");i.classList.add(Ku("h")),this.element.appendChild(i);const s=t.createElement("button");s.classList.add(Ku("b")),e.viewProps.bindDisabled(s);const n=t.createElementNS(nl,"svg");n.innerHTML='<path d="M2 13C8 13 8 3 14 3"/>',s.appendChild(n),i.appendChild(s),this.buttonElement=s;const r=t.createElement("div");if(r.classList.add(Ku("t")),i.appendChild(r),this.textElement=r,"inline"===e.pickerLayout){const e=t.createElement("div");e.classList.add(Ku("p")),this.element.appendChild(e),this.pickerElement=e}else this.pickerElement=null}}const $u=bl("cbzp");class Gu{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add($u()),e.viewProps.bindClassModifiers(this.element);const i=t.createElement("div");i.classList.add($u("g")),this.element.appendChild(i),this.graphElement=i;const s=t.createElement("div");s.classList.add($u("t")),this.element.appendChild(s),this.textElement=s}}function Hu(t,e){const i=new MutationObserver((t=>{for(const s of t)"childList"===s.type&&s.addedNodes.forEach((t=>{t.contains(t)&&(e(),i.disconnect())}))})),s=t.ownerDocument;i.observe(s.body,{attributes:!0,childList:!0,subtree:!0})}const Yu=bl("cbzg");class Xu{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(Yu()),e.viewProps.bindClassModifiers(this.element),e.viewProps.bindTabIndex(this.element);const i=t.createElement("div");i.classList.add(Yu("p")),this.element.appendChild(i),this.previewElement=i;const s=t.createElementNS(nl,"svg");s.classList.add(Yu("g")),this.element.appendChild(s),this.svgElem_=s;const n=t.createElementNS(nl,"path");n.classList.add(Yu("u")),this.svgElem_.appendChild(n),this.guideElem_=n;const r=t.createElementNS(nl,"polyline");r.classList.add(Yu("l")),this.svgElem_.appendChild(r),this.lineElem_=r,this.handleElems_=[t.createElement("div"),t.createElement("div")],this.handleElems_.forEach((t=>{t.classList.add(Yu("h")),this.element.appendChild(t)})),this.vectorElems_=[t.createElementNS(nl,"line"),t.createElementNS(nl,"line")],this.vectorElems_.forEach((t=>{t.classList.add(Yu("v")),this.svgElem_.appendChild(t)})),this.value_=e.value,this.value_.emitter.on("change",this.onValueChange_.bind(this)),this.sel_=e.selection,this.handleElems_.forEach(((t,e)=>{var i,s;dl(this.sel_,(i=t=>t===e,s=Ml(t,Yu("h","sel")),t=>s(i(t))))})),Hu(this.element,(()=>{this.refresh()}))}getVertMargin_(t){return.25*t}valueToPosition(t,e){const{clientWidth:i,clientHeight:s}=this.element,n=this.getVertMargin_(s);return{x:Da(t,0,1,0,i),y:Da(e,0,1,s-n,n)}}positionToValue(t,e){const i=this.element.getBoundingClientRect(),s=i.width,n=i.height,r=this.getVertMargin_(n);return{x:ja(Da(t,0,s,0,1),0,1),y:Da(e,n-r,r,0,1)}}refresh(){this.guideElem_.setAttributeNS(null,"d",[0,1].map((t=>{const e=this.valueToPosition(0,t),i=this.valueToPosition(1,t);return[`M ${e.x},${e.y}`,`L ${i.x},${i.y}`].join(" ")})).join(" "));const t=this.value_.rawValue,e=[];let i=0;for(;;){const s=this.valueToPosition(...t.curve(i));if(e.push([s.x,s.y].join(",")),i>=1)break;i=Math.min(i+.05,1)}this.lineElem_.setAttributeNS(null,"points",e.join(" "));const s=t.toObject();[0,1].forEach((t=>{const e=this.valueToPosition(t,t),i=this.valueToPosition(s[2*t],s[2*t+1]),n=this.vectorElems_[t];n.setAttributeNS(null,"x1",String(e.x)),n.setAttributeNS(null,"y1",String(e.y)),n.setAttributeNS(null,"x2",String(i.x)),n.setAttributeNS(null,"y2",String(i.y));const r=this.handleElems_[t];r.style.left=`${i.x}px`,r.style.top=`${i.y}px`}))}onValueChange_(){this.refresh()}}const Wu=bl("cbzprv");class Zu{constructor(t,e){this.stopped_=!0,this.startTime_=-1,this.onDispose_=this.onDispose_.bind(this),this.onTimer_=this.onTimer_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.element=t.createElement("div"),this.element.classList.add(Wu()),e.viewProps.bindClassModifiers(this.element);const i=t.createElementNS(nl,"svg");i.classList.add(Wu("g")),this.element.appendChild(i),this.svgElem_=i;const s=t.createElementNS(nl,"path");s.classList.add(Wu("t")),this.svgElem_.appendChild(s),this.ticksElem_=s;const n=t.createElement("div");n.classList.add(Wu("m")),this.element.appendChild(n),this.markerElem_=n,this.value_=e.value,this.value_.emitter.on("change",this.onValueChange_),e.viewProps.handleDispose(this.onDispose_),Hu(this.element,(()=>{this.refresh()}))}play(){this.stop(),this.updateMarker_(0),this.markerElem_.classList.add(Wu("m","a")),this.startTime_=(new Date).getTime()+400,this.stopped_=!1,requestAnimationFrame(this.onTimer_)}stop(){this.stopped_=!0,this.markerElem_.classList.remove(Wu("m","a"))}onDispose_(){this.stop()}updateMarker_(t){const e=this.value_.rawValue.y(ja(t,0,1));this.markerElem_.style.left=100*e+"%"}refresh(){const{clientWidth:t,clientHeight:e}=this.svgElem_,i=[],s=this.value_.rawValue;for(let n=0;n<24;n++){const r=Da(n,0,23,0,1),o=Da(s.y(r),0,1,0,t);i.push(`M ${o},0 v${e}`)}this.ticksElem_.setAttributeNS(null,"d",i.join(" "))}onTimer_(){if(null===this.startTime_)return;const t=(new Date).getTime()-this.startTime_,e=t/1e3;this.updateMarker_(e),t>1400&&this.stop(),this.stopped_||requestAnimationFrame(this.onTimer_)}onValueChange_(){this.refresh(),this.play()}}function Qu(t,e,i,s){const n=i-t,r=s-e;return Math.sqrt(n*n+r*r)}class Ju{constructor(t,e){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.keyScale_=e.keyScale,this.value=e.value,this.sel_=aa(0),this.viewProps=e.viewProps,this.view=new Xu(t,{selection:this.sel_,value:this.value,viewProps:this.viewProps}),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_),this.prevView_=new Zu(t,{value:this.value,viewProps:this.viewProps}),this.prevView_.element.addEventListener("mousedown",(t=>{t.stopImmediatePropagation(),t.preventDefault(),this.prevView_.play()})),this.view.previewElement.appendChild(this.prevView_.element);const i=new Kh(this.view.element);i.emitter.on("down",this.onPointerDown_),i.emitter.on("move",this.onPointerMove_),i.emitter.on("up",this.onPointerUp_)}refresh(){this.view.refresh(),this.prevView_.refresh(),this.prevView_.play()}updateValue_(t,e,i){const s=this.sel_.rawValue,n=this.value.rawValue.toObject(),r=this.view.positionToValue(t.x,t.y),o=e?function(t,e,i,s){const n=Qu(t,e,i,s),r=Math.atan2(s-e,i-t),o=Math.round(r/(Math.PI/4))*Math.PI/4;return{x:t+Math.cos(o)*n,y:e+Math.sin(o)*n}}(s,s,r.x,r.y):r;n[2*s]=o.x,n[2*s+1]=o.y,this.value.setRawValue(new Nu(...n),i)}onPointerDown_(t){const e=t.data;if(!e.point)return;const i=this.value.rawValue,s=this.view.valueToPosition(i.x1,i.y1),n=Qu(e.point.x,e.point.y,s.x,s.y),r=this.view.valueToPosition(i.x2,i.y2),o=Qu(e.point.x,e.point.y,r.x,r.y);this.sel_.rawValue=n<=o?0:1,this.updateValue_(e.point,t.shiftKey,{forceEmit:!1,last:!1})}onPointerMove_(t){const e=t.data;e.point&&this.updateValue_(e.point,t.shiftKey,{forceEmit:!1,last:!1})}onPointerUp_(t){const e=t.data;e.point&&this.updateValue_(e.point,t.shiftKey,{forceEmit:!0,last:!0})}onKeyDown_(t){Ih(t.key)&&t.preventDefault();const e=this.sel_.rawValue,i=this.value.rawValue.toObject(),s=this.keyScale_.rawValue;i[2*e]+=Nh(s,Bh(t)),i[2*e+1]+=Nh(s,Fh(t)),this.value.setRawValue(new Nu(...i),{forceEmit:!1,last:!1})}onKeyUp_(t){Ih(t.key)&&t.preventDefault();const e=this.keyScale_.rawValue,i=Nh(e,Bh(t)),s=Nh(e,Fh(t));0===i&&0===s||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class td{constructor(t,e){this.value=e.value,this.viewProps=e.viewProps,this.view=new Gu(t,{viewProps:this.viewProps}),this.gc_=new Ju(t,{keyScale:e.axis.textProps.value("keyScale"),value:this.value,viewProps:this.viewProps}),this.view.graphElement.appendChild(this.gc_.view.element);const i=Object.assign(Object.assign({},e.axis),{constraint:new pa({max:1,min:0})}),s=Object.assign(Object.assign({},e.axis),{constraint:void 0});this.tc_=new Gc(t,{assembly:Fu,axes:[i,s,i,s],parser:La,value:this.value,viewProps:this.viewProps}),this.view.textElement.appendChild(this.tc_.view.element)}get allFocusableElements(){return[this.gc_.view.element,...this.tc_.view.textViews.map((t=>t.inputElement))]}refresh(){this.gc_.refresh()}}class ed{constructor(t,e){this.onButtonBlur_=this.onButtonBlur_.bind(this),this.onButtonClick_=this.onButtonClick_.bind(this),this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.value=e.value,this.viewProps=e.viewProps,this.foldable_=$l.create(e.expanded),this.view=new qu(t,{foldable:this.foldable_,pickerLayout:e.pickerLayout,viewProps:this.viewProps}),this.view.buttonElement.addEventListener("blur",this.onButtonBlur_),this.view.buttonElement.addEventListener("click",this.onButtonClick_),this.tc_=new Sh(t,{parser:Uu,props:la.fromObject({formatter:Bu}),value:this.value,viewProps:this.viewProps}),this.view.textElement.appendChild(this.tc_.view.element),this.popC_="popup"===e.pickerLayout?new Vh(t,{viewProps:this.viewProps}):null;const i=new td(t,{axis:e.axis,value:this.value,viewProps:this.viewProps});i.allFocusableElements.forEach((t=>{t.addEventListener("blur",this.onPopupChildBlur_),t.addEventListener("keydown",this.onPopupChildKeydown_)})),this.pickerC_=i,this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(this.pickerC_.view.element),dl(this.popC_.shows,(t=>{t&&i.refresh()})),zh({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:t=>t,backward:(t,e)=>e})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),Hl(this.foldable_,this.view.pickerElement))}onButtonBlur_(t){if(!this.popC_)return;const e=t.relatedTarget;e&&this.popC_.view.element.contains(e)||(this.popC_.shows.rawValue=!1)}onButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.allFocusableElements[0].focus()}onPopupChildBlur_(t){if(!this.popC_)return;const e=this.popC_.view.element,i=ul(t);i&&e.contains(i)||i&&i===this.view.buttonElement&&!ol(e.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(t){this.popC_&&"Escape"===t.key&&(this.popC_.shows.rawValue=!1)}}const id=Tl({id:"cubicbezier",type:"blade",accept(t){const e=Ja(t,(t=>({value:t.required.array(t.required.number),view:t.required.constant("cubicbezier"),expanded:t.optional.boolean,label:t.optional.string,picker:t.optional.custom((t=>"inline"===t||"popup"===t?t:void 0))})));return e?{params:e}:null},controller(t){var e,i;const s=aa(new Nu(...t.params.value),{constraint:new Kc({assembly:Fu,components:[0,1,2,3].map((t=>t%2==0?new pa({min:0,max:1}):void 0))}),equals:Nu.equals}),n=new ed(t.document,{axis:{textProps:la.fromObject({keyScale:.1,pointerScale:.01,formatter:Aa(2)})},expanded:null!==(e=t.params.expanded)&&void 0!==e&&e,pickerLayout:null!==(i=t.params.picker)&&void 0!==i?i:"popup",value:s,viewProps:t.viewProps});return new Cl(t.document,{blade:t.blade,props:la.fromObject({label:t.params.label}),value:s,valueController:n})},api:t=>t.controller instanceof Cl&&t.controller.valueController instanceof ed?new Tu(t.controller):null});class sd extends qa{get fps(){return this.controller.valueController.fps}get max(){return this.controller.valueController.props.get("max")}set max(t){this.controller.valueController.props.set("max",t)}get min(){return this.controller.valueController.props.get("min")}set min(t){this.controller.valueController.props.set("min",t)}begin(){this.controller.valueController.begin()}end(){this.controller.valueController.end()}on(t,e){const i=e.bind(this);return this.controller.valueController.ticker.emitter.on(t,(()=>{i(new $a(this))})),this}}class nd{constructor(){this.start_=null,this.duration_=0,this.fps_=null,this.frameCount_=0,this.timestamps_=[]}get duration(){return this.duration_}get fps(){return this.fps_}begin(t){this.start_=t.getTime()}calculateFps_(t){if(0===this.timestamps_.length)return null;const e=this.timestamps_[0];return 1e3*(this.frameCount_-e.frameCount)/(t-e.time)}compactTimestamps_(){if(this.timestamps_.length<=20)return;const t=this.timestamps_.length-20;this.timestamps_.splice(0,t);const e=this.timestamps_[0].frameCount;this.timestamps_.forEach((t=>{t.frameCount-=e})),this.frameCount_-=e}end(t){if(null===this.start_)return;const e=t.getTime();this.duration_=e-this.start_,this.start_=null,this.fps_=this.calculateFps_(e),this.timestamps_.push({frameCount:this.frameCount_,time:e}),++this.frameCount_,this.compactTimestamps_()}}const rd=bl("fps");class od{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(rd()),e.viewProps.bindClassModifiers(this.element),this.graphElement=t.createElement("div"),this.graphElement.classList.add(rd("g")),this.element.appendChild(this.graphElement);const i=t.createElement("div");i.classList.add(rd("l")),this.element.appendChild(i);const s=t.createElement("span");s.classList.add(rd("v")),s.textContent="--",i.appendChild(s),this.valueElement=s;const n=t.createElement("span");n.classList.add(rd("u")),n.textContent="FPS",i.appendChild(n)}}class ad{constructor(t,e){this.stopwatch_=new nd,this.onTick_=this.onTick_.bind(this),this.ticker=e.ticker,this.ticker.emitter.on("tick",this.onTick_),this.props=e.props,this.value_=e.value,this.viewProps=e.viewProps,this.view=new od(t,{viewProps:this.viewProps}),this.graphC_=new ku(t,{formatter:Aa(0),props:this.props,rows:e.rows,value:this.value_,viewProps:this.viewProps}),this.view.graphElement.appendChild(this.graphC_.view.element),this.viewProps.handleDispose((()=>{this.graphC_.viewProps.set("disposed",!0),this.ticker.dispose()}))}get fps(){return this.stopwatch_.fps}begin(){this.stopwatch_.begin(new Date)}end(){this.stopwatch_.end(new Date)}onTick_(){const t=this.fps;if(null!==t){const e=this.value_.rawValue;this.value_.rawValue=function(t,e){const i=[...kl(t),e];return i.length>t.length?i.splice(0,i.length-t.length):Pl(i,t.length),i}(e,t),this.view.valueElement.textContent=t.toFixed(0)}}}class ld extends yl{constructor(t,e){const i=e.valueController,s=new fl(t,{blade:e.blade,props:e.labelProps,valueController:i});super({blade:e.blade,view:s.view,viewProps:i.viewProps}),this.valueController=i,this.labelController=s}}function hd(t,e){return 0===e?new vh:new mh(t,null!=e?e:bu.defaultInterval)}const pd=Tl({id:"fpsgraph",type:"blade",accept(t){const e=Ja(t,(t=>({view:t.required.constant("fpsgraph"),interval:t.optional.number,label:t.optional.string,rows:t.optional.number,max:t.optional.number,min:t.optional.number})));return e?{params:e}:null},controller(t){var e,i,s,n;const r=null!==(e=t.params.interval)&&void 0!==e?e:500;return new ld(t.document,{blade:t.blade,labelProps:la.fromObject({label:t.params.label}),valueController:new ad(t.document,{props:la.fromObject({max:null!==(i=t.params.max)&&void 0!==i?i:90,min:null!==(s=t.params.min)&&void 0!==s?s:0}),rows:null!==(n=t.params.rows)&&void 0!==n?n:2,ticker:hd(t.document,r),value:aa(El(80)),viewProps:t.viewProps})})},api:t=>t.controller instanceof ld?new sd(t.controller):null});class cd{constructor(t,e){this.min=t,this.max=e}static isObject(t){if("object"!=typeof t||null===t)return!1;const e=t.min,i=t.max;return"number"==typeof e&&"number"==typeof i}static equals(t,e){return t.min===e.min&&t.max===e.max}get length(){return this.max-this.min}toObject(){return{min:this.min,max:this.max}}}const ud={fromComponents:t=>new cd(t[0],t[1]),toComponents:t=>[t.min,t.max]};class dd{constructor(t){this.edge=t}constrain(t){var e,i,s,n,r,o,a,l;if(t.min<=t.max)return new cd(null!==(i=null===(e=this.edge)||void 0===e?void 0:e.constrain(t.min))&&void 0!==i?i:t.min,null!==(n=null===(s=this.edge)||void 0===s?void 0:s.constrain(t.max))&&void 0!==n?n:t.max);const h=(t.min+t.max)/2;return new cd(null!==(o=null===(r=this.edge)||void 0===r?void 0:r.constrain(h))&&void 0!==o?o:h,null!==(l=null===(a=this.edge)||void 0===a?void 0:a.constrain(h))&&void 0!==l?l:h)}}const vd=bl("rsltxt");class md{constructor(t,e){this.sliderView_=e.sliderView,this.textView_=e.textView,this.element=t.createElement("div"),this.element.classList.add(vd());const i=t.createElement("div");i.classList.add(vd("s")),i.appendChild(this.sliderView_.element),this.element.appendChild(i);const s=t.createElement("div");s.classList.add(vd("t")),s.appendChild(this.textView_.element),this.element.appendChild(s)}}const bd=bl("rsl");class gd{constructor(t,e){this.onSliderPropsChange_=this.onSliderPropsChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.sliderProps_=e.sliderProps,this.sliderProps_.emitter.on("change",this.onSliderPropsChange_),this.element=t.createElement("div"),this.element.classList.add(bd()),e.viewProps.bindClassModifiers(this.element),this.value_=e.value,this.value_.emitter.on("change",this.onValueChange_);const i=t.createElement("div");i.classList.add(bd("t")),this.element.appendChild(i),this.trackElement=i;const s=t.createElement("div");s.classList.add(bd("b")),i.appendChild(s),this.barElement=s;const n=["min","max"].map((e=>{const s=t.createElement("div");return s.classList.add(bd("k"),bd("k",e)),i.appendChild(s),s}));this.knobElements=[n[0],n[1]],this.update_()}valueToX_(t){return 100*ja(Da(t,this.sliderProps_.get("min"),this.sliderProps_.get("max"),0,1),0,1)}update_(){const t=this.value_.rawValue;0===t.length?this.element.classList.add(bd(void 0,"zero")):this.element.classList.remove(bd(void 0,"zero"));const e=[this.valueToX_(t.min),this.valueToX_(t.max)];this.barElement.style.left=`${e[0]}%`,this.barElement.style.right=100-e[1]+"%",this.knobElements.forEach(((t,i)=>{t.style.left=`${e[i]}%`}))}onSliderPropsChange_(){this.update_()}onValueChange_(){this.update_()}}class wd{constructor(t,e){this.grabbing_=null,this.grabOffset_=0,this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.sliderProps=e.sliderProps,this.viewProps=e.viewProps,this.value=e.value,this.view=new gd(t,{sliderProps:this.sliderProps,value:this.value,viewProps:e.viewProps});const i=new Kh(this.view.trackElement);i.emitter.on("down",this.onPointerDown_),i.emitter.on("move",this.onPointerMove_),i.emitter.on("up",this.onPointerUp_)}ofs_(){return"min"===this.grabbing_?this.view.knobElements[0].getBoundingClientRect().width/2:"max"===this.grabbing_?-this.view.knobElements[1].getBoundingClientRect().width/2:0}valueFromData_(t){if(!t.point)return null;return Da((t.point.x+this.ofs_())/t.bounds.width,0,1,this.sliderProps.get("min"),this.sliderProps.get("max"))}onPointerDown_(t){if(!t.data.point)return;const e=t.data.point.x/t.data.bounds.width,i=this.value.rawValue,s=this.sliderProps.get("min"),n=this.sliderProps.get("max"),r=Da(i.min,s,n,0,1),o=Da(i.max,s,n,0,1);Math.abs(o-e)<=.025?this.grabbing_="max":Math.abs(r-e)<=.025?this.grabbing_="min":e>=r&&e<=o?(this.grabbing_="length",this.grabOffset_=Da(e-r,0,1,0,n-s)):e<r?(this.grabbing_="min",this.onPointerMove_(t)):e>o&&(this.grabbing_="max",this.onPointerMove_(t))}applyPointToValue_(t,e){const i=this.valueFromData_(t);if(null===i)return;const s=this.sliderProps.get("min"),n=this.sliderProps.get("max");if("min"===this.grabbing_)this.value.setRawValue(new cd(i,this.value.rawValue.max),e);else if("max"===this.grabbing_)this.value.setRawValue(new cd(this.value.rawValue.min,i),e);else if("length"===this.grabbing_){const t=this.value.rawValue.length;let r=i-this.grabOffset_,o=r+t;r<s?(r=s,o=s+t):o>n&&(r=n-t,o=n),this.value.setRawValue(new cd(r,o),e)}}onPointerMove_(t){this.applyPointToValue_(t.data,{forceEmit:!1,last:!1})}onPointerUp_(t){this.applyPointToValue_(t.data,{forceEmit:!0,last:!0}),this.grabbing_=null}}class fd{constructor(t,e){this.value=e.value,this.viewProps=e.viewProps,this.sc_=new wd(t,e);const i={constraint:e.constraint,textProps:e.textProps};this.tc_=new Gc(t,{assembly:ud,axes:[i,i],parser:e.parser,value:this.value,viewProps:e.viewProps}),this.view=new md(t,{sliderView:this.sc_.view,textView:this.tc_.view})}get textController(){return this.tc_}}function _d(t){return cd.isObject(t)?new cd(t.min,t.max):new cd(0,0)}function xd(t,e){t.writeProperty("max",e.max),t.writeProperty("min",e.min)}const yd=Tl({id:"input-interval",type:"input",accept:(t,e)=>{if(!cd.isObject(t))return null;const i=Ja(e,(t=>Object.assign(Object.assign({},Ua(t)),{readonly:t.optional.constant(!1)})));return i?{initialValue:new cd(t.min,t.max),params:i}:null},binding:{reader:t=>_d,constraint:t=>function(t){const e=[],i=Ba(t);i&&e.push(i);const s=Fa(t);return s&&e.push(s),new dd(new bh(e))}(t.params),equals:cd.equals,writer:t=>xd},controller(t){const e=t.value,i=t.constraint;if(!(i instanceof dd))throw ea.shouldNeverHappen();const s=(e.rawValue.min+e.rawValue.max)/2,n=la.fromObject(Ia(t.params,s)),r=i.edge&&gh(i.edge,ha);if(r)return new fd(t.document,{constraint:i.edge,parser:La,sliderProps:new la({keyScale:n.value("keyScale"),max:r.values.value("max"),min:r.values.value("min")}),textProps:n,value:e,viewProps:t.viewProps});const o={constraint:i.edge,textProps:n};return new Gc(t.document,{assembly:ud,axes:[o,o],parser:La,value:e,viewProps:t.viewProps})}});class Cd{constructor(t){this.controller_=t}get disabled(){return this.controller_.viewProps.get("disabled")}set disabled(t){this.controller_.viewProps.set("disabled",t)}get title(){var t;return null!==(t=this.controller_.props.get("title"))&&void 0!==t?t:""}set title(t){this.controller_.props.set("title",t)}}class Pd extends Ga{constructor(t,e,i,s,n){super(t,s,n),this.cell=e,this.index=i}}class Ed extends qa{constructor(t){super(t),this.cellToApiMap_=new Map;this.controller.valueController.cellControllers.forEach((t=>{const e=new Cd(t);this.cellToApiMap_.set(t,e)}))}get value(){return this.controller.value}cell(t,e){const i=this.controller.valueController,s=i.cellControllers[e*i.size[0]+t];return this.cellToApiMap_.get(s)}on(t,e){const i=e.bind(this);this.controller.value.emitter.on(t,(t=>{const e=this.controller.valueController,s=e.findCellByValue(t.rawValue);if(!s)return;const n=this.cellToApiMap_.get(s);if(!n)return;const r=e.cellControllers.indexOf(s);i(new Pd(this,n,[r%e.size[0],Math.floor(r/e.size[0])],t.rawValue))}))}}const kd=bl("rad");class Vd{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(kd()),e.viewProps.bindClassModifiers(this.element);const i=t.createElement("label");i.classList.add(kd("l")),this.element.appendChild(i);const s=t.createElement("input");s.classList.add(kd("i")),s.name=e.name,s.type="radio",e.viewProps.bindDisabled(s),i.appendChild(s),this.inputElement=s;const n=t.createElement("div");n.classList.add(kd("b")),i.appendChild(n);const r=t.createElement("div");r.classList.add(kd("t")),n.appendChild(r),vl(e.props,"title",(t=>{r.textContent=t}))}}class Md{constructor(t,e){this.props=e.props,this.viewProps=e.viewProps,this.view=new Vd(t,{name:e.name,props:this.props,viewProps:this.viewProps})}}class Ld{constructor(t,e){this.cellCs_=[],this.cellValues_=[],this.onCellInputChange_=this.onCellInputChange_.bind(this),this.size=e.size;const[i,s]=this.size;for(let n=0;n<s;n++)for(let s=0;s<i;s++){const i=new Md(t,{name:e.groupName,props:la.fromObject(Object.assign({},e.cellConfig(s,n))),viewProps:th.create()});this.cellCs_.push(i),this.cellValues_.push(e.cellConfig(s,n).value)}this.value=e.value,dl(this.value,(t=>{const e=this.findCellByValue(t);e&&(e.view.inputElement.checked=!0)})),this.viewProps=th.create(),this.view=new ep(t,{viewProps:this.viewProps,viewName:"radgrid"}),this.view.element.style.gridTemplateColumns=`repeat(${i}, 1fr)`,this.cellCs_.forEach((t=>{t.view.inputElement.addEventListener("change",this.onCellInputChange_),this.view.element.appendChild(t.view.element)}))}get cellControllers(){return this.cellCs_}findCellByValue(t){const e=this.cellValues_.findIndex((e=>e===t));return e<0?null:this.cellCs_[e]}onCellInputChange_(t){const e=t.currentTarget,i=this.cellCs_.findIndex((t=>t.view.inputElement===e));i<0||(this.value.rawValue=this.cellValues_[i])}}const Sd=Tl({id:"radiogrid",type:"blade",accept(t){const e=Ja(t,(t=>({cells:t.required.function,groupName:t.required.string,size:t.required.array(t.required.number),value:t.required.raw,view:t.required.constant("radiogrid"),label:t.optional.string})));return e?{params:e}:null},controller(t){const e=aa(t.params.value);return new Cl(t.document,{blade:t.blade,props:la.fromObject({label:t.params.label}),value:e,valueController:new Ld(t.document,{groupName:t.params.groupName,cellConfig:t.params.cells,size:t.params.size,value:e})})},api:t=>t.controller instanceof Cl&&t.controller.valueController instanceof Ld?new Ed(t.controller):null});function Ad(t){return Tl({id:"input-radiogrid",type:"input",accept(e,i){if(!t.isType(e))return null;const s=Ja(i,(t=>({cells:t.required.function,groupName:t.required.string,size:t.required.array(t.required.number),view:t.required.constant("radiogrid")})));return s?{initialValue:e,params:s}:null},binding:t.binding,controller:t=>new Ld(t.document,{cellConfig:t.params.cells,groupName:t.params.groupName,size:t.params.size,value:t.value})})}const Dd=Ad({isType:t=>"number"==typeof t,binding:{reader:t=>Sa,writer:t=>op}}),Od=Ad({isType:t=>"string"==typeof t,binding:{reader:t=>Th,writer:t=>op}}),jd=Ad({isType:t=>"boolean"==typeof t,binding:{reader:t=>Ah,writer:t=>op}}),Td="essentials",Rd='.tp-cbzgv,.tp-radv_b,.tp-rslv_k,.tp-cbzv_b{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:rgba(0,0,0,0);border-width:0;font-family:inherit;font-size:inherit;font-weight:inherit;margin:0;outline:none;padding:0}.tp-radv_b,.tp-rslv_k,.tp-cbzv_b{background-color:var(--btn-bg);border-radius:var(--bld-br);color:var(--btn-fg);cursor:pointer;display:block;font-weight:bold;height:var(--cnt-usz);line-height:var(--cnt-usz);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.tp-radv_b:hover,.tp-rslv_k:hover,.tp-cbzv_b:hover{background-color:var(--btn-bg-h)}.tp-radv_b:focus,.tp-rslv_k:focus,.tp-cbzv_b:focus{background-color:var(--btn-bg-f)}.tp-radv_b:active,.tp-rslv_k:active,.tp-cbzv_b:active{background-color:var(--btn-bg-a)}.tp-radv_b:disabled,.tp-rslv_k:disabled,.tp-cbzv_b:disabled{opacity:.5}.tp-cbzgv{background-color:var(--in-bg);border-radius:var(--bld-br);box-sizing:border-box;color:var(--in-fg);font-family:inherit;height:var(--cnt-usz);line-height:var(--cnt-usz);min-width:0;width:100%}.tp-cbzgv:hover{background-color:var(--in-bg-h)}.tp-cbzgv:focus{background-color:var(--in-bg-f)}.tp-cbzgv:active{background-color:var(--in-bg-a)}.tp-cbzgv:disabled{opacity:.5}.tp-btngridv{border-radius:var(--bld-br);display:grid;overflow:hidden;gap:2px}.tp-btngridv.tp-v-disabled{opacity:.5}.tp-btngridv .tp-btnv_b:disabled{opacity:1}.tp-btngridv .tp-btnv_b:disabled .tp-btnv_t{opacity:.5}.tp-btngridv .tp-btnv_b{border-radius:0}.tp-cbzv{position:relative}.tp-cbzv_h{display:flex}.tp-cbzv_b{margin-right:4px;position:relative;width:var(--cnt-usz)}.tp-cbzv_b svg{display:block;height:16px;left:50%;margin-left:-8px;margin-top:-8px;position:absolute;top:50%;width:16px}.tp-cbzv_b svg path{stroke:var(--bs-bg);stroke-width:2}.tp-cbzv_t{flex:1}.tp-cbzv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-cbzv.tp-cbzv-expanded .tp-cbzv_p{margin-top:var(--cnt-usp);opacity:1}.tp-cbzv.tp-cbzv-cpl .tp-cbzv_p{overflow:visible}.tp-cbzv .tp-popv{left:calc(-1 * var(--cnt-hp));position:absolute;right:calc(-1 * var(--cnt-hp));top:var(--cnt-usz)}.tp-cbzpv_t{margin-top:var(--cnt-usp)}.tp-cbzgv{height:auto;overflow:hidden;position:relative}.tp-cbzgv.tp-v-disabled{opacity:.5}.tp-cbzgv_p{left:16px;position:absolute;right:16px;top:0}.tp-cbzgv_g{cursor:pointer;display:block;height:calc(var(--cnt-usz) * 5);width:100%}.tp-cbzgv_u{opacity:.1;stroke:var(--in-fg);stroke-dasharray:1}.tp-cbzgv_l{fill:rgba(0,0,0,0);stroke:var(--in-fg)}.tp-cbzgv_v{opacity:.5;stroke:var(--in-fg);stroke-dasharray:1}.tp-cbzgv_h{border:var(--in-fg) solid 1px;border-radius:50%;box-sizing:border-box;height:4px;margin-left:-2px;margin-top:-2px;pointer-events:none;position:absolute;width:4px}.tp-cbzgv:focus .tp-cbzgv_h-sel{background-color:var(--in-fg);border-width:0}.tp-cbzprvv{cursor:pointer;height:4px;padding:4px 0;position:relative}.tp-cbzprvv_g{display:block;height:100%;overflow:visible;width:100%}.tp-cbzprvv_t{opacity:.5;stroke:var(--mo-fg)}.tp-cbzprvv_m{background-color:var(--mo-fg);border-radius:50%;height:4px;margin-left:-2px;margin-top:-2px;opacity:0;position:absolute;top:50%;transition:opacity .2s ease-out;width:4px}.tp-cbzprvv_m.tp-cbzprvv_m-a{opacity:1}.tp-fpsv{position:relative}.tp-fpsv_l{bottom:4px;color:var(--mo-fg);line-height:1;right:4px;pointer-events:none;position:absolute}.tp-fpsv_u{margin-left:.2em;opacity:.7}.tp-rslv{cursor:pointer;padding-left:8px;padding-right:8px}.tp-rslv.tp-v-disabled{opacity:.5}.tp-rslv_t{height:calc(var(--cnt-usz));position:relative}.tp-rslv_t::before{background-color:var(--in-bg);border-radius:1px;content:"";height:2px;margin-top:-1px;position:absolute;top:50%;left:-4px;right:-4px}.tp-rslv_b{bottom:0;top:0;position:absolute}.tp-rslv_b::before{background-color:var(--in-fg);content:"";height:2px;margin-top:-1px;position:absolute;top:50%;left:0;right:0}.tp-rslv_k{height:calc(var(--cnt-usz) - 8px);margin-top:calc((var(--cnt-usz) - 8px)/-2);position:absolute;top:50%;width:8px}.tp-rslv_k.tp-rslv_k-min{margin-left:-8px}.tp-rslv_k.tp-rslv_k-max{margin-left:0}.tp-rslv.tp-rslv-zero .tp-rslv_k.tp-rslv_k-min{border-bottom-right-radius:0;border-top-right-radius:0}.tp-rslv.tp-rslv-zero .tp-rslv_k.tp-rslv_k-max{border-bottom-left-radius:0;border-top-left-radius:0}.tp-rsltxtv{display:flex}.tp-rsltxtv_s{flex:1}.tp-rsltxtv_t{flex:1;margin-left:4px}.tp-radv_l{display:block;position:relative}.tp-radv_i{left:0;opacity:0;position:absolute;top:0}.tp-radv_b{opacity:.5}.tp-radv_i:hover+.tp-radv_b{background-color:var(--btn-bg-h)}.tp-radv_i:focus+.tp-radv_b{background-color:var(--btn-bg-f)}.tp-radv_i:active+.tp-radv_b{background-color:var(--btn-bg-a)}.tp-radv_i:checked+.tp-radv_b{opacity:1}.tp-radv_t{bottom:0;color:inherit;left:0;overflow:hidden;position:absolute;right:0;text-align:center;text-overflow:ellipsis;top:0}.tp-radv_i:disabled+.tp-radv_b>.tp-radv_t{opacity:.5}.tp-radgridv{border-radius:var(--bld-br);display:grid;overflow:hidden;gap:2px}.tp-radgridv.tp-v-disabled{opacity:.5}.tp-radgridv .tp-radv_b{border-radius:0}',zd=[ju,id,pd,yd,Sd,jd,Dd,Od];var Nd=class{init(t){this.config=t,this.pane=new Ho,this.pane.registerPlugin(Yo),this.main=this.pane.addFolder({title:"Parameters",expanded:!0}),this.fpsGraph=this.main.addBlade({view:"fpsgraph",label:"fps",rows:2}),this.main.on("change",(t=>{this.onChangeHandler&&this.onChangeHandler(this.config)})),this.addBindings()}onChange(t){this.onChangeHandler=t}addBindings(){this.main.addBinding(this.config,"speed",{min:-2,max:2,step:.1}),this.main.addBinding(this.config,"noiseForce",{min:-2,max:2,step:.1}),this.main.addBinding(this.config,"noiseScale",{min:.001,max:1})}tickStart(){this.fpsGraph.begin()}tickEnd(){this.fpsGraph.end()}};var Fd,Bd,Id={speed:.2,noiseForce:.5,noiseScale:.3};(Bd=Fd||(Fd={}))[Bd.INIT=0]="INIT",Bd[Bd.READY=1]="READY";const Ud=new class{constructor(){this.status=Fd.INIT}async init(){this.renderer=new vt({dpr:3}),this.gl=this.renderer.gl,document.body.appendChild(this.gl.canvas),this.gl.clearColor(0,0,0,0),this.initCamera(),window.addEventListener("resize",this.onResize.bind(this),!1),this.onResize(),this.scene=new S,this.noiseTex=await this.createTexture(e(ft));this.createSphere().setParent(this.scene),this.tweakPanel=new Nd,this.tweakPanel.init(Id),this.updateConfigUniforms=this.updateConfigUniforms.bind(this),this.tweakPanel.onChange(this.updateConfigUniforms),this.status=Fd.READY}updateConfigUniforms(){this.sphereShader&&(this.sphereShader.uniforms.speed.value=Id.speed,this.sphereShader.uniforms.noiseForce.value=Id.noiseForce,this.sphereShader.uniforms.noiseScale.value=Id.noiseScale)}initCamera(){this.camera=new j(this.gl,{fov:35}),this.camera.position.set(0,1,7),this.camera.lookAt([0,0,0]),this.orbitControls=new nt(this.camera,{element:this.gl.canvas,target:new x(0,0,0)})}onResize(){this.renderer.setSize(window.innerWidth,window.innerHeight),this.camera.perspective({aspect:this.gl.canvas.width/this.gl.canvas.height})}createSphereShader(){return new at(this.gl,{vertex:e("#define GLSLIFY 1\nattribute vec3 position;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nvarying vec3 pos3;\nuniform float uTime;\n\nuniform float speed; // 0.3\nuniform float noiseForce; // 0.5\nuniform float noiseScale; // 0.3\n\nuniform sampler2D nTex;\nuniform sampler2D nTex2;\n\nvoid main() {\n    pos3 = position;\n\n    vec2 uvNoise = pos3.xy * noiseScale;\n    uvNoise.x += uTime * speed;\n    pos3.z += texture2D(nTex, mod(uvNoise,1.0)).r * noiseForce;\n\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(pos3, 1.0);\n    gl_PointSize = 3.0;\n}"),fragment:e("precision highp float;\n#define GLSLIFY 1\nuniform float uTime;\nvarying vec3 pos3;\n\nvoid main() {\n    gl_FragColor.rgb = vec3(0.98,0.965,0.941);\n    gl_FragColor.a = 1.0;\n}"),transparent:!0,uniforms:{uTime:{value:0},speed:{value:Id.speed},noiseForce:{value:Id.noiseForce},noiseScale:{value:Id.noiseScale},nTex:{value:this.noiseTex}}})}update(t){this.status!==Fd.INIT&&this.sphereShader&&(this.tweakPanel.tickStart(),this.orbitControls.update(),this.renderer.render({scene:this.scene,camera:this.camera}),this.sphereShader.uniforms.uTime.value=.001*t,this.tweakPanel.tickEnd())}createTexture(t){const e=new wt(this.gl),i=new Image,s=new Promise((t=>{i.onload=()=>{e.image=i,t(e)}}));return i.src=t,s}createSphere(){this.sphereShader||(this.sphereShader=this.createSphereShader());const t=Math.PI*(3-Math.sqrt(5)),e=4e-5,i=[];for(let s=0;s<5e4;s++){const n=s*e-1+e/2,r=1-n*n,o=Math.sqrt(r),a=s*t;Math.sin(a)*o<0||i.push(Math.cos(a)*o,n,Math.sin(a)*o)}const s=new Float32Array(i.length);i.forEach(((t,e)=>s[e]=t));const n=new F(this.gl,{position:{size:3,data:s}});return new K(this.gl,{mode:this.gl.POINTS,geometry:n,program:this.sphereShader})}};Ud.init(),requestAnimationFrame((function t(e){requestAnimationFrame(t),Ud.update(e)}));
//# sourceMappingURL=index.73cd120b.js.map
