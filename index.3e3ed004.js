function t(t){return t&&t.__esModule?t.default:t}function e(t,e,i,s){Object.defineProperty(t,e,{get:i,set:s,enumerable:!0,configurable:!0})}function i(t,e,i){let s=e[0],n=e[1],r=e[2],a=e[3],o=e[4],l=e[5],h=e[6],p=e[7],d=e[8],u=e[9],c=e[10],v=e[11],m=e[12],b=e[13],g=e[14],w=e[15],_=i[0],f=i[1],x=i[2],y=i[3];return t[0]=_*s+f*o+x*d+y*m,t[1]=_*n+f*l+x*u+y*b,t[2]=_*r+f*h+x*c+y*g,t[3]=_*a+f*p+x*v+y*w,_=i[4],f=i[5],x=i[6],y=i[7],t[4]=_*s+f*o+x*d+y*m,t[5]=_*n+f*l+x*u+y*b,t[6]=_*r+f*h+x*c+y*g,t[7]=_*a+f*p+x*v+y*w,_=i[8],f=i[9],x=i[10],y=i[11],t[8]=_*s+f*o+x*d+y*m,t[9]=_*n+f*l+x*u+y*b,t[10]=_*r+f*h+x*c+y*g,t[11]=_*a+f*p+x*v+y*w,_=i[12],f=i[13],x=i[14],y=i[15],t[12]=_*s+f*o+x*d+y*m,t[13]=_*n+f*l+x*u+y*b,t[14]=_*r+f*h+x*c+y*g,t[15]=_*a+f*p+x*v+y*w,t}function s(t,e){let i=e[0],s=e[1],n=e[2],r=e[4],a=e[5],o=e[6],l=e[8],h=e[9],p=e[10];return t[0]=Math.hypot(i,s,n),t[1]=Math.hypot(r,a,o),t[2]=Math.hypot(l,h,p),t}const n=function(){let t=[0,0,0];return function(e,i){s(t,i);let n=1/t[0],r=1/t[1],a=1/t[2],o=i[0]*n,l=i[1]*r,h=i[2]*a,p=i[4]*n,d=i[5]*r,u=i[6]*a,c=i[8]*n,v=i[9]*r,m=i[10]*a,b=o+d+m,g=0;return b>0?(g=2*Math.sqrt(b+1),e[3]=.25*g,e[0]=(u-v)/g,e[1]=(c-h)/g,e[2]=(l-p)/g):o>d&&o>m?(g=2*Math.sqrt(1+o-d-m),e[3]=(u-v)/g,e[0]=.25*g,e[1]=(l+p)/g,e[2]=(c+h)/g):d>m?(g=2*Math.sqrt(1+d-o-m),e[3]=(c-h)/g,e[0]=(l+p)/g,e[1]=.25*g,e[2]=(u+v)/g):(g=2*Math.sqrt(1+m-o-d),e[3]=(l-p)/g,e[0]=(c+h)/g,e[1]=(u+v)/g,e[2]=.25*g),e}}();class r extends Array{constructor(t=1,e=0,i=0,s=0,n=0,r=1,a=0,o=0,l=0,h=0,p=1,d=0,u=0,c=0,v=0,m=1){return super(t,e,i,s,n,r,a,o,l,h,p,d,u,c,v,m),this}get x(){return this[12]}get y(){return this[13]}get z(){return this[14]}get w(){return this[15]}set x(t){this[12]=t}set y(t){this[13]=t}set z(t){this[14]=t}set w(t){this[15]=t}set(t,e,i,s,n,r,a,o,l,h,p,d,u,c,v,m){return t.length?this.copy(t):(this[0]=t,this[1]=e,this[2]=i,this[3]=s,this[4]=n,this[5]=r,this[6]=a,this[7]=o,this[8]=l,this[9]=h,this[10]=p,this[11]=d,this[12]=u,this[13]=c,this[14]=v,this[15]=m,this)}translate(t,e=this){let i,s,n,r,a,o,l,h,p,d,u,c,v,m,b;return v=t[0],m=t[1],b=t[2],e===this?(this[12]=e[0]*v+e[4]*m+e[8]*b+e[12],this[13]=e[1]*v+e[5]*m+e[9]*b+e[13],this[14]=e[2]*v+e[6]*m+e[10]*b+e[14],this[15]=e[3]*v+e[7]*m+e[11]*b+e[15]):(i=e[0],s=e[1],n=e[2],r=e[3],a=e[4],o=e[5],l=e[6],h=e[7],p=e[8],d=e[9],u=e[10],c=e[11],this[0]=i,this[1]=s,this[2]=n,this[3]=r,this[4]=a,this[5]=o,this[6]=l,this[7]=h,this[8]=p,this[9]=d,this[10]=u,this[11]=c,this[12]=i*v+a*m+p*b+e[12],this[13]=s*v+o*m+d*b+e[13],this[14]=n*v+l*m+u*b+e[14],this[15]=r*v+h*m+c*b+e[15]),this}rotate(t,e,i=this){let s,n,r,a,o,l,h,p,d,u,c,v,m,b,g,w,_,f,x,y,C,P,E,k,V,M,L,A;return 1e-6>Math.abs(A=Math.hypot(V=e[0],M=e[1],L=e[2]))||(V*=A=1/A,M*=A,L*=A,s=Math.sin(t),r=1-(n=Math.cos(t)),a=i[0],o=i[1],l=i[2],h=i[3],p=i[4],d=i[5],u=i[6],c=i[7],v=i[8],m=i[9],b=i[10],g=i[11],w=V*V*r+n,_=M*V*r+L*s,f=L*V*r-M*s,x=V*M*r-L*s,y=M*M*r+n,C=L*M*r+V*s,P=V*L*r+M*s,E=M*L*r-V*s,k=L*L*r+n,this[0]=a*w+p*_+v*f,this[1]=o*w+d*_+m*f,this[2]=l*w+u*_+b*f,this[3]=h*w+c*_+g*f,this[4]=a*x+p*y+v*C,this[5]=o*x+d*y+m*C,this[6]=l*x+u*y+b*C,this[7]=h*x+c*y+g*C,this[8]=a*P+p*E+v*k,this[9]=o*P+d*E+m*k,this[10]=l*P+u*E+b*k,this[11]=h*P+c*E+g*k,i!==this&&(this[12]=i[12],this[13]=i[13],this[14]=i[14],this[15]=i[15])),this}scale(t,e=this){var i;let s,n,r;return s=(i="number"==typeof t?[t,t,t]:t)[0],n=i[1],r=i[2],this[0]=e[0]*s,this[1]=e[1]*s,this[2]=e[2]*s,this[3]=e[3]*s,this[4]=e[4]*n,this[5]=e[5]*n,this[6]=e[6]*n,this[7]=e[7]*n,this[8]=e[8]*r,this[9]=e[9]*r,this[10]=e[10]*r,this[11]=e[11]*r,this[12]=e[12],this[13]=e[13],this[14]=e[14],this[15]=e[15],this}multiply(t,e){return e?i(this,t,e):i(this,this,t),this}identity(){return this[0]=1,this[1]=0,this[2]=0,this[3]=0,this[4]=0,this[5]=1,this[6]=0,this[7]=0,this[8]=0,this[9]=0,this[10]=1,this[11]=0,this[12]=0,this[13]=0,this[14]=0,this[15]=1,this}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this[4]=t[4],this[5]=t[5],this[6]=t[6],this[7]=t[7],this[8]=t[8],this[9]=t[9],this[10]=t[10],this[11]=t[11],this[12]=t[12],this[13]=t[13],this[14]=t[14],this[15]=t[15],this}fromPerspective({fov:t,aspect:e,near:i,far:s}={}){let n,r;return n=1/Math.tan(t/2),r=1/(i-s),this[0]=n/e,this[1]=0,this[2]=0,this[3]=0,this[4]=0,this[5]=n,this[6]=0,this[7]=0,this[8]=0,this[9]=0,this[10]=(s+i)*r,this[11]=-1,this[12]=0,this[13]=0,this[14]=2*s*i*r,this[15]=0,this}fromOrthogonal({left:t,right:e,bottom:i,top:s,near:n,far:r}){let a,o,l;return a=1/(t-e),o=1/(i-s),l=1/(n-r),this[0]=-2*a,this[1]=0,this[2]=0,this[3]=0,this[4]=0,this[5]=-2*o,this[6]=0,this[7]=0,this[8]=0,this[9]=0,this[10]=2*l,this[11]=0,this[12]=(t+e)*a,this[13]=(s+i)*o,this[14]=(r+n)*l,this[15]=1,this}fromQuaternion(t){let e,i,s,n,r,a,o,l,h,p,d,u,c,v,m,b;return e=t[0],i=t[1],s=t[2],n=t[3],r=e+e,a=i+i,o=s+s,l=e*r,h=i*r,p=i*a,d=s*r,u=s*a,c=s*o,v=n*r,m=n*a,b=n*o,this[0]=1-p-c,this[1]=h+b,this[2]=d-m,this[3]=0,this[4]=h-b,this[5]=1-l-c,this[6]=u+v,this[7]=0,this[8]=d+m,this[9]=u-v,this[10]=1-l-p,this[11]=0,this[12]=0,this[13]=0,this[14]=0,this[15]=1,this}setPosition(t){return this.x=t[0],this.y=t[1],this.z=t[2],this}inverse(t=this){let e,i,s,n,r,a,o,l,h,p,d,u,c,v,m,b,g,w,_,f,x,y,C,P,E,k,V,M,L;return e=t[0],i=t[1],s=t[2],n=t[3],r=t[4],a=t[5],o=t[6],l=t[7],h=t[8],p=t[9],d=t[10],u=t[11],c=t[12],v=t[13],m=t[14],b=t[15],g=e*a-i*r,w=e*o-s*r,_=e*l-n*r,f=i*o-s*a,x=i*l-n*a,y=s*l-n*o,C=h*v-p*c,P=h*m-d*c,E=h*b-u*c,k=p*m-d*v,V=p*b-u*v,(L=g*(M=d*b-u*m)-w*V+_*k+f*E-x*P+y*C)&&(L=1/L,this[0]=(a*M-o*V+l*k)*L,this[1]=(s*V-i*M-n*k)*L,this[2]=(v*y-m*x+b*f)*L,this[3]=(d*x-p*y-u*f)*L,this[4]=(o*E-r*M-l*P)*L,this[5]=(e*M-s*E+n*P)*L,this[6]=(m*_-c*y-b*w)*L,this[7]=(h*y-d*_+u*w)*L,this[8]=(r*V-a*E+l*C)*L,this[9]=(i*E-e*V-n*C)*L,this[10]=(c*x-v*_+b*g)*L,this[11]=(p*_-h*x-u*g)*L,this[12]=(a*P-r*k-o*C)*L,this[13]=(e*k-i*P+s*C)*L,this[14]=(v*w-c*f-m*g)*L,this[15]=(h*f-p*w+d*g)*L),this}compose(t,e,i){let s,n,r,a,o,l,h,p,d,u,c,v,m,b,g,w,_,f,x;return s=t[0],n=t[1],r=t[2],a=t[3],o=s+s,l=n+n,h=r+r,p=s*o,d=s*l,u=s*h,c=n*l,v=n*h,m=r*h,b=a*o,g=a*l,w=a*h,_=i[0],f=i[1],x=i[2],this[0]=(1-(c+m))*_,this[1]=(d+w)*_,this[2]=(u-g)*_,this[3]=0,this[4]=(d-w)*f,this[5]=(1-(p+m))*f,this[6]=(v+b)*f,this[7]=0,this[8]=(u+g)*x,this[9]=(v-b)*x,this[10]=(1-(p+c))*x,this[11]=0,this[12]=e[0],this[13]=e[1],this[14]=e[2],this[15]=1,this}getRotation(t){return n(t,this),this}getTranslation(t){return t[0]=this[12],t[1]=this[13],t[2]=this[14],this}getScaling(t){return s(t,this),this}getMaxScaleOnAxis(){let t,e,i,s,n,r,a,o,l;return t=this[0],e=this[1],i=this[2],s=this[4],n=this[5],r=this[6],Math.sqrt(Math.max(t*t+e*e+i*i,s*s+n*n+r*r,(a=this[8])*a+(o=this[9])*o+(l=this[10])*l))}lookAt(t,e,i){let s,n,r,a,o,l,h,p,d,u,c,v,m;return s=t[0],n=t[1],r=t[2],a=i[0],o=i[1],l=i[2],0==(u=(h=s-e[0])*h+(p=n-e[1])*p+(d=r-e[2])*d)?d=1:(h*=u=1/Math.sqrt(u),p*=u,d*=u),0==(u=(c=o*d-l*p)*c+(v=l*h-a*d)*v+(m=a*p-o*h)*m)&&(l?a+=1e-6:o?l+=1e-6:o+=1e-6,u=(c=o*d-l*p)*c+(v=l*h-a*d)*v+(m=a*p-o*h)*m),c*=u=1/Math.sqrt(u),v*=u,m*=u,this[0]=c,this[1]=v,this[2]=m,this[3]=0,this[4]=p*m-d*v,this[5]=d*c-h*m,this[6]=h*v-p*c,this[7]=0,this[8]=h,this[9]=p,this[10]=d,this[11]=0,this[12]=s,this[13]=n,this[14]=r,this[15]=1,this}determinant(){let t,e,i,s,n,r,a,o,l,h,p,d,u,c,v,m;return t=this[0],e=this[1],i=this[2],s=this[3],n=this[4],r=this[5],a=this[6],o=this[7],l=this[8],h=this[9],p=this[10],d=this[11],u=this[12],c=this[13],v=this[14],(t*r-e*n)*(p*(m=this[15])-d*v)-(t*a-i*n)*(h*m-d*c)+(t*o-s*n)*(h*v-p*c)+(e*a-i*r)*(l*m-d*u)-(e*o-s*r)*(l*v-p*u)+(i*o-s*a)*(l*c-h*u)}fromArray(t,e=0){return this[0]=t[e],this[1]=t[e+1],this[2]=t[e+2],this[3]=t[e+3],this[4]=t[e+4],this[5]=t[e+5],this[6]=t[e+6],this[7]=t[e+7],this[8]=t[e+8],this[9]=t[e+9],this[10]=t[e+10],this[11]=t[e+11],this[12]=t[e+12],this[13]=t[e+13],this[14]=t[e+14],this[15]=t[e+15],this}toArray(t=[],e=0){return t[e]=this[0],t[e+1]=this[1],t[e+2]=this[2],t[e+3]=this[3],t[e+4]=this[4],t[e+5]=this[5],t[e+6]=this[6],t[e+7]=this[7],t[e+8]=this[8],t[e+9]=this[9],t[e+10]=this[10],t[e+11]=this[11],t[e+12]=this[12],t[e+13]=this[13],t[e+14]=this[14],t[e+15]=this[15],t}}function a(t){let e=t[0],i=t[1],s=t[2];return Math.sqrt(e*e+i*i+s*s)}function o(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function l(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t}function h(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t}function p(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t}function d(t){let e=t[0],i=t[1],s=t[2];return e*e+i*i+s*s}function u(t,e){let i=e[0],s=e[1],n=e[2],r=i*i+s*s+n*n;return r>0&&(r=1/Math.sqrt(r)),t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t}function c(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function v(t,e,i){let s=e[0],n=e[1],r=e[2],a=i[0],o=i[1],l=i[2];return t[0]=n*l-r*o,t[1]=r*a-s*l,t[2]=s*o-n*a,t}const m=function(){let t=[0,0,0],e=[0,0,0];return function(i,s){o(t,i),o(e,s),u(t,t),u(e,e);let n=c(t,e);return n>1?0:n<-1?Math.PI:Math.acos(n)}}(),b=t=>!!t.length,g=t=>!!t.draw;class w extends Array{constructor(t=0,e=t,i=t){return super(t,e,i),this}get x(){return this[0]}get y(){return this[1]}get z(){return this[2]}set x(t){this[0]=t}set y(t){this[1]=t}set z(t){this[2]=t}set(t,e=t,i=t){return b(t)?this.copy(t):(this[0]=t,this[1]=e,this[2]=i,this)}copy(t){return o(this,t),this}add(t,e){return e?l(this,t,e):l(this,this,t),this}sub(t,e){return e?h(this,t,e):h(this,this,t),this}multiply(t){return t.length?(this[0]=this[0]*t[0],this[1]=this[1]*t[1],this[2]=this[2]*t[2]):p(this,this,t),this}divide(t){return t.length?(this[0]=this[0]/t[0],this[1]=this[1]/t[1],this[2]=this[2]/t[2]):p(this,this,1/t),this}inverse(t=this){return this[0]=1/t[0],this[1]=1/t[1],this[2]=1/t[2],this}len(){return a(this)}distance(t){let e,i,s;return t?Math.sqrt((e=t[0]-this[0])*e+(i=t[1]-this[1])*i+(s=t[2]-this[2])*s):a(this)}squaredLen(){return d(this)}squaredDistance(t){let e,i,s;return t?(e=t[0]-this[0])*e+(i=t[1]-this[1])*i+(s=t[2]-this[2])*s:d(this)}negate(t=this){return this[0]=-t[0],this[1]=-t[1],this[2]=-t[2],this}cross(t,e){return e?v(this,t,e):v(this,this,t),this}scale(t){return p(this,this,t),this}normalize(){return u(this,this),this}dot(t){return c(this,t)}equals(t){return this[0]===t[0]&&this[1]===t[1]&&this[2]===t[2]}applyMatrix4(t){let e,i,s,n;return e=this[0],i=this[1],s=this[2],n=(n=t[3]*e+t[7]*i+t[11]*s+t[15])||1,this[0]=(t[0]*e+t[4]*i+t[8]*s+t[12])/n,this[1]=(t[1]*e+t[5]*i+t[9]*s+t[13])/n,this[2]=(t[2]*e+t[6]*i+t[10]*s+t[14])/n,this}scaleRotateMatrix4(t){let e,i,s,n;return e=this[0],i=this[1],s=this[2],n=(n=t[3]*e+t[7]*i+t[11]*s+t[15])||1,this[0]=(t[0]*e+t[4]*i+t[8]*s)/n,this[1]=(t[1]*e+t[5]*i+t[9]*s)/n,this[2]=(t[2]*e+t[6]*i+t[10]*s)/n,this}applyQuaternion(t){let e,i,s,n,r,a,o,l,h,p,d,u,c,v;return e=this[0],i=this[1],s=this[2],n=t[0],r=t[1],a=t[2],o=t[3],l=r*s-a*i,h=a*e-n*s,p=n*i-r*e,d=r*p-a*h,u=a*l-n*p,c=n*h-r*l,l*=v=2*o,h*=v,p*=v,d*=2,u*=2,c*=2,this[0]=e+l+d,this[1]=i+h+u,this[2]=s+p+c,this}angle(t){return m(this,t)}lerp(t,e){let i,s,n;return i=this[0],s=this[1],n=this[2],this[0]=i+e*(t[0]-i),this[1]=s+e*(t[1]-s),this[2]=n+e*(t[2]-n),this}clone(){return new w(this[0],this[1],this[2])}fromArray(t,e=0){return this[0]=t[e],this[1]=t[e+1],this[2]=t[e+2],this}toArray(t=[],e=0){return t[e]=this[0],t[e+1]=this[1],t[e+2]=this[2],t}transformDirection(t){let e=this[0],i=this[1],s=this[2];return this[0]=t[0]*e+t[4]*i+t[8]*s,this[1]=t[1]*e+t[5]*i+t[9]*s,this[2]=t[2]*e+t[6]*i+t[10]*s,this.normalize()}}function _(t,e,i){let s=e[0],n=e[1],r=e[2],a=e[3],o=i[0],l=i[1],h=i[2],p=i[3];return t[0]=s*p+a*o+n*h-r*l,t[1]=n*p+a*l+r*o-s*h,t[2]=r*p+a*h+s*l-n*o,t[3]=a*p-s*o-n*l-r*h,t}const f=function(t,e){let i=e[0],s=e[1],n=e[2],r=e[3],a=i*i+s*s+n*n+r*r;return a>0&&(a=1/Math.sqrt(a)),t[0]=i*a,t[1]=s*a,t[2]=n*a,t[3]=r*a,t};class x extends Array{constructor(t=0,e=0,i=0,s=1){return super(t,e,i,s),this.onChange=()=>{},this}get x(){return this[0]}get y(){return this[1]}get z(){return this[2]}get w(){return this[3]}set x(t){this[0]=t,this.onChange()}set y(t){this[1]=t,this.onChange()}set z(t){this[2]=t,this.onChange()}set w(t){this[3]=t,this.onChange()}identity(){return this[0]=0,this[1]=0,this[2]=0,this[3]=1,this.onChange(),this}set(t,e,i,s){return t.length?this.copy(t):(this[0]=t,this[1]=e,this[2]=i,this[3]=s,this.onChange(),this)}rotateX(t){var e;let i,s,n,r,a,o;return e=.5*t,i=this[0],s=this[1],n=this[2],r=this[3],a=Math.sin(e),o=Math.cos(e),this[0]=i*o+r*a,this[1]=s*o+n*a,this[2]=n*o-s*a,this[3]=r*o-i*a,this.onChange(),this}rotateY(t){var e;let i,s,n,r,a,o;return e=.5*t,i=this[0],s=this[1],n=this[2],r=this[3],a=Math.sin(e),o=Math.cos(e),this[0]=i*o-n*a,this[1]=s*o+r*a,this[2]=n*o+i*a,this[3]=r*o-s*a,this.onChange(),this}rotateZ(t){var e;let i,s,n,r,a,o;return e=.5*t,i=this[0],s=this[1],n=this[2],r=this[3],a=Math.sin(e),o=Math.cos(e),this[0]=i*o+s*a,this[1]=s*o-i*a,this[2]=n*o+r*a,this[3]=r*o-n*a,this.onChange(),this}inverse(t=this){let e,i,s,n,r,a;return e=t[0],a=(r=e*e+(i=t[1])*i+(s=t[2])*s+(n=t[3])*n)?1/r:0,this[0]=-e*a,this[1]=-i*a,this[2]=-s*a,this[3]=n*a,this.onChange(),this}conjugate(t=this){return this[0]=-t[0],this[1]=-t[1],this[2]=-t[2],this[3]=t[3],this.onChange(),this}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this.onChange(),this}normalize(t=this){return f(this,t),this.onChange(),this}multiply(t,e){return e?_(this,t,e):_(this,this,t),this.onChange(),this}dot(t){return this[0]*t[0]+this[1]*t[1]+this[2]*t[2]+this[3]*t[3]}fromMatrix3(t){return!function(t,e){let i,s=e[0]+e[4]+e[8];if(s>0)i=Math.sqrt(s+1),t[3]=.5*i,i=.5/i,t[0]=(e[5]-e[7])*i,t[1]=(e[6]-e[2])*i,t[2]=(e[1]-e[3])*i;else{let s=0;e[4]>e[0]&&(s=1),e[8]>e[3*s+s]&&(s=2);let n=(s+1)%3,r=(s+2)%3;i=Math.sqrt(e[3*s+s]-e[3*n+n]-e[3*r+r]+1),t[s]=.5*i,i=.5/i,t[3]=(e[3*n+r]-e[3*r+n])*i,t[n]=(e[3*n+s]+e[3*s+n])*i,t[r]=(e[3*r+s]+e[3*s+r])*i}}(this,t),this.onChange(),this}fromEuler(t){return!function(t,e,i="YXZ"){let s=Math.sin(.5*e[0]),n=Math.cos(.5*e[0]),r=Math.sin(.5*e[1]),a=Math.cos(.5*e[1]),o=Math.sin(.5*e[2]),l=Math.cos(.5*e[2]);"XYZ"===i?(t[0]=s*a*l+n*r*o,t[1]=n*r*l-s*a*o,t[2]=n*a*o+s*r*l,t[3]=n*a*l-s*r*o):"YXZ"===i?(t[0]=s*a*l+n*r*o,t[1]=n*r*l-s*a*o,t[2]=n*a*o-s*r*l,t[3]=n*a*l+s*r*o):"ZXY"===i?(t[0]=s*a*l-n*r*o,t[1]=n*r*l+s*a*o,t[2]=n*a*o+s*r*l,t[3]=n*a*l-s*r*o):"ZYX"===i?(t[0]=s*a*l-n*r*o,t[1]=n*r*l+s*a*o,t[2]=n*a*o-s*r*l,t[3]=n*a*l+s*r*o):"YZX"===i?(t[0]=s*a*l+n*r*o,t[1]=n*r*l+s*a*o,t[2]=n*a*o-s*r*l,t[3]=n*a*l-s*r*o):"XZY"===i&&(t[0]=s*a*l-n*r*o,t[1]=n*r*l-s*a*o,t[2]=n*a*o+s*r*l,t[3]=n*a*l+s*r*o)}(this,t,t.order),this}fromAxisAngle(t,e){var i;let s;return s=Math.sin(i=.5*e),this[0]=s*t[0],this[1]=s*t[1],this[2]=s*t[2],this[3]=Math.cos(i),this}slerp(t,e){let i,s,n,r,a,o,l,h,p,d,u,c,v;return o=this[0],l=this[1],h=this[2],p=this[3],d=t[0],(s=o*d+l*(u=t[1])+h*(c=t[2])+p*(v=t[3]))<0&&(s=-s,d=-d,u=-u,c=-c,v=-v),1-s>1e-6?(n=Math.sin(i=Math.acos(s)),r=Math.sin((1-e)*i)/n,a=Math.sin(e*i)/n):(r=1-e,a=e),this[0]=r*o+a*d,this[1]=r*l+a*u,this[2]=r*h+a*c,this[3]=r*p+a*v,this}fromArray(t,e=0){return this[0]=t[e],this[1]=t[e+1],this[2]=t[e+2],this[3]=t[e+3],this}toArray(t=[],e=0){return t[e]=this[0],t[e+1]=this[1],t[e+2]=this[2],t[e+3]=this[3],t}}const y=new r;class C extends Array{constructor(t=0,e=t,i=t,s="YXZ"){return super(t,e,i),this.order=s,this.onChange=()=>{},this}get x(){return this[0]}get y(){return this[1]}get z(){return this[2]}set x(t){this[0]=t,this.onChange()}set y(t){this[1]=t,this.onChange()}set z(t){this[2]=t,this.onChange()}set(t,e=t,i=t){return t.length?this.copy(t):(this[0]=t,this[1]=e,this[2]=i,this.onChange(),this)}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this.onChange(),this}reorder(t){return this.order=t,this.onChange(),this}fromRotationMatrix(t,e=this.order){return!function(t,e,i="YXZ"){"XYZ"===i?(t[1]=Math.asin(Math.min(Math.max(e[8],-1),1)),.99999>Math.abs(e[8])?(t[0]=Math.atan2(-e[9],e[10]),t[2]=Math.atan2(-e[4],e[0])):(t[0]=Math.atan2(e[6],e[5]),t[2]=0)):"YXZ"===i?(t[0]=Math.asin(-Math.min(Math.max(e[9],-1),1)),.99999>Math.abs(e[9])?(t[1]=Math.atan2(e[8],e[10]),t[2]=Math.atan2(e[1],e[5])):(t[1]=Math.atan2(-e[2],e[0]),t[2]=0)):"ZXY"===i?(t[0]=Math.asin(Math.min(Math.max(e[6],-1),1)),.99999>Math.abs(e[6])?(t[1]=Math.atan2(-e[2],e[10]),t[2]=Math.atan2(-e[4],e[5])):(t[1]=0,t[2]=Math.atan2(e[1],e[0]))):"ZYX"===i?(t[1]=Math.asin(-Math.min(Math.max(e[2],-1),1)),.99999>Math.abs(e[2])?(t[0]=Math.atan2(e[6],e[10]),t[2]=Math.atan2(e[1],e[0])):(t[0]=0,t[2]=Math.atan2(-e[4],e[5]))):"YZX"===i?(t[2]=Math.asin(Math.min(Math.max(e[1],-1),1)),.99999>Math.abs(e[1])?(t[0]=Math.atan2(-e[9],e[5]),t[1]=Math.atan2(-e[2],e[0])):(t[0]=0,t[1]=Math.atan2(e[8],e[10]))):"XZY"===i&&(t[2]=Math.asin(-Math.min(Math.max(e[4],-1),1)),.99999>Math.abs(e[4])?(t[0]=Math.atan2(e[6],e[5]),t[1]=Math.atan2(e[8],e[0])):(t[0]=Math.atan2(-e[9],e[10]),t[1]=0))}(this,t,e),this}fromQuaternion(t,e=this.order){return y.fromQuaternion(t),this.fromRotationMatrix(y,e)}toArray(t=[],e=0){return t[e]=this[0],t[e+1]=this[1],t[e+2]=this[2],t}}class P{constructor(){this.parent=null,this.children=[],this.visible=!0,this.matrix=new r,this.worldMatrix=new r,this.matrixAutoUpdate=!0,this.up=new w(0,1,0),this.position=new w,this.scale=new w(1),this.quaternion=new x,this.rotation=new C,this.rotation.onChange=()=>this.quaternion.fromEuler(this.rotation),this.quaternion.onChange=()=>this.rotation.fromQuaternion(this.quaternion)}setParent(t,e=!0){this.parent&&t!==this.parent&&this.parent.removeChild(this,!1),this.parent=t,e&&t&&t.addChild(this,!1)}addChild(t,e=!0){~this.children.indexOf(t)||this.children.push(t),e&&t.setParent(this,!1)}removeChild(t,e=!0){~this.children.indexOf(t)&&this.children.splice(this.children.indexOf(t),1),e&&t.setParent(null,!1)}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.worldMatrixNeedsUpdate||t)&&(null===this.parent?this.worldMatrix.copy(this.matrix):this.worldMatrix.multiply(this.parent.worldMatrix,this.matrix),this.worldMatrixNeedsUpdate=!1,t=!0);for(let e=0,i=this.children.length;e<i;e++)this.children[e].updateMatrixWorld(t)}updateMatrix(){this.matrix.compose(this.quaternion,this.position,this.scale),this.worldMatrixNeedsUpdate=!0}traverse(t){if(!t(this))for(let e=0,i=this.children.length;e<i;e++)this.children[e].traverse(t)}decompose(){this.matrix.getTranslation(this.position),this.matrix.getRotation(this.quaternion),this.matrix.getScaling(this.scale),this.rotation.fromQuaternion(this.quaternion)}lookAt(t,e=!1){e?this.matrix.lookAt(this.position,t,this.up):this.matrix.lookAt(t,this.position,this.up),this.matrix.getRotation(this.quaternion),this.rotation.fromQuaternion(this.quaternion)}}const E=new r,k=new w,V=new w;class M extends P{constructor(t,{near:e=.1,far:i=100,fov:s=45,aspect:n=1,left:a,right:o,bottom:l,top:h,zoom:p=1}={}){super(),Object.assign(this,{near:e,far:i,fov:s,aspect:n,left:a,right:o,bottom:l,top:h,zoom:p}),this.projectionMatrix=new r,this.viewMatrix=new r,this.projectionViewMatrix=new r,this.worldPosition=new w,this.type=a||o?"orthographic":"perspective","orthographic"===this.type?this.orthographic():this.perspective()}perspective({near:t=this.near,far:e=this.far,fov:i=this.fov,aspect:s=this.aspect}={}){return Object.assign(this,{near:t,far:e,fov:i,aspect:s}),this.projectionMatrix.fromPerspective({fov:Math.PI/180*i,aspect:s,near:t,far:e}),this.type="perspective",this}orthographic({near:t=this.near,far:e=this.far,left:i=this.left,right:s=this.right,bottom:n=this.bottom,top:r=this.top,zoom:a=this.zoom}={}){return Object.assign(this,{near:t,far:e,left:i,right:s,bottom:n,top:r,zoom:a}),i/=a,s/=a,n/=a,r/=a,this.projectionMatrix.fromOrthogonal({left:i,right:s,bottom:n,top:r,near:t,far:e}),this.type="orthographic",this}updateMatrixWorld(){return super.updateMatrixWorld(),this.viewMatrix.inverse(this.worldMatrix),this.worldMatrix.getTranslation(this.worldPosition),this.projectionViewMatrix.multiply(this.projectionMatrix,this.viewMatrix),this}lookAt(t){return super.lookAt(t,!0),this}project(t){return t.applyMatrix4(this.viewMatrix),t.applyMatrix4(this.projectionMatrix),this}unproject(t){return t.applyMatrix4(E.inverse(this.projectionMatrix)),t.applyMatrix4(this.worldMatrix),this}updateFrustum(){this.frustum||(this.frustum=[new w,new w,new w,new w,new w,new w]);let t=this.projectionViewMatrix;this.frustum[0].set(t[3]-t[0],t[7]-t[4],t[11]-t[8]).constant=t[15]-t[12],this.frustum[1].set(t[3]+t[0],t[7]+t[4],t[11]+t[8]).constant=t[15]+t[12],this.frustum[2].set(t[3]+t[1],t[7]+t[5],t[11]+t[9]).constant=t[15]+t[13],this.frustum[3].set(t[3]-t[1],t[7]-t[5],t[11]-t[9]).constant=t[15]-t[13],this.frustum[4].set(t[3]-t[2],t[7]-t[6],t[11]-t[10]).constant=t[15]-t[14],this.frustum[5].set(t[3]+t[2],t[7]+t[6],t[11]+t[10]).constant=t[15]+t[14];for(let t=0;t<6;t++){let e=1/this.frustum[t].distance();this.frustum[t].multiply(e),this.frustum[t].constant*=e}}frustumIntersectsMesh(t){if(!t.geometry.attributes.position||(t.geometry.bounds&&t.geometry.bounds.radius!==1/0||t.geometry.computeBoundingSphere(),!t.geometry.bounds))return!0;k.copy(t.geometry.bounds.center),k.applyMatrix4(t.worldMatrix);let e=t.geometry.bounds.radius*t.worldMatrix.getMaxScaleOnAxis();return this.frustumIntersectsSphere(k,e)}frustumIntersectsSphere(t,e){for(let i=0;i<6;i++){let s=this.frustum[i];if(V.copy(s).dot(t)+s.constant<-e)return!1}return!0}}const L=new w;let A=1,S=1,D=!1;class O{constructor(t,e={}){for(let i in this.raycast="box",t.canvas||console.error("gl not passed as fist argument to Geometry"),this.gl=t,this.attributes=e,this.id=A++,this.VAOs={},this.drawRange={start:0,count:0},this.instancedCount=0,this.gl.renderer.bindVertexArray(null),this.gl.renderer.currentGeometry=null,this.glState=this.gl.renderer.state,e)this.addAttribute(i,e[i])}addAttribute(t,e){if(this.attributes[t]=e,e.id=S++,e.size=e.size||1,e.type=e.type||(e.data.constructor===Float32Array?this.gl.FLOAT:e.data.constructor===Uint16Array?this.gl.UNSIGNED_SHORT:this.gl.UNSIGNED_INT),e.target="index"===t?this.gl.ELEMENT_ARRAY_BUFFER:this.gl.ARRAY_BUFFER,e.normalized=e.normalized||!1,e.stride=e.stride||0,e.offset=e.offset||0,e.count=e.count||(e.stride?e.data.byteLength/e.stride:e.data.length/e.size),e.divisor=e.instanced||0,e.needsUpdate=!1,e.buffer||(e.buffer=this.gl.createBuffer(),this.updateAttribute(e)),e.divisor){if(this.isInstanced=!0,this.instancedCount&&this.instancedCount!==e.count*e.divisor)return console.warn("geometry has multiple instanced buffers of different length"),this.instancedCount=Math.min(this.instancedCount,e.count*e.divisor);this.instancedCount=e.count*e.divisor}else"index"===t?this.drawRange.count=e.count:this.attributes.index||(this.drawRange.count=Math.max(this.drawRange.count,e.count))}updateAttribute(t){this.glState.boundBuffer!==t.buffer&&(this.gl.bindBuffer(t.target,t.buffer),this.glState.boundBuffer=t.buffer),this.gl.bufferData(t.target,t.data,this.gl.STATIC_DRAW),t.needsUpdate=!1}setIndex(t){this.addAttribute("index",t)}setDrawRange(t,e){this.drawRange.start=t,this.drawRange.count=e}setInstancedCount(t){this.instancedCount=t}createVAO(t){this.VAOs[t.attributeOrder]=this.gl.renderer.createVertexArray(),this.gl.renderer.bindVertexArray(this.VAOs[t.attributeOrder]),this.bindAttributes(t)}bindAttributes(t){t.attributeLocations.forEach((t,{name:e,type:i})=>{if(!this.attributes[e]){console.warn(`active attribute ${e} not being supplied`);return}let s=this.attributes[e];this.gl.bindBuffer(s.target,s.buffer),this.glState.boundBuffer=s.buffer;let n=1;35674===i&&(n=2),35675===i&&(n=3),35676===i&&(n=4);let r=s.size/n,a=1===n?0:n*n*n,o=1===n?0:n*n;for(let e=0;e<n;e++)this.gl.vertexAttribPointer(t+e,r,s.type,s.normalized,s.stride+a,s.offset+e*o),this.gl.enableVertexAttribArray(t+e),this.gl.renderer.vertexAttribDivisor(t+e,s.divisor)}),this.attributes.index&&this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.attributes.index.buffer)}draw({program:t,mode:e=this.gl.TRIANGLES}){this.gl.renderer.currentGeometry!==`${this.id}_${t.attributeOrder}`&&(this.VAOs[t.attributeOrder]||this.createVAO(t),this.gl.renderer.bindVertexArray(this.VAOs[t.attributeOrder]),this.gl.renderer.currentGeometry=`${this.id}_${t.attributeOrder}`),t.attributeLocations.forEach((t,{name:e})=>{let i=this.attributes[e];i.needsUpdate&&this.updateAttribute(i)}),this.isInstanced?this.attributes.index?this.gl.renderer.drawElementsInstanced(e,this.drawRange.count,this.attributes.index.type,this.attributes.index.offset+2*this.drawRange.start,this.instancedCount):this.gl.renderer.drawArraysInstanced(e,this.drawRange.start,this.drawRange.count,this.instancedCount):this.attributes.index?this.gl.drawElements(e,this.drawRange.count,this.attributes.index.type,this.attributes.index.offset+2*this.drawRange.start):this.gl.drawArrays(e,this.drawRange.start,this.drawRange.count)}getPosition(){let t=this.attributes.position;return t.data?t:D?void 0:(console.warn("No position buffer data found to compute bounds"),D=!0)}computeBoundingBox(t=null){t||(t=this.getPosition());let e=t.data,i=t.offset||0,s=t.stride||t.size;this.bounds||(this.bounds={min:new w,max:new w,center:new w,scale:new w,radius:1/0});let n=this.bounds.min,r=this.bounds.max,a=this.bounds.center,o=this.bounds.scale;n.set(1/0),r.set(-1/0);for(let t=i,a=e.length;t<a;t+=s){let i=e[t],s=e[t+1],a=e[t+2];n.x=Math.min(i,n.x),n.y=Math.min(s,n.y),n.z=Math.min(a,n.z),r.x=Math.max(i,r.x),r.y=Math.max(s,r.y),r.z=Math.max(a,r.z)}o.sub(r,n),a.add(n,r).divide(2)}computeBoundingSphere(t=null){t||(t=this.getPosition());let e=t.data,i=t.offset||0,s=t.stride||t.size;this.bounds||this.computeBoundingBox(t);let n=0;for(let t=i,r=e.length;t<r;t+=s)L.fromArray(e,t),n=Math.max(n,this.bounds.center.squaredDistance(L));this.bounds.radius=Math.sqrt(n)}computeVertexNormals(){let t=this.attributes.position;if(!t)return;let e=this.attributes.normal;e?e.data.fill(0):(this.addAttribute("normal",{size:3,data:new Float32Array(3*t.count)}),e=this.attributes.normal);let i=new w,s=new w,n=new w,r=new w,a=new w,o=new w,l=new w,h=new w,p=this.attributes.index;if(p){let d,u,c;for(let v=0,m=p.count;v<m;v+=3)d=p.data[v],u=p.data[v+1],c=p.data[v+2],i.fromArray(t.data,d*t.size),s.fromArray(t.data,u*t.size),n.fromArray(t.data,c*t.size),l.sub(n,s),h.sub(i,s),l.cross(h),r.fromArray(e.data,d*e.size),a.fromArray(e.data,u*e.size),o.fromArray(e.data,c*e.size),r.add(l),a.add(l),o.add(l),d*=e.size,e.data[d]=r.x,e.data[d+1]=r.y,e.data[d+2]=r.z,u*=e.size,e.data[u]=a.x,e.data[u+1]=a.y,e.data[u+2]=a.z,c*=e.size,e.data[c]=o.x,e.data[c+1]=o.y,e.data[c+2]=o.z}else for(let r=0,a=t.count;r<a;r+=3)i.fromArray(t.data,r*t.size),s.fromArray(t.data,(r+1)*t.size),n.fromArray(t.data,(r+2)*t.size),l.sub(n,s),h.sub(i,s),l.cross(h),e.data[r*e.size]=l.x,e.data[r*e.size+1]=l.y,e.data[r*e.size+2]=l.z,e.data[(r+1)*e.size]=l.x,e.data[(r+1)*e.size+1]=l.y,e.data[(r+1)*e.size+2]=l.z,e.data[(r+2)*e.size]=l.x,e.data[(r+2)*e.size+1]=l.y,e.data[(r+2)*e.size+2]=l.z;this.normalizeNormals(),e.needsUpdate=!0}normalizeNormals(){let t=this.attributes.normal;for(let e=0,i=t.count;e<i;e++)L.fromArray(t.data,e*t.size),L.normalize(),t.data[e*t.size]=L.x,t.data[e*t.size+1]=L.y,t.data[e*t.size+2]=L.z}remove(){for(let t in this.attributes)this.gl.deleteBuffer(this.attributes[t].buffer),delete this.attributes[t]}}function j(t,e,i){let s=e[0],n=e[1],r=e[2],a=e[3],o=e[4],l=e[5],h=e[6],p=e[7],d=e[8],u=i[0],c=i[1],v=i[2],m=i[3],b=i[4],g=i[5],w=i[6],_=i[7],f=i[8];return t[0]=u*s+c*a+v*h,t[1]=u*n+c*o+v*p,t[2]=u*r+c*l+v*d,t[3]=m*s+b*a+g*h,t[4]=m*n+b*o+g*p,t[5]=m*r+b*l+g*d,t[6]=w*s+_*a+f*h,t[7]=w*n+_*o+f*p,t[8]=w*r+_*l+f*d,t}class T extends Array{constructor(t=1,e=0,i=0,s=0,n=1,r=0,a=0,o=0,l=1){return super(t,e,i,s,n,r,a,o,l),this}set(t,e,i,s,n,r,a,o,l){return t.length?this.copy(t):(this[0]=t,this[1]=e,this[2]=i,this[3]=s,this[4]=n,this[5]=r,this[6]=a,this[7]=o,this[8]=l,this)}translate(t,e=this){let i,s,n,r,a,o,l,h,p,d,u;return i=e[0],s=e[1],n=e[2],r=e[3],a=e[4],o=e[5],l=e[6],h=e[7],p=e[8],d=t[0],u=t[1],this[0]=i,this[1]=s,this[2]=n,this[3]=r,this[4]=a,this[5]=o,this[6]=d*i+u*r+l,this[7]=d*s+u*a+h,this[8]=d*n+u*o+p,this}rotate(t,e=this){let i,s,n,r,a,o,l,h,p,d,u;return i=e[0],s=e[1],n=e[2],r=e[3],a=e[4],o=e[5],l=e[6],h=e[7],p=e[8],d=Math.sin(t),u=Math.cos(t),this[0]=u*i+d*r,this[1]=u*s+d*a,this[2]=u*n+d*o,this[3]=u*r-d*i,this[4]=u*a-d*s,this[5]=u*o-d*n,this[6]=l,this[7]=h,this[8]=p,this}scale(t,e=this){let i,s;return i=t[0],s=t[1],this[0]=i*e[0],this[1]=i*e[1],this[2]=i*e[2],this[3]=s*e[3],this[4]=s*e[4],this[5]=s*e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this}multiply(t,e){return e?j(this,t,e):j(this,this,t),this}identity(){return this[0]=1,this[1]=0,this[2]=0,this[3]=0,this[4]=1,this[5]=0,this[6]=0,this[7]=0,this[8]=1,this}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this[4]=t[4],this[5]=t[5],this[6]=t[6],this[7]=t[7],this[8]=t[8],this}fromMatrix4(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[4],this[4]=t[5],this[5]=t[6],this[6]=t[8],this[7]=t[9],this[8]=t[10],this}fromQuaternion(t){let e,i,s,n,r,a,o,l,h,p,d,u,c,v,m,b;return e=t[0],i=t[1],s=t[2],n=t[3],r=e+e,a=i+i,o=s+s,l=e*r,h=i*r,p=i*a,d=s*r,u=s*a,c=s*o,v=n*r,m=n*a,b=n*o,this[0]=1-p-c,this[3]=h-b,this[6]=d+m,this[1]=h+b,this[4]=1-l-c,this[7]=u-v,this[2]=d-m,this[5]=u+v,this[8]=1-l-p,this}fromBasis(t,e,i){return this.set(t[0],t[1],t[2],e[0],e[1],e[2],i[0],i[1],i[2]),this}inverse(t=this){let e,i,s,n,r,a,o,l,h,p,d,u,c;return e=t[0],i=t[1],s=t[2],n=t[3],r=t[4],a=t[5],o=t[6],l=t[7],(c=e*(p=(h=t[8])*r-a*l)+i*(d=-h*n+a*o)+s*(u=l*n-r*o))&&(c=1/c,this[0]=p*c,this[1]=(-h*i+s*l)*c,this[2]=(a*i-s*r)*c,this[3]=d*c,this[4]=(h*e-s*o)*c,this[5]=(-a*e+s*n)*c,this[6]=u*c,this[7]=(-l*e+i*o)*c,this[8]=(r*e-i*n)*c),this}getNormalMatrix(t){let e,i,s,n,r,a,o,l,h,p,d,u,c,v,m,b,g,w,_,f,x,y,C,P,E,k,V,M,L;return e=t[0],i=t[1],s=t[2],n=t[3],r=t[4],a=t[5],o=t[6],l=t[7],h=t[8],p=t[9],d=t[10],u=t[11],c=t[12],v=t[13],m=t[14],b=t[15],g=e*a-i*r,w=e*o-s*r,_=e*l-n*r,f=i*o-s*a,x=i*l-n*a,y=s*l-n*o,C=h*v-p*c,P=h*m-d*c,E=h*b-u*c,k=p*m-d*v,V=p*b-u*v,(L=g*(M=d*b-u*m)-w*V+_*k+f*E-x*P+y*C)&&(L=1/L,this[0]=(a*M-o*V+l*k)*L,this[1]=(o*E-r*M-l*P)*L,this[2]=(r*V-a*E+l*C)*L,this[3]=(s*V-i*M-n*k)*L,this[4]=(e*M-s*E+n*P)*L,this[5]=(i*E-e*V-n*C)*L,this[6]=(v*y-m*x+b*f)*L,this[7]=(m*_-c*y-b*w)*L,this[8]=(c*x-v*_+b*g)*L),this}}let R=0;class N extends P{constructor(t,{geometry:e,program:i,mode:s=t.TRIANGLES,frustumCulled:n=!0,renderOrder:a=0}={}){super(),this.hit=null,t.canvas||console.error("gl not passed as first argument to Mesh"),this.gl=t,this.id=R++,this.geometry=e,this.program=i,this.mode=s,this.frustumCulled=n,this.renderOrder=a,this.modelViewMatrix=new r,this.normalMatrix=new T,this.beforeRenderCallbacks=[],this.afterRenderCallbacks=[]}onBeforeRender(t){return this.beforeRenderCallbacks.push(t),this}onAfterRender(t){return this.afterRenderCallbacks.push(t),this}draw({camera:t}={}){this.beforeRenderCallbacks.forEach(e=>e&&e({mesh:this,camera:t})),t&&(this.program.uniforms.modelMatrix||Object.assign(this.program.uniforms,{modelMatrix:{value:null},viewMatrix:{value:null},modelViewMatrix:{value:null},normalMatrix:{value:null},projectionMatrix:{value:null},cameraPosition:{value:null}}),this.program.uniforms.projectionMatrix.value=t.projectionMatrix,this.program.uniforms.cameraPosition.value=t.worldPosition,this.program.uniforms.viewMatrix.value=t.viewMatrix,this.modelViewMatrix.multiply(t.viewMatrix,this.worldMatrix),this.normalMatrix.getNormalMatrix(this.modelViewMatrix),this.program.uniforms.modelMatrix.value=this.worldMatrix,this.program.uniforms.modelViewMatrix.value=this.modelViewMatrix,this.program.uniforms.normalMatrix.value=this.normalMatrix);let e=this.program.cullFace&&0>this.worldMatrix.determinant();this.program.use({flipFaces:e}),this.geometry.draw({mode:this.mode,program:this.program}),this.afterRenderCallbacks.forEach(e=>e&&e({mesh:this,camera:t}))}}function z(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t}function B(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t}function F(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t}function I(t){var e=t[0],i=t[1];return Math.sqrt(e*e+i*i)}function U(t,e){return t[0]*e[1]-t[1]*e[0]}class K extends Array{constructor(t=0,e=t){return super(t,e),this}get x(){return this[0]}get y(){return this[1]}set x(t){this[0]=t}set y(t){this[1]=t}set(t,e=t){return t.length?this.copy(t):(this[0]=t,this[1]=e,this)}copy(t){return this[0]=t[0],this[1]=t[1],this}add(t,e){return e?z(this,t,e):z(this,this,t),this}sub(t,e){return e?B(this,t,e):B(this,this,t),this}multiply(t){return t.length?(this[0]=this[0]*t[0],this[1]=this[1]*t[1]):F(this,this,t),this}divide(t){return t.length?(this[0]=this[0]/t[0],this[1]=this[1]/t[1]):F(this,this,1/t),this}inverse(t=this){return this[0]=1/t[0],this[1]=1/t[1],this}len(){return I(this)}distance(t){var e,i;return t?Math.sqrt((e=t[0]-this[0])*e+(i=t[1]-this[1])*i):I(this)}squaredLen(){return this.squaredDistance()}squaredDistance(t){var e,i,s,n;return t?(e=t[0]-this[0])*e+(i=t[1]-this[1])*i:(s=this[0])*s+(n=this[1])*n}negate(t=this){return this[0]=-t[0],this[1]=-t[1],this}cross(t,e){return e?U(t,e):U(this,t)}scale(t){return F(this,this,t),this}normalize(){var t,e,i;return(i=(t=this[0])*t+(e=this[1])*e)>0&&(i=1/Math.sqrt(i)),this[0]=this[0]*i,this[1]=this[1]*i,this}dot(t){return this[0]*t[0]+this[1]*t[1]}equals(t){return this[0]===t[0]&&this[1]===t[1]}applyMatrix3(t){var e,i;return e=this[0],i=this[1],this[0]=t[0]*e+t[3]*i+t[6],this[1]=t[1]*e+t[4]*i+t[7],this}applyMatrix4(t){let e,i;return e=this[0],i=this[1],this[0]=t[0]*e+t[4]*i+t[12],this[1]=t[1]*e+t[5]*i+t[13],this}lerp(t,e){var i,s;i=this[0],s=this[1],this[0]=i+e*(t[0]-i),this[1]=s+e*(t[1]-s)}clone(){return new K(this[0],this[1])}fromArray(t,e=0){return this[0]=t[e],this[1]=t[e+1],this}toArray(t=[],e=0){return t[e]=this[0],t[e+1]=this[1],t}}const q={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,DOLLY_PAN:3},$=new w,G=new K,H=new K;function Y(t,{element:e=document.body,enabled:i=!0,target:s=new w,ease:n=.25,inertia:r=.85,enableRotate:a=!0,rotateSpeed:o=.1,autoRotate:l=!1,autoRotateSpeed:h=1,enableZoom:p=!0,zoomSpeed:d=1,enablePan:u=!0,panSpeed:c=.1,minPolarAngle:v=0,maxPolarAngle:m=Math.PI,minAzimuthAngle:b=-1/0,maxAzimuthAngle:g=1/0,minDistance:_=0,maxDistance:f=1/0}={}){this.enabled=i,this.target=s,n=n||1,r=r||0,this.minDistance=_,this.maxDistance=f;let x={radius:1,phi:0,theta:0},y={radius:1,phi:0,theta:0},C={radius:1,phi:0,theta:0},P=new w,E=new w;E.copy(t.position).sub(this.target),C.radius=y.radius=E.distance(),C.theta=y.theta=Math.atan2(E.x,E.z),C.phi=y.phi=Math.acos(Math.min(Math.max(E.y/y.radius,-1),1)),this.offset=E,this.update=()=>{l&&(x.theta-=2*Math.PI/60/60*h),y.radius*=x.radius,y.theta+=x.theta,y.phi+=x.phi,y.theta=Math.max(b,Math.min(g,y.theta)),y.phi=Math.max(v,Math.min(m,y.phi)),y.radius=Math.max(this.minDistance,Math.min(this.maxDistance,y.radius)),C.phi+=(y.phi-C.phi)*n,C.theta+=(y.theta-C.theta)*n,C.radius+=(y.radius-C.radius)*n,this.target.add(P);let e=C.radius*Math.sin(Math.max(1e-6,C.phi));E.x=e*Math.sin(C.theta),E.y=C.radius*Math.cos(C.phi),E.z=e*Math.cos(C.theta),t.position.copy(this.target).add(E),t.lookAt(this.target),x.theta*=r,x.phi*=r,P.multiply(r),x.radius=1},this.forcePosition=()=>{E.copy(t.position).sub(this.target),C.radius=y.radius=E.distance(),C.theta=y.theta=Math.atan2(E.x,E.z),C.phi=y.phi=Math.acos(Math.min(Math.max(E.y/y.radius,-1),1)),t.lookAt(this.target)};let k=new K,V=new K,M=new K,L=q.NONE;function A(){return Math.pow(.95,d)}this.mouseButtons={ORBIT:0,ZOOM:1,PAN:2};let S=(i,s)=>{var n,r,a,o;$.copy(t.position).sub(this.target);let l=$.distance();l*=Math.tan((t.fov||45)/2*Math.PI/180),n=2*i*l/e.clientHeight,r=t.matrix,$.set(r[0],r[1],r[2]),$.multiply(-n),P.add($),a=2*s*l/e.clientHeight,o=t.matrix,$.set(o[4],o[5],o[6]),$.multiply(a),P.add($)};function D(t){x.radius/=t}function O(t,i){G.set(t,i),H.sub(G,k).multiply(o),x.theta-=2*Math.PI*H.x/e.clientHeight,x.phi-=2*Math.PI*H.y/e.clientHeight,k.copy(G)}function j(t,e){G.set(t,e),H.sub(G,V).multiply(c),S(H.x,H.y),V.copy(G)}let T=t=>{if(this.enabled){switch(t.button){case this.mouseButtons.ORBIT:if(!1===a)return;k.set(t.clientX,t.clientY),L=q.ROTATE;break;case this.mouseButtons.ZOOM:if(!1===p)return;M.set(t.clientX,t.clientY),L=q.DOLLY;break;case this.mouseButtons.PAN:if(!1===u)return;V.set(t.clientX,t.clientY),L=q.PAN}L!==q.NONE&&(window.addEventListener("mousemove",R,!1),window.addEventListener("mouseup",N,!1))}},R=t=>{if(this.enabled)switch(L){case q.ROTATE:if(!1===a)return;O(t.clientX,t.clientY);break;case q.DOLLY:if(!1===p)return;G.set(t.clientX,t.clientY),H.sub(G,M),H.y>0?D(A()):H.y<0&&D(1/A()),M.copy(G);break;case q.PAN:if(!1===u)return;j(t.clientX,t.clientY)}},N=()=>{window.removeEventListener("mousemove",R,!1),window.removeEventListener("mouseup",N,!1),L=q.NONE},z=t=>{this.enabled&&p&&(L===q.NONE||L===q.ROTATE)&&(t.stopPropagation(),t.preventDefault(),t.deltaY<0?D(1/A()):t.deltaY>0&&D(A()))},B=t=>{if(this.enabled)switch(t.preventDefault(),t.touches.length){case 1:if(!1===a)return;k.set(t.touches[0].pageX,t.touches[0].pageY),L=q.ROTATE;break;case 2:if(!1===p&&!1===u)return;!function(t){if(p){let e=t.touches[0].pageX-t.touches[1].pageX,i=t.touches[0].pageY-t.touches[1].pageY;M.set(0,Math.sqrt(e*e+i*i))}if(u){let e=.5*(t.touches[0].pageX+t.touches[1].pageX),i=.5*(t.touches[0].pageY+t.touches[1].pageY);V.set(e,i)}}(t),L=q.DOLLY_PAN;break;default:L=q.NONE}},F=t=>{if(this.enabled)switch(t.preventDefault(),t.stopPropagation(),t.touches.length){case 1:if(!1===a)return;O(t.touches[0].pageX,t.touches[0].pageY);break;case 2:if(!1===p&&!1===u)return;!function(t){if(p){let e=t.touches[0].pageX-t.touches[1].pageX,i=t.touches[0].pageY-t.touches[1].pageY;G.set(0,Math.sqrt(e*e+i*i)),H.set(0,Math.pow(G.y/M.y,d)),D(H.y),M.copy(G)}u&&j(.5*(t.touches[0].pageX+t.touches[1].pageX),.5*(t.touches[0].pageY+t.touches[1].pageY))}(t);break;default:L=q.NONE}},I=()=>{this.enabled&&(L=q.NONE)},U=t=>{this.enabled&&t.preventDefault()};this.remove=function(){e.removeEventListener("contextmenu",U),e.removeEventListener("mousedown",T),e.removeEventListener("wheel",z),e.removeEventListener("touchstart",B),e.removeEventListener("touchend",I),e.removeEventListener("touchmove",F),window.removeEventListener("mousemove",R),window.removeEventListener("mouseup",N)},e.addEventListener("contextmenu",U,!1),e.addEventListener("mousedown",T,!1),e.addEventListener("wheel",z,{passive:!1}),e.addEventListener("touchstart",B,{passive:!1}),e.addEventListener("touchend",I,!1),e.addEventListener("touchmove",F,{passive:!1})}let X=1;const W={};class Z{constructor(t,{vertex:e,fragment:i,uniforms:s={},transparent:n=!1,cullFace:r=t.BACK,frontFace:a=t.CCW,depthTest:o=!0,depthWrite:l=!0,depthFunc:h=t.LESS}={}){t.canvas||console.error("gl not passed as fist argument to Program"),this.gl=t,this.uniforms=s,this.id=X++,e||console.warn("vertex shader not supplied"),i||console.warn("fragment shader not supplied"),this.transparent=n,this.cullFace=r,this.frontFace=a,this.depthTest=o,this.depthWrite=l,this.depthFunc=h,this.blendFunc={},this.blendEquation={},this.transparent&&!this.blendFunc.src&&(this.gl.renderer.premultipliedAlpha?this.setBlendFunc(this.gl.ONE,this.gl.ONE_MINUS_SRC_ALPHA):this.setBlendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA));let p=t.createShader(t.VERTEX_SHADER);t.shaderSource(p,e),t.compileShader(p),""!==t.getShaderInfoLog(p)&&console.warn(`${t.getShaderInfoLog(p)}
Vertex Shader
${J(e)}`);let d=t.createShader(t.FRAGMENT_SHADER);if(t.shaderSource(d,i),t.compileShader(d),""!==t.getShaderInfoLog(d)&&console.warn(`${t.getShaderInfoLog(d)}
Fragment Shader
${J(i)}`),this.program=t.createProgram(),t.attachShader(this.program,p),t.attachShader(this.program,d),t.linkProgram(this.program),!t.getProgramParameter(this.program,t.LINK_STATUS)){console.warn(t.getProgramInfoLog(this.program));return}t.deleteShader(p),t.deleteShader(d),this.uniformLocations=new Map;let u=t.getProgramParameter(this.program,t.ACTIVE_UNIFORMS);for(let e=0;e<u;e++){let i=t.getActiveUniform(this.program,e);this.uniformLocations.set(i,t.getUniformLocation(this.program,i.name));let s=i.name.match(/(\w+)/g);i.uniformName=s[0],3===s.length?(i.isStructArray=!0,i.structIndex=Number(s[1]),i.structProperty=s[2]):2===s.length&&isNaN(Number(s[1]))&&(i.isStruct=!0,i.structProperty=s[1])}this.attributeLocations=new Map;let c=[],v=t.getProgramParameter(this.program,t.ACTIVE_ATTRIBUTES);for(let e=0;e<v;e++){let i=t.getActiveAttrib(this.program,e),s=t.getAttribLocation(this.program,i.name);c[s]=i.name,this.attributeLocations.set(i,s)}this.attributeOrder=c.join("")}setBlendFunc(t,e,i,s){this.blendFunc.src=t,this.blendFunc.dst=e,this.blendFunc.srcAlpha=i,this.blendFunc.dstAlpha=s,t&&(this.transparent=!0)}setBlendEquation(t,e){this.blendEquation.modeRGB=t,this.blendEquation.modeAlpha=e}applyState(){this.depthTest?this.gl.renderer.enable(this.gl.DEPTH_TEST):this.gl.renderer.disable(this.gl.DEPTH_TEST),this.cullFace?this.gl.renderer.enable(this.gl.CULL_FACE):this.gl.renderer.disable(this.gl.CULL_FACE),this.blendFunc.src?this.gl.renderer.enable(this.gl.BLEND):this.gl.renderer.disable(this.gl.BLEND),this.cullFace&&this.gl.renderer.setCullFace(this.cullFace),this.gl.renderer.setFrontFace(this.frontFace),this.gl.renderer.setDepthMask(this.depthWrite),this.gl.renderer.setDepthFunc(this.depthFunc),this.blendFunc.src&&this.gl.renderer.setBlendFunc(this.blendFunc.src,this.blendFunc.dst,this.blendFunc.srcAlpha,this.blendFunc.dstAlpha),this.gl.renderer.setBlendEquation(this.blendEquation.modeRGB,this.blendEquation.modeAlpha)}use({flipFaces:t=!1}={}){let e=-1;this.gl.renderer.currentProgram!==this.id&&(this.gl.useProgram(this.program),this.gl.renderer.currentProgram=this.id),this.uniformLocations.forEach((t,i)=>{let s=i.uniformName,n=this.uniforms[s];if(i.isStruct&&(n=n[i.structProperty],s+=`.${i.structProperty}`),i.isStructArray&&(n=n[i.structIndex][i.structProperty],s+=`[${i.structIndex}].${i.structProperty}`),!n)return te(`Active uniform ${s} has not been supplied`);if(n&&void 0===n.value)return te(`${s} uniform is missing a value parameter`);if(n.value.texture)return e+=1,n.value.update(e),Q(this.gl,i.type,t,e);if(n.value.length&&n.value[0].texture){let s=[];return n.value.forEach(t=>{e+=1,t.update(e),s.push(e)}),Q(this.gl,i.type,t,s)}Q(this.gl,i.type,t,n.value)}),this.applyState(),t&&this.gl.renderer.setFrontFace(this.frontFace===this.gl.CCW?this.gl.CW:this.gl.CCW)}remove(){this.gl.deleteProgram(this.program)}}function Q(t,e,i,s){s=s.length?function(t){let e=t.length,i=t[0].length;if(void 0===i)return t;let s=e*i,n=W[s];n||(W[s]=n=new Float32Array(s));for(let s=0;s<e;s++)n.set(t[s],s*i);return n}(s):s;let n=t.renderer.state.uniformLocations.get(i);if(s.length){if(void 0===n||n.length!==s.length)t.renderer.state.uniformLocations.set(i,s.slice(0));else{if(function(t,e){if(t.length!==e.length)return!1;for(let i=0,s=t.length;i<s;i++)if(t[i]!==e[i])return!1;return!0}(n,s))return;n.set?n.set(s):function(t,e){for(let i=0,s=t.length;i<s;i++)t[i]=e[i]}(n,s),t.renderer.state.uniformLocations.set(i,n)}}else{if(n===s)return;t.renderer.state.uniformLocations.set(i,s)}switch(e){case 5126:return s.length?t.uniform1fv(i,s):t.uniform1f(i,s);case 35664:return t.uniform2fv(i,s);case 35665:return t.uniform3fv(i,s);case 35666:return t.uniform4fv(i,s);case 35670:case 5124:case 35678:case 35680:return s.length?t.uniform1iv(i,s):t.uniform1i(i,s);case 35671:case 35667:return t.uniform2iv(i,s);case 35672:case 35668:return t.uniform3iv(i,s);case 35673:case 35669:return t.uniform4iv(i,s);case 35674:return t.uniformMatrix2fv(i,!1,s);case 35675:return t.uniformMatrix3fv(i,!1,s);case 35676:return t.uniformMatrix4fv(i,!1,s)}}function J(t){let e=t.split("\n");for(let t=0;t<e.length;t++)e[t]=t+1+": "+e[t];return e.join("\n")}let tt=0;function te(t){!(tt>100)&&(console.warn(t),++tt>100&&console.warn("More than 100 program warnings - stopping logs."))}const ti=new w;let ts=1;class tn{constructor({canvas:t=document.createElement("canvas"),width:e=300,height:i=150,dpr:s=1,alpha:n=!1,depth:r=!0,stencil:a=!1,antialias:o=!1,premultipliedAlpha:l=!1,preserveDrawingBuffer:h=!1,powerPreference:p="default",autoClear:d=!0,webgl:u=2}={}){let c={alpha:n,depth:r,stencil:a,antialias:o,premultipliedAlpha:l,preserveDrawingBuffer:h,powerPreference:p};this.dpr=s,this.alpha=n,this.color=!0,this.depth=r,this.stencil=a,this.premultipliedAlpha=l,this.autoClear=d,this._id=ts++,2===u&&(this.gl=t.getContext("webgl2",c)),this.isWebgl2=!!this.gl,this.gl||(this.gl=t.getContext("webgl",c)||t.getContext("experimental-webgl",c)),this.gl||console.error("unable to create webgl context"),this.gl.renderer=this,this.setSize(e,i),this.state={},this.state.blendFunc={src:this.gl.ONE,dst:this.gl.ZERO},this.state.blendEquation={modeRGB:this.gl.FUNC_ADD},this.state.cullFace=null,this.state.frontFace=this.gl.CCW,this.state.depthMask=!0,this.state.depthFunc=this.gl.LESS,this.state.premultiplyAlpha=!1,this.state.flipY=!1,this.state.unpackAlignment=4,this.state.framebuffer=null,this.state.viewport={width:null,height:null},this.state.textureUnits=[],this.state.activeTextureUnit=0,this.state.boundBuffer=null,this.state.uniformLocations=new Map,this.extensions={},this.isWebgl2?(this.getExtension("EXT_color_buffer_float"),this.getExtension("OES_texture_float_linear")):(this.getExtension("OES_texture_float"),this.getExtension("OES_texture_float_linear"),this.getExtension("OES_texture_half_float"),this.getExtension("OES_texture_half_float_linear"),this.getExtension("OES_element_index_uint"),this.getExtension("OES_standard_derivatives"),this.getExtension("EXT_sRGB"),this.getExtension("WEBGL_depth_texture"),this.getExtension("WEBGL_draw_buffers")),this.vertexAttribDivisor=this.getExtension("ANGLE_instanced_arrays","vertexAttribDivisor","vertexAttribDivisorANGLE"),this.drawArraysInstanced=this.getExtension("ANGLE_instanced_arrays","drawArraysInstanced","drawArraysInstancedANGLE"),this.drawElementsInstanced=this.getExtension("ANGLE_instanced_arrays","drawElementsInstanced","drawElementsInstancedANGLE"),this.createVertexArray=this.getExtension("OES_vertex_array_object","createVertexArray","createVertexArrayOES"),this.bindVertexArray=this.getExtension("OES_vertex_array_object","bindVertexArray","bindVertexArrayOES"),this.deleteVertexArray=this.getExtension("OES_vertex_array_object","deleteVertexArray","deleteVertexArrayOES"),this.drawBuffers=this.getExtension("WEBGL_draw_buffers","drawBuffers","drawBuffersWEBGL"),this.parameters={},this.parameters.maxTextureUnits=this.gl.getParameter(this.gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS),this.parameters.maxAnisotropy=this.getExtension("EXT_texture_filter_anisotropic")?this.gl.getParameter(this.getExtension("EXT_texture_filter_anisotropic").MAX_TEXTURE_MAX_ANISOTROPY_EXT):0}get id(){return this._id}setSize(t,e){this.width=t,this.height=e,this.gl.canvas.width=t*this.dpr,this.gl.canvas.height=e*this.dpr,Object.assign(this.gl.canvas.style,{width:t+"px",height:e+"px"})}setViewport(t,e){(this.state.viewport.width!==t||this.state.viewport.height!==e)&&(this.state.viewport.width=t,this.state.viewport.height=e,this.gl.viewport(0,0,t,e))}enable(t){!0!==this.state[t]&&(this.gl.enable(t),this.state[t]=!0)}disable(t){!1!==this.state[t]&&(this.gl.disable(t),this.state[t]=!1)}setBlendFunc(t,e,i,s){(this.state.blendFunc.src!==t||this.state.blendFunc.dst!==e||this.state.blendFunc.srcAlpha!==i||this.state.blendFunc.dstAlpha!==s)&&(this.state.blendFunc.src=t,this.state.blendFunc.dst=e,this.state.blendFunc.srcAlpha=i,this.state.blendFunc.dstAlpha=s,void 0!==i?this.gl.blendFuncSeparate(t,e,i,s):this.gl.blendFunc(t,e))}setBlendEquation(t,e){t=t||this.gl.FUNC_ADD,(this.state.blendEquation.modeRGB!==t||this.state.blendEquation.modeAlpha!==e)&&(this.state.blendEquation.modeRGB=t,this.state.blendEquation.modeAlpha=e,void 0!==e?this.gl.blendEquationSeparate(t,e):this.gl.blendEquation(t))}setCullFace(t){this.state.cullFace!==t&&(this.state.cullFace=t,this.gl.cullFace(t))}setFrontFace(t){this.state.frontFace!==t&&(this.state.frontFace=t,this.gl.frontFace(t))}setDepthMask(t){this.state.depthMask!==t&&(this.state.depthMask=t,this.gl.depthMask(t))}setDepthFunc(t){this.state.depthFunc!==t&&(this.state.depthFunc=t,this.gl.depthFunc(t))}activeTexture(t){this.state.activeTextureUnit!==t&&(this.state.activeTextureUnit=t,this.gl.activeTexture(this.gl.TEXTURE0+t))}bindFramebuffer({target:t=this.gl.FRAMEBUFFER,buffer:e=null}={}){this.state.framebuffer!==e&&(this.state.framebuffer=e,this.gl.bindFramebuffer(t,e))}getExtension(t,e,i){return e&&this.gl[e]?this.gl[e].bind(this.gl):(this.extensions[t]||(this.extensions[t]=this.gl.getExtension(t)),e)?this.extensions[t]?this.extensions[t][i].bind(this.extensions[t]):null:this.extensions[t]}sortOpaque(t,e){return t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.program.id!==e.program.id?t.program.id-e.program.id:t.zDepth!==e.zDepth?t.zDepth-e.zDepth:e.id-t.id}sortTransparent(t,e){return t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.zDepth!==e.zDepth?e.zDepth-t.zDepth:e.id-t.id}sortUI(t,e){return t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.program.id!==e.program.id?t.program.id-e.program.id:e.id-t.id}getRenderList({scene:t,camera:e,frustumCull:i,sort:s}){let n=[];if(e&&i&&e.updateFrustum(),t.traverse(t=>{if(!t.visible)return!0;if(g(t)){if(i&&t.frustumCulled&&e&&!e.frustumIntersectsMesh(t))return;n.push(t)}}),s){let t=[],i=[],s=[];n.forEach(n=>{n.program.transparent?n.program.depthTest?i.push(n):s.push(n):t.push(n),n.zDepth=0,0===n.renderOrder&&n.program.depthTest&&e&&(n.worldMatrix.getTranslation(ti),ti.applyMatrix4(e.projectionViewMatrix),n.zDepth=ti.z)}),t.sort(this.sortOpaque),i.sort(this.sortTransparent),s.sort(this.sortUI),n=t.concat(i,s)}return n}render({scene:t,camera:e,target:i=null,update:s=!0,sort:n=!0,frustumCull:r=!0,clear:a}){null===i?(this.bindFramebuffer(),this.setViewport(this.width*this.dpr,this.height*this.dpr)):(this.bindFramebuffer(i),this.setViewport(i.width,i.height)),(a||this.autoClear&&!1!==a)&&(this.depth&&(!i||i.depth)&&(this.enable(this.gl.DEPTH_TEST),this.setDepthMask(!0)),this.gl.clear((this.color?this.gl.COLOR_BUFFER_BIT:0)|(this.depth?this.gl.DEPTH_BUFFER_BIT:0)|(this.stencil?this.gl.STENCIL_BUFFER_BIT:0))),s&&t.updateMatrixWorld(),e&&e.updateMatrixWorld(),this.getRenderList({scene:t,camera:e,frustumCull:r,sort:n}).forEach(t=>{t.draw({camera:e})})}}const tr=new Uint8Array(4);let ta=1;const to=t=>!0===t.isCompressedTexture;class tl{constructor(t,{image:e,target:i=t.TEXTURE_2D,type:s=t.UNSIGNED_BYTE,format:n=t.RGBA,internalFormat:r=n,wrapS:a=t.CLAMP_TO_EDGE,wrapT:o=t.CLAMP_TO_EDGE,generateMipmaps:l=!0,minFilter:h=l?t.NEAREST_MIPMAP_LINEAR:t.LINEAR,magFilter:p=t.LINEAR,premultiplyAlpha:d=!1,unpackAlignment:u=4,flipY:c=i==t.TEXTURE_2D,anisotropy:v=0,level:m=0,width:b,height:g=b}={}){this.gl=t,this.id=ta++,this.image=e,this.target=i,this.type=s,this.format=n,this.internalFormat=r,this.minFilter=h,this.magFilter=p,this.wrapS=a,this.wrapT=o,this.generateMipmaps=l,this.premultiplyAlpha=d,this.unpackAlignment=u,this.flipY=c,this.anisotropy=Math.min(v,this.gl.renderer.parameters.maxAnisotropy),this.level=m,this.width=b,this.height=g,this.texture=this.gl.createTexture(),this.store={image:null},this.glState=this.gl.renderer.state,this.state={minFilter:this.gl.NEAREST_MIPMAP_LINEAR,magFilter:this.gl.LINEAR,wrapS:this.gl.REPEAT,wrapT:this.gl.REPEAT,anisotropy:0}}bind(){this.glState.textureUnits[this.glState.activeTextureUnit]!==this.id&&(this.gl.bindTexture(this.target,this.texture),this.glState.textureUnits[this.glState.activeTextureUnit]=this.id)}update(t=0){let e=!(this.image===this.store.image&&!this.needsUpdate);if((e||this.glState.textureUnits[t]!==this.id)&&(this.gl.renderer.activeTexture(t),this.bind()),e){if(this.needsUpdate=!1,this.flipY!==this.glState.flipY&&(this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,this.flipY),this.glState.flipY=this.flipY),this.premultiplyAlpha!==this.glState.premultiplyAlpha&&(this.gl.pixelStorei(this.gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.premultiplyAlpha),this.glState.premultiplyAlpha=this.premultiplyAlpha),this.unpackAlignment!==this.glState.unpackAlignment&&(this.gl.pixelStorei(this.gl.UNPACK_ALIGNMENT,this.unpackAlignment),this.glState.unpackAlignment=this.unpackAlignment),this.minFilter!==this.state.minFilter&&(this.gl.texParameteri(this.target,this.gl.TEXTURE_MIN_FILTER,this.minFilter),this.state.minFilter=this.minFilter),this.magFilter!==this.state.magFilter&&(this.gl.texParameteri(this.target,this.gl.TEXTURE_MAG_FILTER,this.magFilter),this.state.magFilter=this.magFilter),this.wrapS!==this.state.wrapS&&(this.gl.texParameteri(this.target,this.gl.TEXTURE_WRAP_S,this.wrapS),this.state.wrapS=this.wrapS),this.wrapT!==this.state.wrapT&&(this.gl.texParameteri(this.target,this.gl.TEXTURE_WRAP_T,this.wrapT),this.state.wrapT=this.wrapT),this.anisotropy&&this.anisotropy!==this.state.anisotropy&&(this.gl.texParameterf(this.target,this.gl.renderer.getExtension("EXT_texture_filter_anisotropic").TEXTURE_MAX_ANISOTROPY_EXT,this.anisotropy),this.state.anisotropy=this.anisotropy),this.image){if(this.image.width&&(this.width=this.image.width,this.height=this.image.height),this.target===this.gl.TEXTURE_CUBE_MAP)for(let t=0;t<6;t++)this.gl.texImage2D(this.gl.TEXTURE_CUBE_MAP_POSITIVE_X+t,this.level,this.internalFormat,this.format,this.type,this.image[t]);else if(ArrayBuffer.isView(this.image))this.gl.texImage2D(this.target,this.level,this.internalFormat,this.width,this.height,0,this.format,this.type,this.image);else if(to(this.image)){let t;for(let e=0;e<this.image.length;e++)t=this.image[e],this.gl.compressedTexImage2D(this.target,e,this.internalFormat,t.width,t.height,0,t.data)}else this.gl.texImage2D(this.target,this.level,this.internalFormat,this.format,this.type,this.image);if(this.generateMipmaps){var i,s;this.gl.renderer.isWebgl2||((i=this.image.width)&i-1)==0&&((s=this.image.height)&s-1)==0?this.gl.generateMipmap(this.target):(this.generateMipmaps=!1,this.wrapS=this.wrapT=this.gl.CLAMP_TO_EDGE,this.minFilter=this.gl.LINEAR)}this.onUpdate&&this.onUpdate()}else if(this.target===this.gl.TEXTURE_CUBE_MAP)for(let t=0;t<6;t++)this.gl.texImage2D(this.gl.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,this.gl.RGBA,1,1,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,tr);else this.width?this.gl.texImage2D(this.target,this.level,this.internalFormat,this.width,this.height,0,this.format,this.type,null):this.gl.texImage2D(this.target,0,this.gl.RGBA,1,1,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,tr);this.store.image=this.image}}}var th,tp,td={};td="#define GLSLIFY 1\nattribute vec3 position;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nvarying vec3 pos3;\nuniform float uTime;\n\nuniform float speed; // 0.3\nuniform float noiseForce; // 0.5\nuniform float noiseScale; // 0.3\n\nuniform sampler2D nTex;\nuniform sampler2D nTex2;\n\nvoid main() {\n    pos3 = position;\n\n    vec2 uvNoise = pos3.xy * noiseScale;\n    uvNoise.x += uTime * speed;\n    pos3.z += texture2D(nTex, mod(uvNoise,1.0)).r * noiseForce;\n\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(pos3, 1.0);\n    gl_PointSize = 3.0;\n}";var tu={};tu="precision highp float;\n#define GLSLIFY 1\nuniform float uTime;\nvarying vec3 pos3;\n\nvoid main() {\n    gl_FragColor.rgb = vec3(0.98,0.965,0.941);\n    gl_FragColor.a = 1.0;\n}";var tc={};function tv(t){return null==t}function tm(t){return null!==t&&"object"==typeof t}function tb(t){return null!==t&&"object"==typeof t}function tg(t,e){if(t.length!==e.length)return!1;for(let i=0;i<t.length;i++)if(t[i]!==e[i])return!1;return!0}function tw(t,e){return Array.from(new Set([...Object.keys(t),...Object.keys(e)])).reduce((i,s)=>{let n=t[s],r=e[s];return tb(n)&&tb(r)?Object.assign(Object.assign({},i),{[s]:tw(n,r)}):Object.assign(Object.assign({},i),{[s]:s in e?r:n})},{})}function t_(t){return!!tm(t)&&"target"in t}tc=new URL("T_Noise_03.a6907774.png",import.meta.url).toString();const tf={alreadydisposed:()=>"View has been already disposed",invalidparams:t=>`Invalid parameters for '${t.name}'`,nomatchingcontroller:t=>`No matching controller for '${t.key}'`,nomatchingview:t=>`No matching view for '${JSON.stringify(t.params)}'`,notbindable:()=>"Value is not bindable",notcompatible:t=>`Not compatible with  plugin '${t.id}'`,propertynotfound:t=>`Property '${t.name}' not found`,shouldneverhappen:()=>"This error should never happen"};class tx{static alreadyDisposed(){return new tx({type:"alreadydisposed"})}static notBindable(){return new tx({type:"notbindable"})}static notCompatible(t,e){return new tx({type:"notcompatible",context:{id:`${t}.${e}`}})}static propertyNotFound(t){return new tx({type:"propertynotfound",context:{name:t}})}static shouldNeverHappen(){return new tx({type:"shouldneverhappen"})}constructor(t){var e;this.message=null!==(e=tf[t.type](t.context))&&void 0!==e?e:"Unexpected error",this.name=this.constructor.name,this.stack=Error(this.message).stack,this.type=t.type}toString(){return this.message}}class ty{constructor(t,e){this.obj_=t,this.key=e}static isBindable(t){return null!==t&&("object"==typeof t||"function"==typeof t)}read(){return this.obj_[this.key]}write(t){this.obj_[this.key]=t}writeProperty(t,e){let i=this.read();if(!ty.isBindable(i))throw tx.notBindable();if(!(t in i))throw tx.propertyNotFound(t);i[t]=e}}class tC{constructor(){this.observers_={}}on(t,e,i){var s;let n=this.observers_[t];return n||(n=this.observers_[t]=[]),n.push({handler:e,key:null!==(s=null==i?void 0:i.key)&&void 0!==s?s:e}),this}off(t,e){let i=this.observers_[t];return i&&(this.observers_[t]=i.filter(t=>t.key!==e)),this}emit(t,e){let i=this.observers_[t];i&&i.forEach(t=>{t.handler(e)})}}class tP{constructor(t,e){var i;this.constraint_=null==e?void 0:e.constraint,this.equals_=null!==(i=null==e?void 0:e.equals)&&void 0!==i?i:(t,e)=>t===e,this.emitter=new tC,this.rawValue_=t}get constraint(){return this.constraint_}get rawValue(){return this.rawValue_}set rawValue(t){this.setRawValue(t,{forceEmit:!1,last:!0})}setRawValue(t,e){let i=null!=e?e:{forceEmit:!1,last:!0},s=this.constraint_?this.constraint_.constrain(t):t,n=this.rawValue_;(!this.equals_(n,s)||i.forceEmit)&&(this.emitter.emit("beforechange",{sender:this}),this.rawValue_=s,this.emitter.emit("change",{options:i,previousRawValue:n,rawValue:s,sender:this}))}}class tE{constructor(t){this.emitter=new tC,this.value_=t}get rawValue(){return this.value_}set rawValue(t){this.setRawValue(t,{forceEmit:!1,last:!0})}setRawValue(t,e){let i=null!=e?e:{forceEmit:!1,last:!0},s=this.value_;(s!==t||i.forceEmit)&&(this.emitter.emit("beforechange",{sender:this}),this.value_=t,this.emitter.emit("change",{options:i,previousRawValue:s,rawValue:this.value_,sender:this}))}}class tk{constructor(t){this.emitter=new tC,this.onValueBeforeChange_=this.onValueBeforeChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.value_=t,this.value_.emitter.on("beforechange",this.onValueBeforeChange_),this.value_.emitter.on("change",this.onValueChange_)}get rawValue(){return this.value_.rawValue}onValueBeforeChange_(t){this.emitter.emit("beforechange",Object.assign(Object.assign({},t),{sender:this}))}onValueChange_(t){this.emitter.emit("change",Object.assign(Object.assign({},t),{sender:this}))}}function tV(t,e){let i=null==e?void 0:e.constraint,s=null==e?void 0:e.equals;return i||s?new tP(t,e):new tE(t)}class tM{constructor(t){for(let e in this.emitter=new tC,this.valMap_=t,this.valMap_)this.valMap_[e].emitter.on("change",()=>{this.emitter.emit("change",{key:e,sender:this})})}static createCore(t){return Object.keys(t).reduce((e,i)=>Object.assign(e,{[i]:tV(t[i])}),{})}static fromObject(t){return new tM(this.createCore(t))}get(t){return this.valMap_[t].rawValue}set(t,e){this.valMap_[t].rawValue=e}value(t){return this.valMap_[t]}}class tL{constructor(t){this.values=tM.fromObject({max:t.max,min:t.min})}constrain(t){let e=this.values.get("max");return Math.min(Math.max(t,this.values.get("min")),e)}}class tA{constructor(t){this.values=tM.fromObject({max:t.max,min:t.min})}constrain(t){let e=this.values.get("max"),i=this.values.get("min"),s=t;return tv(i)||(s=Math.max(s,i)),tv(e)||(s=Math.min(s,e)),s}}class tS{constructor(t,e=0){this.step=t,this.origin=e}constrain(t){let e=this.origin%this.step,i=Math.round((t-e)/this.step);return e+i*this.step}}class tD{constructor(t){this.text=t}evaluate(){return Number(this.text)}toString(){return this.text}}const tO={"**":(t,e)=>Math.pow(t,e),"*":(t,e)=>t*e,"/":(t,e)=>t/e,"%":(t,e)=>t%e,"+":(t,e)=>t+e,"-":(t,e)=>t-e,"<<":(t,e)=>t<<e,">>":(t,e)=>t>>e,">>>":(t,e)=>t>>>e,"&":(t,e)=>t&e,"^":(t,e)=>t^e,"|":(t,e)=>t|e};class tj{constructor(t,e,i){this.left=e,this.operator=t,this.right=i}evaluate(){let t=tO[this.operator];if(!t)throw Error(`unexpected binary operator: '${this.operator}`);return t(this.left.evaluate(),this.right.evaluate())}toString(){return["b(",this.left.toString(),this.operator,this.right.toString(),")"].join(" ")}}const tT={"+":t=>t,"-":t=>-t,"~":t=>~t};class tR{constructor(t,e){this.operator=t,this.expression=e}evaluate(){let t=tT[this.operator];if(!t)throw Error(`unexpected unary operator: '${this.operator}`);return t(this.expression.evaluate())}toString(){return["u(",this.operator,this.expression.toString(),")"].join(" ")}}function tN(t){return(e,i)=>{for(let s=0;s<t.length;s++){let n=t[s](e,i);if(""!==n)return n}return""}}function tz(t,e){var i;let s=t.substr(e).match(/^\s+/);return null!==(i=s&&s[0])&&void 0!==i?i:""}function tB(t,e){var i;let s=t.substr(e).match(/^[0-9]+/);return null!==(i=s&&s[0])&&void 0!==i?i:""}function tF(t,e){let i=t.substr(e,1);if(e+=1,"e"!==i.toLowerCase())return"";let s=function(t,e){let i=tB(t,e);if(""!==i)return i;let s=t.substr(e,1);if(e+=1,"-"!==s&&"+"!==s)return"";let n=tB(t,e);return""===n?"":s+n}(t,e);return""===s?"":i+s}function tI(t,e){let i=t.substr(e,1);if("0"===i)return i;let s=function(t,e){let i=t.substr(e,1);return i.match(/^[1-9]$/)?i:""}(t,e);return(e+=s.length,""===s)?"":s+tB(t,e)}const tU=tN([function(t,e){let i=tI(t,e);if(e+=i.length,""===i)return"";let s=t.substr(e,1);if(e+=s.length,"."!==s)return"";let n=tB(t,e);return e+=n.length,i+s+n+tF(t,e)},function(t,e){let i=t.substr(e,1);if(e+=i.length,"."!==i)return"";let s=tB(t,e);return(e+=s.length,""===s)?"":i+s+tF(t,e)},function(t,e){let i=tI(t,e);return(e+=i.length,""===i)?"":i+tF(t,e)}]),tK=tN([function(t,e){let i=t.substr(e,2);if(e+=i.length,"0b"!==i.toLowerCase())return"";let s=function(t,e){var i;let s=t.substr(e).match(/^[01]+/);return null!==(i=s&&s[0])&&void 0!==i?i:""}(t,e);return""===s?"":i+s},function(t,e){let i=t.substr(e,2);if(e+=i.length,"0o"!==i.toLowerCase())return"";let s=function(t,e){var i;let s=t.substr(e).match(/^[0-7]+/);return null!==(i=s&&s[0])&&void 0!==i?i:""}(t,e);return""===s?"":i+s},function(t,e){let i=t.substr(e,2);if(e+=i.length,"0x"!==i.toLowerCase())return"";let s=function(t,e){var i;let s=t.substr(e).match(/^[0-9a-f]+/i);return null!==(i=s&&s[0])&&void 0!==i?i:""}(t,e);return""===s?"":i+s}]),tq=tN([tK,tU]),t$=[["**"],["*","/","%"],["+","-"],["<<",">>>",">>"],["&"],["^"],["|"]].reduce((t,e)=>(i,s)=>{let n=t(i,s);if(!n)return null;s=n.cursor;let r=n.evaluable;for(;;){let n=function(t,e,i){i+=tz(e,i).length;let s=t.filter(t=>e.startsWith(t,i))[0];return s?(i+=s.length,{cursor:i+=tz(e,i).length,operator:s}):null}(e,i,s);if(!n)break;let a=t(i,s=n.cursor);if(!a)return null;s=a.cursor,r=new tj(n.operator,r,a.evaluable)}return r?{cursor:s,evaluable:r}:null},function t(e,i){var s,n;let r=null!==(n=function(t,e){let i=tq(t,e);return(e+=i.length,""===i)?null:{evaluable:new tD(i),cursor:e}}(e,s=i))&&void 0!==n?n:function(t,e){let i=t.substr(e,1);if(e+=i.length,"("!==i)return null;let s=tG(t,e);if(!s)return null;e=s.cursor,e+=tz(t,e).length;let n=t.substr(e,1);return(e+=n.length,")"!==n)?null:{evaluable:s.evaluable,cursor:e}}(e,s);if(r)return r;let a=e.substr(i,1);if(i+=a.length,"+"!==a&&"-"!==a&&"~"!==a)return null;let o=t(e,i);return o?{cursor:i=o.cursor,evaluable:new tR(a,o.evaluable)}:null});function tG(t,e){return e+=tz(t,e).length,t$(t,e)}function tH(t){var e;let i=function(t){let e=tG(t,0);return e&&e.cursor+tz(t,e.cursor).length===t.length?e.evaluable:null}(t);return null!==(e=null==i?void 0:i.evaluate())&&void 0!==e?e:null}function tY(t){if("number"==typeof t)return t;if("string"==typeof t){let e=tH(t);if(!tv(e))return e}return 0}function tX(t){return String(t)}function tW(t){return e=>e.toFixed(Math.max(Math.min(t,20),0))}function tZ(t,e,i,s,n){return s+(t-e)/(i-e)*(n-s)}function tQ(t){return String(t.toFixed(10)).split(".")[1].replace(/0+$/,"").length}function tJ(t,e,i){return Math.min(Math.max(t,e),i)}function t0(t){var e;return null!==(e=t.step)&&void 0!==e?e:1}function t1(t,e){var i;let s=Math.abs(null!==(i=t.step)&&void 0!==i?i:e);return 0===s?.1:Math.pow(10,Math.floor(Math.log10(s))-1)}function t2(t,e){return tv(t.step)?null:new tS(t.step,e)}function t5(t){return tv(t.max)||tv(t.min)?tv(t.max)&&tv(t.min)?null:new tA({max:t.max,min:t.min}):new tL({max:t.max,min:t.min})}function t3(t,e){var i,s,n;return{formatter:null!==(i=t.format)&&void 0!==i?i:tW(tv(t.step)?Math.max(tQ(e),2):tQ(t.step)),keyScale:null!==(s=t.keyScale)&&void 0!==s?s:t0(t),pointerScale:null!==(n=t.pointerScale)&&void 0!==n?n:t1(t,e)}}function t4(t){return{format:t.optional.function,keyScale:t.optional.number,max:t.optional.number,min:t.optional.number,pointerScale:t.optional.number,step:t.optional.number}}function t6(t){return{constraint:t.constraint,textProps:tM.fromObject(t3(t.params,t.initialValue))}}class t9{constructor(t){this.controller=t}get element(){return this.controller.view.element}get disabled(){return this.controller.viewProps.get("disabled")}set disabled(t){this.controller.viewProps.set("disabled",t)}get hidden(){return this.controller.viewProps.get("hidden")}set hidden(t){this.controller.viewProps.set("hidden",t)}dispose(){this.controller.viewProps.set("disposed",!0)}importState(t){return this.controller.importState(t)}exportState(){return this.controller.exportState()}}class t8{constructor(t){this.target=t}}class t7 extends t8{constructor(t,e,i){super(t),this.value=e,this.last=null==i||i}}class et extends t8{constructor(t,e){super(t),this.expanded=e}}class ee extends t8{constructor(t,e){super(t),this.index=e}}class ei extends t8{constructor(t,e){super(t),this.native=e}}class es extends t9{constructor(t){super(t),this.onValueChange_=this.onValueChange_.bind(this),this.emitter_=new tC,this.controller.value.emitter.on("change",this.onValueChange_)}get label(){return this.controller.labelController.props.get("label")}set label(t){this.controller.labelController.props.set("label",t)}get key(){return this.controller.value.binding.target.key}get tag(){return this.controller.tag}set tag(t){this.controller.tag=t}on(t,e){let i=e.bind(this);return this.emitter_.on(t,t=>{i(t)},{key:e}),this}off(t,e){return this.emitter_.off(t,e),this}refresh(){this.controller.value.fetch()}onValueChange_(t){let e=this.controller.value;this.emitter_.emit("change",new t7(this,e.binding.target.read(),t.options.last))}}class en{constructor(t,e){this.onValueBeforeChange_=this.onValueBeforeChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.binding=e,this.value_=t,this.value_.emitter.on("beforechange",this.onValueBeforeChange_),this.value_.emitter.on("change",this.onValueChange_),this.emitter=new tC}get rawValue(){return this.value_.rawValue}set rawValue(t){this.value_.rawValue=t}setRawValue(t,e){this.value_.setRawValue(t,e)}fetch(){this.value_.rawValue=this.binding.read()}push(){this.binding.write(this.value_.rawValue)}onValueBeforeChange_(t){this.emitter.emit("beforechange",Object.assign(Object.assign({},t),{sender:this}))}onValueChange_(t){this.push(),this.emitter.emit("change",Object.assign(Object.assign({},t),{sender:this}))}}function er(t){return e=>i=>{if(!e&&void 0===i)return{succeeded:!1,value:void 0};if(e&&void 0===i)return{succeeded:!0,value:void 0};let s=t(i);return void 0!==s?{succeeded:!0,value:s}:{succeeded:!1,value:void 0}}}function ea(t){return{custom:e=>er(e)(t),boolean:er(t=>"boolean"==typeof t?t:void 0)(t),number:er(t=>"number"==typeof t?t:void 0)(t),string:er(t=>"string"==typeof t?t:void 0)(t),function:er(t=>"function"==typeof t?t:void 0)(t),constant:e=>er(t=>t===e?e:void 0)(t),raw:er(t=>t)(t),object:e=>er(t=>{if(null!==t&&"object"==typeof t)return Object.keys(e).reduce((i,s)=>{if(void 0===i)return;let n=(0,e[s])(t[s]);return n.succeeded?Object.assign(Object.assign({},i),{[s]:n.value}):void 0},{})})(t),array:e=>er(t=>{if(Array.isArray(t))return t.reduce((t,i)=>{if(void 0===t)return;let s=e(i);if(s.succeeded&&void 0!==s.value)return[...t,s.value]},[])})(t)}}const eo={optional:ea(!0),required:ea(!1)};function el(t,e){let i=e(eo),s=eo.required.object(i)(t);return s.succeeded?s.value:void 0}function eh(t,e,i,s){if(e&&!e(t))return!1;let n=el(t,i);return!!n&&s(n)}function ep(t,e){var i;return tw(null!==(i=null==t?void 0:t())&&void 0!==i?i:{},e)}function ed(t){return"value"in t}function eu(t){return!!tm(t)&&"binding"in t&&t_(t.binding)}const ec="http://www.w3.org/2000/svg";function ev(t){t.offsetHeight}function em(t){return void 0!==t.ontouchstart}const eb={check:'<path d="M2 8l4 4l8 -8"/>',dropdown:'<path d="M5 7h6l-3 3 z"/>',p2dpad:'<path d="M8 4v8"/><path d="M4 8h8"/><circle cx="12" cy="12" r="1.2"/>'};function eg(t,e){let i=t.createElementNS(ec,"svg");return i.innerHTML=eb[e],i}function ew(t,e,i){t.insertBefore(e,t.children[i])}function e_(t){t.parentElement&&t.parentElement.removeChild(t)}function ef(t){for(;t.children.length>0;)t.removeChild(t.children[0])}function ex(t){return t.relatedTarget?t.relatedTarget:"explicitOriginalTarget"in t?t.explicitOriginalTarget:null}function ey(t,e){t.emitter.on("change",t=>{e(t.rawValue)}),e(t.rawValue)}function eC(t,e,i){ey(t.value(e),i)}function eP(t){return(e,i)=>["tp","-",t,"v",e?`_${e}`:"",i?`-${i}`:""].join("")}const eE=eP("lbl");class ek{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(eE()),e.viewProps.bindClassModifiers(this.element);let i=t.createElement("div");i.classList.add(eE("l")),eC(e.props,"label",e=>{tv(e)?this.element.classList.add(eE(void 0,"nol")):(this.element.classList.remove(eE(void 0,"nol")),function(t){for(;t.childNodes.length>0;)t.removeChild(t.childNodes[0])}(i),i.appendChild(function(t,e){let i=t.createDocumentFragment();return e.split("\n").map(e=>t.createTextNode(e)).forEach((e,s)=>{s>0&&i.appendChild(t.createElement("br")),i.appendChild(e)}),i}(t,e)))}),this.element.appendChild(i),this.labelElement=i;let s=t.createElement("div");s.classList.add(eE("v")),this.element.appendChild(s),this.valueElement=s}}class eV{constructor(t,e){this.props=e.props,this.valueController=e.valueController,this.viewProps=e.valueController.viewProps,this.view=new ek(t,{props:e.props,viewProps:this.viewProps}),this.view.valueElement.appendChild(this.valueController.view.element)}importProps(t){return eh(t,null,t=>({label:t.optional.string}),t=>(this.props.set("label",t.label),!0))}exportProps(){return ep(null,{label:this.props.get("label")})}}const eM=eP(""),eL={veryfirst:"vfst",first:"fst",last:"lst",verylast:"vlst"};class eA{constructor(t){this.parent_=null,this.blade=t.blade,this.view=t.view,this.viewProps=t.viewProps;let e=this.view.element;this.blade.value("positions").emitter.on("change",()=>{["veryfirst","first","last","verylast"].forEach(t=>{e.classList.remove(eM(void 0,eL[t]))}),this.blade.get("positions").forEach(t=>{e.classList.add(eM(void 0,eL[t]))})}),this.viewProps.handleDispose(()=>{e_(e)})}get parent(){return this.parent_}set parent(t){this.parent_=t,this.viewProps.set("parent",this.parent_?this.parent_.viewProps:null)}importState(t){return eh(t,null,t=>({disabled:t.required.boolean,hidden:t.required.boolean}),t=>(this.viewProps.importState(t),!0))}exportState(){return ep(null,Object.assign({},this.viewProps.exportState()))}}class eS extends eA{constructor(t,e){if(e.value!==e.valueController.value)throw tx.shouldNeverHappen();let i=e.valueController.viewProps,s=new eV(t,{blade:e.blade,props:e.props,valueController:e.valueController});super(Object.assign(Object.assign({},e),{view:new ek(t,{props:e.props,viewProps:i}),viewProps:i})),this.labelController=s,this.value=e.value,this.valueController=e.valueController,this.view.valueElement.appendChild(this.valueController.view.element)}importState(t){return eh(t,e=>{var i,s,n;return super.importState(e)&&this.labelController.importProps(e)&&(null===(n=null===(s=(i=this.valueController).importProps)||void 0===s?void 0:s.call(i,t))||void 0===n||n)},t=>({value:t.optional.raw}),t=>(t.value&&(this.value.rawValue=t.value),!0))}exportState(){var t,e,i;return ep(()=>super.exportState(),Object.assign(Object.assign({value:this.value.rawValue},this.labelController.exportProps()),null!==(i=null===(e=(t=this.valueController).exportProps)||void 0===e?void 0:e.call(t))&&void 0!==i?i:{}))}}function eD(t){let e=Object.assign({},t);return delete e.value,e}class eO extends eS{constructor(t,e){super(t,e),this.tag=e.tag}importState(t){return eh(t,e=>super.importState(eD(t)),t=>({tag:t.optional.string}),t=>(this.tag=t.tag,!0))}exportState(){return ep(()=>eD(super.exportState()),{binding:{key:this.value.binding.target.key,value:this.value.binding.target.read()},tag:this.tag})}}class ej extends eO{importState(t){return eh(t,t=>super.importState(t),t=>({binding:t.required.object({value:t.required.raw})}),t=>(this.value.binding.inject(t.binding.value),this.value.fetch(),!0))}}function eT(t,e){for(;t.length<e;)t.push(void 0)}class eR{constructor(t){this.emitter=new tC,this.onTick_=this.onTick_.bind(this),this.onValueBeforeChange_=this.onValueBeforeChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.binding=t.binding,this.value_=tV(function(t){let e=[];return eT(e,t),e}(t.bufferSize)),this.value_.emitter.on("beforechange",this.onValueBeforeChange_),this.value_.emitter.on("change",this.onValueChange_),this.ticker=t.ticker,this.ticker.emitter.on("tick",this.onTick_),this.fetch()}get rawValue(){return this.value_.rawValue}set rawValue(t){this.value_.rawValue=t}setRawValue(t,e){this.value_.setRawValue(t,e)}fetch(){this.value_.rawValue=function(t,e){let i=[...function(t){let e=t.indexOf(void 0);return e<0?t:t.slice(0,e)}(t),e];return i.length>t.length?i.splice(0,i.length-t.length):eT(i,t.length),i}(this.value_.rawValue,this.binding.read())}onTick_(){this.fetch()}onValueBeforeChange_(t){this.emitter.emit("beforechange",Object.assign(Object.assign({},t),{sender:this}))}onValueChange_(t){this.emitter.emit("change",Object.assign(Object.assign({},t),{sender:this}))}}class eN extends eO{exportState(){return ep(()=>super.exportState(),{binding:{readonly:!0}})}}class ez extends t9{get label(){return this.controller.labelController.props.get("label")}set label(t){this.controller.labelController.props.set("label",t)}get title(){var t;return null!==(t=this.controller.buttonController.props.get("title"))&&void 0!==t?t:""}set title(t){this.controller.buttonController.props.set("title",t)}on(t,e){let i=e.bind(this);return this.controller.buttonController.emitter.on(t,t=>{i(new ei(this,t.nativeEvent))}),this}off(t,e){return this.controller.buttonController.emitter.off(t,e),this}}function eB(t,e){return i=>{i?t.classList.add(e):t.classList.remove(e)}}function eF(t,e){ey(t,t=>{e.textContent=null!=t?t:""})}const eI=eP("btn");class eU{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(eI()),e.viewProps.bindClassModifiers(this.element);let i=t.createElement("button");i.classList.add(eI("b")),e.viewProps.bindDisabled(i),this.element.appendChild(i),this.buttonElement=i;let s=t.createElement("div");s.classList.add(eI("t")),eF(e.props.value("title"),s),this.buttonElement.appendChild(s)}}class eK{constructor(t,e){this.emitter=new tC,this.onClick_=this.onClick_.bind(this),this.props=e.props,this.viewProps=e.viewProps,this.view=new eU(t,{props:this.props,viewProps:this.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}importProps(t){return eh(t,null,t=>({title:t.optional.string}),t=>(this.props.set("title",t.title),!0))}exportProps(){return ep(null,{title:this.props.get("title")})}onClick_(t){this.emitter.emit("click",{nativeEvent:t,sender:this})}}class eq extends eA{constructor(t,e){let i=new eK(t,{props:e.buttonProps,viewProps:e.viewProps}),s=new eV(t,{blade:e.blade,props:e.labelProps,valueController:i});super({blade:e.blade,view:s.view,viewProps:e.viewProps}),this.buttonController=i,this.labelController=s}importState(t){return eh(t,t=>super.importState(t)&&this.buttonController.importProps(t)&&this.labelController.importProps(t),()=>({}),()=>!0)}exportState(){return ep(()=>super.exportState(),Object.assign(Object.assign({},this.buttonController.exportProps()),this.labelController.exportProps()))}}class e${constructor(t){let[e,i]=t.split("-"),s=e.split(".");this.major=parseInt(s[0],10),this.minor=parseInt(s[1],10),this.patch=parseInt(s[2],10),this.prerelease=null!=i?i:null}toString(){let t=[this.major,this.minor,this.patch].join(".");return null!==this.prerelease?[t,this.prerelease].join("-"):t}}const eG=new e$("2.0.3");function eH(t){return Object.assign({core:eG},t)}const eY=eH({id:"button",type:"blade",accept(t){let e=el(t,t=>({title:t.required.string,view:t.required.constant("button"),label:t.optional.string}));return e?{params:e}:null},controller:t=>new eq(t.document,{blade:t.blade,buttonProps:tM.fromObject({title:t.params.title}),labelProps:tM.fromObject({label:t.params.label}),viewProps:t.viewProps}),api:t=>t.controller instanceof eq?new ez(t.controller):null});class eX{constructor(t,e){this.onRackValueChange_=this.onRackValueChange_.bind(this),this.controller_=t,this.emitter_=new tC,this.pool_=e,this.controller_.rack.emitter.on("valuechange",this.onRackValueChange_)}get children(){return this.controller_.rack.children.map(t=>this.pool_.createApi(t))}addBinding(t,e,i){let s=null!=i?i:{},n=this.controller_.element.ownerDocument,r=this.pool_.createBinding(n,function(t,e){if(!ty.isBindable(t))throw tx.notBindable();return new ty(t,e)}(t,e),s),a=this.pool_.createBindingApi(r);return this.add(a,s.index)}addFolder(t){return this.addBlade(Object.assign(Object.assign({},t),{view:"folder"}))}addButton(t){return this.addBlade(Object.assign(Object.assign({},t),{view:"button"}))}addTab(t){return this.addBlade(Object.assign(Object.assign({},t),{view:"tab"}))}add(t,e){let i=t.controller;return this.controller_.rack.add(i,e),t}remove(t){this.controller_.rack.remove(t.controller)}addBlade(t){let e=this.controller_.element.ownerDocument,i=this.pool_.createBlade(e,t),s=this.pool_.createApi(i);return this.add(s,t.index)}on(t,e){let i=e.bind(this);return this.emitter_.on(t,t=>{i(t)},{key:e}),this}off(t,e){return this.emitter_.off(t,e),this}refresh(){this.children.forEach(t=>{tm(t)&&"refresh"in t&&"function"==typeof t.refresh&&t.refresh()})}onRackValueChange_(t){let e=t.bladeController,i=this.pool_.createApi(e),s=eu(e.value)?e.value.binding:null;this.emitter_.emit("change",new t7(i,s?s.target.read():e.value.rawValue,t.options.last))}}class eW extends t9{constructor(t,e){super(t),this.rackApi_=new eX(t.rackController,e)}refresh(){this.rackApi_.refresh()}}class eZ extends eA{constructor(t){super({blade:t.blade,view:t.view,viewProps:t.rackController.viewProps}),this.rackController=t.rackController}importState(t){return eh(t,t=>super.importState(t),t=>({children:t.required.array(t.required.raw)}),t=>this.rackController.rack.children.every((e,i)=>e.importState(t.children[i])))}exportState(){return ep(()=>super.exportState(),{children:this.rackController.rack.children.map(t=>t.exportState())})}}function eQ(t){return"rackController"in t}class eJ{constructor(t){this.emitter=new tC,this.items_=[],this.cache_=new Set,this.onSubListAdd_=this.onSubListAdd_.bind(this),this.onSubListRemove_=this.onSubListRemove_.bind(this),this.extract_=t}get items(){return this.items_}allItems(){return Array.from(this.cache_)}find(t){for(let e of this.allItems())if(t(e))return e;return null}includes(t){return this.cache_.has(t)}add(t,e){if(this.includes(t))throw tx.shouldNeverHappen();let i=void 0!==e?e:this.items_.length;this.items_.splice(i,0,t),this.cache_.add(t);let s=this.extract_(t);s&&(s.emitter.on("add",this.onSubListAdd_),s.emitter.on("remove",this.onSubListRemove_),s.allItems().forEach(t=>{this.cache_.add(t)})),this.emitter.emit("add",{index:i,item:t,root:this,target:this})}remove(t){let e=this.items_.indexOf(t);if(e<0)return;this.items_.splice(e,1),this.cache_.delete(t);let i=this.extract_(t);i&&(i.allItems().forEach(t=>{this.cache_.delete(t)}),i.emitter.off("add",this.onSubListAdd_),i.emitter.off("remove",this.onSubListRemove_)),this.emitter.emit("remove",{index:e,item:t,root:this,target:this})}onSubListAdd_(t){this.cache_.add(t.item),this.emitter.emit("add",{index:t.index,item:t.item,root:this,target:t.target})}onSubListRemove_(t){this.cache_.delete(t.item),this.emitter.emit("remove",{index:t.index,item:t.item,root:this,target:t.target})}}function e0(t){return eQ(t)?t.rackController.rack.bcSet_:null}class e1{constructor(t){var e,i;this.emitter=new tC,this.onBladePositionsChange_=this.onBladePositionsChange_.bind(this),this.onSetAdd_=this.onSetAdd_.bind(this),this.onSetRemove_=this.onSetRemove_.bind(this),this.onChildDispose_=this.onChildDispose_.bind(this),this.onChildPositionsChange_=this.onChildPositionsChange_.bind(this),this.onChildValueChange_=this.onChildValueChange_.bind(this),this.onChildViewPropsChange_=this.onChildViewPropsChange_.bind(this),this.onRackLayout_=this.onRackLayout_.bind(this),this.onRackValueChange_=this.onRackValueChange_.bind(this),this.blade_=null!==(e=t.blade)&&void 0!==e?e:null,null===(i=this.blade_)||void 0===i||i.value("positions").emitter.on("change",this.onBladePositionsChange_),this.viewProps=t.viewProps,this.bcSet_=new eJ(e0),this.bcSet_.emitter.on("add",this.onSetAdd_),this.bcSet_.emitter.on("remove",this.onSetRemove_)}get children(){return this.bcSet_.items}add(t,e){var i;null===(i=t.parent)||void 0===i||i.remove(t),t.parent=this,this.bcSet_.add(t,e)}remove(t){t.parent=null,this.bcSet_.remove(t)}find(t){return this.bcSet_.allItems().filter(t)}onSetAdd_(t){this.updatePositions_();let e=t.target===t.root;if(this.emitter.emit("add",{bladeController:t.item,index:t.index,root:e,sender:this}),!e)return;let i=t.item;if(i.viewProps.emitter.on("change",this.onChildViewPropsChange_),i.blade.value("positions").emitter.on("change",this.onChildPositionsChange_),i.viewProps.handleDispose(this.onChildDispose_),ed(i))i.value.emitter.on("change",this.onChildValueChange_);else if(eQ(i)){let t=i.rackController.rack;if(t){let e=t.emitter;e.on("layout",this.onRackLayout_),e.on("valuechange",this.onRackValueChange_)}}}onSetRemove_(t){this.updatePositions_();let e=t.target===t.root;if(this.emitter.emit("remove",{bladeController:t.item,root:e,sender:this}),!e)return;let i=t.item;if(ed(i))i.value.emitter.off("change",this.onChildValueChange_);else if(eQ(i)){let t=i.rackController.rack;if(t){let e=t.emitter;e.off("layout",this.onRackLayout_),e.off("valuechange",this.onRackValueChange_)}}}updatePositions_(){let t=this.bcSet_.items.filter(t=>!t.viewProps.get("hidden")),e=t[0],i=t[t.length-1];this.bcSet_.items.forEach(t=>{let s=[];t===e&&(s.push("first"),(!this.blade_||this.blade_.get("positions").includes("veryfirst"))&&s.push("veryfirst")),t===i&&(s.push("last"),(!this.blade_||this.blade_.get("positions").includes("verylast"))&&s.push("verylast")),t.blade.set("positions",s)})}onChildPositionsChange_(){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildViewPropsChange_(t){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildDispose_(){this.bcSet_.items.filter(t=>t.viewProps.get("disposed")).forEach(t=>{this.bcSet_.remove(t)})}onChildValueChange_(t){let e=function(t,e){for(let i=0;i<t.length;i++){let s=t[i];if(ed(s)&&s.value===e)return s}return null}(this.find(ed),t.sender);if(!e)throw tx.alreadyDisposed();this.emitter.emit("valuechange",{bladeController:e,options:t.options,sender:this})}onRackLayout_(t){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onRackValueChange_(t){this.emitter.emit("valuechange",{bladeController:t.bladeController,options:t.options,sender:this})}onBladePositionsChange_(){this.updatePositions_()}}class e2{constructor(t){this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this),this.element=t.element,this.viewProps=t.viewProps;let e=new e1({blade:t.root?void 0:t.blade,viewProps:t.viewProps});e.emitter.on("add",this.onRackAdd_),e.emitter.on("remove",this.onRackRemove_),this.rack=e,this.viewProps.handleDispose(()=>{for(let t=this.rack.children.length-1;t>=0;t--)this.rack.children[t].viewProps.set("disposed",!0)})}onRackAdd_(t){t.root&&ew(this.element,t.bladeController.view.element,t.index)}onRackRemove_(t){t.root&&e_(t.bladeController.view.element)}}function e5(){return new tM({positions:tV([],{equals:tg})})}class e3 extends tM{constructor(t){super(t)}static create(t){return new e3(tM.createCore({completed:!0,expanded:t,expandedHeight:null,shouldFixHeight:!1,temporaryExpanded:null}))}get styleExpanded(){var t;return null!==(t=this.get("temporaryExpanded"))&&void 0!==t?t:this.get("expanded")}get styleHeight(){if(!this.styleExpanded)return"0";let t=this.get("expandedHeight");return this.get("shouldFixHeight")&&!tv(t)?`${t}px`:"auto"}bindExpandedClass(t,e){let i=()=>{this.styleExpanded?t.classList.add(e):t.classList.remove(e)};eC(this,"expanded",i),eC(this,"temporaryExpanded",i)}cleanUpTransition(){this.set("shouldFixHeight",!1),this.set("expandedHeight",null),this.set("completed",!0)}}function e4(t,e){e.style.height=t.styleHeight}function e6(t,e){t.value("expanded").emitter.on("beforechange",()=>{if(t.set("completed",!1),tv(t.get("expandedHeight"))){let i;let s=(i=0,function(t,e){let i=t.style.transition;t.style.transition="none",e(),t.style.transition=i}(e,()=>{t.set("expandedHeight",null),t.set("temporaryExpanded",!0),ev(e),i=e.clientHeight,t.set("temporaryExpanded",null),ev(e)}),i);s>0&&t.set("expandedHeight",s)}t.set("shouldFixHeight",!0),ev(e)}),t.emitter.on("change",()=>{e4(t,e)}),e4(t,e),e.addEventListener("transitionend",e=>{"height"===e.propertyName&&t.cleanUpTransition()})}class e9 extends eW{constructor(t,e){super(t,e),this.emitter_=new tC,this.controller.foldable.value("expanded").emitter.on("change",t=>{this.emitter_.emit("fold",new et(this,t.sender.rawValue))}),this.rackApi_.on("change",t=>{this.emitter_.emit("change",t)})}get expanded(){return this.controller.foldable.get("expanded")}set expanded(t){this.controller.foldable.set("expanded",t)}get title(){return this.controller.props.get("title")}set title(t){this.controller.props.set("title",t)}get children(){return this.rackApi_.children}addBinding(t,e,i){return this.rackApi_.addBinding(t,e,i)}addFolder(t){return this.rackApi_.addFolder(t)}addButton(t){return this.rackApi_.addButton(t)}addTab(t){return this.rackApi_.addTab(t)}add(t,e){return this.rackApi_.add(t,e)}remove(t){this.rackApi_.remove(t)}addBlade(t){return this.rackApi_.addBlade(t)}on(t,e){let i=e.bind(this);return this.emitter_.on(t,t=>{i(t)},{key:e}),this}off(t,e){return this.emitter_.off(t,e),this}}const e8=eP("cnt");class e7{constructor(t,e){var i;this.className_=eP(null!==(i=e.viewName)&&void 0!==i?i:"fld"),this.element=t.createElement("div"),this.element.classList.add(this.className_(),e8()),e.viewProps.bindClassModifiers(this.element),this.foldable_=e.foldable,this.foldable_.bindExpandedClass(this.element,this.className_(void 0,"expanded")),eC(this.foldable_,"completed",eB(this.element,this.className_(void 0,"cpl")));let s=t.createElement("button");s.classList.add(this.className_("b")),eC(e.props,"title",t=>{tv(t)?this.element.classList.add(this.className_(void 0,"not")):this.element.classList.remove(this.className_(void 0,"not"))}),e.viewProps.bindDisabled(s),this.element.appendChild(s),this.buttonElement=s;let n=t.createElement("div");n.classList.add(this.className_("i")),this.element.appendChild(n);let r=t.createElement("div");r.classList.add(this.className_("t")),eF(e.props.value("title"),r),this.buttonElement.appendChild(r),this.titleElement=r;let a=t.createElement("div");a.classList.add(this.className_("m")),this.buttonElement.appendChild(a);let o=t.createElement("div");o.classList.add(this.className_("c")),this.element.appendChild(o),this.containerElement=o}}class it extends eZ{constructor(t,e){var i;let s=e3.create(null===(i=e.expanded)||void 0===i||i),n=new e7(t,{foldable:s,props:e.props,viewName:e.root?"rot":void 0,viewProps:e.viewProps});super(Object.assign(Object.assign({},e),{rackController:new e2({blade:e.blade,element:n.containerElement,root:e.root,viewProps:e.viewProps}),view:n})),this.onTitleClick_=this.onTitleClick_.bind(this),this.props=e.props,this.foldable=s,e6(this.foldable,this.view.containerElement),this.rackController.rack.emitter.on("add",()=>{this.foldable.cleanUpTransition()}),this.rackController.rack.emitter.on("remove",()=>{this.foldable.cleanUpTransition()}),this.view.buttonElement.addEventListener("click",this.onTitleClick_)}get document(){return this.view.element.ownerDocument}importState(t){return eh(t,t=>super.importState(t),t=>({expanded:t.required.boolean,title:t.optional.string}),t=>(this.foldable.set("expanded",t.expanded),this.props.set("title",t.title),!0))}exportState(){return ep(()=>super.exportState(),{expanded:this.foldable.get("expanded"),title:this.props.get("title")})}onTitleClick_(){this.foldable.set("expanded",!this.foldable.get("expanded"))}}const ie=eH({id:"folder",type:"blade",accept(t){let e=el(t,t=>({title:t.required.string,view:t.required.constant("folder"),expanded:t.optional.boolean}));return e?{params:e}:null},controller:t=>new it(t.document,{blade:t.blade,expanded:t.params.expanded,props:tM.fromObject({title:t.params.title}),viewProps:t.viewProps}),api:t=>t.controller instanceof it?new e9(t.controller,t.pool):null}),ii=eP("");function is(t,e){return eB(t,ii(void 0,e))}class ir extends tM{constructor(t){var e,i;super(t),this.onDisabledChange_=this.onDisabledChange_.bind(this),this.onParentChange_=this.onParentChange_.bind(this),this.onParentGlobalDisabledChange_=this.onParentGlobalDisabledChange_.bind(this),[this.globalDisabled_,this.setGlobalDisabled_]=[new tk(i=tV(this.getGlobalDisabled_())),(t,e)=>{i.setRawValue(t,e)}],this.value("disabled").emitter.on("change",this.onDisabledChange_),this.value("parent").emitter.on("change",this.onParentChange_),null===(e=this.get("parent"))||void 0===e||e.globalDisabled.emitter.on("change",this.onParentGlobalDisabledChange_)}static create(t){var e,i,s;let n=null!=t?t:{};return new ir(tM.createCore({disabled:null!==(e=n.disabled)&&void 0!==e&&e,disposed:!1,hidden:null!==(i=n.hidden)&&void 0!==i&&i,parent:null!==(s=n.parent)&&void 0!==s?s:null}))}get globalDisabled(){return this.globalDisabled_}bindClassModifiers(t){ey(this.globalDisabled_,is(t,"disabled")),eC(this,"hidden",is(t,"hidden"))}bindDisabled(t){ey(this.globalDisabled_,e=>{t.disabled=e})}bindTabIndex(t){ey(this.globalDisabled_,e=>{t.tabIndex=e?-1:0})}handleDispose(t){this.value("disposed").emitter.on("change",e=>{e&&t()})}importState(t){this.set("disabled",t.disabled),this.set("hidden",t.hidden)}exportState(){return{disabled:this.get("disabled"),hidden:this.get("hidden")}}getGlobalDisabled_(){let t=this.get("parent");return!!t&&t.globalDisabled.rawValue||this.get("disabled")}updateGlobalDisabled_(){this.setGlobalDisabled_(this.getGlobalDisabled_())}onDisabledChange_(){this.updateGlobalDisabled_()}onParentGlobalDisabledChange_(){this.updateGlobalDisabled_()}onParentChange_(t){var e;let i=t.previousRawValue;null==i||i.globalDisabled.emitter.off("change",this.onParentGlobalDisabledChange_),null===(e=this.get("parent"))||void 0===e||e.globalDisabled.emitter.on("change",this.onParentGlobalDisabledChange_),this.updateGlobalDisabled_()}}const ia=eP("tbp");class io{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(ia()),e.viewProps.bindClassModifiers(this.element);let i=t.createElement("div");i.classList.add(ia("c")),this.element.appendChild(i),this.containerElement=i}}const il=eP("tbi");class ih{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(il()),e.viewProps.bindClassModifiers(this.element),eC(e.props,"selected",t=>{t?this.element.classList.add(il(void 0,"sel")):this.element.classList.remove(il(void 0,"sel"))});let i=t.createElement("button");i.classList.add(il("b")),e.viewProps.bindDisabled(i),this.element.appendChild(i),this.buttonElement=i;let s=t.createElement("div");s.classList.add(il("t")),eF(e.props.value("title"),s),this.buttonElement.appendChild(s),this.titleElement=s}}class ip{constructor(t,e){this.emitter=new tC,this.onClick_=this.onClick_.bind(this),this.props=e.props,this.viewProps=e.viewProps,this.view=new ih(t,{props:e.props,viewProps:e.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}onClick_(){this.emitter.emit("click",{sender:this})}}class id extends eZ{constructor(t,e){let i=new io(t,{viewProps:e.viewProps});super(Object.assign(Object.assign({},e),{rackController:new e2({blade:e.blade,element:i.containerElement,viewProps:e.viewProps}),view:i})),this.onItemClick_=this.onItemClick_.bind(this),this.ic_=new ip(t,{props:e.itemProps,viewProps:ir.create()}),this.ic_.emitter.on("click",this.onItemClick_),this.props=e.props,eC(this.props,"selected",t=>{this.itemController.props.set("selected",t),this.viewProps.set("hidden",!t)})}get itemController(){return this.ic_}importState(t){return eh(t,t=>super.importState(t),t=>({selected:t.required.boolean,title:t.required.string}),t=>(this.ic_.props.set("selected",t.selected),this.ic_.props.set("title",t.title),!0))}exportState(){return ep(()=>super.exportState(),{selected:this.ic_.props.get("selected"),title:this.ic_.props.get("title")})}onItemClick_(){this.props.set("selected",!0)}}class iu extends eW{constructor(t,e){super(t,e),this.emitter_=new tC,this.onSelect_=this.onSelect_.bind(this),this.pool_=e,this.rackApi_.on("change",t=>{this.emitter_.emit("change",t)}),this.controller.tab.selectedIndex.emitter.on("change",this.onSelect_)}get pages(){return this.rackApi_.children}addPage(t){let e=new id(this.controller.view.element.ownerDocument,{blade:e5(),itemProps:tM.fromObject({selected:!1,title:t.title}),props:tM.fromObject({selected:!1}),viewProps:ir.create()}),i=this.pool_.createApi(e);return this.rackApi_.add(i,t.index)}removePage(t){this.rackApi_.remove(this.rackApi_.children[t])}on(t,e){let i=e.bind(this);return this.emitter_.on(t,t=>{i(t)},{key:e}),this}off(t,e){return this.emitter_.off(t,e),this}onSelect_(t){this.emitter_.emit("select",new ee(this,t.rawValue))}}class ic extends eW{get title(){var t;return null!==(t=this.controller.itemController.props.get("title"))&&void 0!==t?t:""}set title(t){this.controller.itemController.props.set("title",t)}get selected(){return this.controller.props.get("selected")}set selected(t){this.controller.props.set("selected",t)}get children(){return this.rackApi_.children}addButton(t){return this.rackApi_.addButton(t)}addFolder(t){return this.rackApi_.addFolder(t)}addTab(t){return this.rackApi_.addTab(t)}add(t,e){this.rackApi_.add(t,e)}remove(t){this.rackApi_.remove(t)}addBinding(t,e,i){return this.rackApi_.addBinding(t,e,i)}addBlade(t){return this.rackApi_.addBlade(t)}}class iv{constructor(){this.onItemSelectedChange_=this.onItemSelectedChange_.bind(this),this.empty=tV(!0),this.selectedIndex=tV(-1),this.items_=[]}add(t,e){let i=null!=e?e:this.items_.length;this.items_.splice(i,0,t),t.emitter.on("change",this.onItemSelectedChange_),this.keepSelection_()}remove(t){let e=this.items_.indexOf(t);e<0||(this.items_.splice(e,1),t.emitter.off("change",this.onItemSelectedChange_),this.keepSelection_())}keepSelection_(){if(0===this.items_.length){this.selectedIndex.rawValue=-1,this.empty.rawValue=!0;return}let t=this.items_.findIndex(t=>t.rawValue);t<0?(this.items_.forEach((t,e)=>{t.rawValue=0===e}),this.selectedIndex.rawValue=0):(this.items_.forEach((e,i)=>{e.rawValue=i===t}),this.selectedIndex.rawValue=t),this.empty.rawValue=!1}onItemSelectedChange_(t){if(t.rawValue){let e=this.items_.findIndex(e=>e===t.sender);this.items_.forEach((t,i)=>{t.rawValue=i===e}),this.selectedIndex.rawValue=e}else this.keepSelection_()}}const im=eP("tab");class ib{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(im(),e8()),e.viewProps.bindClassModifiers(this.element),ey(e.empty,eB(this.element,im(void 0,"nop")));let i=t.createElement("div");i.classList.add(im("t")),this.element.appendChild(i),this.itemsElement=i;let s=t.createElement("div");s.classList.add(im("i")),this.element.appendChild(s);let n=t.createElement("div");n.classList.add(im("c")),this.element.appendChild(n),this.contentsElement=n}}class ig extends eZ{constructor(t,e){let i=new iv,s=new ib(t,{empty:i.empty,viewProps:e.viewProps});super({blade:e.blade,rackController:new e2({blade:e.blade,element:s.contentsElement,viewProps:e.viewProps}),view:s}),this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this);let n=this.rackController.rack;n.emitter.on("add",this.onRackAdd_),n.emitter.on("remove",this.onRackRemove_),this.tab=i}add(t,e){this.rackController.rack.add(t,e)}remove(t){this.rackController.rack.remove(this.rackController.rack.children[t])}onRackAdd_(t){if(!t.root)return;let e=t.bladeController;ew(this.view.itemsElement,e.itemController.view.element,t.index),e.itemController.viewProps.set("parent",this.viewProps),this.tab.add(e.props.value("selected"))}onRackRemove_(t){if(!t.root)return;let e=t.bladeController;e_(e.itemController.view.element),e.itemController.viewProps.set("parent",null),this.tab.remove(e.props.value("selected"))}}const iw=eH({id:"tab",type:"blade",accept(t){let e=el(t,t=>({pages:t.required.array(t.required.object({title:t.required.string})),view:t.required.constant("tab")}));return e&&0!==e.pages.length?{params:e}:null},controller(t){let e=new ig(t.document,{blade:t.blade,viewProps:t.viewProps});return t.params.pages.forEach(i=>{let s=new id(t.document,{blade:e5(),itemProps:tM.fromObject({selected:!1,title:i.title}),props:tM.fromObject({selected:!1}),viewProps:ir.create()});e.add(s)}),e},api:t=>t.controller instanceof ig?new iu(t.controller,t.pool):t.controller instanceof id?new ic(t.controller,t.pool):null});class i_ extends es{get options(){return this.controller.valueController.props.get("options")}set options(t){this.controller.valueController.props.set("options",t)}}class ix{constructor(){this.disabled=!1,this.emitter=new tC}dispose(){}tick(){this.disabled||this.emitter.emit("tick",{sender:this})}}class iy{constructor(t,e){this.disabled_=!1,this.timerId_=null,this.onTick_=this.onTick_.bind(this),this.doc_=t,this.emitter=new tC,this.interval_=e,this.setTimer_()}get disabled(){return this.disabled_}set disabled(t){this.disabled_=t,this.disabled_?this.clearTimer_():this.setTimer_()}dispose(){this.clearTimer_()}clearTimer_(){if(null===this.timerId_)return;let t=this.doc_.defaultView;t&&t.clearInterval(this.timerId_),this.timerId_=null}setTimer_(){if(this.clearTimer_(),this.interval_<=0)return;let t=this.doc_.defaultView;t&&(this.timerId_=t.setInterval(this.onTick_,this.interval_))}onTick_(){this.disabled_||this.emitter.emit("tick",{sender:this})}}class iC{constructor(t){this.constraints=t}constrain(t){return this.constraints.reduce((t,e)=>e.constrain(t),t)}}function iP(t,e){if(t instanceof e)return t;if(t instanceof iC){let i=t.constraints.reduce((t,i)=>t||(i instanceof e?i:null),null);if(i)return i}return null}class iE{constructor(t){this.values=tM.fromObject({options:t})}constrain(t){let e=this.values.get("options");return 0===e.length?t:e.filter(e=>e.value===t).length>0?t:e[0].value}}function ik(t){var e;return Array.isArray(t)?null===(e=el({items:t},t=>({items:t.required.array(t.required.object({text:t.required.string,value:t.required.raw}))})))||void 0===e?void 0:e.items:"object"==typeof t?eo.required.raw(t).value:void 0}function iV(t){if(Array.isArray(t))return t;let e=[];return Object.keys(t).forEach(i=>{e.push({text:i,value:t[i]})}),e}function iM(t){return tv(t)?null:new iE(iV(t))}const iL=eP("lst");class iA{constructor(t,e){this.onValueChange_=this.onValueChange_.bind(this),this.props_=e.props,this.element=t.createElement("div"),this.element.classList.add(iL()),e.viewProps.bindClassModifiers(this.element);let i=t.createElement("select");i.classList.add(iL("s")),e.viewProps.bindDisabled(i),this.element.appendChild(i),this.selectElement=i;let s=t.createElement("div");s.classList.add(iL("m")),s.appendChild(eg(t,"dropdown")),this.element.appendChild(s),e.value.emitter.on("change",this.onValueChange_),this.value_=e.value,eC(this.props_,"options",e=>{ef(this.selectElement),e.forEach(e=>{let i=t.createElement("option");i.textContent=e.text,this.selectElement.appendChild(i)}),this.update_()})}update_(){let t=this.props_.get("options").map(t=>t.value);this.selectElement.selectedIndex=t.indexOf(this.value_.rawValue)}onValueChange_(){this.update_()}}class iS{constructor(t,e){this.onSelectChange_=this.onSelectChange_.bind(this),this.props=e.props,this.value=e.value,this.viewProps=e.viewProps,this.view=new iA(t,{props:this.props,value:this.value,viewProps:this.viewProps}),this.view.selectElement.addEventListener("change",this.onSelectChange_)}onSelectChange_(t){let e=t.currentTarget;this.value.rawValue=this.props.get("options")[e.selectedIndex].value}importProps(t){return eh(t,null,t=>({options:t.required.custom(ik)}),t=>(this.props.set("options",iV(t.options)),!0))}exportProps(){return ep(null,{options:this.props.get("options")})}}const iD=eP("pop");class iO{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(iD()),e.viewProps.bindClassModifiers(this.element),ey(e.shows,eB(this.element,iD(void 0,"v")))}}class ij{constructor(t,e){this.shows=tV(!1),this.viewProps=e.viewProps,this.view=new iO(t,{shows:this.shows,viewProps:this.viewProps})}}const iT=eP("txt");class iR{constructor(t,e){this.onChange_=this.onChange_.bind(this),this.element=t.createElement("div"),this.element.classList.add(iT()),e.viewProps.bindClassModifiers(this.element),this.props_=e.props,this.props_.emitter.on("change",this.onChange_);let i=t.createElement("input");i.classList.add(iT("i")),i.type="text",e.viewProps.bindDisabled(i),this.element.appendChild(i),this.inputElement=i,e.value.emitter.on("change",this.onChange_),this.value_=e.value,this.refresh()}refresh(){let t=this.props_.get("formatter");this.inputElement.value=t(this.value_.rawValue)}onChange_(){this.refresh()}}class iN{constructor(t,e){this.onInputChange_=this.onInputChange_.bind(this),this.parser_=e.parser,this.props=e.props,this.value=e.value,this.viewProps=e.viewProps,this.view=new iR(t,{props:e.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(t){let e=t.currentTarget.value,i=this.parser_(e);tv(i)||(this.value.rawValue=i),this.view.refresh()}}function iz(t){return"false"!==t&&!!t}function iB(t){return String(t)}const iF=tW(0);function iI(t){return iF(t)+"%"}function iU(t){return String(t)}function iK(t){return t}function iq({primary:t,secondary:e,forward:i,backward:s}){let n=!1;function r(t){n||(n=!0,t(),n=!1)}t.emitter.on("change",s=>{r(()=>{e.setRawValue(i(t.rawValue,e.rawValue),s.options)})}),e.emitter.on("change",n=>{r(()=>{t.setRawValue(s(t.rawValue,e.rawValue),n.options)}),r(()=>{e.setRawValue(i(t.rawValue,e.rawValue),n.options)})}),r(()=>{e.setRawValue(i(t.rawValue,e.rawValue),{forceEmit:!1,last:!0})})}function i$(t,e){let i=t*(e.altKey?.1:1)*(e.shiftKey?10:1);return e.upKey?+i:e.downKey?-i:0}function iG(t){return{altKey:t.altKey,downKey:"ArrowDown"===t.key,shiftKey:t.shiftKey,upKey:"ArrowUp"===t.key}}function iH(t){return{altKey:t.altKey,downKey:"ArrowLeft"===t.key,shiftKey:t.shiftKey,upKey:"ArrowRight"===t.key}}function iY(t){return"ArrowUp"===t||"ArrowDown"===t||"ArrowLeft"===t||"ArrowRight"===t}function iX(t,e){var i,s;let n=e.ownerDocument.defaultView,r=e.getBoundingClientRect();return{x:t.pageX-((null!==(i=n&&n.scrollX)&&void 0!==i?i:0)+r.left),y:t.pageY-((null!==(s=n&&n.scrollY)&&void 0!==s?s:0)+r.top)}}class iW{constructor(t){this.lastTouch_=null,this.onDocumentMouseMove_=this.onDocumentMouseMove_.bind(this),this.onDocumentMouseUp_=this.onDocumentMouseUp_.bind(this),this.onMouseDown_=this.onMouseDown_.bind(this),this.onTouchEnd_=this.onTouchEnd_.bind(this),this.onTouchMove_=this.onTouchMove_.bind(this),this.onTouchStart_=this.onTouchStart_.bind(this),this.elem_=t,this.emitter=new tC,t.addEventListener("touchstart",this.onTouchStart_,{passive:!1}),t.addEventListener("touchmove",this.onTouchMove_,{passive:!0}),t.addEventListener("touchend",this.onTouchEnd_),t.addEventListener("mousedown",this.onMouseDown_)}computePosition_(t){let e=this.elem_.getBoundingClientRect();return{bounds:{width:e.width,height:e.height},point:t?{x:t.x,y:t.y}:null}}onMouseDown_(t){var e;t.preventDefault(),null===(e=t.currentTarget)||void 0===e||e.focus();let i=this.elem_.ownerDocument;i.addEventListener("mousemove",this.onDocumentMouseMove_),i.addEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("down",{altKey:t.altKey,data:this.computePosition_(iX(t,this.elem_)),sender:this,shiftKey:t.shiftKey})}onDocumentMouseMove_(t){this.emitter.emit("move",{altKey:t.altKey,data:this.computePosition_(iX(t,this.elem_)),sender:this,shiftKey:t.shiftKey})}onDocumentMouseUp_(t){let e=this.elem_.ownerDocument;e.removeEventListener("mousemove",this.onDocumentMouseMove_),e.removeEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("up",{altKey:t.altKey,data:this.computePosition_(iX(t,this.elem_)),sender:this,shiftKey:t.shiftKey})}onTouchStart_(t){t.preventDefault();let e=t.targetTouches.item(0),i=this.elem_.getBoundingClientRect();this.emitter.emit("down",{altKey:t.altKey,data:this.computePosition_(e?{x:e.clientX-i.left,y:e.clientY-i.top}:void 0),sender:this,shiftKey:t.shiftKey}),this.lastTouch_=e}onTouchMove_(t){let e=t.targetTouches.item(0),i=this.elem_.getBoundingClientRect();this.emitter.emit("move",{altKey:t.altKey,data:this.computePosition_(e?{x:e.clientX-i.left,y:e.clientY-i.top}:void 0),sender:this,shiftKey:t.shiftKey}),this.lastTouch_=e}onTouchEnd_(t){var e;let i=null!==(e=t.targetTouches.item(0))&&void 0!==e?e:this.lastTouch_,s=this.elem_.getBoundingClientRect();this.emitter.emit("up",{altKey:t.altKey,data:this.computePosition_(i?{x:i.clientX-s.left,y:i.clientY-s.top}:void 0),sender:this,shiftKey:t.shiftKey})}}const iZ=eP("txt");class iQ{constructor(t,e){this.onChange_=this.onChange_.bind(this),this.props_=e.props,this.props_.emitter.on("change",this.onChange_),this.element=t.createElement("div"),this.element.classList.add(iZ(),iZ(void 0,"num")),e.arrayPosition&&this.element.classList.add(iZ(void 0,e.arrayPosition)),e.viewProps.bindClassModifiers(this.element);let i=t.createElement("input");i.classList.add(iZ("i")),i.type="text",e.viewProps.bindDisabled(i),this.element.appendChild(i),this.inputElement=i,this.onDraggingChange_=this.onDraggingChange_.bind(this),this.dragging_=e.dragging,this.dragging_.emitter.on("change",this.onDraggingChange_),this.element.classList.add(iZ()),this.inputElement.classList.add(iZ("i"));let s=t.createElement("div");s.classList.add(iZ("k")),this.element.appendChild(s),this.knobElement=s;let n=t.createElementNS(ec,"svg");n.classList.add(iZ("g")),this.knobElement.appendChild(n);let r=t.createElementNS(ec,"path");r.classList.add(iZ("gb")),n.appendChild(r),this.guideBodyElem_=r;let a=t.createElementNS(ec,"path");a.classList.add(iZ("gh")),n.appendChild(a),this.guideHeadElem_=a;let o=t.createElement("div");o.classList.add(eP("tt")()),this.knobElement.appendChild(o),this.tooltipElem_=o,e.value.emitter.on("change",this.onChange_),this.value=e.value,this.refresh()}onDraggingChange_(t){if(null===t.rawValue){this.element.classList.remove(iZ(void 0,"drg"));return}this.element.classList.add(iZ(void 0,"drg"));let e=t.rawValue/this.props_.get("pointerScale"),i=e+(e>0?-1:e<0?1:0),s=tJ(-i,-4,4);this.guideHeadElem_.setAttributeNS(null,"d",`M ${i+s},0 L${i},4 L${i+s},8 M ${e},-1 L${e},9`),this.guideBodyElem_.setAttributeNS(null,"d",`M 0,4 L${e},4`);let n=this.props_.get("formatter");this.tooltipElem_.textContent=n(this.value.rawValue),this.tooltipElem_.style.left=`${e}px`}refresh(){let t=this.props_.get("formatter");this.inputElement.value=t(this.value.rawValue)}onChange_(){this.refresh()}}class iJ{constructor(t,e){var i;this.originRawValue_=0,this.onInputChange_=this.onInputChange_.bind(this),this.onInputKeyDown_=this.onInputKeyDown_.bind(this),this.onInputKeyUp_=this.onInputKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.parser_=e.parser,this.props=e.props,this.sliderProps_=null!==(i=e.sliderProps)&&void 0!==i?i:null,this.value=e.value,this.viewProps=e.viewProps,this.dragging_=tV(null),this.view=new iQ(t,{arrayPosition:e.arrayPosition,dragging:this.dragging_,props:this.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_),this.view.inputElement.addEventListener("keydown",this.onInputKeyDown_),this.view.inputElement.addEventListener("keyup",this.onInputKeyUp_);let s=new iW(this.view.knobElement);s.emitter.on("down",this.onPointerDown_),s.emitter.on("move",this.onPointerMove_),s.emitter.on("up",this.onPointerUp_)}constrainValue_(t){var e,i;let s=null===(e=this.sliderProps_)||void 0===e?void 0:e.get("min"),n=null===(i=this.sliderProps_)||void 0===i?void 0:i.get("max"),r=t;return void 0!==s&&(r=Math.max(r,s)),void 0!==n&&(r=Math.min(r,n)),r}onInputChange_(t){let e=t.currentTarget.value,i=this.parser_(e);tv(i)||(this.value.rawValue=this.constrainValue_(i)),this.view.refresh()}onInputKeyDown_(t){let e=i$(this.props.get("keyScale"),iG(t));0!==e&&this.value.setRawValue(this.constrainValue_(this.value.rawValue+e),{forceEmit:!1,last:!1})}onInputKeyUp_(t){0!==i$(this.props.get("keyScale"),iG(t))&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}onPointerDown_(){this.originRawValue_=this.value.rawValue,this.dragging_.rawValue=0}computeDraggingValue_(t){if(!t.point)return null;let e=t.point.x-t.bounds.width/2;return this.constrainValue_(this.originRawValue_+e*this.props.get("pointerScale"))}onPointerMove_(t){let e=this.computeDraggingValue_(t.data);null!==e&&(this.value.setRawValue(e,{forceEmit:!1,last:!1}),this.dragging_.rawValue=this.value.rawValue-this.originRawValue_)}onPointerUp_(t){let e=this.computeDraggingValue_(t.data);null!==e&&(this.value.setRawValue(e,{forceEmit:!0,last:!0}),this.dragging_.rawValue=null)}}const i0=eP("sld");class i1{constructor(t,e){this.onChange_=this.onChange_.bind(this),this.props_=e.props,this.props_.emitter.on("change",this.onChange_),this.element=t.createElement("div"),this.element.classList.add(i0()),e.viewProps.bindClassModifiers(this.element);let i=t.createElement("div");i.classList.add(i0("t")),e.viewProps.bindTabIndex(i),this.element.appendChild(i),this.trackElement=i;let s=t.createElement("div");s.classList.add(i0("k")),this.trackElement.appendChild(s),this.knobElement=s,e.value.emitter.on("change",this.onChange_),this.value=e.value,this.update_()}update_(){let t=tJ(tZ(this.value.rawValue,this.props_.get("min"),this.props_.get("max"),0,100),0,100);this.knobElement.style.width=`${t}%`}onChange_(){this.update_()}}class i2{constructor(t,e){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDownOrMove_=this.onPointerDownOrMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=e.value,this.viewProps=e.viewProps,this.props=e.props,this.view=new i1(t,{props:this.props,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new iW(this.view.trackElement),this.ptHandler_.emitter.on("down",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("move",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.trackElement.addEventListener("keydown",this.onKeyDown_),this.view.trackElement.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(t,e){t.point&&this.value.setRawValue(tZ(tJ(t.point.x,0,t.bounds.width),0,t.bounds.width,this.props.get("min"),this.props.get("max")),e)}onPointerDownOrMove_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerUp_(t){this.handlePointerEvent_(t.data,{forceEmit:!0,last:!0})}onKeyDown_(t){let e=i$(this.props.get("keyScale"),iH(t));0!==e&&this.value.setRawValue(this.value.rawValue+e,{forceEmit:!1,last:!1})}onKeyUp_(t){0!==i$(this.props.get("keyScale"),iH(t))&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const i5=eP("sldtxt");class i3{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(i5());let i=t.createElement("div");i.classList.add(i5("s")),this.sliderView_=e.sliderView,i.appendChild(this.sliderView_.element),this.element.appendChild(i);let s=t.createElement("div");s.classList.add(i5("t")),this.textView_=e.textView,s.appendChild(this.textView_.element),this.element.appendChild(s)}}class i4{constructor(t,e){this.value=e.value,this.viewProps=e.viewProps,this.sliderC_=new i2(t,{props:e.sliderProps,value:e.value,viewProps:this.viewProps}),this.textC_=new iJ(t,{parser:e.parser,props:e.textProps,sliderProps:e.sliderProps,value:e.value,viewProps:e.viewProps}),this.view=new i3(t,{sliderView:this.sliderC_.view,textView:this.textC_.view})}get sliderController(){return this.sliderC_}get textController(){return this.textC_}importProps(t){return eh(t,null,t=>({max:t.required.number,min:t.required.number}),t=>{let e=this.sliderC_.props;return e.set("max",t.max),e.set("min",t.min),!0})}exportProps(){let t=this.sliderC_.props;return ep(null,{max:t.get("max"),min:t.get("min")})}}function i6(t){return{sliderProps:new tM({keyScale:t.keyScale,max:t.max,min:t.min}),textProps:new tM({formatter:tV(t.formatter),keyScale:t.keyScale,pointerScale:tV(t.pointerScale)})}}const i9="cnt-usz";function i8(t){return t4(t)}function i7(t){if(tb(t))return el(t,i8)}function st(t,e){if(!t)return;let i=[],s=t2(t,e);s&&i.push(s);let n=t5(t);return n&&i.push(n),new iC(i)}function se(t){if("inline"===t||"popup"===t)return t}function si(t,e){t.write(e)}const ss=eP("ckb");class sn{constructor(t,e){this.onValueChange_=this.onValueChange_.bind(this),this.element=t.createElement("div"),this.element.classList.add(ss()),e.viewProps.bindClassModifiers(this.element);let i=t.createElement("label");i.classList.add(ss("l")),this.element.appendChild(i),this.labelElement=i;let s=t.createElement("input");s.classList.add(ss("i")),s.type="checkbox",this.labelElement.appendChild(s),this.inputElement=s,e.viewProps.bindDisabled(this.inputElement);let n=t.createElement("div");n.classList.add(ss("w")),this.labelElement.appendChild(n);let r=eg(t,"check");n.appendChild(r),e.value.emitter.on("change",this.onValueChange_),this.value=e.value,this.update_()}update_(){this.inputElement.checked=this.value.rawValue}onValueChange_(){this.update_()}}class sr{constructor(t,e){this.onInputChange_=this.onInputChange_.bind(this),this.onLabelMouseDown_=this.onLabelMouseDown_.bind(this),this.value=e.value,this.viewProps=e.viewProps,this.view=new sn(t,{value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_),this.view.labelElement.addEventListener("mousedown",this.onLabelMouseDown_)}onInputChange_(t){let e=t.currentTarget;this.value.rawValue=e.checked,t.preventDefault(),t.stopPropagation()}onLabelMouseDown_(t){t.preventDefault()}}const sa=eH({id:"input-bool",type:"input",accept:(t,e)=>{if("boolean"!=typeof t)return null;let i=el(e,t=>({options:t.optional.custom(ik),readonly:t.optional.constant(!1)}));return i?{initialValue:t,params:i}:null},binding:{reader:t=>iz,constraint:t=>(function(t){let e=[],i=iM(t.options);return i&&e.push(i),new iC(e)})(t.params),writer:t=>si},controller:t=>{let e=t.document,i=t.value,s=t.constraint,n=s&&iP(s,iE);return n?new iS(e,{props:new tM({options:n.values.value("options")}),value:i,viewProps:t.viewProps}):new sr(e,{value:i,viewProps:t.viewProps})},api:t=>"boolean"!=typeof t.controller.value.rawValue?null:t.controller.valueController instanceof iS?new i_(t.controller):null}),so=eP("col");class sl{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(so()),e.foldable.bindExpandedClass(this.element,so(void 0,"expanded")),eC(e.foldable,"completed",eB(this.element,so(void 0,"cpl")));let i=t.createElement("div");i.classList.add(so("h")),this.element.appendChild(i);let s=t.createElement("div");s.classList.add(so("s")),i.appendChild(s),this.swatchElement=s;let n=t.createElement("div");if(n.classList.add(so("t")),i.appendChild(n),this.textElement=n,"inline"===e.pickerLayout){let e=t.createElement("div");e.classList.add(so("p")),this.element.appendChild(e),this.pickerElement=e}else this.pickerElement=null}}function sh(t,e,i){let s,n,r;let a=(t%360+360)%360,o=tJ(e/100,0,1),l=tJ(i/100,0,1),h=l*o,p=h*(1-Math.abs(a/60%2-1)),d=l-h;return a>=0&&a<60?[s,n,r]=[h,p,0]:a>=60&&a<120?[s,n,r]=[p,h,0]:a>=120&&a<180?[s,n,r]=[0,h,p]:a>=180&&a<240?[s,n,r]=[0,p,h]:a>=240&&a<300?[s,n,r]=[p,0,h]:[s,n,r]=[h,0,p],[(s+d)*255,(n+d)*255,(r+d)*255]}function sp(t){return[t[0],t[1],t[2]]}function sd(t,e){return[t[0],t[1],t[2],e]}const su={hsl:{hsl:(t,e,i)=>[t,e,i],hsv:function(t,e,i){let s=i+e*(100-Math.abs(2*i-100))/200;return[t,0!==s?e*(100-Math.abs(2*i-100))/s:0,i+e*(100-Math.abs(2*i-100))/200]},rgb:function(t,e,i){let s,n,r;let a=(t%360+360)%360,o=tJ(e/100,0,1),l=tJ(i/100,0,1),h=(1-Math.abs(2*l-1))*o,p=h*(1-Math.abs(a/60%2-1)),d=l-h/2;return a>=0&&a<60?[s,n,r]=[h,p,0]:a>=60&&a<120?[s,n,r]=[p,h,0]:a>=120&&a<180?[s,n,r]=[0,h,p]:a>=180&&a<240?[s,n,r]=[0,p,h]:a>=240&&a<300?[s,n,r]=[p,0,h]:[s,n,r]=[h,0,p],[(s+d)*255,(n+d)*255,(r+d)*255]}},hsv:{hsl:function(t,e,i){let s=100-Math.abs(i*(200-e)/100-100);return[t,0!==s?e*i/s:0,i*(200-e)/200]},hsv:(t,e,i)=>[t,e,i],rgb:sh},rgb:{hsl:function(t,e,i){let s=tJ(t/255,0,1),n=tJ(e/255,0,1),r=tJ(i/255,0,1),a=Math.max(s,n,r),o=Math.min(s,n,r),l=a-o,h=0,p=0;return 0!==l&&(p=l/(1-Math.abs(a+o-1)),h=(h=s===a?(n-r)/l:n===a?2+(r-s)/l:4+(s-n)/l)/6+(h<0?1:0)),[360*h,100*p,(o+a)/2*100]},hsv:function(t,e,i){let s=tJ(t/255,0,1),n=tJ(e/255,0,1),r=tJ(i/255,0,1),a=Math.max(s,n,r),o=a-Math.min(s,n,r);return[0===o?0:a===s?((n-r)/o%6+6)%6*60:a===n?60*((r-s)/o+2):60*((s-n)/o+4),100*(0===a?0:o/a),100*a]},rgb:(t,e,i)=>[t,e,i]}};function sc(t,e){return["float"===e?1:"rgb"===t?255:360,"float"===e?1:"rgb"===t?255:100,"float"===e?1:"rgb"===t?255:100]}function sv(t,e,i){var s,n,r;let a=sc(e,i);return["rgb"===e?tJ(t[0],0,a[0]):(n=t[0])===(r=a[0])?r:(n%r+r)%r,tJ(t[1],0,a[1]),tJ(t[2],0,a[2]),tJ(null!==(s=t[3])&&void 0!==s?s:1,0,1)]}function sm(t,e,i,s){let n=sc(e,i),r=sc(e,s);return t.map((t,e)=>t/n[e]*r[e])}function sb(t,e,i){let s=sm(t,e.mode,e.type,"int");return sm(su[e.mode][i.mode](...s),i.mode,"int",i.type)}class sg{static black(){return new sg([0,0,0],"rgb")}constructor(t,e){this.type="int",this.mode=e,this.comps_=sv(t,e,this.type)}getComponents(t){return sd(sb(sp(this.comps_),{mode:this.mode,type:this.type},{mode:null!=t?t:this.mode,type:this.type}),this.comps_[3])}toRgbaObject(){let t=this.getComponents("rgb");return{r:t[0],g:t[1],b:t[2],a:t[3]}}}const sw=eP("colp");class s_{constructor(t,e){this.alphaViews_=null,this.element=t.createElement("div"),this.element.classList.add(sw()),e.viewProps.bindClassModifiers(this.element);let i=t.createElement("div");i.classList.add(sw("hsv"));let s=t.createElement("div");s.classList.add(sw("sv")),this.svPaletteView_=e.svPaletteView,s.appendChild(this.svPaletteView_.element),i.appendChild(s);let n=t.createElement("div");n.classList.add(sw("h")),this.hPaletteView_=e.hPaletteView,n.appendChild(this.hPaletteView_.element),i.appendChild(n),this.element.appendChild(i);let r=t.createElement("div");if(r.classList.add(sw("rgb")),this.textsView_=e.textsView,r.appendChild(this.textsView_.element),this.element.appendChild(r),e.alphaViews){this.alphaViews_={palette:e.alphaViews.palette,text:e.alphaViews.text};let i=t.createElement("div");i.classList.add(sw("a"));let s=t.createElement("div");s.classList.add(sw("ap")),s.appendChild(this.alphaViews_.palette.element),i.appendChild(s);let n=t.createElement("div");n.classList.add(sw("at")),n.appendChild(this.alphaViews_.text.element),i.appendChild(n),this.element.appendChild(i)}}get allFocusableElements(){let t=[this.svPaletteView_.element,this.hPaletteView_.element,this.textsView_.modeSelectElement,...this.textsView_.inputViews.map(t=>t.inputElement)];return this.alphaViews_&&t.push(this.alphaViews_.palette.element,this.alphaViews_.text.inputElement),t}}function sf(t){return"int"===t?"int":"float"===t?"float":void 0}function sx(t){return el(t,t=>({color:t.optional.object({alpha:t.optional.boolean,type:t.optional.custom(sf)}),expanded:t.optional.boolean,picker:t.optional.custom(se),readonly:t.optional.constant(!1)}))}function sy(t){return t?.1:1}function sC(t){var e;return null===(e=t.color)||void 0===e?void 0:e.type}class sP{constructor(t,e){this.type="float",this.mode=e,this.comps_=sv(t,e,this.type)}getComponents(t){return sd(sb(sp(this.comps_),{mode:this.mode,type:this.type},{mode:null!=t?t:this.mode,type:this.type}),this.comps_[3])}toRgbaObject(){let t=this.getComponents("rgb");return{r:t[0],g:t[1],b:t[2],a:t[3]}}}const sE={int:(t,e)=>new sg(t,e),float:(t,e)=>new sP(t,e)};function sk(t,e){if(t.type===e)return t;if("int"===t.type&&"float"===e)return function(t){let e=t.getComponents(),i=sc(t.mode,"int");return new sP([tZ(e[0],0,i[0],0,1),tZ(e[1],0,i[1],0,1),tZ(e[2],0,i[2],0,1),e[3]],t.mode)}(t);if("float"===t.type&&"int"===e)return function(t){let e=t.getComponents(),i=sc(t.mode,"int");return new sg([Math.round(tZ(e[0],0,1,0,i[0])),Math.round(tZ(e[1],0,1,0,i[1])),Math.round(tZ(e[2],0,1,0,i[2])),e[3]],t.mode)}(t);throw tx.shouldNeverHappen()}function sV(t,e){let i=t.match(/^(.+)%$/);return i?Math.min(.01*parseFloat(i[1])*e,e):Math.min(parseFloat(t),e)}const sM={deg:t=>t,grad:t=>360*t/400,rad:t=>360*t/(2*Math.PI),turn:t=>360*t};function sL(t){let e=t.match(/^([0-9.]+?)(deg|grad|rad|turn)$/);if(!e)return parseFloat(t);let i=parseFloat(e[1]);return sM[e[2]](i)}function sA(t){let e=t.match(/^rgb\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;let i=[sV(e[1],255),sV(e[2],255),sV(e[3],255)];return isNaN(i[0])||isNaN(i[1])||isNaN(i[2])?null:i}function sS(t){let e=sA(t);return e?new sg(e,"rgb"):null}function sD(t){let e=t.match(/^rgba\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;let i=[sV(e[1],255),sV(e[2],255),sV(e[3],255),sV(e[4],1)];return isNaN(i[0])||isNaN(i[1])||isNaN(i[2])||isNaN(i[3])?null:i}function sO(t){let e=sD(t);return e?new sg(e,"rgb"):null}function sj(t){let e=t.match(/^hsl\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;let i=[sL(e[1]),sV(e[2],100),sV(e[3],100)];return isNaN(i[0])||isNaN(i[1])||isNaN(i[2])?null:i}function sT(t){let e=sj(t);return e?new sg(e,"hsl"):null}function sR(t){let e=t.match(/^hsla\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;let i=[sL(e[1]),sV(e[2],100),sV(e[3],100),sV(e[4],1)];return isNaN(i[0])||isNaN(i[1])||isNaN(i[2])||isNaN(i[3])?null:i}function sN(t){let e=sR(t);return e?new sg(e,"hsl"):null}function sz(t){let e=t.match(/^#([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(e)return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16)];let i=t.match(/^(?:#|0x)([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return i?[parseInt(i[1],16),parseInt(i[2],16),parseInt(i[3],16)]:null}function sB(t){let e=sz(t);return e?new sg(e,"rgb"):null}function sF(t){let e=t.match(/^#?([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(e)return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16),tZ(parseInt(e[4]+e[4],16),0,255,0,1)];let i=t.match(/^(?:#|0x)?([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return i?[parseInt(i[1],16),parseInt(i[2],16),parseInt(i[3],16),tZ(parseInt(i[4],16),0,255,0,1)]:null}function sI(t){let e=sF(t);return e?new sg(e,"rgb"):null}function sU(t){let e=t.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!e)return null;let i=[parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3])];return isNaN(i[0])||isNaN(i[1])||isNaN(i[2])?null:i}function sK(t){return e=>{let i=sU(e);return i?sE[t](i,"rgb"):null}}function sq(t){let e=t.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*a\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!e)return null;let i=[parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3]),parseFloat(e[4])];return isNaN(i[0])||isNaN(i[1])||isNaN(i[2])||isNaN(i[3])?null:i}function s$(t){return e=>{let i=sq(e);return i?sE[t](i,"rgb"):null}}const sG=[{parser:sz,result:{alpha:!1,mode:"rgb",notation:"hex"}},{parser:sF,result:{alpha:!0,mode:"rgb",notation:"hex"}},{parser:sA,result:{alpha:!1,mode:"rgb",notation:"func"}},{parser:sD,result:{alpha:!0,mode:"rgb",notation:"func"}},{parser:sj,result:{alpha:!1,mode:"hsl",notation:"func"}},{parser:sR,result:{alpha:!0,mode:"hsl",notation:"func"}},{parser:sU,result:{alpha:!1,mode:"rgb",notation:"object"}},{parser:sq,result:{alpha:!0,mode:"rgb",notation:"object"}}];function sH(t){let e=[sB,sI,sS,sO,sT,sN];"int"===t&&e.push(sK("int"),s$("int")),"float"===t&&e.push(sK("float"),s$("float"));let i=t=>e.reduce((e,i)=>null!==e?e:i(t),null);return e=>{let s=i(e);return s?sk(s,t):null}}function sY(t){let e=sH("int");if("string"!=typeof t)return sg.black();let i=e(t);return null!=i?i:sg.black()}function sX(t){let e=tJ(Math.floor(t),0,255).toString(16);return 1===e.length?`0${e}`:e}function sW(t,e="#"){let i=sp(t.getComponents("rgb")).map(sX).join("");return`${e}${i}`}function sZ(t,e="#"){let i=t.getComponents("rgb"),s=[i[0],i[1],i[2],255*i[3]].map(sX).join("");return`${e}${s}`}function sQ(t){let e=tW(0),i=sp(sk(t,"int").getComponents("rgb")).map(t=>e(t));return`rgb(${i.join(", ")})`}function sJ(t){let e=tW(2),i=tW(0),s=sk(t,"int").getComponents("rgb").map((t,s)=>(3===s?e:i)(t));return`rgba(${s.join(", ")})`}function s0(t,e){let i=tW("float"===e?2:0),s=["r","g","b"],n=sp(sk(t,e).getComponents("rgb")).map((t,e)=>`${s[e]}: ${i(t)}`);return`{${n.join(", ")}}`}function s1(t,e){let i=tW(2),s=tW("float"===e?2:0),n=["r","g","b","a"],r=sk(t,e).getComponents("rgb").map((t,e)=>`${n[e]}: ${(3===e?i:s)(t)}`);return`{${r.join(", ")}}`}const s2=[{format:{alpha:!1,mode:"rgb",notation:"hex",type:"int"},stringifier:sW},{format:{alpha:!0,mode:"rgb",notation:"hex",type:"int"},stringifier:sZ},{format:{alpha:!1,mode:"rgb",notation:"func",type:"int"},stringifier:sQ},{format:{alpha:!0,mode:"rgb",notation:"func",type:"int"},stringifier:sJ},{format:{alpha:!1,mode:"hsl",notation:"func",type:"int"},stringifier:function(t){let e=[tW(0),iI,iI],i=sp(sk(t,"int").getComponents("hsl")).map((t,i)=>e[i](t));return`hsl(${i.join(", ")})`}},{format:{alpha:!0,mode:"hsl",notation:"func",type:"int"},stringifier:function(t){let e=[tW(0),iI,iI,tW(2)],i=sk(t,"int").getComponents("hsl").map((t,i)=>e[i](t));return`hsla(${i.join(", ")})`}},...["int","float"].reduce((t,e)=>[...t,{format:{alpha:!1,mode:"rgb",notation:"object",type:e},stringifier:t=>s0(t,e)},{format:{alpha:!0,mode:"rgb",notation:"object",type:e},stringifier:t=>s1(t,e)}],[])];function s5(t){return s2.reduce((e,i)=>{var s;return e||((s=i.format).alpha===t.alpha&&s.mode===t.mode&&s.notation===t.notation&&s.type===t.type?i.stringifier:null)},null)}const s3=eP("apl");class s4{constructor(t,e){this.onValueChange_=this.onValueChange_.bind(this),this.value=e.value,this.value.emitter.on("change",this.onValueChange_),this.element=t.createElement("div"),this.element.classList.add(s3()),e.viewProps.bindClassModifiers(this.element),e.viewProps.bindTabIndex(this.element);let i=t.createElement("div");i.classList.add(s3("b")),this.element.appendChild(i);let s=t.createElement("div");s.classList.add(s3("c")),i.appendChild(s),this.colorElem_=s;let n=t.createElement("div");n.classList.add(s3("m")),this.element.appendChild(n),this.markerElem_=n;let r=t.createElement("div");r.classList.add(s3("p")),this.markerElem_.appendChild(r),this.previewElem_=r,this.update_()}update_(){let t=this.value.rawValue,e=t.getComponents("rgb"),i=new sg([e[0],e[1],e[2],0],"rgb"),s=new sg([e[0],e[1],e[2],255],"rgb"),n=["to right",sJ(i),sJ(s)];this.colorElem_.style.background=`linear-gradient(${n.join(",")})`,this.previewElem_.style.backgroundColor=sJ(t);let r=tZ(e[3],0,1,0,100);this.markerElem_.style.left=`${r}%`}onValueChange_(){this.update_()}}class s6{constructor(t,e){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=e.value,this.viewProps=e.viewProps,this.view=new s4(t,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new iW(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(t,e){if(!t.point)return;let i=t.point.x/t.bounds.width,[s,n,r]=this.value.rawValue.getComponents("hsv");this.value.setRawValue(new sg([s,n,r,i],"hsv"),e)}onPointerDown_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerMove_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerUp_(t){this.handlePointerEvent_(t.data,{forceEmit:!0,last:!0})}onKeyDown_(t){let e=i$(sy(!0),iH(t));if(0===e)return;let[i,s,n,r]=this.value.rawValue.getComponents("hsv");this.value.setRawValue(new sg([i,s,n,r+e],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(t){0!==i$(sy(!0),iH(t))&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const s9=eP("coltxt");class s8{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(s9()),e.viewProps.bindClassModifiers(this.element);let i=t.createElement("div");i.classList.add(s9("m")),this.modeElem_=function(t){let e=t.createElement("select");return e.appendChild([{text:"RGB",value:"rgb"},{text:"HSL",value:"hsl"},{text:"HSV",value:"hsv"},{text:"HEX",value:"hex"}].reduce((e,i)=>{let s=t.createElement("option");return s.textContent=i.text,s.value=i.value,e.appendChild(s),e},t.createDocumentFragment())),e}(t),this.modeElem_.classList.add(s9("ms")),i.appendChild(this.modeSelectElement),e.viewProps.bindDisabled(this.modeElem_);let s=t.createElement("div");s.classList.add(s9("mm")),s.appendChild(eg(t,"dropdown")),i.appendChild(s),this.element.appendChild(i);let n=t.createElement("div");n.classList.add(s9("w")),this.element.appendChild(n),this.inputsElem_=n,this.inputViews_=e.inputViews,this.applyInputViews_(),ey(e.mode,t=>{this.modeElem_.value=t})}get modeSelectElement(){return this.modeElem_}get inputViews(){return this.inputViews_}set inputViews(t){this.inputViews_=t,this.applyInputViews_()}applyInputViews_(){ef(this.inputsElem_);let t=this.element.ownerDocument;this.inputViews_.forEach(e=>{let i=t.createElement("div");i.classList.add(s9("c")),i.appendChild(e.element),this.inputsElem_.appendChild(i)})}}class s7{constructor(t,e){this.onModeSelectChange_=this.onModeSelectChange_.bind(this),this.colorType_=e.colorType,this.value=e.value,this.viewProps=e.viewProps,this.colorMode=tV(this.value.rawValue.mode),this.ccs_=this.createComponentControllers_(t),this.view=new s8(t,{mode:this.colorMode,inputViews:[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view],viewProps:this.viewProps}),this.view.modeSelectElement.addEventListener("change",this.onModeSelectChange_)}createComponentControllers_(t){let e=this.colorMode.rawValue;return"hex"!==e?function(t,e){let i={colorMode:e.colorMode,colorType:e.colorType,parser:tH,viewProps:e.viewProps};return[0,1,2].map(s=>{var n,r,a;let o=(n=t,r=i,new iJ(n,{arrayPosition:0===(a=s)?"fst":2===a?"lst":"mid",parser:r.parser,props:tM.fromObject({formatter:tW("float"===r.colorType?2:0),keyScale:sy(!1),pointerScale:"float"===r.colorType?.01:1}),value:tV(0,{constraint:new tL({min:0,max:sc(r.colorMode,r.colorType)[a]})}),viewProps:r.viewProps}));return iq({primary:e.value,secondary:o.value,forward:t=>sk(t,e.colorType).getComponents(e.colorMode)[s],backward(t,i){var n;let r=e.colorMode,a=sk(t,e.colorType).getComponents(r);return a[s]=i,sk((n=sd(sp(a),a[3]),sE[e.colorType](n,r)),"int")}}),o})}(t,{colorMode:e,colorType:this.colorType_,value:this.value,viewProps:this.viewProps}):function(t,e){let i=new iN(t,{parser:sH("int"),props:tM.fromObject({formatter:sW}),value:tV(sg.black()),viewProps:e.viewProps});return iq({primary:e.value,secondary:i.value,forward:t=>new sg(sp(t.getComponents()),t.mode),backward:(t,e)=>new sg(sd(sp(e.getComponents(t.mode)),t.getComponents()[3]),t.mode)}),[i]}(t,{value:this.value,viewProps:this.viewProps})}onModeSelectChange_(t){let e=t.currentTarget;this.colorMode.rawValue=e.value,this.ccs_=this.createComponentControllers_(this.view.element.ownerDocument),this.view.inputViews=this.ccs_.map(t=>t.view)}}const nt=eP("hpl");class ne{constructor(t,e){this.onValueChange_=this.onValueChange_.bind(this),this.value=e.value,this.value.emitter.on("change",this.onValueChange_),this.element=t.createElement("div"),this.element.classList.add(nt()),e.viewProps.bindClassModifiers(this.element),e.viewProps.bindTabIndex(this.element);let i=t.createElement("div");i.classList.add(nt("c")),this.element.appendChild(i);let s=t.createElement("div");s.classList.add(nt("m")),this.element.appendChild(s),this.markerElem_=s,this.update_()}update_(){let[t]=this.value.rawValue.getComponents("hsv");this.markerElem_.style.backgroundColor=sQ(new sg([t,100,100],"hsv"));let e=tZ(t,0,360,0,100);this.markerElem_.style.left=`${e}%`}onValueChange_(){this.update_()}}class ni{constructor(t,e){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=e.value,this.viewProps=e.viewProps,this.view=new ne(t,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new iW(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(t,e){if(!t.point)return;let i=tZ(tJ(t.point.x,0,t.bounds.width),0,t.bounds.width,0,360),[,s,n,r]=this.value.rawValue.getComponents("hsv");this.value.setRawValue(new sg([i,s,n,r],"hsv"),e)}onPointerDown_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerMove_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerUp_(t){this.handlePointerEvent_(t.data,{forceEmit:!0,last:!0})}onKeyDown_(t){let e=i$(sy(!1),iH(t));if(0===e)return;let[i,s,n,r]=this.value.rawValue.getComponents("hsv");this.value.setRawValue(new sg([i+e,s,n,r],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(t){0!==i$(sy(!1),iH(t))&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const ns=eP("svp");class nn{constructor(t,e){this.onValueChange_=this.onValueChange_.bind(this),this.value=e.value,this.value.emitter.on("change",this.onValueChange_),this.element=t.createElement("div"),this.element.classList.add(ns()),e.viewProps.bindClassModifiers(this.element),e.viewProps.bindTabIndex(this.element);let i=t.createElement("canvas");i.height=64,i.width=64,i.classList.add(ns("c")),this.element.appendChild(i),this.canvasElement=i;let s=t.createElement("div");s.classList.add(ns("m")),this.element.appendChild(s),this.markerElem_=s,this.update_()}update_(){let t=function(t){let e=t.ownerDocument.defaultView;return e&&"document"in e?t.getContext("2d",{willReadFrequently:!0}):null}(this.canvasElement);if(!t)return;let e=this.value.rawValue.getComponents("hsv"),i=this.canvasElement.width,s=this.canvasElement.height,n=t.getImageData(0,0,i,s),r=n.data;for(let t=0;t<s;t++)for(let n=0;n<i;n++){let a=tZ(n,0,i,0,100),o=tZ(t,0,s,100,0),l=sh(e[0],a,o),h=(t*i+n)*4;r[h]=l[0],r[h+1]=l[1],r[h+2]=l[2],r[h+3]=255}t.putImageData(n,0,0);let a=tZ(e[1],0,100,0,100);this.markerElem_.style.left=`${a}%`;let o=tZ(e[2],0,100,100,0);this.markerElem_.style.top=`${o}%`}onValueChange_(){this.update_()}}class nr{constructor(t,e){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=e.value,this.viewProps=e.viewProps,this.view=new nn(t,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new iW(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(t,e){if(!t.point)return;let i=tZ(t.point.x,0,t.bounds.width,0,100),s=tZ(t.point.y,0,t.bounds.height,100,0),[n,,,r]=this.value.rawValue.getComponents("hsv");this.value.setRawValue(new sg([n,i,s,r],"hsv"),e)}onPointerDown_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerMove_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerUp_(t){this.handlePointerEvent_(t.data,{forceEmit:!0,last:!0})}onKeyDown_(t){iY(t.key)&&t.preventDefault();let[e,i,s,n]=this.value.rawValue.getComponents("hsv"),r=sy(!1),a=i$(r,iH(t)),o=i$(r,iG(t));(0!==a||0!==o)&&this.value.setRawValue(new sg([e,i+a,s+o,n],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(t){let e=sy(!1),i=i$(e,iH(t)),s=i$(e,iG(t));(0!==i||0!==s)&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class na{constructor(t,e){this.value=e.value,this.viewProps=e.viewProps,this.hPaletteC_=new ni(t,{value:this.value,viewProps:this.viewProps}),this.svPaletteC_=new nr(t,{value:this.value,viewProps:this.viewProps}),this.alphaIcs_=e.supportsAlpha?{palette:new s6(t,{value:this.value,viewProps:this.viewProps}),text:new iJ(t,{parser:tH,props:tM.fromObject({pointerScale:.01,keyScale:.1,formatter:tW(2)}),value:tV(0,{constraint:new tL({min:0,max:1})}),viewProps:this.viewProps})}:null,this.alphaIcs_&&iq({primary:this.value,secondary:this.alphaIcs_.text.value,forward:t=>t.getComponents()[3],backward:(t,e)=>{let i=t.getComponents();return i[3]=e,new sg(i,t.mode)}}),this.textsC_=new s7(t,{colorType:e.colorType,value:this.value,viewProps:this.viewProps}),this.view=new s_(t,{alphaViews:this.alphaIcs_?{palette:this.alphaIcs_.palette.view,text:this.alphaIcs_.text.view}:null,hPaletteView:this.hPaletteC_.view,supportsAlpha:e.supportsAlpha,svPaletteView:this.svPaletteC_.view,textsView:this.textsC_.view,viewProps:this.viewProps})}get textsController(){return this.textsC_}}const no=eP("colsw");class nl{constructor(t,e){this.onValueChange_=this.onValueChange_.bind(this),e.value.emitter.on("change",this.onValueChange_),this.value=e.value,this.element=t.createElement("div"),this.element.classList.add(no()),e.viewProps.bindClassModifiers(this.element);let i=t.createElement("div");i.classList.add(no("sw")),this.element.appendChild(i),this.swatchElem_=i;let s=t.createElement("button");s.classList.add(no("b")),e.viewProps.bindDisabled(s),this.element.appendChild(s),this.buttonElement=s,this.update_()}update_(){let t=this.value.rawValue;this.swatchElem_.style.backgroundColor=sZ(t)}onValueChange_(){this.update_()}}class nh{constructor(t,e){this.value=e.value,this.viewProps=e.viewProps,this.view=new nl(t,{value:this.value,viewProps:this.viewProps})}}class np{constructor(t,e){this.onButtonBlur_=this.onButtonBlur_.bind(this),this.onButtonClick_=this.onButtonClick_.bind(this),this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.value=e.value,this.viewProps=e.viewProps,this.foldable_=e3.create(e.expanded),this.swatchC_=new nh(t,{value:this.value,viewProps:this.viewProps});let i=this.swatchC_.view.buttonElement;i.addEventListener("blur",this.onButtonBlur_),i.addEventListener("click",this.onButtonClick_),this.textC_=new iN(t,{parser:e.parser,props:tM.fromObject({formatter:e.formatter}),value:this.value,viewProps:this.viewProps}),this.view=new sl(t,{foldable:this.foldable_,pickerLayout:e.pickerLayout}),this.view.swatchElement.appendChild(this.swatchC_.view.element),this.view.textElement.appendChild(this.textC_.view.element),this.popC_="popup"===e.pickerLayout?new ij(t,{viewProps:this.viewProps}):null;let s=new na(t,{colorType:e.colorType,supportsAlpha:e.supportsAlpha,value:this.value,viewProps:this.viewProps});s.view.allFocusableElements.forEach(t=>{t.addEventListener("blur",this.onPopupChildBlur_),t.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=s,this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(s.view.element),iq({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:t=>t,backward:(t,e)=>e})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),e6(this.foldable_,this.view.pickerElement))}get textController(){return this.textC_}onButtonBlur_(t){if(!this.popC_)return;let e=this.view.element,i=t.relatedTarget;i&&e.contains(i)||(this.popC_.shows.rawValue=!1)}onButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(t){if(!this.popC_)return;let e=this.popC_.view.element,i=ex(t);!(i&&e.contains(i))&&(!i||i!==this.swatchC_.view.buttonElement||em(e.ownerDocument))&&(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(t){this.popC_?"Escape"===t.key&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&"Escape"===t.key&&this.swatchC_.view.buttonElement.focus()}}function nd(t){return sp(t.getComponents("rgb")).reduce((t,e)=>t<<8|255&Math.floor(e),0)}function nu(t){return t.getComponents("rgb").reduce((t,e,i)=>t<<8|255&Math.floor(3===i?255*e:e),0)>>>0}function nc(t){return"number"!=typeof t?sg.black():new sg([t>>16&255,t>>8&255,255&t],"rgb")}function nv(t){return"number"!=typeof t?sg.black():new sg([t>>24&255,t>>16&255,t>>8&255,tZ(255&t,0,255,0,1)],"rgb")}function nm(t,e){return!("object"!=typeof t||tv(t))&&e in t&&"number"==typeof t[e]}function nb(t){return nm(t,"r")&&nm(t,"g")&&nm(t,"b")}function ng(t){return nb(t)&&nm(t,"a")}function nw(t,e){if(t.mode!==e.mode||t.type!==e.type)return!1;let i=t.getComponents(),s=e.getComponents();for(let t=0;t<i.length;t++)if(i[t]!==s[t])return!1;return!0}function n_(t){return"a"in t?[t.r,t.g,t.b,t.a]:[t.r,t.g,t.b]}const nf=eH({id:"input-color-number",type:"input",accept:(t,e)=>{var i;if("number"!=typeof t||!("color"in e||"color"===e.view))return null;let s=sx(e);return s?{initialValue:t,params:Object.assign(Object.assign({},s),{supportsAlpha:null!==(i=null==e?void 0:e.color)&&void 0!==i&&!!i.alpha})}:null},binding:{reader:t=>t.params.supportsAlpha?nv:nc,equals:nw,writer:t=>(function(t){let e=t?nu:nd;return(t,i)=>{si(t,e(i))}})(t.params.supportsAlpha)},controller:t=>{var e,i;return new np(t.document,{colorType:"int",expanded:null!==(e=t.params.expanded)&&void 0!==e&&e,formatter:t.params.supportsAlpha?t=>sZ(t,"0x"):t=>sW(t,"0x"),parser:sH("int"),pickerLayout:null!==(i=t.params.picker)&&void 0!==i?i:"popup",supportsAlpha:t.params.supportsAlpha,value:t.value,viewProps:t.viewProps})}}),nx=eH({id:"input-color-object",type:"input",accept:(t,e)=>{var i;if(!nb(t))return null;let s=sx(e);return s?{initialValue:t,params:Object.assign(Object.assign({},s),{colorType:null!==(i=sC(e))&&void 0!==i?i:"int"})}:null},binding:{reader:t=>{var e;return e=t.params.colorType,t=>{let i=nb(t)?"int"===e?new sg(n_(t),"rgb"):"float"===e?new sP(n_(t),"rgb"):sk(sg.black(),"int"):sk(sg.black(),e);return sk(i,"int")}},equals:nw,writer:t=>{var e,i;return e=ng(t.initialValue),i=t.params.colorType,(t,s)=>{e?function(t,e,i){let s=sk(e,i).toRgbaObject();t.writeProperty("r",s.r),t.writeProperty("g",s.g),t.writeProperty("b",s.b),t.writeProperty("a",s.a)}(t,s,i):function(t,e,i){let s=sk(e,i).toRgbaObject();t.writeProperty("r",s.r),t.writeProperty("g",s.g),t.writeProperty("b",s.b)}(t,s,i)}}},controller:t=>{var e,i,s;let n=ng(t.initialValue);return new np(t.document,{colorType:t.params.colorType,expanded:null!==(e=t.params.expanded)&&void 0!==e&&e,formatter:(s=t.params.colorType,t=>n?s1(t,s):s0(t,s)),parser:sH("int"),pickerLayout:null!==(i=t.params.picker)&&void 0!==i?i:"popup",supportsAlpha:n,value:t.value,viewProps:t.viewProps})}}),ny=eH({id:"input-color-string",type:"input",accept:(t,e)=>{if("string"!=typeof t||"text"===e.view)return null;let i=function(t,e="int"){let i=sG.reduce((e,{parser:i,result:s})=>e||(i(t)?s:null),null);return i?"hex"===i.notation&&"float"!==e?Object.assign(Object.assign({},i),{type:"int"}):"func"===i.notation?Object.assign(Object.assign({},i),{type:e}):null:null}(t,sC(e));if(!i)return null;let s=s5(i);if(!s)return null;let n=sx(e);return n?{initialValue:t,params:Object.assign(Object.assign({},n),{format:i,stringifier:s})}:null},binding:{reader:()=>sY,equals:nw,writer:t=>{let e=function(t){let e=s5(t);return e?(t,i)=>{si(t,e(i))}:null}(t.params.format);if(!e)throw tx.notBindable();return e}},controller:t=>{var e,i;return new np(t.document,{colorType:t.params.format.type,expanded:null!==(e=t.params.expanded)&&void 0!==e&&e,formatter:t.params.stringifier,parser:sH("int"),pickerLayout:null!==(i=t.params.picker)&&void 0!==i?i:"popup",supportsAlpha:t.params.format.alpha,value:t.value,viewProps:t.viewProps})}});class nC{constructor(t){this.components=t.components,this.asm_=t.assembly}constrain(t){let e=this.asm_.toComponents(t).map((t,e)=>{var i,s;return null!==(s=null===(i=this.components[e])||void 0===i?void 0:i.constrain(t))&&void 0!==s?s:t});return this.asm_.fromComponents(e)}}const nP=eP("pndtxt");class nE{constructor(t,e){this.textViews=e.textViews,this.element=t.createElement("div"),this.element.classList.add(nP()),this.textViews.forEach(e=>{let i=t.createElement("div");i.classList.add(nP("a")),i.appendChild(e.element),this.element.appendChild(i)})}}class nk{constructor(t,e){this.value=e.value,this.viewProps=e.viewProps,this.acs_=e.axes.map((i,s)=>new iJ(t,{arrayPosition:0===s?"fst":s===e.axes.length-1?"lst":"mid",parser:e.parser,props:e.axes[s].textProps,value:tV(0,{constraint:e.axes[s].constraint}),viewProps:e.viewProps})),this.acs_.forEach((t,i)=>{iq({primary:this.value,secondary:t.value,forward:t=>e.assembly.toComponents(t)[i],backward:(t,s)=>{let n=e.assembly.toComponents(t);return n[i]=s,e.assembly.fromComponents(n)}})}),this.view=new nE(t,{textViews:this.acs_.map(t=>t.view)})}get textControllers(){return this.acs_}}class nV extends es{get max(){return this.controller.valueController.sliderController.props.get("max")}set max(t){this.controller.valueController.sliderController.props.set("max",t)}get min(){return this.controller.valueController.sliderController.props.get("min")}set min(t){this.controller.valueController.sliderController.props.set("min",t)}}const nM=eH({id:"input-number",type:"input",accept:(t,e)=>{if("number"!=typeof t)return null;let i=el(e,t=>Object.assign(Object.assign({},t4(t)),{options:t.optional.custom(ik),readonly:t.optional.constant(!1)}));return i?{initialValue:t,params:i}:null},binding:{reader:t=>tY,constraint:t=>(function(t,e){let i=[],s=t2(t,e);s&&i.push(s);let n=t5(t);n&&i.push(n);let r=iM(t.options);return r&&i.push(r),new iC(i)})(t.params,t.initialValue),writer:t=>si},controller:t=>{let e=t.value,i=t.constraint,s=i&&iP(i,iE);if(s)return new iS(t.document,{props:new tM({options:s.values.value("options")}),value:e,viewProps:t.viewProps});let n=t3(t.params,e.rawValue),r=i&&iP(i,tL);return r?new i4(t.document,Object.assign(Object.assign({},i6(Object.assign(Object.assign({},n),{keyScale:tV(n.keyScale),max:r.values.value("max"),min:r.values.value("min")}))),{parser:tH,value:e,viewProps:t.viewProps})):new iJ(t.document,{parser:tH,props:tM.fromObject(n),value:e,viewProps:t.viewProps})},api:t=>"number"!=typeof t.controller.value.rawValue?null:t.controller.valueController instanceof i4?new nV(t.controller):t.controller.valueController instanceof iS?new i_(t.controller):null});class nL{constructor(t=0,e=0){this.x=t,this.y=e}getComponents(){return[this.x,this.y]}static isObject(t){if(tv(t))return!1;let e=t.x,i=t.y;return"number"==typeof e&&"number"==typeof i}static equals(t,e){return t.x===e.x&&t.y===e.y}toObject(){return{x:this.x,y:this.y}}}const nA={toComponents:t=>t.getComponents(),fromComponents:t=>new nL(...t)},nS=eP("p2d");class nD{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(nS()),e.viewProps.bindClassModifiers(this.element),ey(e.expanded,eB(this.element,nS(void 0,"expanded")));let i=t.createElement("div");i.classList.add(nS("h")),this.element.appendChild(i);let s=t.createElement("button");s.classList.add(nS("b")),s.appendChild(eg(t,"p2dpad")),e.viewProps.bindDisabled(s),i.appendChild(s),this.buttonElement=s;let n=t.createElement("div");if(n.classList.add(nS("t")),i.appendChild(n),this.textElement=n,"inline"===e.pickerLayout){let e=t.createElement("div");e.classList.add(nS("p")),this.element.appendChild(e),this.pickerElement=e}else this.pickerElement=null}}const nO=eP("p2dp");class nj{constructor(t,e){this.onFoldableChange_=this.onFoldableChange_.bind(this),this.onPropsChange_=this.onPropsChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.props_=e.props,this.props_.emitter.on("change",this.onPropsChange_),this.element=t.createElement("div"),this.element.classList.add(nO()),"popup"===e.layout&&this.element.classList.add(nO(void 0,"p")),e.viewProps.bindClassModifiers(this.element);let i=t.createElement("div");i.classList.add(nO("p")),e.viewProps.bindTabIndex(i),this.element.appendChild(i),this.padElement=i;let s=t.createElementNS(ec,"svg");s.classList.add(nO("g")),this.padElement.appendChild(s),this.svgElem_=s;let n=t.createElementNS(ec,"line");n.classList.add(nO("ax")),n.setAttributeNS(null,"x1","0"),n.setAttributeNS(null,"y1","50%"),n.setAttributeNS(null,"x2","100%"),n.setAttributeNS(null,"y2","50%"),this.svgElem_.appendChild(n);let r=t.createElementNS(ec,"line");r.classList.add(nO("ax")),r.setAttributeNS(null,"x1","50%"),r.setAttributeNS(null,"y1","0"),r.setAttributeNS(null,"x2","50%"),r.setAttributeNS(null,"y2","100%"),this.svgElem_.appendChild(r);let a=t.createElementNS(ec,"line");a.classList.add(nO("l")),a.setAttributeNS(null,"x1","50%"),a.setAttributeNS(null,"y1","50%"),this.svgElem_.appendChild(a),this.lineElem_=a;let o=t.createElement("div");o.classList.add(nO("m")),this.padElement.appendChild(o),this.markerElem_=o,e.value.emitter.on("change",this.onValueChange_),this.value=e.value,this.update_()}get allFocusableElements(){return[this.padElement]}update_(){let[t,e]=this.value.rawValue.getComponents(),i=this.props_.get("max"),s=tZ(t,-i,+i,0,100),n=tZ(e,-i,+i,0,100),r=this.props_.get("invertsY")?100-n:n;this.lineElem_.setAttributeNS(null,"x2",`${s}%`),this.lineElem_.setAttributeNS(null,"y2",`${r}%`),this.markerElem_.style.left=`${s}%`,this.markerElem_.style.top=`${r}%`}onValueChange_(){this.update_()}onPropsChange_(){this.update_()}onFoldableChange_(){this.update_()}}function nT(t,e,i){return[i$(e[0],iH(t)),i$(e[1],iG(t))*(i?1:-1)]}class nR{constructor(t,e){this.onPadKeyDown_=this.onPadKeyDown_.bind(this),this.onPadKeyUp_=this.onPadKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.props=e.props,this.value=e.value,this.viewProps=e.viewProps,this.view=new nj(t,{layout:e.layout,props:this.props,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new iW(this.view.padElement),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.padElement.addEventListener("keydown",this.onPadKeyDown_),this.view.padElement.addEventListener("keyup",this.onPadKeyUp_)}handlePointerEvent_(t,e){if(!t.point)return;let i=this.props.get("max"),s=tZ(t.point.x,0,t.bounds.width,-i,+i),n=tZ(this.props.get("invertsY")?t.bounds.height-t.point.y:t.point.y,0,t.bounds.height,-i,+i);this.value.setRawValue(new nL(s,n),e)}onPointerDown_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerMove_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerUp_(t){this.handlePointerEvent_(t.data,{forceEmit:!0,last:!0})}onPadKeyDown_(t){iY(t.key)&&t.preventDefault();let[e,i]=nT(t,[this.props.get("xKeyScale"),this.props.get("yKeyScale")],this.props.get("invertsY"));(0!==e||0!==i)&&this.value.setRawValue(new nL(this.value.rawValue.x+e,this.value.rawValue.y+i),{forceEmit:!1,last:!1})}onPadKeyUp_(t){let[e,i]=nT(t,[this.props.get("xKeyScale"),this.props.get("yKeyScale")],this.props.get("invertsY"));(0!==e||0!==i)&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class nN{constructor(t,e){var i,s;this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.onPadButtonBlur_=this.onPadButtonBlur_.bind(this),this.onPadButtonClick_=this.onPadButtonClick_.bind(this),this.value=e.value,this.viewProps=e.viewProps,this.foldable_=e3.create(e.expanded),this.popC_="popup"===e.pickerLayout?new ij(t,{viewProps:this.viewProps}):null;let n=new nR(t,{layout:e.pickerLayout,props:new tM({invertsY:tV(e.invertsY),max:tV(e.max),xKeyScale:e.axes[0].textProps.value("keyScale"),yKeyScale:e.axes[1].textProps.value("keyScale")}),value:this.value,viewProps:this.viewProps});n.view.allFocusableElements.forEach(t=>{t.addEventListener("blur",this.onPopupChildBlur_),t.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=n,this.textC_=new nk(t,{assembly:nA,axes:e.axes,parser:e.parser,value:this.value,viewProps:this.viewProps}),this.view=new nD(t,{expanded:this.foldable_.value("expanded"),pickerLayout:e.pickerLayout,viewProps:this.viewProps}),this.view.textElement.appendChild(this.textC_.view.element),null===(i=this.view.buttonElement)||void 0===i||i.addEventListener("blur",this.onPadButtonBlur_),null===(s=this.view.buttonElement)||void 0===s||s.addEventListener("click",this.onPadButtonClick_),this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(this.pickerC_.view.element),iq({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:t=>t,backward:(t,e)=>e})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),e6(this.foldable_,this.view.pickerElement))}get textController(){return this.textC_}onPadButtonBlur_(t){if(!this.popC_)return;let e=this.view.element,i=t.relatedTarget;i&&e.contains(i)||(this.popC_.shows.rawValue=!1)}onPadButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(t){if(!this.popC_)return;let e=this.popC_.view.element,i=ex(t);!(i&&e.contains(i))&&(!i||i!==this.view.buttonElement||em(e.ownerDocument))&&(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(t){this.popC_?"Escape"===t.key&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&"Escape"===t.key&&this.view.buttonElement.focus()}}function nz(t){return nL.isObject(t)?new nL(t.x,t.y):new nL}function nB(t,e){t.writeProperty("x",e.x),t.writeProperty("y",e.y)}function nF(t,e){var i,s;return tv(t.min)&&tv(t.max)?Math.max(10*Math.abs(t0(t)),10*Math.abs(e)):Math.max(Math.abs(null!==(i=t.min)&&void 0!==i?i:0),Math.abs(null!==(s=t.max)&&void 0!==s?s:0))}const nI=eH({id:"input-point2d",type:"input",accept:(t,e)=>{if(!nL.isObject(t))return null;let i=el(e,t=>Object.assign(Object.assign({},i8(t)),{expanded:t.optional.boolean,picker:t.optional.custom(se),readonly:t.optional.constant(!1),x:t.optional.custom(i7),y:t.optional.object(Object.assign(Object.assign({},i8(t)),{inverted:t.optional.boolean}))}));return i?{initialValue:t,params:i}:null},binding:{reader:()=>nz,constraint:t=>{var e,i;return e=t.params,i=t.initialValue,new nC({assembly:nA,components:[st(Object.assign(Object.assign({},e),e.x),i.x),st(Object.assign(Object.assign({},e),e.y),i.y)]})},equals:nL.equals,writer:()=>nB},controller:t=>{var e,i,s,n,r,a;let o=t.document,l=t.value,h=t.constraint,p=[t.params.x,t.params.y];return new nN(o,{axes:l.rawValue.getComponents().map((e,i)=>{var s;return t6({constraint:h.components[i],initialValue:e,params:tw(t.params,null!==(s=p[i])&&void 0!==s?s:{})})}),expanded:null!==(e=t.params.expanded)&&void 0!==e&&e,invertsY:function(t){if(!("y"in t))return!1;let e=t.y;return!!e&&"inverted"in e&&!!e.inverted}(t.params),max:(s=t.params,n=l.rawValue,Math.max(nF(tw(s,null!==(r=s.x)&&void 0!==r?r:{}),n.x),nF(tw(s,null!==(a=s.y)&&void 0!==a?a:{}),n.y))),parser:tH,pickerLayout:null!==(i=t.params.picker)&&void 0!==i?i:"popup",value:l,viewProps:t.viewProps})}});class nU{constructor(t=0,e=0,i=0){this.x=t,this.y=e,this.z=i}getComponents(){return[this.x,this.y,this.z]}static isObject(t){if(tv(t))return!1;let e=t.x,i=t.y,s=t.z;return"number"==typeof e&&"number"==typeof i&&"number"==typeof s}static equals(t,e){return t.x===e.x&&t.y===e.y&&t.z===e.z}toObject(){return{x:this.x,y:this.y,z:this.z}}}const nK={toComponents:t=>t.getComponents(),fromComponents:t=>new nU(...t)};function nq(t){return nU.isObject(t)?new nU(t.x,t.y,t.z):new nU}function n$(t,e){t.writeProperty("x",e.x),t.writeProperty("y",e.y),t.writeProperty("z",e.z)}const nG=eH({id:"input-point3d",type:"input",accept:(t,e)=>{if(!nU.isObject(t))return null;let i=el(e,t=>Object.assign(Object.assign({},i8(t)),{readonly:t.optional.constant(!1),x:t.optional.custom(i7),y:t.optional.custom(i7),z:t.optional.custom(i7)}));return i?{initialValue:t,params:i}:null},binding:{reader:t=>nq,constraint:t=>{var e,i;return e=t.params,i=t.initialValue,new nC({assembly:nK,components:[st(Object.assign(Object.assign({},e),e.x),i.x),st(Object.assign(Object.assign({},e),e.y),i.y),st(Object.assign(Object.assign({},e),e.z),i.z)]})},equals:nU.equals,writer:t=>n$},controller:t=>{let e=t.value,i=t.constraint,s=[t.params.x,t.params.y,t.params.z];return new nk(t.document,{assembly:nK,axes:e.rawValue.getComponents().map((e,n)=>{var r;return t6({constraint:i.components[n],initialValue:e,params:tw(t.params,null!==(r=s[n])&&void 0!==r?r:{})})}),parser:tH,value:e,viewProps:t.viewProps})}});class nH{constructor(t=0,e=0,i=0,s=0){this.x=t,this.y=e,this.z=i,this.w=s}getComponents(){return[this.x,this.y,this.z,this.w]}static isObject(t){if(tv(t))return!1;let e=t.x,i=t.y,s=t.z,n=t.w;return"number"==typeof e&&"number"==typeof i&&"number"==typeof s&&"number"==typeof n}static equals(t,e){return t.x===e.x&&t.y===e.y&&t.z===e.z&&t.w===e.w}toObject(){return{x:this.x,y:this.y,z:this.z,w:this.w}}}const nY={toComponents:t=>t.getComponents(),fromComponents:t=>new nH(...t)};function nX(t){return nH.isObject(t)?new nH(t.x,t.y,t.z,t.w):new nH}function nW(t,e){t.writeProperty("x",e.x),t.writeProperty("y",e.y),t.writeProperty("z",e.z),t.writeProperty("w",e.w)}const nZ=eH({id:"input-point4d",type:"input",accept:(t,e)=>{if(!nH.isObject(t))return null;let i=el(e,t=>Object.assign(Object.assign({},i8(t)),{readonly:t.optional.constant(!1),w:t.optional.custom(i7),x:t.optional.custom(i7),y:t.optional.custom(i7),z:t.optional.custom(i7)}));return i?{initialValue:t,params:i}:null},binding:{reader:t=>nX,constraint:t=>{var e,i;return e=t.params,i=t.initialValue,new nC({assembly:nY,components:[st(Object.assign(Object.assign({},e),e.x),i.x),st(Object.assign(Object.assign({},e),e.y),i.y),st(Object.assign(Object.assign({},e),e.z),i.z),st(Object.assign(Object.assign({},e),e.w),i.w)]})},equals:nH.equals,writer:t=>nW},controller:t=>{let e=t.value,i=t.constraint,s=[t.params.x,t.params.y,t.params.z,t.params.w];return new nk(t.document,{assembly:nY,axes:e.rawValue.getComponents().map((e,n)=>{var r;return t6({constraint:i.components[n],initialValue:e,params:tw(t.params,null!==(r=s[n])&&void 0!==r?r:{})})}),parser:tH,value:e,viewProps:t.viewProps})}}),nQ=eH({id:"input-string",type:"input",accept:(t,e)=>{if("string"!=typeof t)return null;let i=el(e,t=>({readonly:t.optional.constant(!1),options:t.optional.custom(ik)}));return i?{initialValue:t,params:i}:null},binding:{reader:t=>iU,constraint:t=>(function(t){let e=[],i=iM(t.options);return i&&e.push(i),new iC(e)})(t.params),writer:t=>si},controller:t=>{let e=t.document,i=t.value,s=t.constraint,n=s&&iP(s,iE);return n?new iS(e,{props:new tM({options:n.values.value("options")}),value:i,viewProps:t.viewProps}):new iN(e,{parser:t=>t,props:tM.fromObject({formatter:iK}),value:i,viewProps:t.viewProps})},api:t=>"string"!=typeof t.controller.value.rawValue?null:t.controller.valueController instanceof iS?new i_(t.controller):null}),nJ={monitor:{defaultInterval:200,defaultRows:3}},n0=eP("mll");class n1{constructor(t,e){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=e.formatter,this.element=t.createElement("div"),this.element.classList.add(n0()),e.viewProps.bindClassModifiers(this.element);let i=t.createElement("textarea");i.classList.add(n0("i")),i.style.height=`calc(var(--${i9}) * ${e.rows})`,i.readOnly=!0,e.viewProps.bindDisabled(i),this.element.appendChild(i),this.textareaElem_=i,e.value.emitter.on("change",this.onValueUpdate_),this.value=e.value,this.update_()}update_(){let t=this.textareaElem_,e=t.scrollTop===t.scrollHeight-t.clientHeight,i=[];this.value.rawValue.forEach(t=>{void 0!==t&&i.push(this.formatter_(t))}),t.textContent=i.join("\n"),e&&(t.scrollTop=t.scrollHeight)}onValueUpdate_(){this.update_()}}class n2{constructor(t,e){this.value=e.value,this.viewProps=e.viewProps,this.view=new n1(t,{formatter:e.formatter,rows:e.rows,value:this.value,viewProps:this.viewProps})}}const n5=eP("sgl");class n3{constructor(t,e){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=e.formatter,this.element=t.createElement("div"),this.element.classList.add(n5()),e.viewProps.bindClassModifiers(this.element);let i=t.createElement("input");i.classList.add(n5("i")),i.readOnly=!0,i.type="text",e.viewProps.bindDisabled(i),this.element.appendChild(i),this.inputElement=i,e.value.emitter.on("change",this.onValueUpdate_),this.value=e.value,this.update_()}update_(){let t=this.value.rawValue,e=t[t.length-1];this.inputElement.value=void 0!==e?this.formatter_(e):""}onValueUpdate_(){this.update_()}}class n4{constructor(t,e){this.value=e.value,this.viewProps=e.viewProps,this.view=new n3(t,{formatter:e.formatter,value:this.value,viewProps:this.viewProps})}}const n6=eH({id:"monitor-bool",type:"monitor",accept:(t,e)=>{if("boolean"!=typeof t)return null;let i=el(e,t=>({readonly:t.required.constant(!0),rows:t.optional.number}));return i?{initialValue:t,params:i}:null},binding:{reader:t=>iz},controller:t=>{var e;return 1===t.value.rawValue.length?new n4(t.document,{formatter:iB,value:t.value,viewProps:t.viewProps}):new n2(t.document,{formatter:iB,rows:null!==(e=t.params.rows)&&void 0!==e?e:nJ.monitor.defaultRows,value:t.value,viewProps:t.viewProps})}});class n9 extends es{get max(){return this.controller.valueController.props.get("max")}set max(t){this.controller.valueController.props.set("max",t)}get min(){return this.controller.valueController.props.get("min")}set min(t){this.controller.valueController.props.set("min",t)}}const n8=eP("grl");class n7{constructor(t,e){this.onCursorChange_=this.onCursorChange_.bind(this),this.onValueUpdate_=this.onValueUpdate_.bind(this),this.element=t.createElement("div"),this.element.classList.add(n8()),e.viewProps.bindClassModifiers(this.element),this.formatter_=e.formatter,this.props_=e.props,this.cursor_=e.cursor,this.cursor_.emitter.on("change",this.onCursorChange_);let i=t.createElementNS(ec,"svg");i.classList.add(n8("g")),i.style.height=`calc(var(--${i9}) * ${e.rows})`,this.element.appendChild(i),this.svgElem_=i;let s=t.createElementNS(ec,"polyline");this.svgElem_.appendChild(s),this.lineElem_=s;let n=t.createElement("div");n.classList.add(n8("t"),eP("tt")()),this.element.appendChild(n),this.tooltipElem_=n,e.value.emitter.on("change",this.onValueUpdate_),this.value=e.value,this.update_()}get graphElement(){return this.svgElem_}update_(){let{clientWidth:t,clientHeight:e}=this.element,i=this.value.rawValue.length-1,s=this.props_.get("min"),n=this.props_.get("max"),r=[];this.value.rawValue.forEach((a,o)=>{if(void 0===a)return;let l=tZ(o,0,i,0,t),h=tZ(a,s,n,e,0);r.push([l,h].join(","))}),this.lineElem_.setAttributeNS(null,"points",r.join(" "));let a=this.tooltipElem_,o=this.value.rawValue[this.cursor_.rawValue];if(void 0===o){a.classList.remove(n8("t","a"));return}let l=tZ(this.cursor_.rawValue,0,i,0,t),h=tZ(o,s,n,e,0);a.style.left=`${l}px`,a.style.top=`${h}px`,a.textContent=`${this.formatter_(o)}`,a.classList.contains(n8("t","a"))||(a.classList.add(n8("t","a"),n8("t","in")),ev(a),a.classList.remove(n8("t","in")))}onValueUpdate_(){this.update_()}onCursorChange_(){this.update_()}}class rt{constructor(t,e){if(this.onGraphMouseMove_=this.onGraphMouseMove_.bind(this),this.onGraphMouseLeave_=this.onGraphMouseLeave_.bind(this),this.onGraphPointerDown_=this.onGraphPointerDown_.bind(this),this.onGraphPointerMove_=this.onGraphPointerMove_.bind(this),this.onGraphPointerUp_=this.onGraphPointerUp_.bind(this),this.props=e.props,this.value=e.value,this.viewProps=e.viewProps,this.cursor_=tV(-1),this.view=new n7(t,{cursor:this.cursor_,formatter:e.formatter,rows:e.rows,props:this.props,value:this.value,viewProps:this.viewProps}),em(t)){let t=new iW(this.view.element);t.emitter.on("down",this.onGraphPointerDown_),t.emitter.on("move",this.onGraphPointerMove_),t.emitter.on("up",this.onGraphPointerUp_)}else this.view.element.addEventListener("mousemove",this.onGraphMouseMove_),this.view.element.addEventListener("mouseleave",this.onGraphMouseLeave_)}importProps(t){return eh(t,null,t=>({max:t.required.number,min:t.required.number}),t=>(this.props.set("max",t.max),this.props.set("min",t.min),!0))}exportProps(){return ep(null,{max:this.props.get("max"),min:this.props.get("min")})}onGraphMouseLeave_(){this.cursor_.rawValue=-1}onGraphMouseMove_(t){let{clientWidth:e}=this.view.element;this.cursor_.rawValue=Math.floor(tZ(t.offsetX,0,e,0,this.value.rawValue.length))}onGraphPointerDown_(t){this.onGraphPointerMove_(t)}onGraphPointerMove_(t){if(!t.data.point){this.cursor_.rawValue=-1;return}this.cursor_.rawValue=Math.floor(tZ(t.data.point.x,0,t.data.bounds.width,0,this.value.rawValue.length))}onGraphPointerUp_(){this.cursor_.rawValue=-1}}function re(t){return tv(t.format)?tW(2):t.format}function ri(t){return"graph"===t.view}const rs=eH({id:"monitor-number",type:"monitor",accept:(t,e)=>{if("number"!=typeof t)return null;let i=el(e,t=>({format:t.optional.function,max:t.optional.number,min:t.optional.number,readonly:t.required.constant(!0),rows:t.optional.number,view:t.optional.string}));return i?{initialValue:t,params:i}:null},binding:{defaultBufferSize:t=>ri(t)?64:1,reader:t=>tY},controller:t=>{var e,i,s,n;return ri(t.params)?new rt(t.document,{formatter:re(t.params),rows:null!==(e=t.params.rows)&&void 0!==e?e:nJ.monitor.defaultRows,props:tM.fromObject({max:null!==(i=t.params.max)&&void 0!==i?i:100,min:null!==(s=t.params.min)&&void 0!==s?s:0}),value:t.value,viewProps:t.viewProps}):1===t.value.rawValue.length?new n4(t.document,{formatter:re(t.params),value:t.value,viewProps:t.viewProps}):new n2(t.document,{formatter:re(t.params),rows:null!==(n=t.params.rows)&&void 0!==n?n:nJ.monitor.defaultRows,value:t.value,viewProps:t.viewProps})},api:t=>t.controller.valueController instanceof rt?new n9(t.controller):null}),rn=eH({id:"monitor-string",type:"monitor",accept:(t,e)=>{if("string"!=typeof t)return null;let i=el(e,t=>({multiline:t.optional.boolean,readonly:t.required.constant(!0),rows:t.optional.number}));return i?{initialValue:t,params:i}:null},binding:{reader:t=>iU},controller:t=>{var e;let i=t.value;return i.rawValue.length>1||t.params.multiline?new n2(t.document,{formatter:iK,rows:null!==(e=t.params.rows)&&void 0!==e?e:nJ.monitor.defaultRows,value:i,viewProps:t.viewProps}):new n4(t.document,{formatter:iK,value:i,viewProps:t.viewProps})}});class rr{constructor(t){this.target=t.target,this.reader_=t.reader,this.writer_=t.writer}read(){return this.reader_(this.target.read())}write(t){this.writer_(this.target,t)}inject(t){this.write(this.reader_(t))}}class ra{constructor(t){this.target=t.target,this.reader_=t.reader}read(){return this.reader_(this.target.read())}}class ro{constructor(t){this.pluginsMap_={blades:[],inputs:[],monitors:[]},this.apiCache_=t}getAll(){return[...this.pluginsMap_.blades,...this.pluginsMap_.inputs,...this.pluginsMap_.monitors]}register(t,e){var i;if(!((i=e.core)&&i.major===eG.major))throw tx.notCompatible(t,e.id);"blade"===e.type?this.pluginsMap_.blades.unshift(e):"input"===e.type?this.pluginsMap_.inputs.unshift(e):"monitor"===e.type&&this.pluginsMap_.monitors.unshift(e)}createInput_(t,e,i){return this.pluginsMap_.inputs.reduce((s,n)=>null!=s?s:function(t,e){var i;let s=t.accept(e.target.read(),e.params);if(tv(s))return null;let n={target:e.target,initialValue:s.initialValue,params:s.params},r=el(e.params,t=>({disabled:t.optional.boolean,hidden:t.optional.boolean,label:t.optional.string,tag:t.optional.string})),a=t.binding.reader(n),o=t.binding.constraint?t.binding.constraint(n):void 0,l=new rr({reader:a,target:e.target,writer:t.binding.writer(n)}),h=new en(tV(a(s.initialValue),{constraint:o,equals:t.binding.equals}),l),p=t.controller({constraint:o,document:e.document,initialValue:s.initialValue,params:s.params,value:h,viewProps:ir.create({disabled:null==r?void 0:r.disabled,hidden:null==r?void 0:r.hidden})});return new ej(e.document,{blade:e5(),props:tM.fromObject({label:"label"in e.params?null!==(i=null==r?void 0:r.label)&&void 0!==i?i:null:e.target.key}),tag:null==r?void 0:r.tag,value:h,valueController:p})}(n,{document:t,target:e,params:i}),null)}createMonitor_(t,e,i){return this.pluginsMap_.monitors.reduce((s,n)=>null!=s?s:function(t,e){var i,s,n,r,a;let o=t.accept(e.target.read(),e.params);if(tv(o))return null;let l={target:e.target,initialValue:o.initialValue,params:o.params},h=el(e.params,t=>({bufferSize:t.optional.number,disabled:t.optional.boolean,hidden:t.optional.boolean,interval:t.optional.number,label:t.optional.string})),p=t.binding.reader(l),d=null!==(s=null!==(i=null==h?void 0:h.bufferSize)&&void 0!==i?i:t.binding.defaultBufferSize&&t.binding.defaultBufferSize(o.params))&&void 0!==s?s:1,u=new eR({binding:new ra({reader:p,target:e.target}),bufferSize:d,ticker:(r=e.document,0===(a=null==h?void 0:h.interval)?new ix:new iy(r,null!=a?a:nJ.monitor.defaultInterval))}),c=t.controller({document:e.document,params:o.params,value:u,viewProps:ir.create({disabled:null==h?void 0:h.disabled,hidden:null==h?void 0:h.hidden})});return c.viewProps.bindDisabled(u.ticker),c.viewProps.handleDispose(()=>{u.ticker.dispose()}),new eN(e.document,{blade:e5(),props:tM.fromObject({label:"label"in e.params?null!==(n=null==h?void 0:h.label)&&void 0!==n?n:null:e.target.key}),value:u,valueController:c})}(n,{document:t,params:i,target:e}),null)}createBinding(t,e,i){if(tv(e.read()))throw new tx({context:{key:e.key},type:"nomatchingcontroller"});let s=this.createInput_(t,e,i);if(s)return s;let n=this.createMonitor_(t,e,i);if(n)return n;throw new tx({context:{key:e.key},type:"nomatchingcontroller"})}createBlade(t,e){let i=this.pluginsMap_.blades.reduce((i,s)=>null!=i?i:function(t,e){let i=t.accept(e.params);if(!i)return null;let s=el(e.params,t=>({disabled:t.optional.boolean,hidden:t.optional.boolean}));return t.controller({blade:e5(),document:e.document,params:Object.assign(Object.assign({},i.params),{disabled:null==s?void 0:s.disabled,hidden:null==s?void 0:s.hidden}),viewProps:ir.create({disabled:null==s?void 0:s.disabled,hidden:null==s?void 0:s.hidden})})}(s,{document:t,params:e}),null);if(!i)throw new tx({type:"nomatchingview",context:{params:e}});return i}createInputBindingApi_(t){let e=this.pluginsMap_.inputs.reduce((e,i)=>{var s,n;return e||(null!==(n=null===(s=i.api)||void 0===s?void 0:s.call(i,{controller:t}))&&void 0!==n?n:null)},null);return this.apiCache_.add(t,null!=e?e:new es(t))}createMonitorBindingApi_(t){let e=this.pluginsMap_.monitors.reduce((e,i)=>{var s,n;return e||(null!==(n=null===(s=i.api)||void 0===s?void 0:s.call(i,{controller:t}))&&void 0!==n?n:null)},null);return this.apiCache_.add(t,null!=e?e:new es(t))}createBindingApi(t){if(this.apiCache_.has(t))return this.apiCache_.get(t);if(ed(t)&&function(t){if(!("binding"in t))return!1;let e=t.binding;return t_(e)&&"read"in e&&"write"in e}(t.value))return this.createInputBindingApi_(t);if(ed(t)&&function(t){if(!("binding"in t))return!1;let e=t.binding;return t_(e)&&"read"in e&&!("write"in e)}(t.value))return this.createMonitorBindingApi_(t);throw tx.shouldNeverHappen()}createApi(t){if(this.apiCache_.has(t))return this.apiCache_.get(t);if(ed(t)&&eu(t.value))return this.createBindingApi(t);let e=this.pluginsMap_.blades.reduce((e,i)=>null!=e?e:i.api({controller:t,pool:this}),null);if(!e)throw tx.shouldNeverHappen();return this.apiCache_.add(t,e)}}const rl=new class{constructor(){this.map_=new Map}get(t){var e;return null!==(e=this.map_.get(t))&&void 0!==e?e:null}has(t){return this.map_.has(t)}add(t,e){return this.map_.set(t,e),t.viewProps.handleDispose(()=>{this.map_.delete(t)}),e}};class rh extends t9{constructor(t){super(t),this.emitter_=new tC,this.controller.value.emitter.on("change",t=>{this.emitter_.emit("change",new t7(this,t.rawValue))})}get label(){return this.controller.labelController.props.get("label")}set label(t){this.controller.labelController.props.set("label",t)}get options(){return this.controller.valueController.props.get("options")}set options(t){this.controller.valueController.props.set("options",t)}get value(){return this.controller.value.rawValue}set value(t){this.controller.value.rawValue=t}on(t,e){let i=e.bind(this);return this.emitter_.on(t,t=>{i(t)},{key:e}),this}off(t,e){return this.emitter_.off(t,e),this}}class rp extends t9{}class rd extends t9{constructor(t){super(t),this.emitter_=new tC,this.controller.value.emitter.on("change",t=>{this.emitter_.emit("change",new t7(this,t.rawValue))})}get label(){return this.controller.labelController.props.get("label")}set label(t){this.controller.labelController.props.set("label",t)}get max(){return this.controller.valueController.sliderController.props.get("max")}set max(t){this.controller.valueController.sliderController.props.set("max",t)}get min(){return this.controller.valueController.sliderController.props.get("min")}set min(t){this.controller.valueController.sliderController.props.set("min",t)}get value(){return this.controller.value.rawValue}set value(t){this.controller.value.rawValue=t}on(t,e){let i=e.bind(this);return this.emitter_.on(t,t=>{i(t)},{key:e}),this}off(t,e){return this.emitter_.off(t,e),this}}class ru extends t9{constructor(t){super(t),this.emitter_=new tC,this.controller.value.emitter.on("change",t=>{this.emitter_.emit("change",new t7(this,t.rawValue))})}get label(){return this.controller.labelController.props.get("label")}set label(t){this.controller.labelController.props.set("label",t)}get formatter(){return this.controller.valueController.props.get("formatter")}set formatter(t){this.controller.valueController.props.set("formatter",t)}get value(){return this.controller.value.rawValue}set value(t){this.controller.value.rawValue=t}on(t,e){let i=e.bind(this);return this.emitter_.on(t,t=>{i(t)},{key:e}),this}off(t,e){return this.emitter_.off(t,e),this}}const rc={id:"list",type:"blade",core:eG,accept(t){let e=el(t,t=>({options:t.required.custom(ik),value:t.required.raw,view:t.required.constant("list"),label:t.optional.string}));return e?{params:e}:null},controller(t){let e=new iE(iV(t.params.options)),i=tV(t.params.value,{constraint:e}),s=new iS(t.document,{props:new tM({options:e.values.value("options")}),value:i,viewProps:t.viewProps});return new eS(t.document,{blade:t.blade,props:tM.fromObject({label:t.params.label}),value:i,valueController:s})},api:t=>t.controller instanceof eS&&t.controller.valueController instanceof iS?new rh(t.controller):null};class rv extends e9{constructor(t,e){super(t,e)}get element(){return this.controller.view.element}}class rm extends it{constructor(t,e){super(t,{expanded:e.expanded,blade:e.blade,props:e.props,root:!0,viewProps:e.viewProps})}}const rb=eP("spr");class rg{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(rb()),e.viewProps.bindClassModifiers(this.element);let i=t.createElement("hr");i.classList.add(rb("r")),this.element.appendChild(i)}}class rw extends eA{constructor(t,e){super(Object.assign(Object.assign({},e),{view:new rg(t,{viewProps:e.viewProps})}))}}const r_={id:"separator",type:"blade",core:eG,accept(t){let e=el(t,t=>({view:t.required.constant("separator")}));return e?{params:e}:null},controller:t=>new rw(t.document,{blade:t.blade,viewProps:t.viewProps}),api:t=>t.controller instanceof rw?new rp(t.controller):null},rf={id:"slider",type:"blade",core:eG,accept(t){let e=el(t,t=>({max:t.required.number,min:t.required.number,view:t.required.constant("slider"),format:t.optional.function,label:t.optional.string,value:t.optional.number}));return e?{params:e}:null},controller(t){var e,i;let s=null!==(e=t.params.value)&&void 0!==e?e:0,n=new tL({max:t.params.max,min:t.params.min}),r=tV(s,{constraint:n}),a=new i4(t.document,Object.assign(Object.assign({},i6({formatter:null!==(i=t.params.format)&&void 0!==i?i:tX,keyScale:tV(1),max:n.values.value("max"),min:n.values.value("min"),pointerScale:t1(t.params,s)})),{parser:tH,value:r,viewProps:t.viewProps}));return new eS(t.document,{blade:t.blade,props:tM.fromObject({label:t.params.label}),value:r,valueController:a})},api:t=>t.controller instanceof eS&&t.controller.valueController instanceof i4?new rd(t.controller):null},rx={id:"text",type:"blade",core:eG,accept(t){let e=el(t,t=>({parse:t.required.function,value:t.required.raw,view:t.required.constant("text"),format:t.optional.function,label:t.optional.string}));return e?{params:e}:null},controller(t){var e;let i=tV(t.params.value),s=new iN(t.document,{parser:t.params.parse,props:tM.fromObject({formatter:null!==(e=t.params.format)&&void 0!==e?e:t=>String(t)}),value:i,viewProps:t.viewProps});return new eS(t.document,{blade:t.blade,props:tM.fromObject({label:t.params.label}),value:i,valueController:s})},api:t=>t.controller instanceof eS&&t.controller.valueController instanceof iN?new ru(t.controller):null};class ry extends rv{constructor(t){var e,i;let s=null!=t?t:{},n=null!==(e=s.document)&&void 0!==e?e:globalThis.document,r=function(){let t=new ro(rl);return[nI,nG,nZ,nQ,nM,ny,nx,nf,sa,n6,rn,rs,eY,ie,iw].forEach(e=>{t.register("core",e)}),t}();super(new rm(n,{expanded:s.expanded,blade:e5(),props:tM.fromObject({title:s.title}),viewProps:ir.create()}),r),this.pool_=r,this.containerElem_=null!==(i=s.container)&&void 0!==i?i:function(t){let e=t.createElement("div");return e.classList.add(eP("dfw")()),t.body&&t.body.appendChild(e),e}(n),this.containerElem_.appendChild(this.element),this.doc_=n,this.usesDefaultWrapper_=!s.container,this.setUpDefaultPlugins_()}get document(){if(!this.doc_)throw tx.alreadyDisposed();return this.doc_}dispose(){let t=this.containerElem_;if(!t)throw tx.alreadyDisposed();if(this.usesDefaultWrapper_){let e=t.parentElement;e&&e.removeChild(t)}this.containerElem_=null,this.doc_=null,super.dispose()}registerPlugin(t){t.css&&function(t,e,i){if(t.querySelector(`style[data-tp-style=${e}]`))return;let s=t.createElement("style");s.dataset.tpStyle=e,s.textContent=i,t.head.appendChild(s)}(this.document,`plugin-${t.id}`,t.css),("plugin"in t?[t.plugin]:"plugins"in t?t.plugins:[]).forEach(e=>{this.pool_.register(t.id,e)})}setUpDefaultPlugins_(){this.registerPlugin({id:"default",css:'.tp-tbiv_b,.tp-coltxtv_ms,.tp-colswv_b,.tp-ckbv_i,.tp-sglv_i,.tp-mllv_i,.tp-grlv_g,.tp-txtv_i,.tp-p2dpv_p,.tp-colswv_sw,.tp-rotv_b,.tp-fldv_b,.tp-p2dv_b,.tp-btnv_b,.tp-lstv_s{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:rgba(0,0,0,0);border-width:0;font-family:inherit;font-size:inherit;font-weight:inherit;margin:0;outline:none;padding:0}.tp-p2dv_b,.tp-btnv_b,.tp-lstv_s{background-color:var(--btn-bg);border-radius:var(--bld-br);color:var(--btn-fg);cursor:pointer;display:block;font-weight:bold;height:var(--cnt-usz);line-height:var(--cnt-usz);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.tp-p2dv_b:hover,.tp-btnv_b:hover,.tp-lstv_s:hover{background-color:var(--btn-bg-h)}.tp-p2dv_b:focus,.tp-btnv_b:focus,.tp-lstv_s:focus{background-color:var(--btn-bg-f)}.tp-p2dv_b:active,.tp-btnv_b:active,.tp-lstv_s:active{background-color:var(--btn-bg-a)}.tp-p2dv_b:disabled,.tp-btnv_b:disabled,.tp-lstv_s:disabled{opacity:.5}.tp-rotv_c>.tp-cntv.tp-v-lst,.tp-tbpv_c>.tp-cntv.tp-v-lst,.tp-fldv_c>.tp-cntv.tp-v-lst{margin-bottom:calc(-1*var(--cnt-vp))}.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-tbpv_c>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_c{border-bottom-left-radius:0}.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-tbpv_c>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_b{border-bottom-left-radius:0}.tp-rotv_c>*:not(.tp-v-fst),.tp-tbpv_c>*:not(.tp-v-fst),.tp-fldv_c>*:not(.tp-v-fst){margin-top:var(--cnt-usp)}.tp-rotv_c>.tp-sprv:not(.tp-v-fst),.tp-tbpv_c>.tp-sprv:not(.tp-v-fst),.tp-fldv_c>.tp-sprv:not(.tp-v-fst),.tp-rotv_c>.tp-cntv:not(.tp-v-fst),.tp-tbpv_c>.tp-cntv:not(.tp-v-fst),.tp-fldv_c>.tp-cntv:not(.tp-v-fst){margin-top:var(--cnt-vp)}.tp-rotv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-tbpv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-fldv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-rotv_c>.tp-cntv+*:not(.tp-v-hidden),.tp-tbpv_c>.tp-cntv+*:not(.tp-v-hidden),.tp-fldv_c>.tp-cntv+*:not(.tp-v-hidden){margin-top:var(--cnt-vp)}.tp-rotv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-tbpv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-fldv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-rotv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-tbpv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-fldv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv{margin-top:0}.tp-tbpv_c>.tp-cntv,.tp-fldv_c>.tp-cntv{margin-left:4px}.tp-tbpv_c>.tp-fldv>.tp-fldv_b,.tp-fldv_c>.tp-fldv>.tp-fldv_b{border-top-left-radius:var(--bld-br);border-bottom-left-radius:var(--bld-br)}.tp-tbpv_c>.tp-fldv.tp-fldv-expanded>.tp-fldv_b,.tp-fldv_c>.tp-fldv.tp-fldv-expanded>.tp-fldv_b{border-bottom-left-radius:0}.tp-tbpv_c .tp-fldv>.tp-fldv_c,.tp-fldv_c .tp-fldv>.tp-fldv_c{border-bottom-left-radius:var(--bld-br)}.tp-tbpv_c>.tp-cntv+.tp-fldv>.tp-fldv_b,.tp-fldv_c>.tp-cntv+.tp-fldv>.tp-fldv_b{border-top-left-radius:0}.tp-tbpv_c>.tp-cntv+.tp-tabv>.tp-tabv_t,.tp-fldv_c>.tp-cntv+.tp-tabv>.tp-tabv_t{border-top-left-radius:0}.tp-tbpv_c>.tp-tabv>.tp-tabv_t,.tp-fldv_c>.tp-tabv>.tp-tabv_t{border-top-left-radius:var(--bld-br)}.tp-tbpv_c .tp-tabv>.tp-tabv_c,.tp-fldv_c .tp-tabv>.tp-tabv_c{border-bottom-left-radius:var(--bld-br)}.tp-rotv_b,.tp-fldv_b{background-color:var(--cnt-bg);color:var(--cnt-fg);cursor:pointer;display:block;height:calc(var(--cnt-usz) + 4px);line-height:calc(var(--cnt-usz) + 4px);overflow:hidden;padding-left:var(--cnt-hp);padding-right:calc(4px + var(--cnt-usz) + var(--cnt-hp));position:relative;text-align:left;text-overflow:ellipsis;white-space:nowrap;width:100%;transition:border-radius .2s ease-in-out .2s}.tp-rotv_b:hover,.tp-fldv_b:hover{background-color:var(--cnt-bg-h)}.tp-rotv_b:focus,.tp-fldv_b:focus{background-color:var(--cnt-bg-f)}.tp-rotv_b:active,.tp-fldv_b:active{background-color:var(--cnt-bg-a)}.tp-rotv_b:disabled,.tp-fldv_b:disabled{opacity:.5}.tp-rotv_m,.tp-fldv_m{background:linear-gradient(to left, var(--cnt-fg), var(--cnt-fg) 2px, transparent 2px, transparent 4px, var(--cnt-fg) 4px);border-radius:2px;bottom:0;content:"";display:block;height:6px;right:calc(var(--cnt-hp) + (var(--cnt-usz) + 4px - 6px)/2 - 2px);margin:auto;opacity:.5;position:absolute;top:0;transform:rotate(90deg);transition:transform .2s ease-in-out;width:6px}.tp-rotv.tp-rotv-expanded .tp-rotv_m,.tp-fldv.tp-fldv-expanded>.tp-fldv_b>.tp-fldv_m{transform:none}.tp-rotv_c,.tp-fldv_c{box-sizing:border-box;height:0;opacity:0;overflow:hidden;padding-bottom:0;padding-top:0;position:relative;transition:height .2s ease-in-out,opacity .2s linear,padding .2s ease-in-out}.tp-rotv.tp-rotv-cpl:not(.tp-rotv-expanded) .tp-rotv_c,.tp-fldv.tp-fldv-cpl:not(.tp-fldv-expanded)>.tp-fldv_c{display:none}.tp-rotv.tp-rotv-expanded .tp-rotv_c,.tp-fldv.tp-fldv-expanded>.tp-fldv_c{opacity:1;padding-bottom:var(--cnt-vp);padding-top:var(--cnt-vp);transform:none;overflow:visible;transition:height .2s ease-in-out,opacity .2s linear .2s,padding .2s ease-in-out}.tp-txtv_i,.tp-p2dpv_p,.tp-colswv_sw{background-color:var(--in-bg);border-radius:var(--bld-br);box-sizing:border-box;color:var(--in-fg);font-family:inherit;height:var(--cnt-usz);line-height:var(--cnt-usz);min-width:0;width:100%}.tp-txtv_i:hover,.tp-p2dpv_p:hover,.tp-colswv_sw:hover{background-color:var(--in-bg-h)}.tp-txtv_i:focus,.tp-p2dpv_p:focus,.tp-colswv_sw:focus{background-color:var(--in-bg-f)}.tp-txtv_i:active,.tp-p2dpv_p:active,.tp-colswv_sw:active{background-color:var(--in-bg-a)}.tp-txtv_i:disabled,.tp-p2dpv_p:disabled,.tp-colswv_sw:disabled{opacity:.5}.tp-lstv,.tp-coltxtv_m{position:relative}.tp-lstv_s{padding:0 20px 0 4px;width:100%}.tp-lstv_m,.tp-coltxtv_mm{bottom:0;margin:auto;pointer-events:none;position:absolute;right:2px;top:0}.tp-lstv_m svg,.tp-coltxtv_mm svg{bottom:0;height:16px;margin:auto;position:absolute;right:0;top:0;width:16px}.tp-lstv_m svg path,.tp-coltxtv_mm svg path{fill:currentColor}.tp-sglv_i,.tp-mllv_i,.tp-grlv_g{background-color:var(--mo-bg);border-radius:var(--bld-br);box-sizing:border-box;color:var(--mo-fg);height:var(--cnt-usz);scrollbar-color:currentColor rgba(0,0,0,0);scrollbar-width:thin;width:100%}.tp-sglv_i::-webkit-scrollbar,.tp-mllv_i::-webkit-scrollbar,.tp-grlv_g::-webkit-scrollbar{height:8px;width:8px}.tp-sglv_i::-webkit-scrollbar-corner,.tp-mllv_i::-webkit-scrollbar-corner,.tp-grlv_g::-webkit-scrollbar-corner{background-color:rgba(0,0,0,0)}.tp-sglv_i::-webkit-scrollbar-thumb,.tp-mllv_i::-webkit-scrollbar-thumb,.tp-grlv_g::-webkit-scrollbar-thumb{background-clip:padding-box;background-color:currentColor;border:rgba(0,0,0,0) solid 2px;border-radius:4px}.tp-pndtxtv,.tp-coltxtv_w{display:flex}.tp-pndtxtv_a,.tp-coltxtv_c{width:100%}.tp-pndtxtv_a+.tp-pndtxtv_a,.tp-coltxtv_c+.tp-pndtxtv_a,.tp-pndtxtv_a+.tp-coltxtv_c,.tp-coltxtv_c+.tp-coltxtv_c{margin-left:2px}.tp-rotv{--bs-bg: var(--tp-base-background-color, hsl(230, 7%, 17%));--bs-br: var(--tp-base-border-radius, 6px);--bs-ff: var(--tp-base-font-family, Roboto Mono, Source Code Pro, Menlo, Courier, monospace);--bs-sh: var(--tp-base-shadow-color, rgba(0, 0, 0, 0.2));--bld-br: var(--tp-blade-border-radius, 2px);--bld-hp: var(--tp-blade-horizontal-padding, 4px);--bld-vw: var(--tp-blade-value-width, 160px);--btn-bg: var(--tp-button-background-color, hsl(230, 7%, 70%));--btn-bg-a: var(--tp-button-background-color-active, #d6d7db);--btn-bg-f: var(--tp-button-background-color-focus, #c8cad0);--btn-bg-h: var(--tp-button-background-color-hover, #bbbcc4);--btn-fg: var(--tp-button-foreground-color, hsl(230, 7%, 17%));--cnt-bg: var(--tp-container-background-color, rgba(187, 188, 196, 0.1));--cnt-bg-a: var(--tp-container-background-color-active, rgba(187, 188, 196, 0.25));--cnt-bg-f: var(--tp-container-background-color-focus, rgba(187, 188, 196, 0.2));--cnt-bg-h: var(--tp-container-background-color-hover, rgba(187, 188, 196, 0.15));--cnt-fg: var(--tp-container-foreground-color, hsl(230, 7%, 75%));--cnt-hp: var(--tp-container-horizontal-padding, 4px);--cnt-vp: var(--tp-container-vertical-padding, 4px);--cnt-usp: var(--tp-container-unit-spacing, 4px);--cnt-usz: var(--tp-container-unit-size, 20px);--in-bg: var(--tp-input-background-color, rgba(187, 188, 196, 0.1));--in-bg-a: var(--tp-input-background-color-active, rgba(187, 188, 196, 0.25));--in-bg-f: var(--tp-input-background-color-focus, rgba(187, 188, 196, 0.2));--in-bg-h: var(--tp-input-background-color-hover, rgba(187, 188, 196, 0.15));--in-fg: var(--tp-input-foreground-color, hsl(230, 7%, 75%));--lbl-fg: var(--tp-label-foreground-color, rgba(187, 188, 196, 0.7));--mo-bg: var(--tp-monitor-background-color, rgba(0, 0, 0, 0.2));--mo-fg: var(--tp-monitor-foreground-color, rgba(187, 188, 196, 0.7));--grv-fg: var(--tp-groove-foreground-color, rgba(187, 188, 196, 0.1))}.tp-btnv_b{width:100%}.tp-btnv_t{text-align:center}.tp-ckbv_l{display:block;position:relative}.tp-ckbv_i{left:0;opacity:0;position:absolute;top:0}.tp-ckbv_w{background-color:var(--in-bg);border-radius:var(--bld-br);cursor:pointer;display:block;height:var(--cnt-usz);position:relative;width:var(--cnt-usz)}.tp-ckbv_w svg{bottom:0;display:block;height:16px;left:0;margin:auto;opacity:0;position:absolute;right:0;top:0;width:16px}.tp-ckbv_w svg path{fill:none;stroke:var(--in-fg);stroke-width:2}.tp-ckbv_i:hover+.tp-ckbv_w{background-color:var(--in-bg-h)}.tp-ckbv_i:focus+.tp-ckbv_w{background-color:var(--in-bg-f)}.tp-ckbv_i:active+.tp-ckbv_w{background-color:var(--in-bg-a)}.tp-ckbv_i:checked+.tp-ckbv_w svg{opacity:1}.tp-ckbv.tp-v-disabled .tp-ckbv_w{opacity:.5}.tp-colv{position:relative}.tp-colv_h{display:flex}.tp-colv_s{flex-grow:0;flex-shrink:0;width:var(--cnt-usz)}.tp-colv_t{flex:1;margin-left:4px}.tp-colv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-colv.tp-colv-expanded.tp-colv-cpl .tp-colv_p{overflow:visible}.tp-colv.tp-colv-expanded .tp-colv_p{margin-top:var(--cnt-usp);opacity:1}.tp-colv .tp-popv{left:calc(-1*var(--cnt-hp));right:calc(-1*var(--cnt-hp));top:var(--cnt-usz)}.tp-colpv_h,.tp-colpv_ap{margin-left:6px;margin-right:6px}.tp-colpv_h{margin-top:var(--cnt-usp)}.tp-colpv_rgb{display:flex;margin-top:var(--cnt-usp);width:100%}.tp-colpv_a{display:flex;margin-top:var(--cnt-vp);padding-top:calc(var(--cnt-vp) + 2px);position:relative}.tp-colpv_a::before{background-color:var(--grv-fg);content:"";height:2px;left:calc(-1*var(--cnt-hp));position:absolute;right:calc(-1*var(--cnt-hp));top:0}.tp-colpv.tp-v-disabled .tp-colpv_a::before{opacity:.5}.tp-colpv_ap{align-items:center;display:flex;flex:3}.tp-colpv_at{flex:1;margin-left:4px}.tp-svpv{border-radius:var(--bld-br);outline:none;overflow:hidden;position:relative}.tp-svpv.tp-v-disabled{opacity:.5}.tp-svpv_c{cursor:crosshair;display:block;height:calc(var(--cnt-usz)*4);width:100%}.tp-svpv_m{border-radius:100%;border:rgba(255,255,255,.75) solid 2px;box-sizing:border-box;filter:drop-shadow(0 0 1px rgba(0, 0, 0, 0.3));height:12px;margin-left:-6px;margin-top:-6px;pointer-events:none;position:absolute;width:12px}.tp-svpv:focus .tp-svpv_m{border-color:#fff}.tp-hplv{cursor:pointer;height:var(--cnt-usz);outline:none;position:relative}.tp-hplv.tp-v-disabled{opacity:.5}.tp-hplv_c{background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAABCAYAAABubagXAAAAQ0lEQVQoU2P8z8Dwn0GCgQEDi2OK/RBgYHjBgIpfovFh8j8YBIgzFGQxuqEgPhaDOT5gOhPkdCxOZeBg+IDFZZiGAgCaSSMYtcRHLgAAAABJRU5ErkJggg==);background-position:left top;background-repeat:no-repeat;background-size:100% 100%;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;position:absolute;top:50%;width:100%}.tp-hplv_m{border-radius:var(--bld-br);border:rgba(255,255,255,.75) solid 2px;box-shadow:0 0 2px rgba(0,0,0,.1);box-sizing:border-box;height:12px;left:50%;margin-left:-6px;margin-top:-6px;pointer-events:none;position:absolute;top:50%;width:12px}.tp-hplv:focus .tp-hplv_m{border-color:#fff}.tp-aplv{cursor:pointer;height:var(--cnt-usz);outline:none;position:relative;width:100%}.tp-aplv.tp-v-disabled{opacity:.5}.tp-aplv_b{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:4px 4px;background-position:0 0,2px 2px;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;overflow:hidden;position:absolute;top:50%;width:100%}.tp-aplv_c{bottom:0;left:0;position:absolute;right:0;top:0}.tp-aplv_m{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:12px 12px;background-position:0 0,6px 6px;border-radius:var(--bld-br);box-shadow:0 0 2px rgba(0,0,0,.1);height:12px;left:50%;margin-left:-6px;margin-top:-6px;overflow:hidden;pointer-events:none;position:absolute;top:50%;width:12px}.tp-aplv_p{border-radius:var(--bld-br);border:rgba(255,255,255,.75) solid 2px;box-sizing:border-box;bottom:0;left:0;position:absolute;right:0;top:0}.tp-aplv:focus .tp-aplv_p{border-color:#fff}.tp-colswv{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:10px 10px;background-position:0 0,5px 5px;border-radius:var(--bld-br);overflow:hidden}.tp-colswv.tp-v-disabled{opacity:.5}.tp-colswv_sw{border-radius:0}.tp-colswv_b{cursor:pointer;display:block;height:var(--cnt-usz);left:0;position:absolute;top:0;width:var(--cnt-usz)}.tp-colswv_b:focus::after{border:rgba(255,255,255,.75) solid 2px;border-radius:var(--bld-br);bottom:0;content:"";display:block;left:0;position:absolute;right:0;top:0}.tp-coltxtv{display:flex;width:100%}.tp-coltxtv_m{margin-right:4px}.tp-coltxtv_ms{border-radius:var(--bld-br);color:var(--lbl-fg);cursor:pointer;height:var(--cnt-usz);line-height:var(--cnt-usz);padding:0 18px 0 4px}.tp-coltxtv_ms:hover{background-color:var(--in-bg-h)}.tp-coltxtv_ms:focus{background-color:var(--in-bg-f)}.tp-coltxtv_ms:active{background-color:var(--in-bg-a)}.tp-coltxtv_mm{color:var(--lbl-fg)}.tp-coltxtv.tp-v-disabled .tp-coltxtv_mm{opacity:.5}.tp-coltxtv_w{flex:1}.tp-dfwv{position:absolute;top:8px;right:8px;width:256px}.tp-fldv{position:relative}.tp-fldv_t{padding-left:4px}.tp-fldv_b:disabled .tp-fldv_m{display:none}.tp-fldv_c{padding-left:4px}.tp-fldv_i{bottom:0;color:var(--cnt-bg);left:0;overflow:hidden;position:absolute;top:calc(var(--cnt-usz) + 4px);width:max(var(--bs-br),4px)}.tp-fldv_i::before{background-color:currentColor;bottom:0;content:"";left:0;position:absolute;top:0;width:4px}.tp-fldv_b:hover+.tp-fldv_i{color:var(--cnt-bg-h)}.tp-fldv_b:focus+.tp-fldv_i{color:var(--cnt-bg-f)}.tp-fldv_b:active+.tp-fldv_i{color:var(--cnt-bg-a)}.tp-fldv.tp-v-disabled>.tp-fldv_i{opacity:.5}.tp-grlv{position:relative}.tp-grlv_g{display:block;height:calc(var(--cnt-usz)*3)}.tp-grlv_g polyline{fill:none;stroke:var(--mo-fg);stroke-linejoin:round}.tp-grlv_t{margin-top:-4px;transition:left .05s,top .05s;visibility:hidden}.tp-grlv_t.tp-grlv_t-a{visibility:visible}.tp-grlv_t.tp-grlv_t-in{transition:none}.tp-grlv.tp-v-disabled .tp-grlv_g{opacity:.5}.tp-grlv .tp-ttv{background-color:var(--mo-fg)}.tp-grlv .tp-ttv::before{border-top-color:var(--mo-fg)}.tp-lblv{align-items:center;display:flex;line-height:1.3;padding-left:var(--cnt-hp);padding-right:var(--cnt-hp)}.tp-lblv.tp-lblv-nol{display:block}.tp-lblv_l{color:var(--lbl-fg);flex:1;-webkit-hyphens:auto;hyphens:auto;overflow:hidden;padding-left:4px;padding-right:16px}.tp-lblv.tp-v-disabled .tp-lblv_l{opacity:.5}.tp-lblv.tp-lblv-nol .tp-lblv_l{display:none}.tp-lblv_v{align-self:flex-start;flex-grow:0;flex-shrink:0;width:var(--bld-vw)}.tp-lblv.tp-lblv-nol .tp-lblv_v{width:100%}.tp-lstv_s{padding:0 20px 0 var(--bld-hp);width:100%}.tp-lstv_m{color:var(--btn-fg)}.tp-sglv_i{padding-left:var(--bld-hp);padding-right:var(--bld-hp)}.tp-sglv.tp-v-disabled .tp-sglv_i{opacity:.5}.tp-mllv_i{display:block;height:calc(var(--cnt-usz)*3);line-height:var(--cnt-usz);padding-left:var(--bld-hp);padding-right:var(--bld-hp);resize:none;white-space:pre}.tp-mllv.tp-v-disabled .tp-mllv_i{opacity:.5}.tp-p2dv{position:relative}.tp-p2dv_h{display:flex}.tp-p2dv_b{height:var(--cnt-usz);margin-right:4px;position:relative;width:var(--cnt-usz)}.tp-p2dv_b svg{display:block;height:16px;left:50%;margin-left:-8px;margin-top:-8px;position:absolute;top:50%;width:16px}.tp-p2dv_b svg path{stroke:currentColor;stroke-width:2}.tp-p2dv_b svg circle{fill:currentColor}.tp-p2dv_t{flex:1}.tp-p2dv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-p2dv.tp-p2dv-expanded .tp-p2dv_p{margin-top:var(--cnt-usp);opacity:1}.tp-p2dv .tp-popv{left:calc(-1*var(--cnt-hp));right:calc(-1*var(--cnt-hp));top:var(--cnt-usz)}.tp-p2dpv{padding-left:calc(var(--cnt-usz) + 4px)}.tp-p2dpv_p{cursor:crosshair;height:0;overflow:hidden;padding-bottom:100%;position:relative}.tp-p2dpv.tp-v-disabled .tp-p2dpv_p{opacity:.5}.tp-p2dpv_g{display:block;height:100%;left:0;pointer-events:none;position:absolute;top:0;width:100%}.tp-p2dpv_ax{opacity:.1;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_l{opacity:.5;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_m{border:var(--in-fg) solid 1px;border-radius:50%;box-sizing:border-box;height:4px;margin-left:-2px;margin-top:-2px;position:absolute;width:4px}.tp-p2dpv_p:focus .tp-p2dpv_m{background-color:var(--in-fg);border-width:0}.tp-popv{background-color:var(--bs-bg);border-radius:var(--bs-br);box-shadow:0 2px 4px var(--bs-sh);display:none;max-width:var(--bld-vw);padding:var(--cnt-vp) var(--cnt-hp);position:absolute;visibility:hidden;z-index:1000}.tp-popv.tp-popv-v{display:block;visibility:visible}.tp-sldv.tp-v-disabled{opacity:.5}.tp-sldv_t{box-sizing:border-box;cursor:pointer;height:var(--cnt-usz);margin:0 6px;outline:none;position:relative}.tp-sldv_t::before{background-color:var(--in-bg);border-radius:1px;bottom:0;content:"";display:block;height:2px;left:0;margin:auto;position:absolute;right:0;top:0}.tp-sldv_k{height:100%;left:0;position:absolute;top:0}.tp-sldv_k::before{background-color:var(--in-fg);border-radius:1px;bottom:0;content:"";display:block;height:2px;left:0;margin-bottom:auto;margin-top:auto;position:absolute;right:0;top:0}.tp-sldv_k::after{background-color:var(--btn-bg);border-radius:var(--bld-br);bottom:0;content:"";display:block;height:12px;margin-bottom:auto;margin-top:auto;position:absolute;right:-6px;top:0;width:12px}.tp-sldv_t:hover .tp-sldv_k::after{background-color:var(--btn-bg-h)}.tp-sldv_t:focus .tp-sldv_k::after{background-color:var(--btn-bg-f)}.tp-sldv_t:active .tp-sldv_k::after{background-color:var(--btn-bg-a)}.tp-sldtxtv{display:flex}.tp-sldtxtv_s{flex:2}.tp-sldtxtv_t{flex:1;margin-left:4px}.tp-tabv{position:relative}.tp-tabv_t{align-items:flex-end;color:var(--cnt-bg);display:flex;overflow:hidden;position:relative}.tp-tabv_t:hover{color:var(--cnt-bg-h)}.tp-tabv_t:has(*:focus){color:var(--cnt-bg-f)}.tp-tabv_t:has(*:active){color:var(--cnt-bg-a)}.tp-tabv_t::before{background-color:currentColor;bottom:0;content:"";height:2px;left:0;pointer-events:none;position:absolute;right:0}.tp-tabv.tp-v-disabled .tp-tabv_t::before{opacity:.5}.tp-tabv.tp-tabv-nop .tp-tabv_t{height:calc(var(--cnt-usz) + 4px);position:relative}.tp-tabv.tp-tabv-nop .tp-tabv_t::before{background-color:var(--cnt-bg);bottom:0;content:"";height:2px;left:0;position:absolute;right:0}.tp-tabv_i{bottom:0;color:var(--cnt-bg);left:0;overflow:hidden;position:absolute;top:calc(var(--cnt-usz) + 4px);width:max(var(--bs-br),4px)}.tp-tabv_i::before{background-color:currentColor;bottom:0;content:"";left:0;position:absolute;top:0;width:4px}.tp-tabv_t:hover+.tp-tabv_i{color:var(--cnt-bg-h)}.tp-tabv_t:has(*:focus)+.tp-tabv_i{color:var(--cnt-bg-f)}.tp-tabv_t:has(*:active)+.tp-tabv_i{color:var(--cnt-bg-a)}.tp-tabv.tp-v-disabled>.tp-tabv_i{opacity:.5}.tp-tbiv{flex:1;min-width:0;position:relative}.tp-tbiv+.tp-tbiv{margin-left:2px}.tp-tbiv+.tp-tbiv.tp-v-disabled::before{opacity:.5}.tp-tbiv_b{display:block;padding-left:calc(var(--cnt-hp) + 4px);padding-right:calc(var(--cnt-hp) + 4px);position:relative;width:100%}.tp-tbiv_b:disabled{opacity:.5}.tp-tbiv_b::before{background-color:var(--cnt-bg);bottom:2px;content:"";left:0;pointer-events:none;position:absolute;right:0;top:0}.tp-tbiv_b:hover::before{background-color:var(--cnt-bg-h)}.tp-tbiv_b:focus::before{background-color:var(--cnt-bg-f)}.tp-tbiv_b:active::before{background-color:var(--cnt-bg-a)}.tp-tbiv_t{color:var(--cnt-fg);height:calc(var(--cnt-usz) + 4px);line-height:calc(var(--cnt-usz) + 4px);opacity:.5;overflow:hidden;position:relative;text-overflow:ellipsis}.tp-tbiv.tp-tbiv-sel .tp-tbiv_t{opacity:1}.tp-tbpv_c{padding-bottom:var(--cnt-vp);padding-left:4px;padding-top:var(--cnt-vp)}.tp-txtv{position:relative}.tp-txtv_i{padding-left:var(--bld-hp);padding-right:var(--bld-hp)}.tp-txtv.tp-txtv-fst .tp-txtv_i{border-bottom-right-radius:0;border-top-right-radius:0}.tp-txtv.tp-txtv-mid .tp-txtv_i{border-radius:0}.tp-txtv.tp-txtv-lst .tp-txtv_i{border-bottom-left-radius:0;border-top-left-radius:0}.tp-txtv.tp-txtv-num .tp-txtv_i{text-align:right}.tp-txtv.tp-txtv-drg .tp-txtv_i{opacity:.3}.tp-txtv_k{cursor:pointer;height:100%;left:calc(var(--bld-hp) - 5px);position:absolute;top:0;width:12px}.tp-txtv_k::before{background-color:var(--in-fg);border-radius:1px;bottom:0;content:"";height:calc(var(--cnt-usz) - 4px);left:50%;margin-bottom:auto;margin-left:-1px;margin-top:auto;opacity:.1;position:absolute;top:0;transition:border-radius .1s,height .1s,transform .1s,width .1s;width:2px}.tp-txtv_k:hover::before,.tp-txtv.tp-txtv-drg .tp-txtv_k::before{opacity:1}.tp-txtv.tp-txtv-drg .tp-txtv_k::before{border-radius:50%;height:4px;transform:translateX(-1px);width:4px}.tp-txtv_g{bottom:0;display:block;height:8px;left:50%;margin:auto;overflow:visible;pointer-events:none;position:absolute;top:0;visibility:hidden;width:100%}.tp-txtv.tp-txtv-drg .tp-txtv_g{visibility:visible}.tp-txtv_gb{fill:none;stroke:var(--in-fg);stroke-dasharray:1}.tp-txtv_gh{fill:none;stroke:var(--in-fg)}.tp-txtv .tp-ttv{margin-left:6px;visibility:hidden}.tp-txtv.tp-txtv-drg .tp-ttv{visibility:visible}.tp-ttv{background-color:var(--in-fg);border-radius:var(--bld-br);color:var(--bs-bg);padding:2px 4px;pointer-events:none;position:absolute;transform:translate(-50%, -100%)}.tp-ttv::before{border-color:var(--in-fg) rgba(0,0,0,0) rgba(0,0,0,0) rgba(0,0,0,0);border-style:solid;border-width:2px;box-sizing:border-box;content:"";font-size:.9em;height:4px;left:50%;margin-left:-2px;position:absolute;top:100%;width:4px}.tp-rotv{background-color:var(--bs-bg);border-radius:var(--bs-br);box-shadow:0 2px 4px var(--bs-sh);font-family:var(--bs-ff);font-size:11px;font-weight:500;line-height:1;text-align:left}.tp-rotv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br);border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br);padding-left:calc(4px + var(--cnt-usz) + var(--cnt-hp));text-align:center}.tp-rotv.tp-rotv-expanded .tp-rotv_b{border-bottom-left-radius:0;border-bottom-right-radius:0;transition-delay:0s;transition-duration:0s}.tp-rotv.tp-rotv-not>.tp-rotv_b{display:none}.tp-rotv_b:disabled .tp-rotv_m{display:none}.tp-rotv_c>.tp-fldv.tp-v-lst>.tp-fldv_c{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c>.tp-fldv.tp-v-lst>.tp-fldv_i{border-bottom-left-radius:var(--bs-br)}.tp-rotv_c>.tp-fldv.tp-v-lst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c>.tp-fldv.tp-v-lst.tp-fldv-expanded>.tp-fldv_b{transition-delay:0s;transition-duration:0s}.tp-rotv_c .tp-fldv.tp-v-vlst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-right-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst{margin-top:calc(-1*var(--cnt-vp))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst>.tp-fldv_b{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv_c>.tp-tabv.tp-v-lst>.tp-tabv_c{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c>.tp-tabv.tp-v-lst>.tp-tabv_i{border-bottom-left-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst{margin-top:calc(-1*var(--cnt-vp))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst>.tp-tabv_t{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv.tp-v-disabled,.tp-rotv .tp-v-disabled{pointer-events:none}.tp-rotv.tp-v-hidden,.tp-rotv .tp-v-hidden{display:none}.tp-sprv_r{background-color:var(--grv-fg);border-width:0;display:block;height:2px;margin:0;width:100%}.tp-sprv.tp-v-disabled .tp-sprv_r{opacity:.5}',plugins:[rc,r_,rf,iw,rx]})}}new e$("4.0.3");var rC={};function rP(t){return null==t}function rE(t){return null!==t&&"object"==typeof t}function rk(t){return null!==t&&"object"==typeof t}function rV(t,e){if(t.length!==e.length)return!1;for(let i=0;i<t.length;i++)if(t[i]!==e[i])return!1;return!0}function rM(t,e){return Array.from(new Set([...Object.keys(t),...Object.keys(e)])).reduce((i,s)=>{let n=t[s],r=e[s];return rk(n)&&rk(r)?Object.assign(Object.assign({},i),{[s]:rM(n,r)}):Object.assign(Object.assign({},i),{[s]:s in e?r:n})},{})}e(rC,"ButtonCellApi",()=>hW),e(rC,"ButtonGridApi",()=>hQ),e(rC,"ButtonGridController",()=>hJ),e(rC,"CubicBezierApi",()=>h2),e(rC,"CubicBezier",()=>h5),e(rC,"CubicBezierAssembly",()=>h3),e(rC,"CubicBezierView",()=>h7),e(rC,"CubicBezierPickerView",()=>pe),e(rC,"CubicBezierGraphView",()=>pn),e(rC,"CubicBezierPreviewView",()=>pa),e(rC,"CubicBezierGraphController",()=>pl),e(rC,"CubicBezierPickerController",()=>ph),e(rC,"CubicBezierController",()=>pp),e(rC,"FpsGraphBladeApi",()=>pu),e(rC,"Fpswatch",()=>pc),e(rC,"FpsView",()=>pm),e(rC,"FpsGraphController",()=>pb),e(rC,"Interval",()=>p_),e(rC,"IntervalAssembly",()=>pf),e(rC,"IntervalConstraint",()=>px),e(rC,"RangeSliderTextView",()=>pC),e(rC,"RangeSliderView",()=>pE),e(rC,"RangeSliderController",()=>pk),e(rC,"RangeSliderTextController",()=>pV),e(rC,"RadioCellApi",()=>pS),e(rC,"TpRadioGridChangeEvent",()=>pD),e(rC,"RadioGridApi",()=>pO),e(rC,"RadioView",()=>pT),e(rC,"RadioController",()=>pR),e(rC,"RadioGridController",()=>pN),e(rC,"id",()=>pK),e(rC,"css",()=>pq),e(rC,"plugins",()=>p$);const rL={alreadydisposed:()=>"View has been already disposed",invalidparams:t=>`Invalid parameters for '${t.name}'`,nomatchingcontroller:t=>`No matching controller for '${t.key}'`,nomatchingview:t=>`No matching view for '${JSON.stringify(t.params)}'`,notbindable:()=>"Value is not bindable",notcompatible:t=>`Not compatible with  plugin '${t.id}'`,propertynotfound:t=>`Property '${t.name}' not found`,shouldneverhappen:()=>"This error should never happen"};class rA{static alreadyDisposed(){return new rA({type:"alreadydisposed"})}static notBindable(){return new rA({type:"notbindable"})}static notCompatible(t,e){return new rA({type:"notcompatible",context:{id:`${t}.${e}`}})}static propertyNotFound(t){return new rA({type:"propertynotfound",context:{name:t}})}static shouldNeverHappen(){return new rA({type:"shouldneverhappen"})}constructor(t){var e;this.message=null!==(e=rL[t.type](t.context))&&void 0!==e?e:"Unexpected error",this.name=this.constructor.name,this.stack=Error(this.message).stack,this.type=t.type}toString(){return this.message}}class rS{constructor(t,e){this.obj_=t,this.key=e}static isBindable(t){return null!==t&&("object"==typeof t||"function"==typeof t)}read(){return this.obj_[this.key]}write(t){this.obj_[this.key]=t}writeProperty(t,e){let i=this.read();if(!rS.isBindable(i))throw rA.notBindable();if(!(t in i))throw rA.propertyNotFound(t);i[t]=e}}class rD{constructor(){this.observers_={}}on(t,e){let i=this.observers_[t];return i||(i=this.observers_[t]=[]),i.push({handler:e}),this}off(t,e){let i=this.observers_[t];return i&&(this.observers_[t]=i.filter(t=>t.handler!==e)),this}emit(t,e){let i=this.observers_[t];i&&i.forEach(t=>{t.handler(e)})}}class rO{constructor(t,e){var i;this.constraint_=null==e?void 0:e.constraint,this.equals_=null!==(i=null==e?void 0:e.equals)&&void 0!==i?i:(t,e)=>t===e,this.emitter=new rD,this.rawValue_=t}get constraint(){return this.constraint_}get rawValue(){return this.rawValue_}set rawValue(t){this.setRawValue(t,{forceEmit:!1,last:!0})}setRawValue(t,e){let i=null!=e?e:{forceEmit:!1,last:!0},s=this.constraint_?this.constraint_.constrain(t):t,n=this.rawValue_;(!this.equals_(n,s)||i.forceEmit)&&(this.emitter.emit("beforechange",{sender:this}),this.rawValue_=s,this.emitter.emit("change",{options:i,previousRawValue:n,rawValue:s,sender:this}))}}class rj{constructor(t){this.emitter=new rD,this.value_=t}get rawValue(){return this.value_}set rawValue(t){this.setRawValue(t,{forceEmit:!1,last:!0})}setRawValue(t,e){let i=null!=e?e:{forceEmit:!1,last:!0},s=this.value_;(s!==t||i.forceEmit)&&(this.emitter.emit("beforechange",{sender:this}),this.value_=t,this.emitter.emit("change",{options:i,previousRawValue:s,rawValue:this.value_,sender:this}))}}class rT{constructor(t){this.emitter=new rD,this.onValueBeforeChange_=this.onValueBeforeChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.value_=t,this.value_.emitter.on("beforechange",this.onValueBeforeChange_),this.value_.emitter.on("change",this.onValueChange_)}get rawValue(){return this.value_.rawValue}onValueBeforeChange_(t){this.emitter.emit("beforechange",Object.assign(Object.assign({},t),{sender:this}))}onValueChange_(t){this.emitter.emit("change",Object.assign(Object.assign({},t),{sender:this}))}}function rR(t,e){let i=null==e?void 0:e.constraint,s=null==e?void 0:e.equals;return i||s?new rO(t,e):new rj(t)}class rN{constructor(t){for(let e in this.emitter=new rD,this.valMap_=t,this.valMap_)this.valMap_[e].emitter.on("change",()=>{this.emitter.emit("change",{key:e,sender:this})})}static createCore(t){return Object.keys(t).reduce((e,i)=>Object.assign(e,{[i]:rR(t[i])}),{})}static fromObject(t){return new rN(this.createCore(t))}get(t){return this.valMap_[t].rawValue}set(t,e){this.valMap_[t].rawValue=e}value(t){return this.valMap_[t]}}class rz{constructor(t){this.values=rN.fromObject({max:t.max,min:t.min})}constrain(t){let e=this.values.get("max");return Math.min(Math.max(t,this.values.get("min")),e)}}class rB{constructor(t){this.values=rN.fromObject({max:t.max,min:t.min})}constrain(t){let e=this.values.get("max"),i=this.values.get("min"),s=t;return rP(i)||(s=Math.max(s,i)),rP(e)||(s=Math.min(s,e)),s}}class rF{constructor(t,e=0){this.step=t,this.origin=e}constrain(t){let e=this.origin%this.step,i=Math.round((t-e)/this.step);return e+i*this.step}}class rI{constructor(t){this.text=t}evaluate(){return Number(this.text)}toString(){return this.text}}const rU={"**":(t,e)=>Math.pow(t,e),"*":(t,e)=>t*e,"/":(t,e)=>t/e,"%":(t,e)=>t%e,"+":(t,e)=>t+e,"-":(t,e)=>t-e,"<<":(t,e)=>t<<e,">>":(t,e)=>t>>e,">>>":(t,e)=>t>>>e,"&":(t,e)=>t&e,"^":(t,e)=>t^e,"|":(t,e)=>t|e};class rK{constructor(t,e,i){this.left=e,this.operator=t,this.right=i}evaluate(){let t=rU[this.operator];if(!t)throw Error(`unexpected binary operator: '${this.operator}`);return t(this.left.evaluate(),this.right.evaluate())}toString(){return["b(",this.left.toString(),this.operator,this.right.toString(),")"].join(" ")}}const rq={"+":t=>t,"-":t=>-t,"~":t=>~t};class r${constructor(t,e){this.operator=t,this.expression=e}evaluate(){let t=rq[this.operator];if(!t)throw Error(`unexpected unary operator: '${this.operator}`);return t(this.expression.evaluate())}toString(){return["u(",this.operator,this.expression.toString(),")"].join(" ")}}function rG(t){return(e,i)=>{for(let s=0;s<t.length;s++){let n=t[s](e,i);if(""!==n)return n}return""}}function rH(t,e){var i;let s=t.substr(e).match(/^\s+/);return null!==(i=s&&s[0])&&void 0!==i?i:""}function rY(t,e){var i;let s=t.substr(e).match(/^[0-9]+/);return null!==(i=s&&s[0])&&void 0!==i?i:""}function rX(t,e){let i=t.substr(e,1);if(e+=1,"e"!==i.toLowerCase())return"";let s=function(t,e){let i=rY(t,e);if(""!==i)return i;let s=t.substr(e,1);if(e+=1,"-"!==s&&"+"!==s)return"";let n=rY(t,e);return""===n?"":s+n}(t,e);return""===s?"":i+s}function rW(t,e){let i=t.substr(e,1);if("0"===i)return i;let s=function(t,e){let i=t.substr(e,1);return i.match(/^[1-9]$/)?i:""}(t,e);return(e+=s.length,""===s)?"":s+rY(t,e)}const rZ=rG([function(t,e){let i=rW(t,e);if(e+=i.length,""===i)return"";let s=t.substr(e,1);if(e+=s.length,"."!==s)return"";let n=rY(t,e);return e+=n.length,i+s+n+rX(t,e)},function(t,e){let i=t.substr(e,1);if(e+=i.length,"."!==i)return"";let s=rY(t,e);return(e+=s.length,""===s)?"":i+s+rX(t,e)},function(t,e){let i=rW(t,e);return(e+=i.length,""===i)?"":i+rX(t,e)}]),rQ=rG([function(t,e){let i=t.substr(e,2);if(e+=i.length,"0b"!==i.toLowerCase())return"";let s=function(t,e){var i;let s=t.substr(e).match(/^[01]+/);return null!==(i=s&&s[0])&&void 0!==i?i:""}(t,e);return""===s?"":i+s},function(t,e){let i=t.substr(e,2);if(e+=i.length,"0o"!==i.toLowerCase())return"";let s=function(t,e){var i;let s=t.substr(e).match(/^[0-7]+/);return null!==(i=s&&s[0])&&void 0!==i?i:""}(t,e);return""===s?"":i+s},function(t,e){let i=t.substr(e,2);if(e+=i.length,"0x"!==i.toLowerCase())return"";let s=function(t,e){var i;let s=t.substr(e).match(/^[0-9a-f]+/i);return null!==(i=s&&s[0])&&void 0!==i?i:""}(t,e);return""===s?"":i+s}]),rJ=rG([rQ,rZ]),r0=[["**"],["*","/","%"],["+","-"],["<<",">>>",">>"],["&"],["^"],["|"]].reduce((t,e)=>(i,s)=>{let n=t(i,s);if(!n)return null;s=n.cursor;let r=n.evaluable;for(;;){let n=function(t,e,i){i+=rH(e,i).length;let s=t.filter(t=>e.startsWith(t,i))[0];return s?(i+=s.length,{cursor:i+=rH(e,i).length,operator:s}):null}(e,i,s);if(!n)break;let a=t(i,s=n.cursor);if(!a)return null;s=a.cursor,r=new rK(n.operator,r,a.evaluable)}return r?{cursor:s,evaluable:r}:null},function t(e,i){var s,n;let r=null!==(n=function(t,e){let i=rJ(t,e);return(e+=i.length,""===i)?null:{evaluable:new rI(i),cursor:e}}(e,s=i))&&void 0!==n?n:function(t,e){let i=t.substr(e,1);if(e+=i.length,"("!==i)return null;let s=r1(t,e);if(!s)return null;e=s.cursor,e+=rH(t,e).length;let n=t.substr(e,1);return(e+=n.length,")"!==n)?null:{evaluable:s.evaluable,cursor:e}}(e,s);if(r)return r;let a=e.substr(i,1);if(i+=a.length,"+"!==a&&"-"!==a&&"~"!==a)return null;let o=t(e,i);return o?{cursor:i=o.cursor,evaluable:new r$(a,o.evaluable)}:null});function r1(t,e){return e+=rH(t,e).length,r0(t,e)}function r2(t){var e;let i=function(t){let e=r1(t,0);return e&&e.cursor+rH(t,e.cursor).length===t.length?e.evaluable:null}(t);return null!==(e=null==i?void 0:i.evaluate())&&void 0!==e?e:null}function r5(t){if("number"==typeof t)return t;if("string"==typeof t){let e=r2(t);if(!rP(e))return e}return 0}function r3(t){return e=>e.toFixed(Math.max(Math.min(t,20),0))}function r4(t,e,i,s,n){return s+(t-e)/(i-e)*(n-s)}function r6(t){return String(t.toFixed(10)).split(".")[1].replace(/0+$/,"").length}function r9(t,e,i){return Math.min(Math.max(t,e),i)}function r8(t){var e;return null!==(e=t.step)&&void 0!==e?e:1}function r7(t,e){return rP(t.step)?null:new rF(t.step,e)}function at(t){return rP(t.max)||rP(t.min)?rP(t.max)&&rP(t.min)?null:new rB({max:t.max,min:t.min}):new rz({max:t.max,min:t.min})}function ae(t,e){var i,s,n;return{formatter:null!==(i=t.format)&&void 0!==i?i:r3(rP(t.step)?Math.max(r6(e),2):r6(t.step)),keyScale:null!==(s=t.keyScale)&&void 0!==s?s:r8(t),pointerScale:null!==(n=t.pointerScale)&&void 0!==n?n:function(t,e){var i;let s=Math.abs(null!==(i=t.step)&&void 0!==i?i:e);return 0===s?.1:Math.pow(10,Math.floor(Math.log10(s))-1)}(t,e)}}function ai(t){return{format:t.optional.function,keyScale:t.optional.number,max:t.optional.number,min:t.optional.number,pointerScale:t.optional.number,step:t.optional.number}}function as(t){return{constraint:t.constraint,textProps:rN.fromObject(ae(t.params,t.initialValue))}}class an{constructor(t){this.controller=t}get element(){return this.controller.view.element}get disabled(){return this.controller.viewProps.get("disabled")}set disabled(t){this.controller.viewProps.set("disabled",t)}get hidden(){return this.controller.viewProps.get("hidden")}set hidden(t){this.controller.viewProps.set("hidden",t)}dispose(){this.controller.viewProps.set("disposed",!0)}importState(t){return this.controller.importState(t)}exportState(){return this.controller.exportState()}}class ar{constructor(t){this.target=t}}class aa extends ar{constructor(t,e,i){super(t),this.value=e,this.last=null==i||i}}class ao extends ar{constructor(t,e){super(t),this.expanded=e}}class al extends ar{constructor(t,e){super(t),this.index=e}}class ah extends an{constructor(t){super(t),this.onValueChange_=this.onValueChange_.bind(this),this.emitter_=new rD,this.controller.value.emitter.on("change",this.onValueChange_)}get label(){return this.controller.labelController.props.get("label")}set label(t){this.controller.labelController.props.set("label",t)}get key(){return this.controller.value.binding.target.key}get tag(){return this.controller.tag}set tag(t){this.controller.tag=t}on(t,e){let i=e.bind(this);return this.emitter_.on(t,t=>{i(t)}),this}refresh(){this.controller.value.fetch()}onValueChange_(t){let e=this.controller.value;this.emitter_.emit("change",new aa(this,e.binding.target.read(),t.options.last))}}function ap(t){return e=>i=>{if(!e&&void 0===i)return{succeeded:!1,value:void 0};if(e&&void 0===i)return{succeeded:!0,value:void 0};let s=t(i);return void 0!==s?{succeeded:!0,value:s}:{succeeded:!1,value:void 0}}}function ad(t){return{custom:e=>ap(e)(t),boolean:ap(t=>"boolean"==typeof t?t:void 0)(t),number:ap(t=>"number"==typeof t?t:void 0)(t),string:ap(t=>"string"==typeof t?t:void 0)(t),function:ap(t=>"function"==typeof t?t:void 0)(t),constant:e=>ap(t=>t===e?e:void 0)(t),raw:ap(t=>t)(t),object:e=>ap(t=>{if(null!==t&&"object"==typeof t)return Object.keys(e).reduce((i,s)=>{if(void 0===i)return;let n=(0,e[s])(t[s]);return n.succeeded?Object.assign(Object.assign({},i),{[s]:n.value}):void 0},{})})(t),array:e=>ap(t=>{if(Array.isArray(t))return t.reduce((t,i)=>{if(void 0===t)return;let s=e(i);if(s.succeeded&&void 0!==s.value)return[...t,s.value]},[])})(t)}}const au={optional:ad(!0),required:ad(!1)};function ac(t,e){let i=e(au),s=au.required.object(i)(t);return s.succeeded?s.value:void 0}function av(t,e,i,s){if(e&&!e(t))return!1;let n=ac(t,i);return!!n&&s(n)}function am(t,e){var i;return rM(null!==(i=null==t?void 0:t())&&void 0!==i?i:{},e)}function ab(t){return"value"in t}const ag="http://www.w3.org/2000/svg";function aw(t){t.offsetHeight}function a_(t){return void 0!==t.ontouchstart}const af={check:'<path d="M2 8l4 4l8 -8"/>',dropdown:'<path d="M5 7h6l-3 3 z"/>',p2dpad:'<path d="M8 4v8"/><path d="M4 8h8"/><circle cx="12" cy="12" r="1.2"/>'};function ax(t,e){let i=t.createElementNS(ag,"svg");return i.innerHTML=af[e],i}function ay(t,e,i){t.insertBefore(e,t.children[i])}function aC(t){t.parentElement&&t.parentElement.removeChild(t)}function aP(t){for(;t.children.length>0;)t.removeChild(t.children[0])}function aE(t){return t.relatedTarget?t.relatedTarget:"explicitOriginalTarget"in t?t.explicitOriginalTarget:null}function ak(t,e){t.emitter.on("change",t=>{e(t.rawValue)}),e(t.rawValue)}function aV(t,e,i){ak(t.value(e),i)}function aM(t){return(e,i)=>["tp","-",t,"v",e?`_${e}`:"",i?`-${i}`:""].join("")}const aL=aM("lbl");class aA{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(aL()),e.viewProps.bindClassModifiers(this.element);let i=t.createElement("div");i.classList.add(aL("l")),aV(e.props,"label",e=>{rP(e)?this.element.classList.add(aL(void 0,"nol")):(this.element.classList.remove(aL(void 0,"nol")),function(t){for(;t.childNodes.length>0;)t.removeChild(t.childNodes[0])}(i),i.appendChild(function(t,e){let i=t.createDocumentFragment();return e.split("\n").map(e=>t.createTextNode(e)).forEach((e,s)=>{s>0&&i.appendChild(t.createElement("br")),i.appendChild(e)}),i}(t,e)))}),this.element.appendChild(i),this.labelElement=i;let s=t.createElement("div");s.classList.add(aL("v")),this.element.appendChild(s),this.valueElement=s}}class aS{constructor(t,e){this.props=e.props,this.valueController=e.valueController,this.viewProps=e.valueController.viewProps,this.view=new aA(t,{props:e.props,viewProps:this.viewProps}),this.view.valueElement.appendChild(this.valueController.view.element)}importProps(t){return av(t,null,t=>({label:t.optional.string}),t=>(this.props.set("label",t.label),!0))}exportProps(){return am(null,{label:this.props.get("label")})}}const aD=aM(""),aO={veryfirst:"vfst",first:"fst",last:"lst",verylast:"vlst"};class aj{constructor(t){this.parent_=null,this.blade=t.blade,this.view=t.view,this.viewProps=t.viewProps;let e=this.view.element;this.blade.value("positions").emitter.on("change",()=>{["veryfirst","first","last","verylast"].forEach(t=>{e.classList.remove(aD(void 0,aO[t]))}),this.blade.get("positions").forEach(t=>{e.classList.add(aD(void 0,aO[t]))})}),this.viewProps.handleDispose(()=>{aC(e)})}get parent(){return this.parent_}set parent(t){this.parent_=t,this.viewProps.set("parent",this.parent_?this.parent_.viewProps:null)}importState(t){return av(t,null,t=>({disabled:t.required.boolean,hidden:t.required.boolean}),t=>(this.viewProps.importState(t),!0))}exportState(){return am(null,Object.assign({},this.viewProps.exportState()))}}class aT extends aj{constructor(t,e){if(e.value!==e.valueController.value)throw rA.shouldNeverHappen();let i=e.valueController.viewProps,s=new aS(t,{blade:e.blade,props:e.props,valueController:e.valueController});super(Object.assign(Object.assign({},e),{view:new aA(t,{props:e.props,viewProps:i}),viewProps:i})),this.labelController=s,this.value=e.value,this.valueController=e.valueController,this.view.valueElement.appendChild(this.valueController.view.element)}importState(t){return av(t,e=>{var i,s,n;return super.importState(e)&&this.labelController.importProps(e)&&(null===(n=null===(s=(i=this.valueController).importProps)||void 0===s?void 0:s.call(i,t))||void 0===n||n)},t=>({value:t.optional.raw}),t=>(t.value&&(this.value.rawValue=t.value),!0))}exportState(){var t,e,i;return am(()=>super.exportState(),Object.assign(Object.assign({value:this.value.rawValue},this.labelController.exportProps()),null!==(i=null===(e=(t=this.valueController).exportProps)||void 0===e?void 0:e.call(t))&&void 0!==i?i:{}))}}function aR(t,e){for(;t.length<e;)t.push(void 0)}class aN extends an{get label(){return this.controller.labelController.props.get("label")}set label(t){this.controller.labelController.props.set("label",t)}get title(){var t;return null!==(t=this.controller.buttonController.props.get("title"))&&void 0!==t?t:""}set title(t){this.controller.buttonController.props.set("title",t)}on(t,e){let i=e.bind(this);return this.controller.buttonController.emitter.on(t,()=>{i(new ar(this))}),this}}function az(t,e){return i=>{i?t.classList.add(e):t.classList.remove(e)}}function aB(t,e){ak(t,t=>{e.textContent=null!=t?t:""})}const aF=aM("btn");class aI{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(aF()),e.viewProps.bindClassModifiers(this.element);let i=t.createElement("button");i.classList.add(aF("b")),e.viewProps.bindDisabled(i),this.element.appendChild(i),this.buttonElement=i;let s=t.createElement("div");s.classList.add(aF("t")),aB(e.props.value("title"),s),this.buttonElement.appendChild(s)}}class aU{constructor(t,e){this.emitter=new rD,this.onClick_=this.onClick_.bind(this),this.props=e.props,this.viewProps=e.viewProps,this.view=new aI(t,{props:this.props,viewProps:this.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}importProps(t){return av(t,null,t=>({title:t.optional.string}),t=>(this.props.set("title",t.title),!0))}exportProps(){return am(null,{title:this.props.get("title")})}onClick_(){this.emitter.emit("click",{sender:this})}}class aK extends aj{constructor(t,e){let i=new aU(t,{props:e.buttonProps,viewProps:e.viewProps}),s=new aS(t,{blade:e.blade,props:e.labelProps,valueController:i});super({blade:e.blade,view:s.view,viewProps:e.viewProps}),this.buttonController=i,this.labelController=s}importState(t){return av(t,t=>super.importState(t)&&this.buttonController.importProps(t)&&this.labelController.importProps(t),()=>({}),()=>!0)}exportState(){return am(()=>super.exportState(),Object.assign(Object.assign({},this.buttonController.exportProps()),this.labelController.exportProps()))}}const aq=new class{constructor(t){let[e,i]=t.split("-"),s=e.split(".");this.major=parseInt(s[0],10),this.minor=parseInt(s[1],10),this.patch=parseInt(s[2],10),this.prerelease=null!=i?i:null}toString(){let t=[this.major,this.minor,this.patch].join(".");return null!==this.prerelease?[t,this.prerelease].join("-"):t}}("2.0.0-beta.2");function a$(t){return Object.assign({core:aq},t)}a$({id:"button",type:"blade",accept(t){let e=ac(t,t=>({title:t.required.string,view:t.required.constant("button"),label:t.optional.string}));return e?{params:e}:null},controller:t=>new aK(t.document,{blade:t.blade,buttonProps:rN.fromObject({title:t.params.title}),labelProps:rN.fromObject({label:t.params.label}),viewProps:t.viewProps}),api:t=>t.controller instanceof aK?new aN(t.controller):null});class aG{constructor(t,e){this.onRackValueChange_=this.onRackValueChange_.bind(this),this.controller_=t,this.emitter_=new rD,this.pool_=e,this.controller_.rack.emitter.on("valuechange",this.onRackValueChange_)}get children(){return this.controller_.rack.children.map(t=>this.pool_.createApi(t))}addBinding(t,e,i){let s=null!=i?i:{},n=this.controller_.element.ownerDocument,r=this.pool_.createBinding(n,function(t,e){if(!rS.isBindable(t))throw rA.notBindable();return new rS(t,e)}(t,e),s),a=this.pool_.createBindingApi(r);return this.add(a,s.index)}addFolder(t){return this.addBlade(Object.assign(Object.assign({},t),{view:"folder"}))}addButton(t){return this.addBlade(Object.assign(Object.assign({},t),{view:"button"}))}addTab(t){return this.addBlade(Object.assign(Object.assign({},t),{view:"tab"}))}add(t,e){let i=t.controller;return this.controller_.rack.add(i,e),t}remove(t){this.controller_.rack.remove(t.controller)}addBlade(t){let e=this.controller_.element.ownerDocument,i=this.pool_.createBlade(e,t),s=this.pool_.createApi(i);return this.add(s,t.index)}on(t,e){let i=e.bind(this);return this.emitter_.on(t,t=>{i(t)}),this}refresh(){this.children.forEach(t=>{rE(t)&&"refresh"in t&&"function"==typeof t.refresh&&t.refresh()})}onRackValueChange_(t){var e,i;let s=t.bladeController,n=this.pool_.createApi(s),r=rE(e=s.value)&&"binding"in e&&rE(i=e.binding)&&"target"in i?s.value.binding:null;this.emitter_.emit("change",new aa(n,r?r.target.read():s.value.rawValue,t.options.last))}}class aH extends an{constructor(t,e){super(t),this.rackApi_=new aG(t.rackController,e)}}class aY extends aj{constructor(t){super({blade:t.blade,view:t.view,viewProps:t.rackController.viewProps}),this.rackController=t.rackController}importState(t){return av(t,t=>super.importState(t),t=>({children:t.required.array(t.required.raw)}),t=>this.rackController.rack.children.every((e,i)=>e.importState(t.children[i])))}exportState(){return am(()=>super.exportState(),{children:this.rackController.rack.children.map(t=>t.exportState())})}}function aX(t){return"rackController"in t}class aW{constructor(t){this.emitter=new rD,this.items_=[],this.cache_=new Set,this.onSubListAdd_=this.onSubListAdd_.bind(this),this.onSubListRemove_=this.onSubListRemove_.bind(this),this.extract_=t}get items(){return this.items_}allItems(){return Array.from(this.cache_)}find(t){for(let e of this.allItems())if(t(e))return e;return null}includes(t){return this.cache_.has(t)}add(t,e){if(this.includes(t))throw rA.shouldNeverHappen();let i=void 0!==e?e:this.items_.length;this.items_.splice(i,0,t),this.cache_.add(t);let s=this.extract_(t);s&&(s.emitter.on("add",this.onSubListAdd_),s.emitter.on("remove",this.onSubListRemove_),s.allItems().forEach(t=>{this.cache_.add(t)})),this.emitter.emit("add",{index:i,item:t,root:this,target:this})}remove(t){let e=this.items_.indexOf(t);if(e<0)return;this.items_.splice(e,1),this.cache_.delete(t);let i=this.extract_(t);i&&(i.allItems().forEach(t=>{this.cache_.delete(t)}),i.emitter.off("add",this.onSubListAdd_),i.emitter.off("remove",this.onSubListRemove_)),this.emitter.emit("remove",{index:e,item:t,root:this,target:this})}onSubListAdd_(t){this.cache_.add(t.item),this.emitter.emit("add",{index:t.index,item:t.item,root:this,target:t.target})}onSubListRemove_(t){this.cache_.delete(t.item),this.emitter.emit("remove",{index:t.index,item:t.item,root:this,target:t.target})}}function aZ(t){return aX(t)?t.rackController.rack.bcSet_:null}class aQ{constructor(t){var e,i;this.emitter=new rD,this.onBladePositionsChange_=this.onBladePositionsChange_.bind(this),this.onSetAdd_=this.onSetAdd_.bind(this),this.onSetRemove_=this.onSetRemove_.bind(this),this.onChildDispose_=this.onChildDispose_.bind(this),this.onChildPositionsChange_=this.onChildPositionsChange_.bind(this),this.onChildValueChange_=this.onChildValueChange_.bind(this),this.onChildViewPropsChange_=this.onChildViewPropsChange_.bind(this),this.onRackLayout_=this.onRackLayout_.bind(this),this.onRackValueChange_=this.onRackValueChange_.bind(this),this.blade_=null!==(e=t.blade)&&void 0!==e?e:null,null===(i=this.blade_)||void 0===i||i.value("positions").emitter.on("change",this.onBladePositionsChange_),this.viewProps=t.viewProps,this.bcSet_=new aW(aZ),this.bcSet_.emitter.on("add",this.onSetAdd_),this.bcSet_.emitter.on("remove",this.onSetRemove_)}get children(){return this.bcSet_.items}add(t,e){var i;null===(i=t.parent)||void 0===i||i.remove(t),t.parent=this,this.bcSet_.add(t,e)}remove(t){t.parent=null,this.bcSet_.remove(t)}find(t){return this.bcSet_.allItems().filter(t)}onSetAdd_(t){this.updatePositions_();let e=t.target===t.root;if(this.emitter.emit("add",{bladeController:t.item,index:t.index,root:e,sender:this}),!e)return;let i=t.item;if(i.viewProps.emitter.on("change",this.onChildViewPropsChange_),i.blade.value("positions").emitter.on("change",this.onChildPositionsChange_),i.viewProps.handleDispose(this.onChildDispose_),ab(i))i.value.emitter.on("change",this.onChildValueChange_);else if(aX(i)){let t=i.rackController.rack;if(t){let e=t.emitter;e.on("layout",this.onRackLayout_),e.on("valuechange",this.onRackValueChange_)}}}onSetRemove_(t){this.updatePositions_();let e=t.target===t.root;if(this.emitter.emit("remove",{bladeController:t.item,root:e,sender:this}),!e)return;let i=t.item;if(ab(i))i.value.emitter.off("change",this.onChildValueChange_);else if(aX(i)){let t=i.rackController.rack;if(t){let e=t.emitter;e.off("layout",this.onRackLayout_),e.off("valuechange",this.onRackValueChange_)}}}updatePositions_(){let t=this.bcSet_.items.filter(t=>!t.viewProps.get("hidden")),e=t[0],i=t[t.length-1];this.bcSet_.items.forEach(t=>{let s=[];t===e&&(s.push("first"),(!this.blade_||this.blade_.get("positions").includes("veryfirst"))&&s.push("veryfirst")),t===i&&(s.push("last"),(!this.blade_||this.blade_.get("positions").includes("verylast"))&&s.push("verylast")),t.blade.set("positions",s)})}onChildPositionsChange_(){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildViewPropsChange_(t){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildDispose_(){this.bcSet_.items.filter(t=>t.viewProps.get("disposed")).forEach(t=>{this.bcSet_.remove(t)})}onChildValueChange_(t){let e=function(t,e){for(let i=0;i<t.length;i++){let s=t[i];if(ab(s)&&s.value===e)return s}return null}(this.find(ab),t.sender);if(!e)throw rA.alreadyDisposed();this.emitter.emit("valuechange",{bladeController:e,options:t.options,sender:this})}onRackLayout_(t){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onRackValueChange_(t){this.emitter.emit("valuechange",{bladeController:t.bladeController,options:t.options,sender:this})}onBladePositionsChange_(){this.updatePositions_()}}class aJ{constructor(t){this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this),this.element=t.element,this.viewProps=t.viewProps;let e=new aQ({blade:t.root?void 0:t.blade,viewProps:t.viewProps});e.emitter.on("add",this.onRackAdd_),e.emitter.on("remove",this.onRackRemove_),this.rack=e,this.viewProps.handleDispose(()=>{for(let t=this.rack.children.length-1;t>=0;t--)this.rack.children[t].viewProps.set("disposed",!0)})}onRackAdd_(t){t.root&&ay(this.element,t.bladeController.view.element,t.index)}onRackRemove_(t){t.root&&aC(t.bladeController.view.element)}}function a0(){return new rN({positions:rR([],{equals:rV})})}class a1 extends rN{constructor(t){super(t)}static create(t){return new a1(rN.createCore({completed:!0,expanded:t,expandedHeight:null,shouldFixHeight:!1,temporaryExpanded:null}))}get styleExpanded(){var t;return null!==(t=this.get("temporaryExpanded"))&&void 0!==t?t:this.get("expanded")}get styleHeight(){if(!this.styleExpanded)return"0";let t=this.get("expandedHeight");return this.get("shouldFixHeight")&&!rP(t)?`${t}px`:"auto"}bindExpandedClass(t,e){let i=()=>{this.styleExpanded?t.classList.add(e):t.classList.remove(e)};aV(this,"expanded",i),aV(this,"temporaryExpanded",i)}cleanUpTransition(){this.set("shouldFixHeight",!1),this.set("expandedHeight",null),this.set("completed",!0)}}function a2(t,e){e.style.height=t.styleHeight}function a5(t,e){t.value("expanded").emitter.on("beforechange",()=>{if(t.set("completed",!1),rP(t.get("expandedHeight"))){let i;let s=(i=0,function(t,e){let i=t.style.transition;t.style.transition="none",e(),t.style.transition=i}(e,()=>{t.set("expandedHeight",null),t.set("temporaryExpanded",!0),aw(e),i=e.clientHeight,t.set("temporaryExpanded",null),aw(e)}),i);s>0&&t.set("expandedHeight",s)}t.set("shouldFixHeight",!0),aw(e)}),t.emitter.on("change",()=>{a2(t,e)}),a2(t,e),e.addEventListener("transitionend",e=>{"height"===e.propertyName&&t.cleanUpTransition()})}class a3 extends aH{constructor(t,e){super(t,e),this.emitter_=new rD,this.controller.foldable.value("expanded").emitter.on("change",t=>{this.emitter_.emit("fold",new ao(this,t.sender.rawValue))}),this.rackApi_.on("change",t=>{this.emitter_.emit("change",t)})}get expanded(){return this.controller.foldable.get("expanded")}set expanded(t){this.controller.foldable.set("expanded",t)}get title(){return this.controller.props.get("title")}set title(t){this.controller.props.set("title",t)}get children(){return this.rackApi_.children}addBinding(t,e,i){return this.rackApi_.addBinding(t,e,i)}addFolder(t){return this.rackApi_.addFolder(t)}addButton(t){return this.rackApi_.addButton(t)}addTab(t){return this.rackApi_.addTab(t)}add(t,e){return this.rackApi_.add(t,e)}remove(t){this.rackApi_.remove(t)}addBlade(t){return this.rackApi_.addBlade(t)}on(t,e){let i=e.bind(this);return this.emitter_.on(t,t=>{i(t)}),this}refresh(){this.rackApi_.refresh()}}const a4=aM("cnt");class a6{constructor(t,e){var i;this.className_=aM(null!==(i=e.viewName)&&void 0!==i?i:"fld"),this.element=t.createElement("div"),this.element.classList.add(this.className_(),a4()),e.viewProps.bindClassModifiers(this.element),this.foldable_=e.foldable,this.foldable_.bindExpandedClass(this.element,this.className_(void 0,"expanded")),aV(this.foldable_,"completed",az(this.element,this.className_(void 0,"cpl")));let s=t.createElement("button");s.classList.add(this.className_("b")),aV(e.props,"title",t=>{rP(t)?this.element.classList.add(this.className_(void 0,"not")):this.element.classList.remove(this.className_(void 0,"not"))}),e.viewProps.bindDisabled(s),this.element.appendChild(s),this.buttonElement=s;let n=t.createElement("div");n.classList.add(this.className_("i")),this.element.appendChild(n);let r=t.createElement("div");r.classList.add(this.className_("t")),aB(e.props.value("title"),r),this.buttonElement.appendChild(r),this.titleElement=r;let a=t.createElement("div");a.classList.add(this.className_("m")),this.buttonElement.appendChild(a);let o=t.createElement("div");o.classList.add(this.className_("c")),this.element.appendChild(o),this.containerElement=o}}class a9 extends aY{constructor(t,e){var i;let s=a1.create(null===(i=e.expanded)||void 0===i||i),n=new a6(t,{foldable:s,props:e.props,viewName:e.root?"rot":void 0,viewProps:e.viewProps});super(Object.assign(Object.assign({},e),{rackController:new aJ({blade:e.blade,element:n.containerElement,root:e.root,viewProps:e.viewProps}),view:n})),this.onTitleClick_=this.onTitleClick_.bind(this),this.props=e.props,this.foldable=s,a5(this.foldable,this.view.containerElement),this.rackController.rack.emitter.on("add",()=>{this.foldable.cleanUpTransition()}),this.rackController.rack.emitter.on("remove",()=>{this.foldable.cleanUpTransition()}),this.view.buttonElement.addEventListener("click",this.onTitleClick_)}get document(){return this.view.element.ownerDocument}importState(t){return av(t,t=>super.importState(t),t=>({expanded:t.required.boolean,title:t.optional.string}),t=>(this.foldable.set("expanded",t.expanded),this.props.set("title",t.title),!0))}exportState(){return am(()=>super.exportState(),{expanded:this.foldable.get("expanded"),title:this.props.get("title")})}onTitleClick_(){this.foldable.set("expanded",!this.foldable.get("expanded"))}}a$({id:"folder",type:"blade",accept(t){let e=ac(t,t=>({title:t.required.string,view:t.required.constant("folder"),expanded:t.optional.boolean}));return e?{params:e}:null},controller:t=>new a9(t.document,{blade:t.blade,expanded:t.params.expanded,props:rN.fromObject({title:t.params.title}),viewProps:t.viewProps}),api:t=>t.controller instanceof a9?new a3(t.controller,t.pool):null});const a8=aM("");function a7(t,e){return az(t,a8(void 0,e))}class ot extends rN{constructor(t){var e,i;super(t),this.onDisabledChange_=this.onDisabledChange_.bind(this),this.onParentChange_=this.onParentChange_.bind(this),this.onParentGlobalDisabledChange_=this.onParentGlobalDisabledChange_.bind(this),[this.globalDisabled_,this.setGlobalDisabled_]=[new rT(i=rR(this.getGlobalDisabled_())),(t,e)=>{i.setRawValue(t,e)}],this.value("disabled").emitter.on("change",this.onDisabledChange_),this.value("parent").emitter.on("change",this.onParentChange_),null===(e=this.get("parent"))||void 0===e||e.globalDisabled.emitter.on("change",this.onParentGlobalDisabledChange_)}static create(t){var e,i,s;let n=null!=t?t:{};return new ot(rN.createCore({disabled:null!==(e=n.disabled)&&void 0!==e&&e,disposed:!1,hidden:null!==(i=n.hidden)&&void 0!==i&&i,parent:null!==(s=n.parent)&&void 0!==s?s:null}))}get globalDisabled(){return this.globalDisabled_}bindClassModifiers(t){ak(this.globalDisabled_,a7(t,"disabled")),aV(this,"hidden",a7(t,"hidden"))}bindDisabled(t){ak(this.globalDisabled_,e=>{t.disabled=e})}bindTabIndex(t){ak(this.globalDisabled_,e=>{t.tabIndex=e?-1:0})}handleDispose(t){this.value("disposed").emitter.on("change",e=>{e&&t()})}importState(t){this.set("disabled",t.disabled),this.set("hidden",t.hidden)}exportState(){return{disabled:this.get("disabled"),hidden:this.get("hidden")}}getGlobalDisabled_(){let t=this.get("parent");return!!t&&t.globalDisabled.rawValue||this.get("disabled")}updateGlobalDisabled_(){this.setGlobalDisabled_(this.getGlobalDisabled_())}onDisabledChange_(){this.updateGlobalDisabled_()}onParentGlobalDisabledChange_(){this.updateGlobalDisabled_()}onParentChange_(t){var e;let i=t.previousRawValue;null==i||i.globalDisabled.emitter.off("change",this.onParentGlobalDisabledChange_),null===(e=this.get("parent"))||void 0===e||e.globalDisabled.emitter.on("change",this.onParentGlobalDisabledChange_),this.updateGlobalDisabled_()}}const oe=aM("tbp");class oi{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(oe()),e.viewProps.bindClassModifiers(this.element);let i=t.createElement("div");i.classList.add(oe("c")),this.element.appendChild(i),this.containerElement=i}}const os=aM("tbi");class on{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(os()),e.viewProps.bindClassModifiers(this.element),aV(e.props,"selected",t=>{t?this.element.classList.add(os(void 0,"sel")):this.element.classList.remove(os(void 0,"sel"))});let i=t.createElement("button");i.classList.add(os("b")),e.viewProps.bindDisabled(i),this.element.appendChild(i),this.buttonElement=i;let s=t.createElement("div");s.classList.add(os("t")),aB(e.props.value("title"),s),this.buttonElement.appendChild(s),this.titleElement=s}}class or{constructor(t,e){this.emitter=new rD,this.onClick_=this.onClick_.bind(this),this.props=e.props,this.viewProps=e.viewProps,this.view=new on(t,{props:e.props,viewProps:e.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}onClick_(){this.emitter.emit("click",{sender:this})}}class oa extends aY{constructor(t,e){let i=new oi(t,{viewProps:e.viewProps});super(Object.assign(Object.assign({},e),{rackController:new aJ({blade:e.blade,element:i.containerElement,viewProps:e.viewProps}),view:i})),this.onItemClick_=this.onItemClick_.bind(this),this.ic_=new or(t,{props:e.itemProps,viewProps:ot.create()}),this.ic_.emitter.on("click",this.onItemClick_),this.props=e.props,aV(this.props,"selected",t=>{this.itemController.props.set("selected",t),this.viewProps.set("hidden",!t)})}get itemController(){return this.ic_}importState(t){return av(t,t=>super.importState(t),t=>({selected:t.required.boolean,title:t.required.string}),t=>(this.ic_.props.set("selected",t.selected),this.ic_.props.set("title",t.title),!0))}exportState(){return am(()=>super.exportState(),{selected:this.ic_.props.get("selected"),title:this.ic_.props.get("title")})}onItemClick_(){this.props.set("selected",!0)}}class oo extends aH{constructor(t,e){super(t,e),this.emitter_=new rD,this.onSelect_=this.onSelect_.bind(this),this.pool_=e,this.rackApi_.on("change",t=>{this.emitter_.emit("change",t)}),this.controller.tab.selectedIndex.emitter.on("change",this.onSelect_)}get pages(){return this.rackApi_.children}addPage(t){let e=new oa(this.controller.view.element.ownerDocument,{blade:a0(),itemProps:rN.fromObject({selected:!1,title:t.title}),props:rN.fromObject({selected:!1}),viewProps:ot.create()}),i=this.pool_.createApi(e);return this.rackApi_.add(i,t.index)}removePage(t){this.rackApi_.remove(this.rackApi_.children[t])}on(t,e){let i=e.bind(this);return this.emitter_.on(t,t=>{i(t)}),this}onSelect_(t){this.emitter_.emit("select",new al(this,t.rawValue))}}class ol extends aH{get title(){var t;return null!==(t=this.controller.itemController.props.get("title"))&&void 0!==t?t:""}set title(t){this.controller.itemController.props.set("title",t)}get selected(){return this.controller.props.get("selected")}set selected(t){this.controller.props.set("selected",t)}get children(){return this.rackApi_.children}addButton(t){return this.rackApi_.addButton(t)}addFolder(t){return this.rackApi_.addFolder(t)}addTab(t){return this.rackApi_.addTab(t)}add(t,e){this.rackApi_.add(t,e)}remove(t){this.rackApi_.remove(t)}addBinding(t,e,i){return this.rackApi_.addBinding(t,e,i)}addBlade(t){return this.rackApi_.addBlade(t)}refresh(){this.rackApi_.refresh()}}class oh{constructor(){this.onItemSelectedChange_=this.onItemSelectedChange_.bind(this),this.empty=rR(!0),this.selectedIndex=rR(-1),this.items_=[]}add(t,e){let i=null!=e?e:this.items_.length;this.items_.splice(i,0,t),t.emitter.on("change",this.onItemSelectedChange_),this.keepSelection_()}remove(t){let e=this.items_.indexOf(t);e<0||(this.items_.splice(e,1),t.emitter.off("change",this.onItemSelectedChange_),this.keepSelection_())}keepSelection_(){if(0===this.items_.length){this.selectedIndex.rawValue=-1,this.empty.rawValue=!0;return}let t=this.items_.findIndex(t=>t.rawValue);t<0?(this.items_.forEach((t,e)=>{t.rawValue=0===e}),this.selectedIndex.rawValue=0):(this.items_.forEach((e,i)=>{e.rawValue=i===t}),this.selectedIndex.rawValue=t),this.empty.rawValue=!1}onItemSelectedChange_(t){if(t.rawValue){let e=this.items_.findIndex(e=>e===t.sender);this.items_.forEach((t,i)=>{t.rawValue=i===e}),this.selectedIndex.rawValue=e}else this.keepSelection_()}}const op=aM("tab");class od{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(op(),a4()),e.viewProps.bindClassModifiers(this.element),ak(e.empty,az(this.element,op(void 0,"nop")));let i=t.createElement("div");i.classList.add(op("t")),this.element.appendChild(i),this.itemsElement=i;let s=t.createElement("div");s.classList.add(op("i")),this.element.appendChild(s);let n=t.createElement("div");n.classList.add(op("c")),this.element.appendChild(n),this.contentsElement=n}}class ou extends aY{constructor(t,e){let i=new oh,s=new od(t,{empty:i.empty,viewProps:e.viewProps});super({blade:e.blade,rackController:new aJ({blade:e.blade,element:s.contentsElement,viewProps:e.viewProps}),view:s}),this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this);let n=this.rackController.rack;n.emitter.on("add",this.onRackAdd_),n.emitter.on("remove",this.onRackRemove_),this.tab=i}add(t,e){this.rackController.rack.add(t,e)}remove(t){this.rackController.rack.remove(this.rackController.rack.children[t])}onRackAdd_(t){if(!t.root)return;let e=t.bladeController;ay(this.view.itemsElement,e.itemController.view.element,t.index),e.itemController.viewProps.set("parent",this.viewProps),this.tab.add(e.props.value("selected"))}onRackRemove_(t){if(!t.root)return;let e=t.bladeController;aC(e.itemController.view.element),e.itemController.viewProps.set("parent",null),this.tab.remove(e.props.value("selected"))}}a$({id:"tab",type:"blade",accept(t){let e=ac(t,t=>({pages:t.required.array(t.required.object({title:t.required.string})),view:t.required.constant("tab")}));return e&&0!==e.pages.length?{params:e}:null},controller(t){let e=new ou(t.document,{blade:t.blade,viewProps:t.viewProps});return t.params.pages.forEach(i=>{let s=new oa(t.document,{blade:a0(),itemProps:rN.fromObject({selected:!1,title:i.title}),props:rN.fromObject({selected:!1}),viewProps:ot.create()});e.add(s)}),e},api:t=>t.controller instanceof ou?new oo(t.controller,t.pool):t.controller instanceof oa?new ol(t.controller,t.pool):null});class oc extends ah{get options(){return this.controller.valueController.props.get("options")}set options(t){this.controller.valueController.props.set("options",t)}}class ov{constructor(){this.disabled=!1,this.emitter=new rD}dispose(){}tick(){this.disabled||this.emitter.emit("tick",{sender:this})}}class om{constructor(t,e){this.disabled_=!1,this.timerId_=null,this.onTick_=this.onTick_.bind(this),this.doc_=t,this.emitter=new rD,this.interval_=e,this.setTimer_()}get disabled(){return this.disabled_}set disabled(t){this.disabled_=t,this.disabled_?this.clearTimer_():this.setTimer_()}dispose(){this.clearTimer_()}clearTimer_(){if(null===this.timerId_)return;let t=this.doc_.defaultView;t&&t.clearInterval(this.timerId_),this.timerId_=null}setTimer_(){if(this.clearTimer_(),this.interval_<=0)return;let t=this.doc_.defaultView;t&&(this.timerId_=t.setInterval(this.onTick_,this.interval_))}onTick_(){this.disabled_||this.emitter.emit("tick",{sender:this})}}class ob{constructor(t){this.constraints=t}constrain(t){return this.constraints.reduce((t,e)=>e.constrain(t),t)}}function og(t,e){if(t instanceof e)return t;if(t instanceof ob){let i=t.constraints.reduce((t,i)=>t||(i instanceof e?i:null),null);if(i)return i}return null}class ow{constructor(t){this.values=rN.fromObject({options:t})}constrain(t){let e=this.values.get("options");return 0===e.length?t:e.filter(e=>e.value===t).length>0?t:e[0].value}}function o_(t){var e;return Array.isArray(t)?null===(e=ac({items:t},t=>({items:t.required.array(t.required.object({text:t.required.string,value:t.required.raw}))})))||void 0===e?void 0:e.items:"object"==typeof t?au.required.raw(t).value:void 0}function of(t){if(Array.isArray(t))return t;let e=[];return Object.keys(t).forEach(i=>{e.push({text:i,value:t[i]})}),e}function ox(t){return rP(t)?null:new ow(of(t))}const oy=aM("lst");class oC{constructor(t,e){this.onValueChange_=this.onValueChange_.bind(this),this.props_=e.props,this.element=t.createElement("div"),this.element.classList.add(oy()),e.viewProps.bindClassModifiers(this.element);let i=t.createElement("select");i.classList.add(oy("s")),e.viewProps.bindDisabled(i),this.element.appendChild(i),this.selectElement=i;let s=t.createElement("div");s.classList.add(oy("m")),s.appendChild(ax(t,"dropdown")),this.element.appendChild(s),e.value.emitter.on("change",this.onValueChange_),this.value_=e.value,aV(this.props_,"options",e=>{aP(this.selectElement),e.forEach(e=>{let i=t.createElement("option");i.textContent=e.text,this.selectElement.appendChild(i)}),this.update_()})}update_(){let t=this.props_.get("options").map(t=>t.value);this.selectElement.selectedIndex=t.indexOf(this.value_.rawValue)}onValueChange_(){this.update_()}}class oP{constructor(t,e){this.onSelectChange_=this.onSelectChange_.bind(this),this.props=e.props,this.value=e.value,this.viewProps=e.viewProps,this.view=new oC(t,{props:this.props,value:this.value,viewProps:this.viewProps}),this.view.selectElement.addEventListener("change",this.onSelectChange_)}onSelectChange_(t){let e=t.currentTarget;this.value.rawValue=this.props.get("options")[e.selectedIndex].value}importProps(t){return av(t,null,t=>({options:t.required.custom(o_)}),t=>(this.props.set("options",of(t.options)),!0))}exportProps(){return am(null,{options:this.props.get("options")})}}const oE=aM("pop");class ok{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(oE()),e.viewProps.bindClassModifiers(this.element),ak(e.shows,az(this.element,oE(void 0,"v")))}}class oV{constructor(t,e){this.shows=rR(!1),this.viewProps=e.viewProps,this.view=new ok(t,{shows:this.shows,viewProps:this.viewProps})}}const oM=aM("txt");class oL{constructor(t,e){this.onChange_=this.onChange_.bind(this),this.element=t.createElement("div"),this.element.classList.add(oM()),e.viewProps.bindClassModifiers(this.element),this.props_=e.props,this.props_.emitter.on("change",this.onChange_);let i=t.createElement("input");i.classList.add(oM("i")),i.type="text",e.viewProps.bindDisabled(i),this.element.appendChild(i),this.inputElement=i,e.value.emitter.on("change",this.onChange_),this.value_=e.value,this.refresh()}refresh(){let t=this.props_.get("formatter");this.inputElement.value=t(this.value_.rawValue)}onChange_(){this.refresh()}}class oA{constructor(t,e){this.onInputChange_=this.onInputChange_.bind(this),this.parser_=e.parser,this.props=e.props,this.value=e.value,this.viewProps=e.viewProps,this.view=new oL(t,{props:e.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(t){let e=t.currentTarget.value,i=this.parser_(e);rP(i)||(this.value.rawValue=i),this.view.refresh()}}function oS(t){return"false"!==t&&!!t}function oD(t){return String(t)}const oO=r3(0);function oj(t){return oO(t)+"%"}function oT(t){return String(t)}function oR(t){return t}function oN({primary:t,secondary:e,forward:i,backward:s}){let n=!1;function r(t){n||(n=!0,t(),n=!1)}t.emitter.on("change",s=>{r(()=>{e.setRawValue(i(t.rawValue,e.rawValue),s.options)})}),e.emitter.on("change",n=>{r(()=>{t.setRawValue(s(t.rawValue,e.rawValue),n.options)}),r(()=>{e.setRawValue(i(t.rawValue,e.rawValue),n.options)})}),r(()=>{e.setRawValue(i(t.rawValue,e.rawValue),{forceEmit:!1,last:!0})})}function oz(t,e){let i=t*(e.altKey?.1:1)*(e.shiftKey?10:1);return e.upKey?+i:e.downKey?-i:0}function oB(t){return{altKey:t.altKey,downKey:"ArrowDown"===t.key,shiftKey:t.shiftKey,upKey:"ArrowUp"===t.key}}function oF(t){return{altKey:t.altKey,downKey:"ArrowLeft"===t.key,shiftKey:t.shiftKey,upKey:"ArrowRight"===t.key}}function oI(t){return"ArrowUp"===t||"ArrowDown"===t||"ArrowLeft"===t||"ArrowRight"===t}function oU(t,e){var i,s;let n=e.ownerDocument.defaultView,r=e.getBoundingClientRect();return{x:t.pageX-((null!==(i=n&&n.scrollX)&&void 0!==i?i:0)+r.left),y:t.pageY-((null!==(s=n&&n.scrollY)&&void 0!==s?s:0)+r.top)}}class oK{constructor(t){this.lastTouch_=null,this.onDocumentMouseMove_=this.onDocumentMouseMove_.bind(this),this.onDocumentMouseUp_=this.onDocumentMouseUp_.bind(this),this.onMouseDown_=this.onMouseDown_.bind(this),this.onTouchEnd_=this.onTouchEnd_.bind(this),this.onTouchMove_=this.onTouchMove_.bind(this),this.onTouchStart_=this.onTouchStart_.bind(this),this.elem_=t,this.emitter=new rD,t.addEventListener("touchstart",this.onTouchStart_,{passive:!1}),t.addEventListener("touchmove",this.onTouchMove_,{passive:!0}),t.addEventListener("touchend",this.onTouchEnd_),t.addEventListener("mousedown",this.onMouseDown_)}computePosition_(t){let e=this.elem_.getBoundingClientRect();return{bounds:{width:e.width,height:e.height},point:t?{x:t.x,y:t.y}:null}}onMouseDown_(t){var e;t.preventDefault(),null===(e=t.currentTarget)||void 0===e||e.focus();let i=this.elem_.ownerDocument;i.addEventListener("mousemove",this.onDocumentMouseMove_),i.addEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("down",{altKey:t.altKey,data:this.computePosition_(oU(t,this.elem_)),sender:this,shiftKey:t.shiftKey})}onDocumentMouseMove_(t){this.emitter.emit("move",{altKey:t.altKey,data:this.computePosition_(oU(t,this.elem_)),sender:this,shiftKey:t.shiftKey})}onDocumentMouseUp_(t){let e=this.elem_.ownerDocument;e.removeEventListener("mousemove",this.onDocumentMouseMove_),e.removeEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("up",{altKey:t.altKey,data:this.computePosition_(oU(t,this.elem_)),sender:this,shiftKey:t.shiftKey})}onTouchStart_(t){t.preventDefault();let e=t.targetTouches.item(0),i=this.elem_.getBoundingClientRect();this.emitter.emit("down",{altKey:t.altKey,data:this.computePosition_(e?{x:e.clientX-i.left,y:e.clientY-i.top}:void 0),sender:this,shiftKey:t.shiftKey}),this.lastTouch_=e}onTouchMove_(t){let e=t.targetTouches.item(0),i=this.elem_.getBoundingClientRect();this.emitter.emit("move",{altKey:t.altKey,data:this.computePosition_(e?{x:e.clientX-i.left,y:e.clientY-i.top}:void 0),sender:this,shiftKey:t.shiftKey}),this.lastTouch_=e}onTouchEnd_(t){var e;let i=null!==(e=t.targetTouches.item(0))&&void 0!==e?e:this.lastTouch_,s=this.elem_.getBoundingClientRect();this.emitter.emit("up",{altKey:t.altKey,data:this.computePosition_(i?{x:i.clientX-s.left,y:i.clientY-s.top}:void 0),sender:this,shiftKey:t.shiftKey})}}const oq=aM("txt");class o${constructor(t,e){this.onChange_=this.onChange_.bind(this),this.props_=e.props,this.props_.emitter.on("change",this.onChange_),this.element=t.createElement("div"),this.element.classList.add(oq(),oq(void 0,"num")),e.arrayPosition&&this.element.classList.add(oq(void 0,e.arrayPosition)),e.viewProps.bindClassModifiers(this.element);let i=t.createElement("input");i.classList.add(oq("i")),i.type="text",e.viewProps.bindDisabled(i),this.element.appendChild(i),this.inputElement=i,this.onDraggingChange_=this.onDraggingChange_.bind(this),this.dragging_=e.dragging,this.dragging_.emitter.on("change",this.onDraggingChange_),this.element.classList.add(oq()),this.inputElement.classList.add(oq("i"));let s=t.createElement("div");s.classList.add(oq("k")),this.element.appendChild(s),this.knobElement=s;let n=t.createElementNS(ag,"svg");n.classList.add(oq("g")),this.knobElement.appendChild(n);let r=t.createElementNS(ag,"path");r.classList.add(oq("gb")),n.appendChild(r),this.guideBodyElem_=r;let a=t.createElementNS(ag,"path");a.classList.add(oq("gh")),n.appendChild(a),this.guideHeadElem_=a;let o=t.createElement("div");o.classList.add(aM("tt")()),this.knobElement.appendChild(o),this.tooltipElem_=o,e.value.emitter.on("change",this.onChange_),this.value=e.value,this.refresh()}onDraggingChange_(t){if(null===t.rawValue){this.element.classList.remove(oq(void 0,"drg"));return}this.element.classList.add(oq(void 0,"drg"));let e=t.rawValue/this.props_.get("pointerScale"),i=e+(e>0?-1:e<0?1:0),s=r9(-i,-4,4);this.guideHeadElem_.setAttributeNS(null,"d",`M ${i+s},0 L${i},4 L${i+s},8 M ${e},-1 L${e},9`),this.guideBodyElem_.setAttributeNS(null,"d",`M 0,4 L${e},4`);let n=this.props_.get("formatter");this.tooltipElem_.textContent=n(this.value.rawValue),this.tooltipElem_.style.left=`${e}px`}refresh(){let t=this.props_.get("formatter");this.inputElement.value=t(this.value.rawValue)}onChange_(){this.refresh()}}class oG{constructor(t,e){var i;this.originRawValue_=0,this.onInputChange_=this.onInputChange_.bind(this),this.onInputKeyDown_=this.onInputKeyDown_.bind(this),this.onInputKeyUp_=this.onInputKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.parser_=e.parser,this.props=e.props,this.sliderProps_=null!==(i=e.sliderProps)&&void 0!==i?i:null,this.value=e.value,this.viewProps=e.viewProps,this.dragging_=rR(null),this.view=new o$(t,{arrayPosition:e.arrayPosition,dragging:this.dragging_,props:this.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_),this.view.inputElement.addEventListener("keydown",this.onInputKeyDown_),this.view.inputElement.addEventListener("keyup",this.onInputKeyUp_);let s=new oK(this.view.knobElement);s.emitter.on("down",this.onPointerDown_),s.emitter.on("move",this.onPointerMove_),s.emitter.on("up",this.onPointerUp_)}constrainValue_(t){var e,i;let s=null===(e=this.sliderProps_)||void 0===e?void 0:e.get("min"),n=null===(i=this.sliderProps_)||void 0===i?void 0:i.get("max"),r=t;return void 0!==s&&(r=Math.max(r,s)),void 0!==n&&(r=Math.min(r,n)),r}onInputChange_(t){let e=t.currentTarget.value,i=this.parser_(e);rP(i)||(this.value.rawValue=this.constrainValue_(i)),this.view.refresh()}onInputKeyDown_(t){let e=oz(this.props.get("keyScale"),oB(t));0!==e&&this.value.setRawValue(this.constrainValue_(this.value.rawValue+e),{forceEmit:!1,last:!1})}onInputKeyUp_(t){0!==oz(this.props.get("keyScale"),oB(t))&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}onPointerDown_(){this.originRawValue_=this.value.rawValue,this.dragging_.rawValue=0}computeDraggingValue_(t){if(!t.point)return null;let e=t.point.x-t.bounds.width/2;return this.constrainValue_(this.originRawValue_+e*this.props.get("pointerScale"))}onPointerMove_(t){let e=this.computeDraggingValue_(t.data);null!==e&&(this.value.setRawValue(e,{forceEmit:!1,last:!1}),this.dragging_.rawValue=this.value.rawValue-this.originRawValue_)}onPointerUp_(t){let e=this.computeDraggingValue_(t.data);null!==e&&(this.value.setRawValue(e,{forceEmit:!0,last:!0}),this.dragging_.rawValue=null)}}const oH=aM("sld");class oY{constructor(t,e){this.onChange_=this.onChange_.bind(this),this.props_=e.props,this.props_.emitter.on("change",this.onChange_),this.element=t.createElement("div"),this.element.classList.add(oH()),e.viewProps.bindClassModifiers(this.element);let i=t.createElement("div");i.classList.add(oH("t")),e.viewProps.bindTabIndex(i),this.element.appendChild(i),this.trackElement=i;let s=t.createElement("div");s.classList.add(oH("k")),this.trackElement.appendChild(s),this.knobElement=s,e.value.emitter.on("change",this.onChange_),this.value=e.value,this.update_()}update_(){let t=r9(r4(this.value.rawValue,this.props_.get("min"),this.props_.get("max"),0,100),0,100);this.knobElement.style.width=`${t}%`}onChange_(){this.update_()}}class oX{constructor(t,e){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDownOrMove_=this.onPointerDownOrMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=e.value,this.viewProps=e.viewProps,this.props=e.props,this.view=new oY(t,{props:this.props,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new oK(this.view.trackElement),this.ptHandler_.emitter.on("down",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("move",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.trackElement.addEventListener("keydown",this.onKeyDown_),this.view.trackElement.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(t,e){t.point&&this.value.setRawValue(r4(r9(t.point.x,0,t.bounds.width),0,t.bounds.width,this.props.get("min"),this.props.get("max")),e)}onPointerDownOrMove_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerUp_(t){this.handlePointerEvent_(t.data,{forceEmit:!0,last:!0})}onKeyDown_(t){let e=oz(this.props.get("keyScale"),oF(t));0!==e&&this.value.setRawValue(this.value.rawValue+e,{forceEmit:!1,last:!1})}onKeyUp_(t){0!==oz(this.props.get("keyScale"),oF(t))&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const oW=aM("sldtxt");class oZ{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(oW());let i=t.createElement("div");i.classList.add(oW("s")),this.sliderView_=e.sliderView,i.appendChild(this.sliderView_.element),this.element.appendChild(i);let s=t.createElement("div");s.classList.add(oW("t")),this.textView_=e.textView,s.appendChild(this.textView_.element),this.element.appendChild(s)}}class oQ{constructor(t,e){this.value=e.value,this.viewProps=e.viewProps,this.sliderC_=new oX(t,{props:e.sliderProps,value:e.value,viewProps:this.viewProps}),this.textC_=new oG(t,{parser:e.parser,props:e.textProps,sliderProps:e.sliderProps,value:e.value,viewProps:e.viewProps}),this.view=new oZ(t,{sliderView:this.sliderC_.view,textView:this.textC_.view})}get sliderController(){return this.sliderC_}get textController(){return this.textC_}importProps(t){return av(t,null,t=>({max:t.required.number,min:t.required.number}),t=>{let e=this.sliderC_.props;return e.set("max",t.max),e.set("min",t.min),!0})}exportProps(){let t=this.sliderC_.props;return am(null,{max:t.get("max"),min:t.get("min")})}}const oJ="cnt-usz";class o0{constructor(t,e){let i=aM(e.viewName);this.element=t.createElement("div"),this.element.classList.add(i()),e.viewProps.bindClassModifiers(this.element)}}function o1(t){return ai(t)}function o2(t){if(rk(t))return ac(t,o1)}function o5(t,e){if(!t)return;let i=[],s=r7(t,e);s&&i.push(s);let n=at(t);return n&&i.push(n),new ob(i)}function o3(t){if("inline"===t||"popup"===t)return t}function o4(t,e){t.write(e)}const o6=aM("ckb");class o9{constructor(t,e){this.onValueChange_=this.onValueChange_.bind(this),this.element=t.createElement("div"),this.element.classList.add(o6()),e.viewProps.bindClassModifiers(this.element);let i=t.createElement("label");i.classList.add(o6("l")),this.element.appendChild(i);let s=t.createElement("input");s.classList.add(o6("i")),s.type="checkbox",i.appendChild(s),this.inputElement=s,e.viewProps.bindDisabled(this.inputElement);let n=t.createElement("div");n.classList.add(o6("w")),i.appendChild(n);let r=ax(t,"check");n.appendChild(r),e.value.emitter.on("change",this.onValueChange_),this.value=e.value,this.update_()}update_(){this.inputElement.checked=this.value.rawValue}onValueChange_(){this.update_()}}class o8{constructor(t,e){this.onInputChange_=this.onInputChange_.bind(this),this.value=e.value,this.viewProps=e.viewProps,this.view=new o9(t,{value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(t){let e=t.currentTarget;this.value.rawValue=e.checked}}a$({id:"input-bool",type:"input",accept:(t,e)=>{if("boolean"!=typeof t)return null;let i=ac(e,t=>({options:t.optional.custom(o_),readonly:t.optional.constant(!1)}));return i?{initialValue:t,params:i}:null},binding:{reader:t=>oS,constraint:t=>(function(t){let e=[],i=ox(t.options);return i&&e.push(i),new ob(e)})(t.params),writer:t=>o4},controller:t=>{let e=t.document,i=t.value,s=t.constraint,n=s&&og(s,ow);return n?new oP(e,{props:new rN({options:n.values.value("options")}),value:i,viewProps:t.viewProps}):new o8(e,{value:i,viewProps:t.viewProps})},api:t=>"boolean"!=typeof t.controller.value.rawValue?null:t.controller.valueController instanceof oP?new oc(t.controller):null});const o7=aM("col");class lt{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(o7()),e.foldable.bindExpandedClass(this.element,o7(void 0,"expanded")),aV(e.foldable,"completed",az(this.element,o7(void 0,"cpl")));let i=t.createElement("div");i.classList.add(o7("h")),this.element.appendChild(i);let s=t.createElement("div");s.classList.add(o7("s")),i.appendChild(s),this.swatchElement=s;let n=t.createElement("div");if(n.classList.add(o7("t")),i.appendChild(n),this.textElement=n,"inline"===e.pickerLayout){let e=t.createElement("div");e.classList.add(o7("p")),this.element.appendChild(e),this.pickerElement=e}else this.pickerElement=null}}function le(t,e,i){let s,n,r;let a=(t%360+360)%360,o=r9(e/100,0,1),l=r9(i/100,0,1),h=l*o,p=h*(1-Math.abs(a/60%2-1)),d=l-h;return a>=0&&a<60?[s,n,r]=[h,p,0]:a>=60&&a<120?[s,n,r]=[p,h,0]:a>=120&&a<180?[s,n,r]=[0,h,p]:a>=180&&a<240?[s,n,r]=[0,p,h]:a>=240&&a<300?[s,n,r]=[p,0,h]:[s,n,r]=[h,0,p],[(s+d)*255,(n+d)*255,(r+d)*255]}function li(t){return[t[0],t[1],t[2]]}function ls(t,e){return[t[0],t[1],t[2],e]}const ln={hsl:{hsl:(t,e,i)=>[t,e,i],hsv:function(t,e,i){let s=i+e*(100-Math.abs(2*i-100))/200;return[t,0!==s?e*(100-Math.abs(2*i-100))/s:0,i+e*(100-Math.abs(2*i-100))/200]},rgb:function(t,e,i){let s,n,r;let a=(t%360+360)%360,o=r9(e/100,0,1),l=r9(i/100,0,1),h=(1-Math.abs(2*l-1))*o,p=h*(1-Math.abs(a/60%2-1)),d=l-h/2;return a>=0&&a<60?[s,n,r]=[h,p,0]:a>=60&&a<120?[s,n,r]=[p,h,0]:a>=120&&a<180?[s,n,r]=[0,h,p]:a>=180&&a<240?[s,n,r]=[0,p,h]:a>=240&&a<300?[s,n,r]=[p,0,h]:[s,n,r]=[h,0,p],[(s+d)*255,(n+d)*255,(r+d)*255]}},hsv:{hsl:function(t,e,i){let s=100-Math.abs(i*(200-e)/100-100);return[t,0!==s?e*i/s:0,i*(200-e)/200]},hsv:(t,e,i)=>[t,e,i],rgb:le},rgb:{hsl:function(t,e,i){let s=r9(t/255,0,1),n=r9(e/255,0,1),r=r9(i/255,0,1),a=Math.max(s,n,r),o=Math.min(s,n,r),l=a-o,h=0,p=0;return 0!==l&&(p=l/(1-Math.abs(a+o-1)),h=(h=s===a?(n-r)/l:n===a?2+(r-s)/l:4+(s-n)/l)/6+(h<0?1:0)),[360*h,100*p,(o+a)/2*100]},hsv:function(t,e,i){let s=r9(t/255,0,1),n=r9(e/255,0,1),r=r9(i/255,0,1),a=Math.max(s,n,r),o=a-Math.min(s,n,r);return[0===o?0:a===s?((n-r)/o%6+6)%6*60:a===n?60*((r-s)/o+2):60*((s-n)/o+4),100*(0===a?0:o/a),100*a]},rgb:(t,e,i)=>[t,e,i]}};function lr(t,e){return["float"===e?1:"rgb"===t?255:360,"float"===e?1:"rgb"===t?255:100,"float"===e?1:"rgb"===t?255:100]}function la(t,e,i){var s,n,r;let a=lr(e,i);return["rgb"===e?r9(t[0],0,a[0]):(n=t[0])===(r=a[0])?r:(n%r+r)%r,r9(t[1],0,a[1]),r9(t[2],0,a[2]),r9(null!==(s=t[3])&&void 0!==s?s:1,0,1)]}function lo(t,e,i,s){let n=lr(e,i),r=lr(e,s);return t.map((t,e)=>t/n[e]*r[e])}function ll(t,e,i){let s=lo(t,e.mode,e.type,"int");return lo(ln[e.mode][i.mode](...s),i.mode,"int",i.type)}class lh{static black(){return new lh([0,0,0],"rgb")}constructor(t,e){this.type="int",this.mode=e,this.comps_=la(t,e,this.type)}getComponents(t){return ls(ll(li(this.comps_),{mode:this.mode,type:this.type},{mode:null!=t?t:this.mode,type:this.type}),this.comps_[3])}toRgbaObject(){let t=this.getComponents("rgb");return{r:t[0],g:t[1],b:t[2],a:t[3]}}}const lp=aM("colp");class ld{constructor(t,e){this.alphaViews_=null,this.element=t.createElement("div"),this.element.classList.add(lp()),e.viewProps.bindClassModifiers(this.element);let i=t.createElement("div");i.classList.add(lp("hsv"));let s=t.createElement("div");s.classList.add(lp("sv")),this.svPaletteView_=e.svPaletteView,s.appendChild(this.svPaletteView_.element),i.appendChild(s);let n=t.createElement("div");n.classList.add(lp("h")),this.hPaletteView_=e.hPaletteView,n.appendChild(this.hPaletteView_.element),i.appendChild(n),this.element.appendChild(i);let r=t.createElement("div");if(r.classList.add(lp("rgb")),this.textsView_=e.textsView,r.appendChild(this.textsView_.element),this.element.appendChild(r),e.alphaViews){this.alphaViews_={palette:e.alphaViews.palette,text:e.alphaViews.text};let i=t.createElement("div");i.classList.add(lp("a"));let s=t.createElement("div");s.classList.add(lp("ap")),s.appendChild(this.alphaViews_.palette.element),i.appendChild(s);let n=t.createElement("div");n.classList.add(lp("at")),n.appendChild(this.alphaViews_.text.element),i.appendChild(n),this.element.appendChild(i)}}get allFocusableElements(){let t=[this.svPaletteView_.element,this.hPaletteView_.element,this.textsView_.modeSelectElement,...this.textsView_.inputViews.map(t=>t.inputElement)];return this.alphaViews_&&t.push(this.alphaViews_.palette.element,this.alphaViews_.text.inputElement),t}}function lu(t){return"int"===t?"int":"float"===t?"float":void 0}function lc(t){return ac(t,t=>({color:t.optional.object({alpha:t.optional.boolean,type:t.optional.custom(lu)}),expanded:t.optional.boolean,picker:t.optional.custom(o3),readonly:t.optional.constant(!1)}))}function lv(t){return t?.1:1}function lm(t){var e;return null===(e=t.color)||void 0===e?void 0:e.type}class lb{constructor(t,e){this.type="float",this.mode=e,this.comps_=la(t,e,this.type)}getComponents(t){return ls(ll(li(this.comps_),{mode:this.mode,type:this.type},{mode:null!=t?t:this.mode,type:this.type}),this.comps_[3])}toRgbaObject(){let t=this.getComponents("rgb");return{r:t[0],g:t[1],b:t[2],a:t[3]}}}const lg={int:(t,e)=>new lh(t,e),float:(t,e)=>new lb(t,e)};function lw(t,e){if(t.type===e)return t;if("int"===t.type&&"float"===e)return function(t){let e=t.getComponents(),i=lr(t.mode,"int");return new lb([r4(e[0],0,i[0],0,1),r4(e[1],0,i[1],0,1),r4(e[2],0,i[2],0,1),e[3]],t.mode)}(t);if("float"===t.type&&"int"===e)return function(t){let e=t.getComponents(),i=lr(t.mode,"int");return new lh([Math.round(r4(e[0],0,1,0,i[0])),Math.round(r4(e[1],0,1,0,i[1])),Math.round(r4(e[2],0,1,0,i[2])),e[3]],t.mode)}(t);throw rA.shouldNeverHappen()}function l_(t,e){let i=t.match(/^(.+)%$/);return i?Math.min(.01*parseFloat(i[1])*e,e):Math.min(parseFloat(t),e)}const lf={deg:t=>t,grad:t=>360*t/400,rad:t=>360*t/(2*Math.PI),turn:t=>360*t};function lx(t){let e=t.match(/^([0-9.]+?)(deg|grad|rad|turn)$/);if(!e)return parseFloat(t);let i=parseFloat(e[1]);return lf[e[2]](i)}function ly(t){let e=t.match(/^rgb\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;let i=[l_(e[1],255),l_(e[2],255),l_(e[3],255)];return isNaN(i[0])||isNaN(i[1])||isNaN(i[2])?null:i}function lC(t){let e=ly(t);return e?new lh(e,"rgb"):null}function lP(t){let e=t.match(/^rgba\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;let i=[l_(e[1],255),l_(e[2],255),l_(e[3],255),l_(e[4],1)];return isNaN(i[0])||isNaN(i[1])||isNaN(i[2])||isNaN(i[3])?null:i}function lE(t){let e=lP(t);return e?new lh(e,"rgb"):null}function lk(t){let e=t.match(/^hsl\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;let i=[lx(e[1]),l_(e[2],100),l_(e[3],100)];return isNaN(i[0])||isNaN(i[1])||isNaN(i[2])?null:i}function lV(t){let e=lk(t);return e?new lh(e,"hsl"):null}function lM(t){let e=t.match(/^hsla\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;let i=[lx(e[1]),l_(e[2],100),l_(e[3],100),l_(e[4],1)];return isNaN(i[0])||isNaN(i[1])||isNaN(i[2])||isNaN(i[3])?null:i}function lL(t){let e=lM(t);return e?new lh(e,"hsl"):null}function lA(t){let e=t.match(/^#([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(e)return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16)];let i=t.match(/^(?:#|0x)([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return i?[parseInt(i[1],16),parseInt(i[2],16),parseInt(i[3],16)]:null}function lS(t){let e=lA(t);return e?new lh(e,"rgb"):null}function lD(t){let e=t.match(/^#?([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(e)return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16),r4(parseInt(e[4]+e[4],16),0,255,0,1)];let i=t.match(/^(?:#|0x)?([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return i?[parseInt(i[1],16),parseInt(i[2],16),parseInt(i[3],16),r4(parseInt(i[4],16),0,255,0,1)]:null}function lO(t){let e=lD(t);return e?new lh(e,"rgb"):null}function lj(t){let e=t.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!e)return null;let i=[parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3])];return isNaN(i[0])||isNaN(i[1])||isNaN(i[2])?null:i}function lT(t){return e=>{let i=lj(e);return i?lg[t](i,"rgb"):null}}function lR(t){let e=t.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*a\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!e)return null;let i=[parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3]),parseFloat(e[4])];return isNaN(i[0])||isNaN(i[1])||isNaN(i[2])||isNaN(i[3])?null:i}function lN(t){return e=>{let i=lR(e);return i?lg[t](i,"rgb"):null}}const lz=[{parser:lA,result:{alpha:!1,mode:"rgb",notation:"hex"}},{parser:lD,result:{alpha:!0,mode:"rgb",notation:"hex"}},{parser:ly,result:{alpha:!1,mode:"rgb",notation:"func"}},{parser:lP,result:{alpha:!0,mode:"rgb",notation:"func"}},{parser:lk,result:{alpha:!1,mode:"hsl",notation:"func"}},{parser:lM,result:{alpha:!0,mode:"hsl",notation:"func"}},{parser:lj,result:{alpha:!1,mode:"rgb",notation:"object"}},{parser:lR,result:{alpha:!0,mode:"rgb",notation:"object"}}];function lB(t){let e=[lS,lO,lC,lE,lV,lL];"int"===t&&e.push(lT("int"),lN("int")),"float"===t&&e.push(lT("float"),lN("float"));let i=t=>e.reduce((e,i)=>null!==e?e:i(t),null);return e=>{let s=i(e);return s?lw(s,t):null}}function lF(t){let e=lB("int");if("string"!=typeof t)return lh.black();let i=e(t);return null!=i?i:lh.black()}function lI(t){let e=r9(Math.floor(t),0,255).toString(16);return 1===e.length?`0${e}`:e}function lU(t,e="#"){let i=li(t.getComponents("rgb")).map(lI).join("");return`${e}${i}`}function lK(t,e="#"){let i=t.getComponents("rgb"),s=[i[0],i[1],i[2],255*i[3]].map(lI).join("");return`${e}${s}`}function lq(t){let e=r3(0),i=li(lw(t,"int").getComponents("rgb")).map(t=>e(t));return`rgb(${i.join(", ")})`}function l$(t){let e=r3(2),i=r3(0),s=lw(t,"int").getComponents("rgb").map((t,s)=>(3===s?e:i)(t));return`rgba(${s.join(", ")})`}function lG(t,e){let i=r3("float"===e?2:0),s=["r","g","b"],n=li(lw(t,e).getComponents("rgb")).map((t,e)=>`${s[e]}: ${i(t)}`);return`{${n.join(", ")}}`}function lH(t,e){let i=r3(2),s=r3("float"===e?2:0),n=["r","g","b","a"],r=lw(t,e).getComponents("rgb").map((t,e)=>`${n[e]}: ${(3===e?i:s)(t)}`);return`{${r.join(", ")}}`}const lY=[{format:{alpha:!1,mode:"rgb",notation:"hex",type:"int"},stringifier:lU},{format:{alpha:!0,mode:"rgb",notation:"hex",type:"int"},stringifier:lK},{format:{alpha:!1,mode:"rgb",notation:"func",type:"int"},stringifier:lq},{format:{alpha:!0,mode:"rgb",notation:"func",type:"int"},stringifier:l$},{format:{alpha:!1,mode:"hsl",notation:"func",type:"int"},stringifier:function(t){let e=[r3(0),oj,oj],i=li(lw(t,"int").getComponents("hsl")).map((t,i)=>e[i](t));return`hsl(${i.join(", ")})`}},{format:{alpha:!0,mode:"hsl",notation:"func",type:"int"},stringifier:function(t){let e=[r3(0),oj,oj,r3(2)],i=lw(t,"int").getComponents("hsl").map((t,i)=>e[i](t));return`hsla(${i.join(", ")})`}},...["int","float"].reduce((t,e)=>[...t,{format:{alpha:!1,mode:"rgb",notation:"object",type:e},stringifier:t=>lG(t,e)},{format:{alpha:!0,mode:"rgb",notation:"object",type:e},stringifier:t=>lH(t,e)}],[])];function lX(t){return lY.reduce((e,i)=>{var s;return e||((s=i.format).alpha===t.alpha&&s.mode===t.mode&&s.notation===t.notation&&s.type===t.type?i.stringifier:null)},null)}const lW=aM("apl");class lZ{constructor(t,e){this.onValueChange_=this.onValueChange_.bind(this),this.value=e.value,this.value.emitter.on("change",this.onValueChange_),this.element=t.createElement("div"),this.element.classList.add(lW()),e.viewProps.bindClassModifiers(this.element),e.viewProps.bindTabIndex(this.element);let i=t.createElement("div");i.classList.add(lW("b")),this.element.appendChild(i);let s=t.createElement("div");s.classList.add(lW("c")),i.appendChild(s),this.colorElem_=s;let n=t.createElement("div");n.classList.add(lW("m")),this.element.appendChild(n),this.markerElem_=n;let r=t.createElement("div");r.classList.add(lW("p")),this.markerElem_.appendChild(r),this.previewElem_=r,this.update_()}update_(){let t=this.value.rawValue,e=t.getComponents("rgb"),i=new lh([e[0],e[1],e[2],0],"rgb"),s=new lh([e[0],e[1],e[2],255],"rgb"),n=["to right",l$(i),l$(s)];this.colorElem_.style.background=`linear-gradient(${n.join(",")})`,this.previewElem_.style.backgroundColor=l$(t);let r=r4(e[3],0,1,0,100);this.markerElem_.style.left=`${r}%`}onValueChange_(){this.update_()}}class lQ{constructor(t,e){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=e.value,this.viewProps=e.viewProps,this.view=new lZ(t,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new oK(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(t,e){if(!t.point)return;let i=t.point.x/t.bounds.width,[s,n,r]=this.value.rawValue.getComponents("hsv");this.value.setRawValue(new lh([s,n,r,i],"hsv"),e)}onPointerDown_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerMove_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerUp_(t){this.handlePointerEvent_(t.data,{forceEmit:!0,last:!0})}onKeyDown_(t){let e=oz(lv(!0),oF(t));if(0===e)return;let[i,s,n,r]=this.value.rawValue.getComponents("hsv");this.value.setRawValue(new lh([i,s,n,r+e],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(t){0!==oz(lv(!0),oF(t))&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const lJ=aM("coltxt");class l0{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(lJ()),e.viewProps.bindClassModifiers(this.element);let i=t.createElement("div");i.classList.add(lJ("m")),this.modeElem_=function(t){let e=t.createElement("select");return e.appendChild([{text:"RGB",value:"rgb"},{text:"HSL",value:"hsl"},{text:"HSV",value:"hsv"},{text:"HEX",value:"hex"}].reduce((e,i)=>{let s=t.createElement("option");return s.textContent=i.text,s.value=i.value,e.appendChild(s),e},t.createDocumentFragment())),e}(t),this.modeElem_.classList.add(lJ("ms")),i.appendChild(this.modeSelectElement),e.viewProps.bindDisabled(this.modeElem_);let s=t.createElement("div");s.classList.add(lJ("mm")),s.appendChild(ax(t,"dropdown")),i.appendChild(s),this.element.appendChild(i);let n=t.createElement("div");n.classList.add(lJ("w")),this.element.appendChild(n),this.inputsElem_=n,this.inputViews_=e.inputViews,this.applyInputViews_(),ak(e.mode,t=>{this.modeElem_.value=t})}get modeSelectElement(){return this.modeElem_}get inputViews(){return this.inputViews_}set inputViews(t){this.inputViews_=t,this.applyInputViews_()}applyInputViews_(){aP(this.inputsElem_);let t=this.element.ownerDocument;this.inputViews_.forEach(e=>{let i=t.createElement("div");i.classList.add(lJ("c")),i.appendChild(e.element),this.inputsElem_.appendChild(i)})}}class l1{constructor(t,e){this.onModeSelectChange_=this.onModeSelectChange_.bind(this),this.colorType_=e.colorType,this.value=e.value,this.viewProps=e.viewProps,this.colorMode=rR(this.value.rawValue.mode),this.ccs_=this.createComponentControllers_(t),this.view=new l0(t,{mode:this.colorMode,inputViews:[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view],viewProps:this.viewProps}),this.view.modeSelectElement.addEventListener("change",this.onModeSelectChange_)}createComponentControllers_(t){let e=this.colorMode.rawValue;return"hex"!==e?function(t,e){let i={colorMode:e.colorMode,colorType:e.colorType,parser:r2,viewProps:e.viewProps};return[0,1,2].map(s=>{var n,r,a;let o=(n=t,r=i,new oG(n,{arrayPosition:0===(a=s)?"fst":2===a?"lst":"mid",parser:r.parser,props:rN.fromObject({formatter:r3("float"===r.colorType?2:0),keyScale:lv(!1),pointerScale:"float"===r.colorType?.01:1}),value:rR(0,{constraint:new rz({min:0,max:lr(r.colorMode,r.colorType)[a]})}),viewProps:r.viewProps}));return oN({primary:e.value,secondary:o.value,forward:t=>lw(t,e.colorType).getComponents(e.colorMode)[s],backward(t,i){var n;let r=e.colorMode,a=lw(t,e.colorType).getComponents(r);return a[s]=i,lw((n=ls(li(a),a[3]),lg[e.colorType](n,r)),"int")}}),o})}(t,{colorMode:e,colorType:this.colorType_,value:this.value,viewProps:this.viewProps}):function(t,e){let i=new oA(t,{parser:lB("int"),props:rN.fromObject({formatter:lU}),value:rR(lh.black()),viewProps:e.viewProps});return oN({primary:e.value,secondary:i.value,forward:t=>new lh(li(t.getComponents()),t.mode),backward:(t,e)=>new lh(ls(li(e.getComponents(t.mode)),t.getComponents()[3]),t.mode)}),[i]}(t,{value:this.value,viewProps:this.viewProps})}onModeSelectChange_(t){let e=t.currentTarget;this.colorMode.rawValue=e.value,this.ccs_=this.createComponentControllers_(this.view.element.ownerDocument),this.view.inputViews=this.ccs_.map(t=>t.view)}}const l2=aM("hpl");class l5{constructor(t,e){this.onValueChange_=this.onValueChange_.bind(this),this.value=e.value,this.value.emitter.on("change",this.onValueChange_),this.element=t.createElement("div"),this.element.classList.add(l2()),e.viewProps.bindClassModifiers(this.element),e.viewProps.bindTabIndex(this.element);let i=t.createElement("div");i.classList.add(l2("c")),this.element.appendChild(i);let s=t.createElement("div");s.classList.add(l2("m")),this.element.appendChild(s),this.markerElem_=s,this.update_()}update_(){let[t]=this.value.rawValue.getComponents("hsv");this.markerElem_.style.backgroundColor=lq(new lh([t,100,100],"hsv"));let e=r4(t,0,360,0,100);this.markerElem_.style.left=`${e}%`}onValueChange_(){this.update_()}}class l3{constructor(t,e){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=e.value,this.viewProps=e.viewProps,this.view=new l5(t,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new oK(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(t,e){if(!t.point)return;let i=r4(r9(t.point.x,0,t.bounds.width),0,t.bounds.width,0,360),[,s,n,r]=this.value.rawValue.getComponents("hsv");this.value.setRawValue(new lh([i,s,n,r],"hsv"),e)}onPointerDown_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerMove_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerUp_(t){this.handlePointerEvent_(t.data,{forceEmit:!0,last:!0})}onKeyDown_(t){let e=oz(lv(!1),oF(t));if(0===e)return;let[i,s,n,r]=this.value.rawValue.getComponents("hsv");this.value.setRawValue(new lh([i+e,s,n,r],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(t){0!==oz(lv(!1),oF(t))&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const l4=aM("svp");class l6{constructor(t,e){this.onValueChange_=this.onValueChange_.bind(this),this.value=e.value,this.value.emitter.on("change",this.onValueChange_),this.element=t.createElement("div"),this.element.classList.add(l4()),e.viewProps.bindClassModifiers(this.element),e.viewProps.bindTabIndex(this.element);let i=t.createElement("canvas");i.height=64,i.width=64,i.classList.add(l4("c")),this.element.appendChild(i),this.canvasElement=i;let s=t.createElement("div");s.classList.add(l4("m")),this.element.appendChild(s),this.markerElem_=s,this.update_()}update_(){let t=function(t){let e=t.ownerDocument.defaultView;return e&&"document"in e?t.getContext("2d",{willReadFrequently:!0}):null}(this.canvasElement);if(!t)return;let e=this.value.rawValue.getComponents("hsv"),i=this.canvasElement.width,s=this.canvasElement.height,n=t.getImageData(0,0,i,s),r=n.data;for(let t=0;t<s;t++)for(let n=0;n<i;n++){let a=r4(n,0,i,0,100),o=r4(t,0,s,100,0),l=le(e[0],a,o),h=(t*i+n)*4;r[h]=l[0],r[h+1]=l[1],r[h+2]=l[2],r[h+3]=255}t.putImageData(n,0,0);let a=r4(e[1],0,100,0,100);this.markerElem_.style.left=`${a}%`;let o=r4(e[2],0,100,100,0);this.markerElem_.style.top=`${o}%`}onValueChange_(){this.update_()}}class l9{constructor(t,e){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=e.value,this.viewProps=e.viewProps,this.view=new l6(t,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new oK(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(t,e){if(!t.point)return;let i=r4(t.point.x,0,t.bounds.width,0,100),s=r4(t.point.y,0,t.bounds.height,100,0),[n,,,r]=this.value.rawValue.getComponents("hsv");this.value.setRawValue(new lh([n,i,s,r],"hsv"),e)}onPointerDown_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerMove_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerUp_(t){this.handlePointerEvent_(t.data,{forceEmit:!0,last:!0})}onKeyDown_(t){oI(t.key)&&t.preventDefault();let[e,i,s,n]=this.value.rawValue.getComponents("hsv"),r=lv(!1),a=oz(r,oF(t)),o=oz(r,oB(t));(0!==a||0!==o)&&this.value.setRawValue(new lh([e,i+a,s+o,n],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(t){let e=lv(!1),i=oz(e,oF(t)),s=oz(e,oB(t));(0!==i||0!==s)&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class l8{constructor(t,e){this.value=e.value,this.viewProps=e.viewProps,this.hPaletteC_=new l3(t,{value:this.value,viewProps:this.viewProps}),this.svPaletteC_=new l9(t,{value:this.value,viewProps:this.viewProps}),this.alphaIcs_=e.supportsAlpha?{palette:new lQ(t,{value:this.value,viewProps:this.viewProps}),text:new oG(t,{parser:r2,props:rN.fromObject({pointerScale:.01,keyScale:.1,formatter:r3(2)}),value:rR(0,{constraint:new rz({min:0,max:1})}),viewProps:this.viewProps})}:null,this.alphaIcs_&&oN({primary:this.value,secondary:this.alphaIcs_.text.value,forward:t=>t.getComponents()[3],backward:(t,e)=>{let i=t.getComponents();return i[3]=e,new lh(i,t.mode)}}),this.textsC_=new l1(t,{colorType:e.colorType,value:this.value,viewProps:this.viewProps}),this.view=new ld(t,{alphaViews:this.alphaIcs_?{palette:this.alphaIcs_.palette.view,text:this.alphaIcs_.text.view}:null,hPaletteView:this.hPaletteC_.view,supportsAlpha:e.supportsAlpha,svPaletteView:this.svPaletteC_.view,textsView:this.textsC_.view,viewProps:this.viewProps})}get textsController(){return this.textsC_}}const l7=aM("colsw");class ht{constructor(t,e){this.onValueChange_=this.onValueChange_.bind(this),e.value.emitter.on("change",this.onValueChange_),this.value=e.value,this.element=t.createElement("div"),this.element.classList.add(l7()),e.viewProps.bindClassModifiers(this.element);let i=t.createElement("div");i.classList.add(l7("sw")),this.element.appendChild(i),this.swatchElem_=i;let s=t.createElement("button");s.classList.add(l7("b")),e.viewProps.bindDisabled(s),this.element.appendChild(s),this.buttonElement=s,this.update_()}update_(){let t=this.value.rawValue;this.swatchElem_.style.backgroundColor=lK(t)}onValueChange_(){this.update_()}}class he{constructor(t,e){this.value=e.value,this.viewProps=e.viewProps,this.view=new ht(t,{value:this.value,viewProps:this.viewProps})}}class hi{constructor(t,e){this.onButtonBlur_=this.onButtonBlur_.bind(this),this.onButtonClick_=this.onButtonClick_.bind(this),this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.value=e.value,this.viewProps=e.viewProps,this.foldable_=a1.create(e.expanded),this.swatchC_=new he(t,{value:this.value,viewProps:this.viewProps});let i=this.swatchC_.view.buttonElement;i.addEventListener("blur",this.onButtonBlur_),i.addEventListener("click",this.onButtonClick_),this.textC_=new oA(t,{parser:e.parser,props:rN.fromObject({formatter:e.formatter}),value:this.value,viewProps:this.viewProps}),this.view=new lt(t,{foldable:this.foldable_,pickerLayout:e.pickerLayout}),this.view.swatchElement.appendChild(this.swatchC_.view.element),this.view.textElement.appendChild(this.textC_.view.element),this.popC_="popup"===e.pickerLayout?new oV(t,{viewProps:this.viewProps}):null;let s=new l8(t,{colorType:e.colorType,supportsAlpha:e.supportsAlpha,value:this.value,viewProps:this.viewProps});s.view.allFocusableElements.forEach(t=>{t.addEventListener("blur",this.onPopupChildBlur_),t.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=s,this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(s.view.element),oN({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:t=>t,backward:(t,e)=>e})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),a5(this.foldable_,this.view.pickerElement))}get textController(){return this.textC_}onButtonBlur_(t){if(!this.popC_)return;let e=this.view.element,i=t.relatedTarget;i&&e.contains(i)||(this.popC_.shows.rawValue=!1)}onButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(t){if(!this.popC_)return;let e=this.popC_.view.element,i=aE(t);!(i&&e.contains(i))&&(!i||i!==this.swatchC_.view.buttonElement||a_(e.ownerDocument))&&(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(t){this.popC_?"Escape"===t.key&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&"Escape"===t.key&&this.swatchC_.view.buttonElement.focus()}}function hs(t){return li(t.getComponents("rgb")).reduce((t,e)=>t<<8|255&Math.floor(e),0)}function hn(t){return t.getComponents("rgb").reduce((t,e,i)=>t<<8|255&Math.floor(3===i?255*e:e),0)>>>0}function hr(t){return"number"!=typeof t?lh.black():new lh([t>>16&255,t>>8&255,255&t],"rgb")}function ha(t){return"number"!=typeof t?lh.black():new lh([t>>24&255,t>>16&255,t>>8&255,r4(255&t,0,255,0,1)],"rgb")}function ho(t,e){return!("object"!=typeof t||rP(t))&&e in t&&"number"==typeof t[e]}function hl(t){return ho(t,"r")&&ho(t,"g")&&ho(t,"b")}function hh(t){return hl(t)&&ho(t,"a")}function hp(t,e){if(t.mode!==e.mode||t.type!==e.type)return!1;let i=t.getComponents(),s=e.getComponents();for(let t=0;t<i.length;t++)if(i[t]!==s[t])return!1;return!0}function hd(t){return"a"in t?[t.r,t.g,t.b,t.a]:[t.r,t.g,t.b]}a$({id:"input-color-number",type:"input",accept:(t,e)=>{var i;if("number"!=typeof t||!("color"in e||"color"===e.view))return null;let s=lc(e);return s?{initialValue:t,params:Object.assign(Object.assign({},s),{supportsAlpha:null!==(i=null==e?void 0:e.color)&&void 0!==i&&!!i.alpha})}:null},binding:{reader:t=>t.params.supportsAlpha?ha:hr,equals:hp,writer:t=>(function(t){let e=t?hn:hs;return(t,i)=>{o4(t,e(i))}})(t.params.supportsAlpha)},controller:t=>{var e,i;return new hi(t.document,{colorType:"int",expanded:null!==(e=t.params.expanded)&&void 0!==e&&e,formatter:t.params.supportsAlpha?t=>lK(t,"0x"):t=>lU(t,"0x"),parser:lB("int"),pickerLayout:null!==(i=t.params.picker)&&void 0!==i?i:"popup",supportsAlpha:t.params.supportsAlpha,value:t.value,viewProps:t.viewProps})}}),a$({id:"input-color-object",type:"input",accept:(t,e)=>{var i;if(!hl(t))return null;let s=lc(e);return s?{initialValue:t,params:Object.assign(Object.assign({},s),{colorType:null!==(i=lm(e))&&void 0!==i?i:"int"})}:null},binding:{reader:t=>{var e;return e=t.params.colorType,t=>{let i=hl(t)?"int"===e?new lh(hd(t),"rgb"):"float"===e?new lb(hd(t),"rgb"):lw(lh.black(),"int"):lw(lh.black(),e);return lw(i,"int")}},equals:hp,writer:t=>{var e,i;return e=hh(t.initialValue),i=t.params.colorType,(t,s)=>{e?function(t,e,i){let s=lw(e,i).toRgbaObject();t.writeProperty("r",s.r),t.writeProperty("g",s.g),t.writeProperty("b",s.b),t.writeProperty("a",s.a)}(t,s,i):function(t,e,i){let s=lw(e,i).toRgbaObject();t.writeProperty("r",s.r),t.writeProperty("g",s.g),t.writeProperty("b",s.b)}(t,s,i)}}},controller:t=>{var e,i,s;let n=hh(t.initialValue);return new hi(t.document,{colorType:t.params.colorType,expanded:null!==(e=t.params.expanded)&&void 0!==e&&e,formatter:(s=t.params.colorType,t=>n?lH(t,s):lG(t,s)),parser:lB("int"),pickerLayout:null!==(i=t.params.picker)&&void 0!==i?i:"popup",supportsAlpha:n,value:t.value,viewProps:t.viewProps})}}),a$({id:"input-color-string",type:"input",accept:(t,e)=>{if("string"!=typeof t||"text"===e.view)return null;let i=function(t,e="int"){let i=lz.reduce((e,{parser:i,result:s})=>e||(i(t)?s:null),null);return i?"hex"===i.notation&&"float"!==e?Object.assign(Object.assign({},i),{type:"int"}):"func"===i.notation?Object.assign(Object.assign({},i),{type:e}):null:null}(t,lm(e));if(!i)return null;let s=lX(i);if(!s)return null;let n=lc(e);return n?{initialValue:t,params:Object.assign(Object.assign({},n),{format:i,stringifier:s})}:null},binding:{reader:()=>lF,equals:hp,writer:t=>{let e=function(t){let e=lX(t);return e?(t,i)=>{o4(t,e(i))}:null}(t.params.format);if(!e)throw rA.notBindable();return e}},controller:t=>{var e,i;return new hi(t.document,{colorType:t.params.format.type,expanded:null!==(e=t.params.expanded)&&void 0!==e&&e,formatter:t.params.stringifier,parser:lB("int"),pickerLayout:null!==(i=t.params.picker)&&void 0!==i?i:"popup",supportsAlpha:t.params.format.alpha,value:t.value,viewProps:t.viewProps})}});class hu{constructor(t){this.components=t.components,this.asm_=t.assembly}constrain(t){let e=this.asm_.toComponents(t).map((t,e)=>{var i,s;return null!==(s=null===(i=this.components[e])||void 0===i?void 0:i.constrain(t))&&void 0!==s?s:t});return this.asm_.fromComponents(e)}}const hc=aM("pndtxt");class hv{constructor(t,e){this.textViews=e.textViews,this.element=t.createElement("div"),this.element.classList.add(hc()),this.textViews.forEach(e=>{let i=t.createElement("div");i.classList.add(hc("a")),i.appendChild(e.element),this.element.appendChild(i)})}}class hm{constructor(t,e){this.value=e.value,this.viewProps=e.viewProps,this.acs_=e.axes.map((i,s)=>new oG(t,{arrayPosition:0===s?"fst":s===e.axes.length-1?"lst":"mid",parser:e.parser,props:e.axes[s].textProps,value:rR(0,{constraint:e.axes[s].constraint}),viewProps:e.viewProps})),this.acs_.forEach((t,i)=>{oN({primary:this.value,secondary:t.value,forward:t=>e.assembly.toComponents(t)[i],backward:(t,s)=>{let n=e.assembly.toComponents(t);return n[i]=s,e.assembly.fromComponents(n)}})}),this.view=new hv(t,{textViews:this.acs_.map(t=>t.view)})}get textControllers(){return this.acs_}}class hb extends ah{get max(){return this.controller.valueController.sliderController.props.get("max")}set max(t){this.controller.valueController.sliderController.props.set("max",t)}get min(){return this.controller.valueController.sliderController.props.get("min")}set min(t){this.controller.valueController.sliderController.props.set("min",t)}}a$({id:"input-number",type:"input",accept:(t,e)=>{if("number"!=typeof t)return null;let i=ac(e,t=>Object.assign(Object.assign({},ai(t)),{options:t.optional.custom(o_),readonly:t.optional.constant(!1)}));return i?{initialValue:t,params:i}:null},binding:{reader:t=>r5,constraint:t=>(function(t,e){let i=[],s=r7(t,e);s&&i.push(s);let n=at(t);n&&i.push(n);let r=ox(t.options);return r&&i.push(r),new ob(i)})(t.params,t.initialValue),writer:t=>o4},controller:t=>{let e=t.value,i=t.constraint,s=i&&og(i,ow);if(s)return new oP(t.document,{props:new rN({options:s.values.value("options")}),value:e,viewProps:t.viewProps});let n=ae(t.params,e.rawValue),r=i&&og(i,rz);if(r){var a;return new oQ(t.document,Object.assign(Object.assign({},{sliderProps:new rN({keyScale:(a=Object.assign(Object.assign({},n),{keyScale:rR(n.keyScale),max:r.values.value("max"),min:r.values.value("min")})).keyScale,max:a.max,min:a.min}),textProps:new rN({formatter:rR(a.formatter),keyScale:a.keyScale,pointerScale:rR(a.pointerScale)})}),{parser:r2,value:e,viewProps:t.viewProps}))}return new oG(t.document,{parser:r2,props:rN.fromObject(n),value:e,viewProps:t.viewProps})},api:t=>"number"!=typeof t.controller.value.rawValue?null:t.controller.valueController instanceof oQ?new hb(t.controller):t.controller.valueController instanceof oP?new oc(t.controller):null});class hg{constructor(t=0,e=0){this.x=t,this.y=e}getComponents(){return[this.x,this.y]}static isObject(t){if(rP(t))return!1;let e=t.x,i=t.y;return"number"==typeof e&&"number"==typeof i}static equals(t,e){return t.x===e.x&&t.y===e.y}toObject(){return{x:this.x,y:this.y}}}const hw={toComponents:t=>t.getComponents(),fromComponents:t=>new hg(...t)},h_=aM("p2d");class hf{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(h_()),e.viewProps.bindClassModifiers(this.element),ak(e.expanded,az(this.element,h_(void 0,"expanded")));let i=t.createElement("div");i.classList.add(h_("h")),this.element.appendChild(i);let s=t.createElement("button");s.classList.add(h_("b")),s.appendChild(ax(t,"p2dpad")),e.viewProps.bindDisabled(s),i.appendChild(s),this.buttonElement=s;let n=t.createElement("div");if(n.classList.add(h_("t")),i.appendChild(n),this.textElement=n,"inline"===e.pickerLayout){let e=t.createElement("div");e.classList.add(h_("p")),this.element.appendChild(e),this.pickerElement=e}else this.pickerElement=null}}const hx=aM("p2dp");class hy{constructor(t,e){this.onFoldableChange_=this.onFoldableChange_.bind(this),this.onPropsChange_=this.onPropsChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.props_=e.props,this.props_.emitter.on("change",this.onPropsChange_),this.element=t.createElement("div"),this.element.classList.add(hx()),"popup"===e.layout&&this.element.classList.add(hx(void 0,"p")),e.viewProps.bindClassModifiers(this.element);let i=t.createElement("div");i.classList.add(hx("p")),e.viewProps.bindTabIndex(i),this.element.appendChild(i),this.padElement=i;let s=t.createElementNS(ag,"svg");s.classList.add(hx("g")),this.padElement.appendChild(s),this.svgElem_=s;let n=t.createElementNS(ag,"line");n.classList.add(hx("ax")),n.setAttributeNS(null,"x1","0"),n.setAttributeNS(null,"y1","50%"),n.setAttributeNS(null,"x2","100%"),n.setAttributeNS(null,"y2","50%"),this.svgElem_.appendChild(n);let r=t.createElementNS(ag,"line");r.classList.add(hx("ax")),r.setAttributeNS(null,"x1","50%"),r.setAttributeNS(null,"y1","0"),r.setAttributeNS(null,"x2","50%"),r.setAttributeNS(null,"y2","100%"),this.svgElem_.appendChild(r);let a=t.createElementNS(ag,"line");a.classList.add(hx("l")),a.setAttributeNS(null,"x1","50%"),a.setAttributeNS(null,"y1","50%"),this.svgElem_.appendChild(a),this.lineElem_=a;let o=t.createElement("div");o.classList.add(hx("m")),this.padElement.appendChild(o),this.markerElem_=o,e.value.emitter.on("change",this.onValueChange_),this.value=e.value,this.update_()}get allFocusableElements(){return[this.padElement]}update_(){let[t,e]=this.value.rawValue.getComponents(),i=this.props_.get("max"),s=r4(t,-i,+i,0,100),n=r4(e,-i,+i,0,100),r=this.props_.get("invertsY")?100-n:n;this.lineElem_.setAttributeNS(null,"x2",`${s}%`),this.lineElem_.setAttributeNS(null,"y2",`${r}%`),this.markerElem_.style.left=`${s}%`,this.markerElem_.style.top=`${r}%`}onValueChange_(){this.update_()}onPropsChange_(){this.update_()}onFoldableChange_(){this.update_()}}function hC(t,e,i){return[oz(e[0],oF(t)),oz(e[1],oB(t))*(i?1:-1)]}class hP{constructor(t,e){this.onPadKeyDown_=this.onPadKeyDown_.bind(this),this.onPadKeyUp_=this.onPadKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.props=e.props,this.value=e.value,this.viewProps=e.viewProps,this.view=new hy(t,{layout:e.layout,props:this.props,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new oK(this.view.padElement),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.padElement.addEventListener("keydown",this.onPadKeyDown_),this.view.padElement.addEventListener("keyup",this.onPadKeyUp_)}handlePointerEvent_(t,e){if(!t.point)return;let i=this.props.get("max"),s=r4(t.point.x,0,t.bounds.width,-i,+i),n=r4(this.props.get("invertsY")?t.bounds.height-t.point.y:t.point.y,0,t.bounds.height,-i,+i);this.value.setRawValue(new hg(s,n),e)}onPointerDown_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerMove_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerUp_(t){this.handlePointerEvent_(t.data,{forceEmit:!0,last:!0})}onPadKeyDown_(t){oI(t.key)&&t.preventDefault();let[e,i]=hC(t,[this.props.get("xKeyScale"),this.props.get("yKeyScale")],this.props.get("invertsY"));(0!==e||0!==i)&&this.value.setRawValue(new hg(this.value.rawValue.x+e,this.value.rawValue.y+i),{forceEmit:!1,last:!1})}onPadKeyUp_(t){let[e,i]=hC(t,[this.props.get("xKeyScale"),this.props.get("yKeyScale")],this.props.get("invertsY"));(0!==e||0!==i)&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class hE{constructor(t,e){var i,s;this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.onPadButtonBlur_=this.onPadButtonBlur_.bind(this),this.onPadButtonClick_=this.onPadButtonClick_.bind(this),this.value=e.value,this.viewProps=e.viewProps,this.foldable_=a1.create(e.expanded),this.popC_="popup"===e.pickerLayout?new oV(t,{viewProps:this.viewProps}):null;let n=new hP(t,{layout:e.pickerLayout,props:new rN({invertsY:rR(e.invertsY),max:rR(e.max),xKeyScale:e.axes[0].textProps.value("keyScale"),yKeyScale:e.axes[1].textProps.value("keyScale")}),value:this.value,viewProps:this.viewProps});n.view.allFocusableElements.forEach(t=>{t.addEventListener("blur",this.onPopupChildBlur_),t.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=n,this.textC_=new hm(t,{assembly:hw,axes:e.axes,parser:e.parser,value:this.value,viewProps:this.viewProps}),this.view=new hf(t,{expanded:this.foldable_.value("expanded"),pickerLayout:e.pickerLayout,viewProps:this.viewProps}),this.view.textElement.appendChild(this.textC_.view.element),null===(i=this.view.buttonElement)||void 0===i||i.addEventListener("blur",this.onPadButtonBlur_),null===(s=this.view.buttonElement)||void 0===s||s.addEventListener("click",this.onPadButtonClick_),this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(this.pickerC_.view.element),oN({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:t=>t,backward:(t,e)=>e})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),a5(this.foldable_,this.view.pickerElement))}get textController(){return this.textC_}onPadButtonBlur_(t){if(!this.popC_)return;let e=this.view.element,i=t.relatedTarget;i&&e.contains(i)||(this.popC_.shows.rawValue=!1)}onPadButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(t){if(!this.popC_)return;let e=this.popC_.view.element,i=aE(t);!(i&&e.contains(i))&&(!i||i!==this.view.buttonElement||a_(e.ownerDocument))&&(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(t){this.popC_?"Escape"===t.key&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&"Escape"===t.key&&this.view.buttonElement.focus()}}function hk(t){return hg.isObject(t)?new hg(t.x,t.y):new hg}function hV(t,e){t.writeProperty("x",e.x),t.writeProperty("y",e.y)}function hM(t,e){var i,s;return rP(t.min)&&rP(t.max)?Math.max(10*Math.abs(r8(t)),10*Math.abs(e)):Math.max(Math.abs(null!==(i=t.min)&&void 0!==i?i:0),Math.abs(null!==(s=t.max)&&void 0!==s?s:0))}a$({id:"input-point2d",type:"input",accept:(t,e)=>{if(!hg.isObject(t))return null;let i=ac(e,t=>Object.assign(Object.assign({},o1(t)),{expanded:t.optional.boolean,picker:t.optional.custom(o3),readonly:t.optional.constant(!1),x:t.optional.custom(o2),y:t.optional.object(Object.assign(Object.assign({},o1(t)),{inverted:t.optional.boolean}))}));return i?{initialValue:t,params:i}:null},binding:{reader:()=>hk,constraint:t=>{var e,i;return e=t.params,i=t.initialValue,new hu({assembly:hw,components:[o5(Object.assign(Object.assign({},e),e.x),i.x),o5(Object.assign(Object.assign({},e),e.y),i.y)]})},equals:hg.equals,writer:()=>hV},controller:t=>{var e,i,s,n,r,a;let o=t.document,l=t.value,h=t.constraint,p=[t.params.x,t.params.y];return new hE(o,{axes:l.rawValue.getComponents().map((e,i)=>{var s;return as({constraint:h.components[i],initialValue:e,params:rM(t.params,null!==(s=p[i])&&void 0!==s?s:{})})}),expanded:null!==(e=t.params.expanded)&&void 0!==e&&e,invertsY:function(t){if(!("y"in t))return!1;let e=t.y;return!!e&&"inverted"in e&&!!e.inverted}(t.params),max:(s=t.params,n=l.rawValue,Math.max(hM(rM(s,null!==(r=s.x)&&void 0!==r?r:{}),n.x),hM(rM(s,null!==(a=s.y)&&void 0!==a?a:{}),n.y))),parser:r2,pickerLayout:null!==(i=t.params.picker)&&void 0!==i?i:"popup",value:l,viewProps:t.viewProps})}});class hL{constructor(t=0,e=0,i=0){this.x=t,this.y=e,this.z=i}getComponents(){return[this.x,this.y,this.z]}static isObject(t){if(rP(t))return!1;let e=t.x,i=t.y,s=t.z;return"number"==typeof e&&"number"==typeof i&&"number"==typeof s}static equals(t,e){return t.x===e.x&&t.y===e.y&&t.z===e.z}toObject(){return{x:this.x,y:this.y,z:this.z}}}const hA={toComponents:t=>t.getComponents(),fromComponents:t=>new hL(...t)};function hS(t){return hL.isObject(t)?new hL(t.x,t.y,t.z):new hL}function hD(t,e){t.writeProperty("x",e.x),t.writeProperty("y",e.y),t.writeProperty("z",e.z)}a$({id:"input-point3d",type:"input",accept:(t,e)=>{if(!hL.isObject(t))return null;let i=ac(e,t=>Object.assign(Object.assign({},o1(t)),{readonly:t.optional.constant(!1),x:t.optional.custom(o2),y:t.optional.custom(o2),z:t.optional.custom(o2)}));return i?{initialValue:t,params:i}:null},binding:{reader:t=>hS,constraint:t=>{var e,i;return e=t.params,i=t.initialValue,new hu({assembly:hA,components:[o5(Object.assign(Object.assign({},e),e.x),i.x),o5(Object.assign(Object.assign({},e),e.y),i.y),o5(Object.assign(Object.assign({},e),e.z),i.z)]})},equals:hL.equals,writer:t=>hD},controller:t=>{let e=t.value,i=t.constraint,s=[t.params.x,t.params.y,t.params.z];return new hm(t.document,{assembly:hA,axes:e.rawValue.getComponents().map((e,n)=>{var r;return as({constraint:i.components[n],initialValue:e,params:rM(t.params,null!==(r=s[n])&&void 0!==r?r:{})})}),parser:r2,value:e,viewProps:t.viewProps})}});class hO{constructor(t=0,e=0,i=0,s=0){this.x=t,this.y=e,this.z=i,this.w=s}getComponents(){return[this.x,this.y,this.z,this.w]}static isObject(t){if(rP(t))return!1;let e=t.x,i=t.y,s=t.z,n=t.w;return"number"==typeof e&&"number"==typeof i&&"number"==typeof s&&"number"==typeof n}static equals(t,e){return t.x===e.x&&t.y===e.y&&t.z===e.z&&t.w===e.w}toObject(){return{x:this.x,y:this.y,z:this.z,w:this.w}}}const hj={toComponents:t=>t.getComponents(),fromComponents:t=>new hO(...t)};function hT(t){return hO.isObject(t)?new hO(t.x,t.y,t.z,t.w):new hO}function hR(t,e){t.writeProperty("x",e.x),t.writeProperty("y",e.y),t.writeProperty("z",e.z),t.writeProperty("w",e.w)}a$({id:"input-point4d",type:"input",accept:(t,e)=>{if(!hO.isObject(t))return null;let i=ac(e,t=>Object.assign(Object.assign({},o1(t)),{readonly:t.optional.constant(!1),w:t.optional.custom(o2),x:t.optional.custom(o2),y:t.optional.custom(o2),z:t.optional.custom(o2)}));return i?{initialValue:t,params:i}:null},binding:{reader:t=>hT,constraint:t=>{var e,i;return e=t.params,i=t.initialValue,new hu({assembly:hj,components:[o5(Object.assign(Object.assign({},e),e.x),i.x),o5(Object.assign(Object.assign({},e),e.y),i.y),o5(Object.assign(Object.assign({},e),e.z),i.z),o5(Object.assign(Object.assign({},e),e.w),i.w)]})},equals:hO.equals,writer:t=>hR},controller:t=>{let e=t.value,i=t.constraint,s=[t.params.x,t.params.y,t.params.z,t.params.w];return new hm(t.document,{assembly:hj,axes:e.rawValue.getComponents().map((e,n)=>{var r;return as({constraint:i.components[n],initialValue:e,params:rM(t.params,null!==(r=s[n])&&void 0!==r?r:{})})}),parser:r2,value:e,viewProps:t.viewProps})}}),a$({id:"input-string",type:"input",accept:(t,e)=>{if("string"!=typeof t)return null;let i=ac(e,t=>({readonly:t.optional.constant(!1),options:t.optional.custom(o_)}));return i?{initialValue:t,params:i}:null},binding:{reader:t=>oT,constraint:t=>(function(t){let e=[],i=ox(t.options);return i&&e.push(i),new ob(e)})(t.params),writer:t=>o4},controller:t=>{let e=t.document,i=t.value,s=t.constraint,n=s&&og(s,ow);return n?new oP(e,{props:new rN({options:n.values.value("options")}),value:i,viewProps:t.viewProps}):new oA(e,{parser:t=>t,props:rN.fromObject({formatter:oR}),value:i,viewProps:t.viewProps})},api:t=>"string"!=typeof t.controller.value.rawValue?null:t.controller.valueController instanceof oP?new oc(t.controller):null});const hN={monitor:{defaultInterval:200,defaultRows:3}},hz=aM("mll");class hB{constructor(t,e){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=e.formatter,this.element=t.createElement("div"),this.element.classList.add(hz()),e.viewProps.bindClassModifiers(this.element);let i=t.createElement("textarea");i.classList.add(hz("i")),i.style.height=`calc(var(--${oJ}) * ${e.rows})`,i.readOnly=!0,e.viewProps.bindDisabled(i),this.element.appendChild(i),this.textareaElem_=i,e.value.emitter.on("change",this.onValueUpdate_),this.value=e.value,this.update_()}update_(){let t=this.textareaElem_,e=t.scrollTop===t.scrollHeight-t.clientHeight,i=[];this.value.rawValue.forEach(t=>{void 0!==t&&i.push(this.formatter_(t))}),t.textContent=i.join("\n"),e&&(t.scrollTop=t.scrollHeight)}onValueUpdate_(){this.update_()}}class hF{constructor(t,e){this.value=e.value,this.viewProps=e.viewProps,this.view=new hB(t,{formatter:e.formatter,rows:e.rows,value:this.value,viewProps:this.viewProps})}}const hI=aM("sgl");class hU{constructor(t,e){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=e.formatter,this.element=t.createElement("div"),this.element.classList.add(hI()),e.viewProps.bindClassModifiers(this.element);let i=t.createElement("input");i.classList.add(hI("i")),i.readOnly=!0,i.type="text",e.viewProps.bindDisabled(i),this.element.appendChild(i),this.inputElement=i,e.value.emitter.on("change",this.onValueUpdate_),this.value=e.value,this.update_()}update_(){let t=this.value.rawValue,e=t[t.length-1];this.inputElement.value=void 0!==e?this.formatter_(e):""}onValueUpdate_(){this.update_()}}class hK{constructor(t,e){this.value=e.value,this.viewProps=e.viewProps,this.view=new hU(t,{formatter:e.formatter,value:this.value,viewProps:this.viewProps})}}a$({id:"monitor-bool",type:"monitor",accept:(t,e)=>{if("boolean"!=typeof t)return null;let i=ac(e,t=>({readonly:t.required.constant(!0),rows:t.optional.number}));return i?{initialValue:t,params:i}:null},binding:{reader:t=>oS},controller:t=>{var e;return 1===t.value.rawValue.length?new hK(t.document,{formatter:oD,value:t.value,viewProps:t.viewProps}):new hF(t.document,{formatter:oD,rows:null!==(e=t.params.rows)&&void 0!==e?e:hN.monitor.defaultRows,value:t.value,viewProps:t.viewProps})}});class hq extends ah{get max(){return this.controller.valueController.props.get("max")}set max(t){this.controller.valueController.props.set("max",t)}get min(){return this.controller.valueController.props.get("min")}set min(t){this.controller.valueController.props.set("min",t)}}const h$=aM("grl");class hG{constructor(t,e){this.onCursorChange_=this.onCursorChange_.bind(this),this.onValueUpdate_=this.onValueUpdate_.bind(this),this.element=t.createElement("div"),this.element.classList.add(h$()),e.viewProps.bindClassModifiers(this.element),this.formatter_=e.formatter,this.props_=e.props,this.cursor_=e.cursor,this.cursor_.emitter.on("change",this.onCursorChange_);let i=t.createElementNS(ag,"svg");i.classList.add(h$("g")),i.style.height=`calc(var(--${oJ}) * ${e.rows})`,this.element.appendChild(i),this.svgElem_=i;let s=t.createElementNS(ag,"polyline");this.svgElem_.appendChild(s),this.lineElem_=s;let n=t.createElement("div");n.classList.add(h$("t"),aM("tt")()),this.element.appendChild(n),this.tooltipElem_=n,e.value.emitter.on("change",this.onValueUpdate_),this.value=e.value,this.update_()}get graphElement(){return this.svgElem_}update_(){let t=this.svgElem_.getBoundingClientRect(),e=this.value.rawValue.length-1,i=this.props_.get("min"),s=this.props_.get("max"),n=[];this.value.rawValue.forEach((r,a)=>{if(void 0===r)return;let o=r4(a,0,e,0,t.width),l=r4(r,i,s,t.height,0);n.push([o,l].join(","))}),this.lineElem_.setAttributeNS(null,"points",n.join(" "));let r=this.tooltipElem_,a=this.value.rawValue[this.cursor_.rawValue];if(void 0===a){r.classList.remove(h$("t","a"));return}let o=r4(this.cursor_.rawValue,0,e,0,t.width),l=r4(a,i,s,t.height,0);r.style.left=`${o}px`,r.style.top=`${l}px`,r.textContent=`${this.formatter_(a)}`,r.classList.contains(h$("t","a"))||(r.classList.add(h$("t","a"),h$("t","in")),aw(r),r.classList.remove(h$("t","in")))}onValueUpdate_(){this.update_()}onCursorChange_(){this.update_()}}class hH{constructor(t,e){if(this.onGraphMouseMove_=this.onGraphMouseMove_.bind(this),this.onGraphMouseLeave_=this.onGraphMouseLeave_.bind(this),this.onGraphPointerDown_=this.onGraphPointerDown_.bind(this),this.onGraphPointerMove_=this.onGraphPointerMove_.bind(this),this.onGraphPointerUp_=this.onGraphPointerUp_.bind(this),this.props=e.props,this.value=e.value,this.viewProps=e.viewProps,this.cursor_=rR(-1),this.view=new hG(t,{cursor:this.cursor_,formatter:e.formatter,rows:e.rows,props:this.props,value:this.value,viewProps:this.viewProps}),a_(t)){let t=new oK(this.view.element);t.emitter.on("down",this.onGraphPointerDown_),t.emitter.on("move",this.onGraphPointerMove_),t.emitter.on("up",this.onGraphPointerUp_)}else this.view.element.addEventListener("mousemove",this.onGraphMouseMove_),this.view.element.addEventListener("mouseleave",this.onGraphMouseLeave_)}importProps(t){return av(t,null,t=>({max:t.required.number,min:t.required.number}),t=>(this.props.set("max",t.max),this.props.set("min",t.min),!0))}exportProps(){return am(null,{max:this.props.get("max"),min:this.props.get("min")})}onGraphMouseLeave_(){this.cursor_.rawValue=-1}onGraphMouseMove_(t){let e=this.view.element.getBoundingClientRect();this.cursor_.rawValue=Math.floor(r4(t.offsetX,0,e.width,0,this.value.rawValue.length))}onGraphPointerDown_(t){this.onGraphPointerMove_(t)}onGraphPointerMove_(t){if(!t.data.point){this.cursor_.rawValue=-1;return}this.cursor_.rawValue=Math.floor(r4(t.data.point.x,0,t.data.bounds.width,0,this.value.rawValue.length))}onGraphPointerUp_(){this.cursor_.rawValue=-1}}function hY(t){return rP(t.format)?r3(2):t.format}function hX(t){return"graph"===t.view}a$({id:"monitor-number",type:"monitor",accept:(t,e)=>{if("number"!=typeof t)return null;let i=ac(e,t=>({format:t.optional.function,max:t.optional.number,min:t.optional.number,readonly:t.required.constant(!0),rows:t.optional.number,view:t.optional.string}));return i?{initialValue:t,params:i}:null},binding:{defaultBufferSize:t=>hX(t)?64:1,reader:t=>r5},controller:t=>{var e,i,s,n;return hX(t.params)?new hH(t.document,{formatter:hY(t.params),rows:null!==(e=t.params.rows)&&void 0!==e?e:hN.monitor.defaultRows,props:rN.fromObject({max:null!==(i=t.params.max)&&void 0!==i?i:100,min:null!==(s=t.params.min)&&void 0!==s?s:0}),value:t.value,viewProps:t.viewProps}):1===t.value.rawValue.length?new hK(t.document,{formatter:hY(t.params),value:t.value,viewProps:t.viewProps}):new hF(t.document,{formatter:hY(t.params),rows:null!==(n=t.params.rows)&&void 0!==n?n:hN.monitor.defaultRows,value:t.value,viewProps:t.viewProps})},api:t=>t.controller.valueController instanceof hH?new hq(t.controller):null}),a$({id:"monitor-string",type:"monitor",accept:(t,e)=>{if("string"!=typeof t)return null;let i=ac(e,t=>({multiline:t.optional.boolean,readonly:t.required.constant(!0),rows:t.optional.number}));return i?{initialValue:t,params:i}:null},binding:{reader:t=>oT},controller:t=>{var e;let i=t.value;return i.rawValue.length>1||t.params.multiline?new hF(t.document,{formatter:oR,rows:null!==(e=t.params.rows)&&void 0!==e?e:hN.monitor.defaultRows,value:i,viewProps:t.viewProps}):new hK(t.document,{formatter:oR,value:i,viewProps:t.viewProps})}});class hW{constructor(t){this.controller_=t}get disabled(){return this.controller_.viewProps.get("disabled")}set disabled(t){this.controller_.viewProps.set("disabled",t)}get title(){var t;return null!==(t=this.controller_.props.get("title"))&&void 0!==t?t:""}set title(t){this.controller_.props.set("title",t)}on(t,e){let i=e.bind(this);return this.controller_.emitter.on(t,()=>{i(new ar(this))}),this}}class hZ extends ar{constructor(t,e,i){super(t),this.cell=e,this.index=i}}class hQ extends an{constructor(t){super(t),this.cellToApiMap_=new Map,this.emitter_=new rD;let e=this.controller.valueController;e.cellControllers.forEach((t,i)=>{let s=new hW(t);this.cellToApiMap_.set(t,s),t.emitter.on("click",()=>{let t=i%e.size[0],n=Math.floor(i/e.size[0]);this.emitter_.emit("click",{event:new hZ(this,s,[t,n])})})})}cell(t,e){let i=this.controller.valueController,s=i.cellControllers[e*i.size[0]+t];return this.cellToApiMap_.get(s)}on(t,e){let i=e.bind(this);return this.emitter_.on(t,t=>{i(t.event)}),this}}class hJ{constructor(t,e){this.size=e.size;let[i,s]=this.size,n=[];for(let r=0;r<s;r++)for(let s=0;s<i;s++){let i=new aU(t,{props:rN.fromObject(Object.assign({},e.cellConfig(s,r))),viewProps:ot.create()});n.push(i)}this.cellCs_=n,this.viewProps=ot.create(),this.viewProps.handleDispose(()=>{this.cellCs_.forEach(t=>{t.viewProps.set("disposed",!0)})}),this.view=new o0(t,{viewProps:this.viewProps,viewName:"btngrid"}),this.view.element.style.gridTemplateColumns=`repeat(${i}, 1fr)`,this.cellCs_.forEach(t=>{this.view.element.appendChild(t.view.element)})}get cellControllers(){return this.cellCs_}}class h0 extends aj{constructor(t,e){let i=e.valueController,s=new aS(t,{blade:e.blade,props:e.labelProps,valueController:i});super({blade:e.blade,view:s.view,viewProps:i.viewProps}),this.valueController=i,this.labelController=s}}const h1=a$({id:"buttongrid",type:"blade",accept(t){let e=ac(t,t=>({cells:t.required.function,size:t.required.array(t.required.number),view:t.required.constant("buttongrid"),label:t.optional.string}));return e?{params:e}:null},controller:t=>new h0(t.document,{blade:t.blade,labelProps:rN.fromObject({label:t.params.label}),valueController:new hJ(t.document,{cellConfig:t.params.cells,size:t.params.size})}),api:t=>t.controller instanceof h0?new hQ(t.controller):null});class h2 extends an{get label(){return this.controller.labelController.props.get("label")}set label(t){this.controller.labelController.props.set("label",t)}get value(){return this.controller.valueController.value.rawValue}set value(t){this.controller.valueController.value.rawValue=t}on(t,e){let i=e.bind(this);return this.controller.valueController.value.emitter.on(t,t=>{i(new aa(this,t.rawValue,t.options.last))}),this}}class h5{constructor(t=0,e=0,i=1,s=1){this.cache_=[],this.comps_=[t,e,i,s]}get x1(){return this.comps_[0]}get y1(){return this.comps_[1]}get x2(){return this.comps_[2]}get y2(){return this.comps_[3]}static isObject(t){return!rP(t)&&!!Array.isArray(t)&&"number"==typeof t[0]&&"number"==typeof t[1]&&"number"==typeof t[2]&&"number"==typeof t[3]}static equals(t,e){return t.x1===e.x1&&t.y1===e.y1&&t.x2===e.x2&&t.y2===e.y2}curve(t){var e,i,s,n;let r=0*(1-t)+this.x1*t,a=0*(1-t)+this.y1*t,o=this.x1*(1-t)+this.x2*t,l=this.y1*(1-t)+this.y2*t,h=this.x2*(1-t)+1*t,p=this.y2*(1-t)+1*t;return[(e=r*(1-t)+o*t,i=o*(1-t)+h*t,e*(1-t)+i*t),(s=a*(1-t)+l*t,n=l*(1-t)+p*t,s*(1-t)+n*t)]}y(t){if(0===this.cache_.length){let t=[];for(let e=0;e<100;e++)t.push(function(t,e){let i=.25,s=.5,n=-1;for(let r=0;r<20;r++){let[r,a]=t.curve(s);if(s+=i*(r<e?1:-1),n=a,i*=.5,.001>Math.abs(e-r))break}return n}(this,r4(e,0,99,0,1)));this.cache_=t}return this.cache_[Math.round(r4(r9(t,0,1),0,1,0,99))]}toObject(){return[this.comps_[0],this.comps_[1],this.comps_[2],this.comps_[3]]}}const h3={toComponents:t=>t.toObject(),fromComponents:t=>new h5(...t)};function h4(t){let e=r3(2),i=t.toObject().map(t=>e(t));return`cubic-bezier(${i.join(", ")})`}const h6=[0,.5,.5,1];function h9(t){let e=t.match(/^cubic-bezier\s*\(\s*([0-9.]+)\s*,\s*([0-9.]+)\s*,\s*([0-9.]+)\s*,\s*([0-9.]+)\s*\)$/);if(!e)return new h5(...h6);let i=[e[1],e[2],e[3],e[4]].reduce((t,e)=>{if(!t)return null;let i=Number(e);return isNaN(i)?null:[...t,i]},[]);return new h5(...null!=i?i:h6)}const h8=aM("cbz");class h7{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(h8()),e.viewProps.bindClassModifiers(this.element),e.foldable.bindExpandedClass(this.element,h8(void 0,"expanded")),aV(e.foldable,"completed",az(this.element,h8(void 0,"cpl")));let i=t.createElement("div");i.classList.add(h8("h")),this.element.appendChild(i);let s=t.createElement("button");s.classList.add(h8("b")),e.viewProps.bindDisabled(s);let n=t.createElementNS(ag,"svg");n.innerHTML='<path d="M2 13C8 13 8 3 14 3"/>',s.appendChild(n),i.appendChild(s),this.buttonElement=s;let r=t.createElement("div");if(r.classList.add(h8("t")),i.appendChild(r),this.textElement=r,"inline"===e.pickerLayout){let e=t.createElement("div");e.classList.add(h8("p")),this.element.appendChild(e),this.pickerElement=e}else this.pickerElement=null}}const pt=aM("cbzp");class pe{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(pt()),e.viewProps.bindClassModifiers(this.element);let i=t.createElement("div");i.classList.add(pt("g")),this.element.appendChild(i),this.graphElement=i;let s=t.createElement("div");s.classList.add(pt("t")),this.element.appendChild(s),this.textElement=s}}function pi(t,e){let i=new MutationObserver(t=>{for(let s of t)"childList"===s.type&&s.addedNodes.forEach(t=>{t.contains(t)&&(e(),i.disconnect())})}),s=t.ownerDocument;i.observe(s.body,{attributes:!0,childList:!0,subtree:!0})}const ps=aM("cbzg");class pn{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(ps()),e.viewProps.bindClassModifiers(this.element),e.viewProps.bindTabIndex(this.element);let i=t.createElement("div");i.classList.add(ps("p")),this.element.appendChild(i),this.previewElement=i;let s=t.createElementNS(ag,"svg");s.classList.add(ps("g")),this.element.appendChild(s),this.svgElem_=s;let n=t.createElementNS(ag,"path");n.classList.add(ps("u")),this.svgElem_.appendChild(n),this.guideElem_=n;let r=t.createElementNS(ag,"polyline");r.classList.add(ps("l")),this.svgElem_.appendChild(r),this.lineElem_=r,this.handleElems_=[t.createElement("div"),t.createElement("div")],this.handleElems_.forEach(t=>{t.classList.add(ps("h")),this.element.appendChild(t)}),this.vectorElems_=[t.createElementNS(ag,"line"),t.createElementNS(ag,"line")],this.vectorElems_.forEach(t=>{t.classList.add(ps("v")),this.svgElem_.appendChild(t)}),this.value_=e.value,this.value_.emitter.on("change",this.onValueChange_.bind(this)),this.sel_=e.selection,this.handleElems_.forEach((t,e)=>{var i,s;ak(this.sel_,(i=t=>t===e,s=az(t,ps("h","sel")),t=>s(i(t))))}),pi(this.element,()=>{this.refresh()})}getVertMargin_(t){return .25*t}valueToPosition(t,e){let{clientWidth:i,clientHeight:s}=this.element,n=this.getVertMargin_(s);return{x:r4(t,0,1,0,i),y:r4(e,0,1,s-n,n)}}positionToValue(t,e){let i=this.element.getBoundingClientRect(),s=i.width,n=i.height,r=this.getVertMargin_(n);return{x:r9(r4(t,0,s,0,1),0,1),y:r4(e,n-r,r,0,1)}}refresh(){this.guideElem_.setAttributeNS(null,"d",[0,1].map(t=>{let e=this.valueToPosition(0,t),i=this.valueToPosition(1,t);return`M ${e.x},${e.y} L ${i.x},${i.y}`}).join(" "));let t=this.value_.rawValue,e=[],i=0;for(;;){let s=this.valueToPosition(...t.curve(i));if(e.push([s.x,s.y].join(",")),i>=1)break;i=Math.min(i+.05,1)}this.lineElem_.setAttributeNS(null,"points",e.join(" "));let s=t.toObject();[0,1].forEach(t=>{let e=this.valueToPosition(t,t),i=this.valueToPosition(s[2*t],s[2*t+1]),n=this.vectorElems_[t];n.setAttributeNS(null,"x1",String(e.x)),n.setAttributeNS(null,"y1",String(e.y)),n.setAttributeNS(null,"x2",String(i.x)),n.setAttributeNS(null,"y2",String(i.y));let r=this.handleElems_[t];r.style.left=`${i.x}px`,r.style.top=`${i.y}px`})}onValueChange_(){this.refresh()}}const pr=aM("cbzprv");class pa{constructor(t,e){this.stopped_=!0,this.startTime_=-1,this.onDispose_=this.onDispose_.bind(this),this.onTimer_=this.onTimer_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.element=t.createElement("div"),this.element.classList.add(pr()),e.viewProps.bindClassModifiers(this.element);let i=t.createElementNS(ag,"svg");i.classList.add(pr("g")),this.element.appendChild(i),this.svgElem_=i;let s=t.createElementNS(ag,"path");s.classList.add(pr("t")),this.svgElem_.appendChild(s),this.ticksElem_=s;let n=t.createElement("div");n.classList.add(pr("m")),this.element.appendChild(n),this.markerElem_=n,this.value_=e.value,this.value_.emitter.on("change",this.onValueChange_),e.viewProps.handleDispose(this.onDispose_),pi(this.element,()=>{this.refresh()})}play(){this.stop(),this.updateMarker_(0),this.markerElem_.classList.add(pr("m","a")),this.startTime_=new Date().getTime()+400,this.stopped_=!1,requestAnimationFrame(this.onTimer_)}stop(){this.stopped_=!0,this.markerElem_.classList.remove(pr("m","a"))}onDispose_(){this.stop()}updateMarker_(t){let e=this.value_.rawValue.y(r9(t,0,1));this.markerElem_.style.left=`${100*e}%`}refresh(){let{clientWidth:t,clientHeight:e}=this.svgElem_,i=[],s=this.value_.rawValue;for(let n=0;n<24;n++){let r=r4(n,0,23,0,1),a=r4(s.y(r),0,1,0,t);i.push(`M ${a},0 v${e}`)}this.ticksElem_.setAttributeNS(null,"d",i.join(" "))}onTimer_(){if(null===this.startTime_)return;let t=new Date().getTime()-this.startTime_;this.updateMarker_(t/1e3),t>1400&&this.stop(),this.stopped_||requestAnimationFrame(this.onTimer_)}onValueChange_(){this.refresh(),this.play()}}function po(t,e,i,s){let n=i-t,r=s-e;return Math.sqrt(n*n+r*r)}class pl{constructor(t,e){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.keyScale_=e.keyScale,this.value=e.value,this.sel_=rR(0),this.viewProps=e.viewProps,this.view=new pn(t,{selection:this.sel_,value:this.value,viewProps:this.viewProps}),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_),this.prevView_=new pa(t,{value:this.value,viewProps:this.viewProps}),this.prevView_.element.addEventListener("mousedown",t=>{t.stopImmediatePropagation(),t.preventDefault(),this.prevView_.play()}),this.view.previewElement.appendChild(this.prevView_.element);let i=new oK(this.view.element);i.emitter.on("down",this.onPointerDown_),i.emitter.on("move",this.onPointerMove_),i.emitter.on("up",this.onPointerUp_)}refresh(){this.view.refresh(),this.prevView_.refresh(),this.prevView_.play()}updateValue_(t,e,i){let s=this.sel_.rawValue,n=this.value.rawValue.toObject(),r=this.view.positionToValue(t.x,t.y),a=e?function(t,e,i,s){let n=po(t,e,i,s),r=Math.round(Math.atan2(s-e,i-t)/(Math.PI/4))*Math.PI/4;return{x:t+Math.cos(r)*n,y:e+Math.sin(r)*n}}(s,s,r.x,r.y):r;n[2*s]=a.x,n[2*s+1]=a.y,this.value.setRawValue(new h5(...n),i)}onPointerDown_(t){let e=t.data;if(!e.point)return;let i=this.value.rawValue,s=this.view.valueToPosition(i.x1,i.y1),n=po(e.point.x,e.point.y,s.x,s.y),r=this.view.valueToPosition(i.x2,i.y2),a=po(e.point.x,e.point.y,r.x,r.y);this.sel_.rawValue=n<=a?0:1,this.updateValue_(e.point,t.shiftKey,{forceEmit:!1,last:!1})}onPointerMove_(t){let e=t.data;e.point&&this.updateValue_(e.point,t.shiftKey,{forceEmit:!1,last:!1})}onPointerUp_(t){let e=t.data;e.point&&this.updateValue_(e.point,t.shiftKey,{forceEmit:!0,last:!0})}onKeyDown_(t){oI(t.key)&&t.preventDefault();let e=this.sel_.rawValue,i=this.value.rawValue.toObject(),s=this.keyScale_.rawValue;i[2*e]+=oz(s,oF(t)),i[2*e+1]+=oz(s,oB(t)),this.value.setRawValue(new h5(...i),{forceEmit:!1,last:!1})}onKeyUp_(t){oI(t.key)&&t.preventDefault();let e=this.keyScale_.rawValue,i=oz(e,oF(t)),s=oz(e,oB(t));(0!==i||0!==s)&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class ph{constructor(t,e){this.value=e.value,this.viewProps=e.viewProps,this.view=new pe(t,{viewProps:this.viewProps}),this.gc_=new pl(t,{keyScale:e.axis.textProps.value("keyScale"),value:this.value,viewProps:this.viewProps}),this.view.graphElement.appendChild(this.gc_.view.element);let i=Object.assign(Object.assign({},e.axis),{constraint:new rB({max:1,min:0})}),s=Object.assign(Object.assign({},e.axis),{constraint:void 0});this.tc_=new hm(t,{assembly:h3,axes:[i,s,i,s],parser:r2,value:this.value,viewProps:this.viewProps}),this.view.textElement.appendChild(this.tc_.view.element)}get allFocusableElements(){return[this.gc_.view.element,...this.tc_.view.textViews.map(t=>t.inputElement)]}refresh(){this.gc_.refresh()}}class pp{constructor(t,e){this.onButtonBlur_=this.onButtonBlur_.bind(this),this.onButtonClick_=this.onButtonClick_.bind(this),this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.value=e.value,this.viewProps=e.viewProps,this.foldable_=a1.create(e.expanded),this.view=new h7(t,{foldable:this.foldable_,pickerLayout:e.pickerLayout,viewProps:this.viewProps}),this.view.buttonElement.addEventListener("blur",this.onButtonBlur_),this.view.buttonElement.addEventListener("click",this.onButtonClick_),this.tc_=new oA(t,{parser:h9,props:rN.fromObject({formatter:h4}),value:this.value,viewProps:this.viewProps}),this.view.textElement.appendChild(this.tc_.view.element),this.popC_="popup"===e.pickerLayout?new oV(t,{viewProps:this.viewProps}):null;let i=new ph(t,{axis:e.axis,value:this.value,viewProps:this.viewProps});i.allFocusableElements.forEach(t=>{t.addEventListener("blur",this.onPopupChildBlur_),t.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=i,this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(this.pickerC_.view.element),ak(this.popC_.shows,t=>{t&&i.refresh()}),oN({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:t=>t,backward:(t,e)=>e})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),a5(this.foldable_,this.view.pickerElement))}onButtonBlur_(t){if(!this.popC_)return;let e=t.relatedTarget;e&&this.popC_.view.element.contains(e)||(this.popC_.shows.rawValue=!1)}onButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.allFocusableElements[0].focus()}onPopupChildBlur_(t){if(!this.popC_)return;let e=this.popC_.view.element,i=aE(t);!(i&&e.contains(i))&&(!i||i!==this.view.buttonElement||a_(e.ownerDocument))&&(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(t){this.popC_&&"Escape"===t.key&&(this.popC_.shows.rawValue=!1)}}const pd=a$({id:"cubicbezier",type:"blade",accept(t){let e=ac(t,t=>({value:t.required.array(t.required.number),view:t.required.constant("cubicbezier"),expanded:t.optional.boolean,label:t.optional.string,picker:t.optional.custom(t=>"inline"===t||"popup"===t?t:void 0)}));return e?{params:e}:null},controller(t){var e,i;let s=rR(new h5(...t.params.value),{constraint:new hu({assembly:h3,components:[0,1,2,3].map(t=>t%2==0?new rB({min:0,max:1}):void 0)}),equals:h5.equals}),n=new pp(t.document,{axis:{textProps:rN.fromObject({keyScale:.1,pointerScale:.01,formatter:r3(2)})},expanded:null!==(e=t.params.expanded)&&void 0!==e&&e,pickerLayout:null!==(i=t.params.picker)&&void 0!==i?i:"popup",value:s,viewProps:t.viewProps});return new aT(t.document,{blade:t.blade,props:rN.fromObject({label:t.params.label}),value:s,valueController:n})},api:t=>t.controller instanceof aT&&t.controller.valueController instanceof pp?new h2(t.controller):null});class pu extends an{get fps(){return this.controller.valueController.fps}get max(){return this.controller.valueController.props.get("max")}set max(t){this.controller.valueController.props.set("max",t)}get min(){return this.controller.valueController.props.get("min")}set min(t){this.controller.valueController.props.set("min",t)}begin(){this.controller.valueController.begin()}end(){this.controller.valueController.end()}on(t,e){let i=e.bind(this);return this.controller.valueController.ticker.emitter.on(t,()=>{i(new ar(this))}),this}}class pc{constructor(){this.start_=null,this.duration_=0,this.fps_=null,this.frameCount_=0,this.timestamps_=[]}get duration(){return this.duration_}get fps(){return this.fps_}begin(t){this.start_=t.getTime()}calculateFps_(t){if(0===this.timestamps_.length)return null;let e=this.timestamps_[0];return 1e3*(this.frameCount_-e.frameCount)/(t-e.time)}compactTimestamps_(){if(this.timestamps_.length<=20)return;let t=this.timestamps_.length-20;this.timestamps_.splice(0,t);let e=this.timestamps_[0].frameCount;this.timestamps_.forEach(t=>{t.frameCount-=e}),this.frameCount_-=e}end(t){if(null===this.start_)return;let e=t.getTime();this.duration_=e-this.start_,this.start_=null,this.fps_=this.calculateFps_(e),this.timestamps_.push({frameCount:this.frameCount_,time:e}),++this.frameCount_,this.compactTimestamps_()}}const pv=aM("fps");class pm{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(pv()),e.viewProps.bindClassModifiers(this.element),this.graphElement=t.createElement("div"),this.graphElement.classList.add(pv("g")),this.element.appendChild(this.graphElement);let i=t.createElement("div");i.classList.add(pv("l")),this.element.appendChild(i);let s=t.createElement("span");s.classList.add(pv("v")),s.textContent="--",i.appendChild(s),this.valueElement=s;let n=t.createElement("span");n.classList.add(pv("u")),n.textContent="FPS",i.appendChild(n)}}class pb{constructor(t,e){this.stopwatch_=new pc,this.onTick_=this.onTick_.bind(this),this.ticker=e.ticker,this.ticker.emitter.on("tick",this.onTick_),this.props=e.props,this.value_=e.value,this.viewProps=e.viewProps,this.view=new pm(t,{viewProps:this.viewProps}),this.graphC_=new hH(t,{formatter:r3(0),props:this.props,rows:e.rows,value:this.value_,viewProps:this.viewProps}),this.view.graphElement.appendChild(this.graphC_.view.element),this.viewProps.handleDispose(()=>{this.graphC_.viewProps.set("disposed",!0),this.ticker.dispose()})}get fps(){return this.stopwatch_.fps}begin(){this.stopwatch_.begin(new Date)}end(){this.stopwatch_.end(new Date)}onTick_(){let t=this.fps;if(null!==t){let e=this.value_.rawValue;this.value_.rawValue=function(t,e){let i=[...function(t){let e=t.indexOf(void 0);return e<0?t:t.slice(0,e)}(t),e];return i.length>t.length?i.splice(0,i.length-t.length):aR(i,t.length),i}(e,t),this.view.valueElement.textContent=t.toFixed(0)}}}class pg extends aj{constructor(t,e){let i=e.valueController,s=new aS(t,{blade:e.blade,props:e.labelProps,valueController:i});super({blade:e.blade,view:s.view,viewProps:i.viewProps}),this.valueController=i,this.labelController=s}}const pw=a$({id:"fpsgraph",type:"blade",accept(t){let e=ac(t,t=>({view:t.required.constant("fpsgraph"),interval:t.optional.number,label:t.optional.string,rows:t.optional.number,max:t.optional.number,min:t.optional.number}));return e?{params:e}:null},controller(t){var e,i,s,n,r;let a=null!==(e=t.params.interval)&&void 0!==e?e:500;return new pg(t.document,{blade:t.blade,labelProps:rN.fromObject({label:t.params.label}),valueController:new pb(t.document,{props:rN.fromObject({max:null!==(i=t.params.max)&&void 0!==i?i:90,min:null!==(s=t.params.min)&&void 0!==s?s:0}),rows:null!==(n=t.params.rows)&&void 0!==n?n:2,ticker:(r=t.document,0===a?new ov:new om(r,null!=a?a:hN.monitor.defaultInterval)),value:rR(function(t){let e=[];return aR(e,80),e}(0)),viewProps:t.viewProps})})},api:t=>t.controller instanceof pg?new pu(t.controller):null});class p_{constructor(t,e){this.min=t,this.max=e}static isObject(t){if("object"!=typeof t||null===t)return!1;let e=t.min,i=t.max;return"number"==typeof e&&"number"==typeof i}static equals(t,e){return t.min===e.min&&t.max===e.max}get length(){return this.max-this.min}toObject(){return{min:this.min,max:this.max}}}const pf={fromComponents:t=>new p_(t[0],t[1]),toComponents:t=>[t.min,t.max]};class px{constructor(t){this.edge=t}constrain(t){var e,i,s,n,r,a,o,l;if(t.min<=t.max)return new p_(null!==(i=null===(e=this.edge)||void 0===e?void 0:e.constrain(t.min))&&void 0!==i?i:t.min,null!==(n=null===(s=this.edge)||void 0===s?void 0:s.constrain(t.max))&&void 0!==n?n:t.max);let h=(t.min+t.max)/2;return new p_(null!==(a=null===(r=this.edge)||void 0===r?void 0:r.constrain(h))&&void 0!==a?a:h,null!==(l=null===(o=this.edge)||void 0===o?void 0:o.constrain(h))&&void 0!==l?l:h)}}const py=aM("rsltxt");class pC{constructor(t,e){this.sliderView_=e.sliderView,this.textView_=e.textView,this.element=t.createElement("div"),this.element.classList.add(py());let i=t.createElement("div");i.classList.add(py("s")),i.appendChild(this.sliderView_.element),this.element.appendChild(i);let s=t.createElement("div");s.classList.add(py("t")),s.appendChild(this.textView_.element),this.element.appendChild(s)}}const pP=aM("rsl");class pE{constructor(t,e){this.onSliderPropsChange_=this.onSliderPropsChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.sliderProps_=e.sliderProps,this.sliderProps_.emitter.on("change",this.onSliderPropsChange_),this.element=t.createElement("div"),this.element.classList.add(pP()),e.viewProps.bindClassModifiers(this.element),this.value_=e.value,this.value_.emitter.on("change",this.onValueChange_);let i=t.createElement("div");i.classList.add(pP("t")),this.element.appendChild(i),this.trackElement=i;let s=t.createElement("div");s.classList.add(pP("b")),i.appendChild(s),this.barElement=s;let n=["min","max"].map(e=>{let s=t.createElement("div");return s.classList.add(pP("k"),pP("k",e)),i.appendChild(s),s});this.knobElements=[n[0],n[1]],this.update_()}valueToX_(t){return 100*r9(r4(t,this.sliderProps_.get("min"),this.sliderProps_.get("max"),0,1),0,1)}update_(){let t=this.value_.rawValue;0===t.length?this.element.classList.add(pP(void 0,"zero")):this.element.classList.remove(pP(void 0,"zero"));let e=[this.valueToX_(t.min),this.valueToX_(t.max)];this.barElement.style.left=`${e[0]}%`,this.barElement.style.right=`${100-e[1]}%`,this.knobElements.forEach((t,i)=>{t.style.left=`${e[i]}%`})}onSliderPropsChange_(){this.update_()}onValueChange_(){this.update_()}}class pk{constructor(t,e){this.grabbing_=null,this.grabOffset_=0,this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.sliderProps=e.sliderProps,this.viewProps=e.viewProps,this.value=e.value,this.view=new pE(t,{sliderProps:this.sliderProps,value:this.value,viewProps:e.viewProps});let i=new oK(this.view.trackElement);i.emitter.on("down",this.onPointerDown_),i.emitter.on("move",this.onPointerMove_),i.emitter.on("up",this.onPointerUp_)}ofs_(){return"min"===this.grabbing_?this.view.knobElements[0].getBoundingClientRect().width/2:"max"===this.grabbing_?-this.view.knobElements[1].getBoundingClientRect().width/2:0}valueFromData_(t){return t.point?r4((t.point.x+this.ofs_())/t.bounds.width,0,1,this.sliderProps.get("min"),this.sliderProps.get("max")):null}onPointerDown_(t){if(!t.data.point)return;let e=t.data.point.x/t.data.bounds.width,i=this.value.rawValue,s=this.sliderProps.get("min"),n=this.sliderProps.get("max"),r=r4(i.min,s,n,0,1),a=r4(i.max,s,n,0,1);.025>=Math.abs(a-e)?this.grabbing_="max":.025>=Math.abs(r-e)?this.grabbing_="min":e>=r&&e<=a?(this.grabbing_="length",this.grabOffset_=r4(e-r,0,1,0,n-s)):e<r?(this.grabbing_="min",this.onPointerMove_(t)):e>a&&(this.grabbing_="max",this.onPointerMove_(t))}applyPointToValue_(t,e){let i=this.valueFromData_(t);if(null===i)return;let s=this.sliderProps.get("min"),n=this.sliderProps.get("max");if("min"===this.grabbing_)this.value.setRawValue(new p_(i,this.value.rawValue.max),e);else if("max"===this.grabbing_)this.value.setRawValue(new p_(this.value.rawValue.min,i),e);else if("length"===this.grabbing_){let t=this.value.rawValue.length,r=i-this.grabOffset_,a=r+t;r<s?(r=s,a=s+t):a>n&&(r=n-t,a=n),this.value.setRawValue(new p_(r,a),e)}}onPointerMove_(t){this.applyPointToValue_(t.data,{forceEmit:!1,last:!1})}onPointerUp_(t){this.applyPointToValue_(t.data,{forceEmit:!0,last:!0}),this.grabbing_=null}}class pV{constructor(t,e){this.value=e.value,this.viewProps=e.viewProps,this.sc_=new pk(t,e);let i={constraint:e.constraint,textProps:e.textProps};this.tc_=new hm(t,{assembly:pf,axes:[i,i],parser:e.parser,value:this.value,viewProps:e.viewProps}),this.view=new pC(t,{sliderView:this.sc_.view,textView:this.tc_.view})}get textController(){return this.tc_}}function pM(t){return p_.isObject(t)?new p_(t.min,t.max):new p_(0,0)}function pL(t,e){t.writeProperty("max",e.max),t.writeProperty("min",e.min)}const pA=a$({id:"input-interval",type:"input",accept:(t,e)=>{if(!p_.isObject(t))return null;let i=ac(e,t=>Object.assign(Object.assign({},ai(t)),{readonly:t.optional.constant(!1)}));return i?{initialValue:new p_(t.min,t.max),params:i}:null},binding:{reader:t=>pM,constraint:t=>(function(t){let e=[],i=at(t);i&&e.push(i);let s=r7(t);return s&&e.push(s),new px(new ob(e))})(t.params),equals:p_.equals,writer:t=>pL},controller(t){let e=t.value,i=t.constraint;if(!(i instanceof px))throw rA.shouldNeverHappen();let s=(e.rawValue.min+e.rawValue.max)/2,n=rN.fromObject(ae(t.params,s)),r=i.edge&&og(i.edge,rz);if(r)return new pV(t.document,{constraint:i.edge,parser:r2,sliderProps:new rN({keyScale:n.value("keyScale"),max:r.values.value("max"),min:r.values.value("min")}),textProps:n,value:e,viewProps:t.viewProps});let a={constraint:i.edge,textProps:n};return new hm(t.document,{assembly:pf,axes:[a,a],parser:r2,value:e,viewProps:t.viewProps})}});class pS{constructor(t){this.controller_=t}get disabled(){return this.controller_.viewProps.get("disabled")}set disabled(t){this.controller_.viewProps.set("disabled",t)}get title(){var t;return null!==(t=this.controller_.props.get("title"))&&void 0!==t?t:""}set title(t){this.controller_.props.set("title",t)}}class pD extends aa{constructor(t,e,i,s,n){super(t,s,n),this.cell=e,this.index=i}}class pO extends an{constructor(t){super(t),this.cellToApiMap_=new Map,this.controller.valueController.cellControllers.forEach(t=>{let e=new pS(t);this.cellToApiMap_.set(t,e)})}get value(){return this.controller.value}cell(t,e){let i=this.controller.valueController,s=i.cellControllers[e*i.size[0]+t];return this.cellToApiMap_.get(s)}on(t,e){let i=e.bind(this);this.controller.value.emitter.on(t,t=>{let e=this.controller.valueController,s=e.findCellByValue(t.rawValue);if(!s)return;let n=this.cellToApiMap_.get(s);if(!n)return;let r=e.cellControllers.indexOf(s);i(new pD(this,n,[r%e.size[0],Math.floor(r/e.size[0])],t.rawValue))})}}const pj=aM("rad");class pT{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(pj()),e.viewProps.bindClassModifiers(this.element);let i=t.createElement("label");i.classList.add(pj("l")),this.element.appendChild(i);let s=t.createElement("input");s.classList.add(pj("i")),s.name=e.name,s.type="radio",e.viewProps.bindDisabled(s),i.appendChild(s),this.inputElement=s;let n=t.createElement("div");n.classList.add(pj("b")),i.appendChild(n);let r=t.createElement("div");r.classList.add(pj("t")),n.appendChild(r),aV(e.props,"title",t=>{r.textContent=t})}}class pR{constructor(t,e){this.props=e.props,this.viewProps=e.viewProps,this.view=new pT(t,{name:e.name,props:this.props,viewProps:this.viewProps})}}class pN{constructor(t,e){this.cellCs_=[],this.cellValues_=[],this.onCellInputChange_=this.onCellInputChange_.bind(this),this.size=e.size;let[i,s]=this.size;for(let n=0;n<s;n++)for(let s=0;s<i;s++){let i=new pR(t,{name:e.groupName,props:rN.fromObject(Object.assign({},e.cellConfig(s,n))),viewProps:ot.create()});this.cellCs_.push(i),this.cellValues_.push(e.cellConfig(s,n).value)}this.value=e.value,ak(this.value,t=>{let e=this.findCellByValue(t);e&&(e.view.inputElement.checked=!0)}),this.viewProps=ot.create(),this.view=new o0(t,{viewProps:this.viewProps,viewName:"radgrid"}),this.view.element.style.gridTemplateColumns=`repeat(${i}, 1fr)`,this.cellCs_.forEach(t=>{t.view.inputElement.addEventListener("change",this.onCellInputChange_),this.view.element.appendChild(t.view.element)})}get cellControllers(){return this.cellCs_}findCellByValue(t){let e=this.cellValues_.findIndex(e=>e===t);return e<0?null:this.cellCs_[e]}onCellInputChange_(t){let e=t.currentTarget,i=this.cellCs_.findIndex(t=>t.view.inputElement===e);i<0||(this.value.rawValue=this.cellValues_[i])}}const pz=a$({id:"radiogrid",type:"blade",accept(t){let e=ac(t,t=>({cells:t.required.function,groupName:t.required.string,size:t.required.array(t.required.number),value:t.required.raw,view:t.required.constant("radiogrid"),label:t.optional.string}));return e?{params:e}:null},controller(t){let e=rR(t.params.value);return new aT(t.document,{blade:t.blade,props:rN.fromObject({label:t.params.label}),value:e,valueController:new pN(t.document,{groupName:t.params.groupName,cellConfig:t.params.cells,size:t.params.size,value:e})})},api:t=>t.controller instanceof aT&&t.controller.valueController instanceof pN?new pO(t.controller):null});function pB(t){return a$({id:"input-radiogrid",type:"input",accept(e,i){if(!t.isType(e))return null;let s=ac(i,t=>({cells:t.required.function,groupName:t.required.string,size:t.required.array(t.required.number),view:t.required.constant("radiogrid")}));return s?{initialValue:e,params:s}:null},binding:t.binding,controller:t=>new pN(t.document,{cellConfig:t.params.cells,groupName:t.params.groupName,size:t.params.size,value:t.value})})}const pF=pB({isType:t=>"number"==typeof t,binding:{reader:t=>r5,writer:t=>o4}}),pI=pB({isType:t=>"string"==typeof t,binding:{reader:t=>oT,writer:t=>o4}}),pU=pB({isType:t=>"boolean"==typeof t,binding:{reader:t=>oS,writer:t=>o4}}),pK="essentials",pq='.tp-cbzgv,.tp-radv_b,.tp-rslv_k,.tp-cbzv_b{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:rgba(0,0,0,0);border-width:0;font-family:inherit;font-size:inherit;font-weight:inherit;margin:0;outline:none;padding:0}.tp-radv_b,.tp-rslv_k,.tp-cbzv_b{background-color:var(--btn-bg);border-radius:var(--bld-br);color:var(--btn-fg);cursor:pointer;display:block;font-weight:bold;height:var(--cnt-usz);line-height:var(--cnt-usz);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.tp-radv_b:hover,.tp-rslv_k:hover,.tp-cbzv_b:hover{background-color:var(--btn-bg-h)}.tp-radv_b:focus,.tp-rslv_k:focus,.tp-cbzv_b:focus{background-color:var(--btn-bg-f)}.tp-radv_b:active,.tp-rslv_k:active,.tp-cbzv_b:active{background-color:var(--btn-bg-a)}.tp-radv_b:disabled,.tp-rslv_k:disabled,.tp-cbzv_b:disabled{opacity:.5}.tp-cbzgv{background-color:var(--in-bg);border-radius:var(--bld-br);box-sizing:border-box;color:var(--in-fg);font-family:inherit;height:var(--cnt-usz);line-height:var(--cnt-usz);min-width:0;width:100%}.tp-cbzgv:hover{background-color:var(--in-bg-h)}.tp-cbzgv:focus{background-color:var(--in-bg-f)}.tp-cbzgv:active{background-color:var(--in-bg-a)}.tp-cbzgv:disabled{opacity:.5}.tp-btngridv{border-radius:var(--bld-br);display:grid;overflow:hidden;gap:2px}.tp-btngridv.tp-v-disabled{opacity:.5}.tp-btngridv .tp-btnv_b:disabled{opacity:1}.tp-btngridv .tp-btnv_b:disabled .tp-btnv_t{opacity:.5}.tp-btngridv .tp-btnv_b{border-radius:0}.tp-cbzv{position:relative}.tp-cbzv_h{display:flex}.tp-cbzv_b{margin-right:4px;position:relative;width:var(--cnt-usz)}.tp-cbzv_b svg{display:block;height:16px;left:50%;margin-left:-8px;margin-top:-8px;position:absolute;top:50%;width:16px}.tp-cbzv_b svg path{stroke:var(--bs-bg);stroke-width:2}.tp-cbzv_t{flex:1}.tp-cbzv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-cbzv.tp-cbzv-expanded .tp-cbzv_p{margin-top:var(--cnt-usp);opacity:1}.tp-cbzv.tp-cbzv-cpl .tp-cbzv_p{overflow:visible}.tp-cbzv .tp-popv{left:calc(-1 * var(--cnt-hp));position:absolute;right:calc(-1 * var(--cnt-hp));top:var(--cnt-usz)}.tp-cbzpv_t{margin-top:var(--cnt-usp)}.tp-cbzgv{height:auto;overflow:hidden;position:relative}.tp-cbzgv.tp-v-disabled{opacity:.5}.tp-cbzgv_p{left:16px;position:absolute;right:16px;top:0}.tp-cbzgv_g{cursor:pointer;display:block;height:calc(var(--cnt-usz) * 5);width:100%}.tp-cbzgv_u{opacity:.1;stroke:var(--in-fg);stroke-dasharray:1}.tp-cbzgv_l{fill:rgba(0,0,0,0);stroke:var(--in-fg)}.tp-cbzgv_v{opacity:.5;stroke:var(--in-fg);stroke-dasharray:1}.tp-cbzgv_h{border:var(--in-fg) solid 1px;border-radius:50%;box-sizing:border-box;height:4px;margin-left:-2px;margin-top:-2px;pointer-events:none;position:absolute;width:4px}.tp-cbzgv:focus .tp-cbzgv_h-sel{background-color:var(--in-fg);border-width:0}.tp-cbzprvv{cursor:pointer;height:4px;padding:4px 0;position:relative}.tp-cbzprvv_g{display:block;height:100%;overflow:visible;width:100%}.tp-cbzprvv_t{opacity:.5;stroke:var(--mo-fg)}.tp-cbzprvv_m{background-color:var(--mo-fg);border-radius:50%;height:4px;margin-left:-2px;margin-top:-2px;opacity:0;position:absolute;top:50%;transition:opacity .2s ease-out;width:4px}.tp-cbzprvv_m.tp-cbzprvv_m-a{opacity:1}.tp-fpsv{position:relative}.tp-fpsv_l{bottom:4px;color:var(--mo-fg);line-height:1;right:4px;pointer-events:none;position:absolute}.tp-fpsv_u{margin-left:.2em;opacity:.7}.tp-rslv{cursor:pointer;padding-left:8px;padding-right:8px}.tp-rslv.tp-v-disabled{opacity:.5}.tp-rslv_t{height:calc(var(--cnt-usz));position:relative}.tp-rslv_t::before{background-color:var(--in-bg);border-radius:1px;content:"";height:2px;margin-top:-1px;position:absolute;top:50%;left:-4px;right:-4px}.tp-rslv_b{bottom:0;top:0;position:absolute}.tp-rslv_b::before{background-color:var(--in-fg);content:"";height:2px;margin-top:-1px;position:absolute;top:50%;left:0;right:0}.tp-rslv_k{height:calc(var(--cnt-usz) - 8px);margin-top:calc((var(--cnt-usz) - 8px)/-2);position:absolute;top:50%;width:8px}.tp-rslv_k.tp-rslv_k-min{margin-left:-8px}.tp-rslv_k.tp-rslv_k-max{margin-left:0}.tp-rslv.tp-rslv-zero .tp-rslv_k.tp-rslv_k-min{border-bottom-right-radius:0;border-top-right-radius:0}.tp-rslv.tp-rslv-zero .tp-rslv_k.tp-rslv_k-max{border-bottom-left-radius:0;border-top-left-radius:0}.tp-rsltxtv{display:flex}.tp-rsltxtv_s{flex:1}.tp-rsltxtv_t{flex:1;margin-left:4px}.tp-radv_l{display:block;position:relative}.tp-radv_i{left:0;opacity:0;position:absolute;top:0}.tp-radv_b{opacity:.5}.tp-radv_i:hover+.tp-radv_b{background-color:var(--btn-bg-h)}.tp-radv_i:focus+.tp-radv_b{background-color:var(--btn-bg-f)}.tp-radv_i:active+.tp-radv_b{background-color:var(--btn-bg-a)}.tp-radv_i:checked+.tp-radv_b{opacity:1}.tp-radv_t{bottom:0;color:inherit;left:0;overflow:hidden;position:absolute;right:0;text-align:center;text-overflow:ellipsis;top:0}.tp-radv_i:disabled+.tp-radv_b>.tp-radv_t{opacity:.5}.tp-radgridv{border-radius:var(--bld-br);display:grid;overflow:hidden;gap:2px}.tp-radgridv.tp-v-disabled{opacity:.5}.tp-radgridv .tp-radv_b{border-radius:0}',p$=[h1,pd,pw,pA,pz,pU,pF,pI];var pG=class{init(t){this.config=t,this.pane=new ry,this.pane.registerPlugin(rC),this.main=this.pane.addFolder({title:"Parameters",expanded:!0}),this.fpsGraph=this.main.addBlade({view:"fpsgraph",label:"fps",rows:2}),this.main.on("change",t=>{this.onChangeHandler&&this.onChangeHandler(this.config)}),this.addBindings()}onChange(t){this.onChangeHandler=t}addBindings(){this.main.addBinding(this.config,"speed",{min:-2,max:2,step:.1}),this.main.addBinding(this.config,"noiseForce",{min:-2,max:2,step:.1}),this.main.addBinding(this.config,"noiseScale",{min:.001,max:1})}tickStart(){this.fpsGraph.begin()}tickEnd(){this.fpsGraph.end()}},pH={speed:.2,noiseForce:.5,noiseScale:.3};(th=tp||(tp={}))[th.INIT=0]="INIT",th[th.READY=1]="READY";const pY=new class{constructor(){this.status=tp.INIT}async init(){this.renderer=new tn({dpr:3}),this.gl=this.renderer.gl,document.body.appendChild(this.gl.canvas),this.gl.clearColor(0,0,0,0),this.initCamera(),window.addEventListener("resize",this.onResize.bind(this),!1),this.onResize(),this.scene=new P,this.noiseTex=await this.createTexture(t(tc)),this.createSphere().setParent(this.scene),this.tweakPanel=new pG,this.tweakPanel.init(pH),this.updateConfigUniforms=this.updateConfigUniforms.bind(this),this.tweakPanel.onChange(this.updateConfigUniforms),this.status=tp.READY}updateConfigUniforms(){this.sphereShader&&(this.sphereShader.uniforms.speed.value=pH.speed,this.sphereShader.uniforms.noiseForce.value=pH.noiseForce,this.sphereShader.uniforms.noiseScale.value=pH.noiseScale)}initCamera(){this.camera=new M(this.gl,{fov:35}),this.camera.position.set(0,1,7),this.camera.lookAt([0,0,0]),this.orbitControls=new Y(this.camera,{element:this.gl.canvas,target:new w(0,0,0)})}onResize(){this.renderer.setSize(window.innerWidth,window.innerHeight),this.camera.perspective({aspect:this.gl.canvas.width/this.gl.canvas.height})}createSphereShader(){return new Z(this.gl,{vertex:t(td),fragment:t(tu),transparent:!0,uniforms:{uTime:{value:0},speed:{value:pH.speed},noiseForce:{value:pH.noiseForce},noiseScale:{value:pH.noiseScale},nTex:{value:this.noiseTex}}})}update(t){this.status!==tp.INIT&&this.sphereShader&&(this.tweakPanel.tickStart(),this.orbitControls.update(),this.renderer.render({scene:this.scene,camera:this.camera}),this.sphereShader.uniforms.uTime.value=.001*t,this.tweakPanel.tickEnd())}createTexture(t){let e=new tl(this.gl),i=new Image,s=new Promise(t=>{i.onload=()=>{e.image=i,t(e)}});return i.src=t,s}createSphere(){this.sphereShader||(this.sphereShader=this.createSphereShader());let t=Math.PI*(3-Math.sqrt(5)),e=[];for(let i=0;i<5e4;i++){let s=4e-5*i-1+2e-5,n=Math.sqrt(1-s*s),r=i*t;Math.sin(r)*n<0||e.push(Math.cos(r)*n,s,Math.sin(r)*n)}let i=new Float32Array(e.length);e.forEach((t,e)=>i[e]=t);let s=new O(this.gl,{position:{size:3,data:i}});return new N(this.gl,{mode:this.gl.POINTS,geometry:s,program:this.sphereShader})}};pY.init(),requestAnimationFrame(function t(e){requestAnimationFrame(t),pY.update(e)});
//# sourceMappingURL=index.3e3ed004.js.map
